cscope 15 $HOME/gapans_changes/of-controller/1.0/controller/ofproto/src/crm               0000320661
	@crm_attribute.c

22 
	~"üm_sy¡em_d•’d’c›s.h
"

23 
	~"üm_‹ÇÁ_­i.h
"

25 *
üm_©Œibu‹s_mempoŞ_g
;

27 
št32_t
 
	$üm_add_©Œibu‹
(
of_li¡_t
 *
©Œibu‹s_p
, 
üm_©Œibu‹_Çme_v®ue_·œ
* 
©Œibu‹_šfo_p
)

29 
üm_»sourû_©Œibu‹_’Œy
 *
©Œibu‹_’Œy_p
=
NULL
,*
©Œibu‹_’Œy_sÿn_p
=NULL;

30 
ušt8_t
 
h—p_b
 = 0;

31 
št32_t
 
»tv®
;

34 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "entered");

35 if(
©Œibu‹_šfo_p
 =ğ
NULL
)

36  
CRM_FAILURE
;

38 if(
©Œibu‹_šfo_p
->
Çme_¡ršg
 =ğ
NULL
)

39  
CRM_ERROR_ATTRIBUTE_NAME_NULL
;

41 if(
©Œibu‹_šfo_p
->
v®ue_¡ršg
 =ğ
NULL
)

42  
CRM_ERROR_ATTRIBUTE_VALUE_NULL
;

44 if(
	`¡¾’
(
©Œibu‹_šfo_p
->
Çme_¡ršg
è> 
CRM_MAX_ATTRIBUTE_NAME_LEN
)

45  
CRM_ERROR_INVALID_ATTRIBUTE_NAME_LEN
;

47 if(
	`¡¾’
(
©Œibu‹_šfo_p
->
v®ue_¡ršg
è> 
CRM_MAX_ATTRIBUTE_VALUE_LEN
)

48  
CRM_ERROR_INVALID_ATTRIBUTE_VALUE_LEN
;

50 
	`OF_LIST_SCAN
(*
©Œibu‹s_p
, 
©Œibu‹_’Œy_sÿn_p
, 
üm_»sourû_©Œibu‹_’Œy
*, 
CRM_RESOURCE_ATTRIBUTE_ENTRY_LISTNODE_OFFSET
 )

52 if(!
	`¡rcmp
(
©Œibu‹_’Œy_sÿn_p
->
Çme
, 
©Œibu‹_šfo_p
->
Çme_¡ršg
))

54 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Modifying‡ttribute value");

55 
	`¡rıy
(
©Œibu‹_’Œy_sÿn_p
->
v®ue
, 
©Œibu‹_šfo_p
->
v®ue_¡ršg
);

56  
CRM_SUCCESS
;

59 
»tv®
 = 
	`mempoŞ_g‘_mem_block
(
üm_©Œibu‹s_mempoŞ_g
,(
uch¬8_t
**)&
©Œibu‹_’Œy_p
,&
h—p_b
);

60 if(
»tv®
 !ğ
MEMPOOL_SUCCESS
)

61  
CRM_ERROR_NO_MEM
;

63 
©Œibu‹_’Œy_p
->
h—p_b
 = heap_b;

64 
	`¡rıy
(
©Œibu‹_’Œy_p
->
Çme
, 
©Œibu‹_šfo_p
->
Çme_¡ršg
);

65 
	`¡rıy
(
©Œibu‹_’Œy_p
->
v®ue
, 
©Œibu‹_šfo_p
->
v®ue_¡ršg
);

68 
	`OF_APPEND_NODE_TO_LIST
((*
©Œibu‹s_p
), 
©Œibu‹_’Œy_p
, 
CRM_RESOURCE_ATTRIBUTE_ENTRY_LISTNODE_OFFSET
);

69  
CRM_SUCCESS
;

70 
	}
}

72 
št32_t
 
	$üm_g‘_fœ¡_©Œibu‹
Ğ
of_li¡_t
 *
©Œibu‹s_p
,

73 
üm_©Œibu‹_Çme_v®ue_ouut_šfo
 *
©Œibu‹_ouut_p
)

75 
üm_»sourû_©Œibu‹_’Œy
 *
©Œibu‹_’Œy_p
=
NULL
;

76 
ušt8_t
 
’Œy_found_b
 = 0;

78 if(
©Œibu‹s_p
 =ğ
NULL
)

79  
CRM_ERROR_ATTRIBUTE_NAME_NULL
;

81 
	`OF_LIST_SCAN
(*
©Œibu‹s_p
, 
©Œibu‹_’Œy_p
, 
üm_»sourû_©Œibu‹_’Œy
*, 
CRM_RESOURCE_ATTRIBUTE_ENTRY_LISTNODE_OFFSET
 )

83 
’Œy_found_b
 = 1;

87 if(
’Œy_found_b
 == 0 )

88  
CRM_ERROR_ATTRIBUTE_NAME_NULL
;

90 if(
©Œibu‹_ouut_p
->
Çme_¡ršg
 =ğ
NULL
)

91  
CRM_ERROR_ATTRIBUTE_NAME_NULL
;

93 if(
	`¡¾’
(
©Œibu‹_’Œy_p
->
Çme
è> (
©Œibu‹_ouut_p
->
Çme_Ëngth
))

95 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Debug");

96 
©Œibu‹_ouut_p
->
Çme_Ëngth
 = 
	`¡¾’
(
©Œibu‹_’Œy_p
->
Çme
) +1;

97  
CRM_ERROR_INVALID_ATTRIBUTE_NAME_LEN
;

100 if(
©Œibu‹_ouut_p
->
v®ue_¡ršg
 =ğ
NULL
)

102 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Debug");

103  
CRM_ERROR_ATTRIBUTE_VALUE_NULL
;

105 if(
	`¡¾’
(
©Œibu‹_’Œy_p
->
v®ue
è> (
©Œibu‹_ouut_p
->
v®ue_Ëngth
))

107 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Debug");

108 
©Œibu‹_ouut_p
->
v®ue_Ëngth
 = 
	`¡¾’
(
©Œibu‹_’Œy_p
->
v®ue
) +1;

109  
CRM_ERROR_INVALID_ATTRIBUTE_VALUE_LEN
;

113 
	`¡rıy
(
©Œibu‹_ouut_p
->
Çme_¡ršg
, 
©Œibu‹_’Œy_p
->
Çme
);

114 
©Œibu‹_ouut_p
->
Çme_Ëngth
 = 
	`¡¾’
(
©Œibu‹_’Œy_p
->
Çme
) +1;

115 
	`¡rıy
(
©Œibu‹_ouut_p
->
v®ue_¡ršg
, 
©Œibu‹_’Œy_p
->
v®ue
);

116 
©Œibu‹_ouut_p
->
v®ue_Ëngth
 = 
	`¡¾’
(
©Œibu‹_’Œy_p
->
v®ue
) +1;

117  
CRM_SUCCESS
;

118 
	}
}

121 
št32_t
 
	$üm_g‘_Ãxt_©Œibu‹
(
of_li¡_t
 *
©Œibu‹s
,*
cu¼’t_©Œibu‹_Çme
,

122 
üm_©Œibu‹_Çme_v®ue_ouut_šfo
 *
©Œibu‹_ouut
)

124 
ušt8_t
 
cu¼’t_’Œy_found_b
 = 0;

125 
üm_»sourû_©Œibu‹_’Œy
 *
©Œibu‹_’Œy_p
;

126 
št32_t
 
»tv®
;

128 if((
©Œibu‹_ouut
 =ğ
NULL
è|| (
cu¼’t_©Œibu‹_Çme
 == NULL))

129  
CRM_FAILURE
;

131 if(
©Œibu‹_ouut
->
Çme_¡ršg
 =ğ
NULL
)

132  
CRM_ERROR_ATTRIBUTE_NAME_NULL
;

134 if(
©Œibu‹_ouut
->
v®ue_¡ršg
 =ğ
NULL
)

135  
CRM_ERROR_ATTRIBUTE_VALUE_NULL
;

137 
»tv®
 = 
CRM_ERROR_NO_MORE_ENTRIES
;

139 
	`OF_LIST_SCAN
(*
©Œibu‹s
,
©Œibu‹_’Œy_p
,
üm_»sourû_©Œibu‹_’Œy
*, 
CRM_RESOURCE_ATTRIBUTE_ENTRY_LISTNODE_OFFSET
 )

141 if(
cu¼’t_’Œy_found_b
 == 0)

143 if(!
	`¡rcmp
(
©Œibu‹_’Œy_p
->
Çme
,
cu¼’t_©Œibu‹_Çme
))

145 
cu¼’t_’Œy_found_b
 = 1;

154 if(
	`¡¾’
(
©Œibu‹_’Œy_p
->
Çme
è> (
©Œibu‹_ouut
->
Çme_Ëngth
))

156 
©Œibu‹_ouut
->
Çme_Ëngth
 = 
	`¡¾’
(
©Œibu‹_’Œy_p
->
Çme
) +1;

157 
»tv®
 = 
CRM_ERROR_INVALID_ATTRIBUTE_NAME_LEN
;

161 if(
	`¡¾’
(
©Œibu‹_’Œy_p
->
v®ue
è> (
©Œibu‹_ouut
->
v®ue_Ëngth
))

163 
©Œibu‹_ouut
->
v®ue_Ëngth
 = 
	`¡¾’
(
©Œibu‹_’Œy_p
->
v®ue
) +1;

164  
CRM_ERROR_INVALID_ATTRIBUTE_VALUE_LEN
;

166 
	`¡rıy
(
©Œibu‹_ouut
->
Çme_¡ršg
,
©Œibu‹_’Œy_p
->
Çme
);

167 
©Œibu‹_ouut
->
Çme_Ëngth
 = 
	`¡¾’
(
©Œibu‹_’Œy_p
->
Çme
) +1;

168 
	`¡rıy
(
©Œibu‹_ouut
->
v®ue_¡ršg
, 
©Œibu‹_’Œy_p
->
v®ue
);

169 
©Œibu‹_ouut
->
v®ue_Ëngth
 = 
	`¡¾’
(
©Œibu‹_’Œy_p
->
v®ue
) +1;

170 
»tv®
 = 
CRM_SUCCESS
;

174 if(
cu¼’t_’Œy_found_b
 == 0)

175 
»tv®
 = 
CRM_ERROR_INVALID_NAME
;

177  
»tv®
;

179 
	}
}

181 
št32_t
 
	$üm_g‘_exaù_©Œibu‹
(
of_li¡_t
 *
©Œibu‹s_p
,

182 *
©Œibu‹_Çme_¡ršg
,

183 
üm_©Œibu‹_Çme_v®ue_ouut_šfo
 *
©Œibu‹_ouut
)

185 
üm_»sourû_©Œibu‹_’Œy
 *
©Œibu‹_’Œy_sÿn_p
=
NULL
;

186 
uch¬8_t
 
l¡off£t
 = 
CRM_RESOURCE_ATTRIBUTE_ENTRY_LISTNODE_OFFSET
;

188 
	`OF_LIST_SCAN
(*
©Œibu‹s_p
, 
©Œibu‹_’Œy_sÿn_p
, 
üm_»sourû_©Œibu‹_’Œy
*, 
l¡off£t
 )

190 if(!
	`¡rcmp
(
©Œibu‹_’Œy_sÿn_p
->
Çme
, 
©Œibu‹_Çme_¡ršg
))

192 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ALL
, "attribute‚ame found ");

193 
	`¡rıy
(
©Œibu‹_ouut
->
Çme_¡ršg
,
©Œibu‹_’Œy_sÿn_p
->
Çme
);

194 
©Œibu‹_ouut
->
Çme_Ëngth
 = 
	`¡¾’
(
©Œibu‹_’Œy_sÿn_p
->
Çme
) +1;

195 
	`¡rıy
(
©Œibu‹_ouut
->
v®ue_¡ršg
, 
©Œibu‹_’Œy_sÿn_p
->
v®ue
);

196 
©Œibu‹_ouut
->
v®ue_Ëngth
 = 
	`¡¾’
(
©Œibu‹_’Œy_sÿn_p
->
v®ue
) +1;

197  
CRM_SUCCESS
;

200 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ALL
, "attribute‚ame‚ot found ");

201  
CRM_FAILURE
;

202 
	}
}

	@crm_port_api.c

29 
	~"üm_sy¡em_d•’d’c›s.h
"

30 
	~"üm_‹ÇÁ_­i.h
"

31 
	~"üm_vn_­i.h
"

32 
	~"üm_pÜt_­i.h
"

33 
	~"üm_vm_­i.h
"

34 
	~"pÜt_¡©us_mgr.h
"

35 
	~"¼m_üm_¹Ês_mgr.h
"

38 * 
üm_pÜt_mempoŞ_g
;

39 * 
üm_nÙifiÿtiÚs_mempoŞ_g
;

40 
ušt32_t
 
üm_no_of_pÜt_buck‘s_g
;

41 
mchash_bË
* 
üm_pÜt_bË_g
;

43 
of_li¡_t
 
üm_pÜt_nÙifiÿtiÚs
[
CRM_PORT_LAST_NOTIFICATION_TYPE
 + 1];

44 
d©aba£_v›w
 
	gpÜt_db_v›w
[
CRM_MAX_VIEW_DATABASE
];

51 
št32_t
 
	$üm_add_üm_nwpÜt
(
üm_nwpÜt_cÚfig_šfo
 *
nw_pÜt_šfo
, 
ušt64_t
 *
ouut_üm_pÜt_hªdË_p
)

53 
ušt64_t
 
sw™ch_hªdË
,
bridge_hªdË
;

54 
uch¬8_t
 
h—p_b
;

55 
uch¬8_t
* 
hashobj_p
 = 
NULL
;

56 
št32_t
 
¡©us_b
,
»t_v®
 = 
CRM_FAILURE
;

57 
ušt32_t
 
šdex
,
magic
,
­phookoff£t
,
hashkey
,
off£t
;

59 
üm_pÜt
* 
üm_pÜt_node_p
 = 
NULL
;

60 
üm_pÜt
* 
üm_pÜt_node_sÿn_p
 = 
NULL
;

61 
üm_pÜt_nÙifiÿtiÚ_d©a
 
nÙifiÿtiÚ_d©a
={};

62 
üm_nÙifiÿtiÚ_­p_hook_šfo
* 
­p_’Œy_p
=
NULL
;

63 
ušt32_t
 
sw™ch_
;

65 if((
nw_pÜt_šfo
->
pÜt_Çme
 =ğ
NULL
) ||

66 (
	`¡¾’
(
nw_pÜt_šfo
->
pÜt_Çme
è>ğ
CRM_MAX_PORT_NAME_LEN
) ||

67 (
nw_pÜt_šfo
->
sw™ch_Çme
 =ğ
NULL
) ||

68 (
nw_pÜt_šfo
->
br_Çme
 =ğ
NULL
))

70 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"crm‚etwork…ort input config info invalid.");

71  
CRM_FAILURE
;

74 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"nw_pÜt_šfo->pÜt_Çm = %s",
nw_pÜt_šfo
->
pÜt_Çme
);

75 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"nw_pÜt_šfo->sw™ch_Çmğ %s",
nw_pÜt_šfo
->
sw™ch_Çme
);

76 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"nw_pÜt_šfo->br_Çm = %s",
nw_pÜt_šfo
->
br_Çme
);

77 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"nw_pÜt_šfo->pÜt_ty³ = %d",
nw_pÜt_šfo
->
pÜt_ty³
);

78 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"nw_pÜt_šfo->nw_ty³ = %d",
nw_pÜt_šfo
->
nw_ty³
);

80 if(
nw_pÜt_šfo
->
nw_ty³
 =ğ
VXLAN_TYPE
)

82 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"£rviû_pÜˆğ %x",(
nw_pÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
vxÏn_šfo
.
£rviû_pÜt
);

83 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"»mÙe_ = %x",(
nw_pÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
vxÏn_šfo
.
»mÙe_
);

84 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"vn˜ = %x",(
nw_pÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
vxÏn_šfo
.
nid
);

86 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"»mÙe = %d",(
nw_pÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
vxÏn_šfo
.
»mÙe_
);

88 if((
nw_pÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
vxÏn_šfo
.
»mÙe_
 == 0)

89 
nw_pÜt_šfo
->
pÜt_ty³
 = 
NW_UNICAST_PORT
;

91 
nw_pÜt_šfo
->
pÜt_ty³
 = 
NW_BROADCAST_PORT
;

94 ià(
nw_pÜt_šfo
->
nw_ty³
 =ğ
NVGRE_TYPE
)

96 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"£rviû_pÜˆğ %x",(
nw_pÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
nvg»_šfo
.
£rviû_pÜt
);

97 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"»mÙe_ = %x",(
nw_pÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
nvg»_šfo
.
»mÙe_
);

98 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"nid = %x",(
nw_pÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
nvg»_šfo
.
nid
);

100 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"»mÙe = %d",(
nw_pÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
nvg»_šfo
.
»mÙe_
);

102 if((
nw_pÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
nvg»_šfo
.
»mÙe_
 == 0)

103 
nw_pÜt_šfo
->
pÜt_ty³
 = 
NW_UNICAST_PORT
;

105 
nw_pÜt_šfo
->
pÜt_ty³
 = 
NW_BROADCAST_PORT
;

109 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Invalid Network Type");

110  
CRM_FAILURE
;

113 
»t_v®
 = 
	`¼m_check_üm_nwpÜt_»sourû_»ÏtiÚshs
(
nw_pÜt_šfo
->
sw™ch_Çme
,nw_pÜt_šfo->
br_Çme
,

114 &
sw™ch_hªdË
,&
bridge_hªdË
,&
sw™ch_
);

115 if(
»t_v®
 !ğ
RRM_SUCCESS
)

117 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Incomplete Relationships");

118  
CRM_ERROR_INCOMPLETE_RESOURCE_RELATIONSHIPS
;

121 
	`CNTLR_RCU_READ_LOCK_TAKE
();

124 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
nw_pÜt_šfo
->
pÜt_Çme
, 
üm_no_of_pÜt_buck‘s_g
);

125 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "hashkey:%d\r\n",
hashkey
);

126 
off£t
 = 
CRM_PORT_NODE_PORT_TBL_OFFSET
;

128 
	`MCHASH_BUCKET_SCAN
(
üm_pÜt_bË_g
, 
hashkey
, 
üm_pÜt_node_sÿn_p
, 
üm_pÜt
*, 
off£t
)

130 if(
	`¡rcmp
(
nw_pÜt_šfo
->
pÜt_Çme
, 
üm_pÜt_node_sÿn_p
->port_name) != 0)

132 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"du¶iÿ‹ crm…ÜˆÇm%s", 
nw_pÜt_šfo
->
pÜt_Çme
);

133 
»t_v®
 = 
CRM_ERROR_DUPLICATE_CRM_PORT_RESOURCE
;

137 
»t_v®
 = 
	`mempoŞ_g‘_mem_block
(
üm_pÜt_mempoŞ_g
, (
uch¬8_t
 **)&
üm_pÜt_node_p
, &
h—p_b
);

138 if(
»t_v®
 !ğ
MEMPOOL_SUCCESS
)

140 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"failedo‡llocate memory block forhe crm…ort‚ode.");

141 
»t_v®
 = 
CRM_FAILURE
;

144 
üm_pÜt_node_p
->
h—p_b
 = heap_b;

147 
	`¡rıy
(
üm_pÜt_node_p
->
pÜt_Çme
, 
nw_pÜt_šfo
->port_name);

148 
	`¡rıy
(
üm_pÜt_node_p
->
sw™ch_Çme
, 
nw_pÜt_šfo
->switch_name);

149 
	`¡rıy
(
üm_pÜt_node_p
->
br1_Çme
, 
nw_pÜt_šfo
->
br_Çme
);

151 
üm_pÜt_node_p
->
sw™ch_hªdË
 = switch_handle;

152 
üm_pÜt_node_p
->
üm_pÜt_ty³
 = 
nw_pÜt_šfo
->
pÜt_ty³
;

153 
üm_pÜt_node_p
->
sy¡em_br_§ã»f
 = 
bridge_hªdË
;

154 
üm_pÜt_node_p
->
nw_ty³
 = 
nw_pÜt_šfo
->nw_type;

155 
üm_pÜt_node_p
->
sw™ch_
 = switch_ip;

157 if(
nw_pÜt_šfo
->
nw_ty³
 =ğ
VXLAN_TYPE
)

159 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"nw_type is VXLAN");

160 (
üm_pÜt_node_p
->
nw_·¿ms
).
vxÏn_nw
.
nid
 = (
nw_pÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
vxÏn_šfo
.nid;

161 
üm_pÜt_node_p
->
nw_·¿ms
.
vxÏn_nw
.
£rviû_pÜt
 = (
nw_pÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
vxÏn_šfo
.service_port;

162 
üm_pÜt_node_p
->
nw_·¿ms
.
vxÏn_nw
.
»mÙe_
 = (
nw_pÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
vxÏn_šfo
.remote_ip;

164 if(
nw_pÜt_šfo
->
nw_ty³
 =ğ
NVGRE_TYPE
)

166 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"nw_type is NVGRE");

167 (
üm_pÜt_node_p
->
nw_·¿ms
).
nvg»_nw
.
nid
 = (
nw_pÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
nvg»_šfo
.nid;

168 
üm_pÜt_node_p
->
nw_·¿ms
.
nvg»_nw
.
£rviû_pÜt
 = (
nw_pÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
nvg»_šfo
.service_port;

169 
üm_pÜt_node_p
->
nw_·¿ms
.
nvg»_nw
.
»mÙe_
 = (
nw_pÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
nvg»_šfo
.remote_ip;

171 if(
nw_pÜt_šfo
->
nw_ty³
 =ğ
VLAN_TYPE
)

173 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"portype is vlan");

174 
üm_pÜt_node_p
->
nw_·¿ms
.
vÏn_nw
.
vÏn_id
 = (
nw_pÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
vÏn_šfo
.vlan_id;

177 
üm_pÜt_node_p
->
pÜt_¡©us
 = 
SYSTEM_PORT_NOT_READY
;

178 
üm_pÜt_node_p
->
pÜt_id
 = 0;

182 
»t_v®
 = 
CRM_SUCCESS
;

184 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Appending crm /network…ort‚ode");

186 
hashobj_p
 = (
uch¬8_t
 *)
üm_pÜt_node_p
 + 
CRM_PORT_NODE_PORT_TBL_OFFSET
;

187 
	`MCHASH_APPEND_NODE
(
üm_pÜt_bË_g
, 
hashkey
, 
üm_pÜt_node_p
, 
šdex
, 
magic
, 
hashobj_p
, 
¡©us_b
);

188 if(
¡©us_b
 =ğ
FALSE
)

190 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"çedØ­³nd crm…Üˆ‚odtØhashabË\r\n", 
__FUNCTION__
, 
__LINE__
);

191 
»t_v®
 = 
CRM_FAILURE
;

194 *
ouut_üm_pÜt_hªdË_p
 = 
magic
;

195 *
ouut_üm_pÜt_hªdË_p
 = (((*ouut_üm_pÜt_hªdË_pè<<32)|(
šdex
));

197 
üm_pÜt_node_p
->
magic
 = magic;

198 
üm_pÜt_node_p
->
šdex
 = index;

199 
üm_pÜt_node_p
->
üm_pÜt_hªdË
 = *
ouut_üm_pÜt_hªdË_p
;

200 
	`OF_LIST_INIT
(
üm_pÜt_node_p
->
©Œibu‹s
,
üm_©Œibu‹s_ä“_©Œibu‹_’Œy_rcu
);

202 
­phookoff£t
 = 
CRM_NOTIFICATION_APP_HOOK_OFFSET
;

205 
nÙifiÿtiÚ_d©a
.
Ãw_pÜt_id
 = 
üm_pÜt_node_p
->
pÜt_id
;

206 
nÙifiÿtiÚ_d©a
.
üm_pÜt_ty³
 = 
üm_pÜt_node_p
->crm_port_type;

207 
nÙifiÿtiÚ_d©a
.
üm_pÜt_¡©us
 = 
üm_pÜt_node_p
->
pÜt_¡©us
;

208 
	`¡ºıy
(
nÙifiÿtiÚ_d©a
.
pÜt_Çme
 , 
üm_pÜt_node_p
->pÜt_Çme, 
CRM_MAX_PORT_NAME_LEN
);

209 
nÙifiÿtiÚ_d©a
.
üm_pÜt_hªdË
 = 
üm_pÜt_node_p
->
magic
;

210 
nÙifiÿtiÚ_d©a
.
üm_pÜt_hªdË
 = (ÒÙifiÿtiÚ_d©a.üm_pÜt_hªdË<<32)|(
üm_pÜt_node_p
->
šdex
));

211 
nÙifiÿtiÚ_d©a
.
dp_hªdË
 = 
üm_pÜt_node_p
->
sy¡em_br_§ã»f
;

212 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
swÇme
 , 
üm_pÜt_node_p
->
sw™ch_Çme
);

213 
nÙifiÿtiÚ_d©a
.
sw™ch_hªdË
 = 
üm_pÜt_node_p
->switch_handle;

215 
nÙifiÿtiÚ_d©a
.
nw_ty³
 = 
üm_pÜt_node_p
->nw_type;

217 if(
nÙifiÿtiÚ_d©a
.
nw_ty³
 =ğ
VXLAN_TYPE
)

219 
nÙifiÿtiÚ_d©a
.
nw_·¿ms
.
vxÏn_nw
.
£rviû_pÜt
 = 
üm_pÜt_node_p
->nw_params.vxlan_nw.service_port;

220 
nÙifiÿtiÚ_d©a
.
nw_·¿ms
.
vxÏn_nw
.
»mÙe_
 = 
üm_pÜt_node_p
->nw_params.vxlan_nw.remote_ip;

221 
nÙifiÿtiÚ_d©a
.
nw_·¿ms
.
vxÏn_nw
.
nid
 = 
üm_pÜt_node_p
->nw_params.vxlan_nw.nid;

223 if(
nÙifiÿtiÚ_d©a
.
nw_ty³
 =ğ
NVGRE_TYPE
)

225 
nÙifiÿtiÚ_d©a
.
nw_·¿ms
.
nvg»_nw
.
£rviû_pÜt
 = 
üm_pÜt_node_p
->nw_params.nvgre_nw.service_port;

226 
nÙifiÿtiÚ_d©a
.
nw_·¿ms
.
nvg»_nw
.
»mÙe_
 = 
üm_pÜt_node_p
->nw_params.nvgre_nw.remote_ip;

227 
nÙifiÿtiÚ_d©a
.
nw_·¿ms
.
nvg»_nw
.
nid
 = 
üm_pÜt_node_p
->nw_params.nvgre_nw.nid;

230 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "sending‚otifications");

231 
	`OF_LIST_SCAN
(
üm_pÜt_nÙifiÿtiÚs
[
CRM_PORT_STATUS
], 
­p_’Œy_p
, 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *, 
­phookoff£t
 )

233 ((
üm_pÜt_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_PORT_STATUS
,

234 
nÙifiÿtiÚ_d©a
.
üm_pÜt_hªdË
,

235 
nÙifiÿtiÚ_d©a
,

236 
­p_’Œy_p
->
cbk_¬g1
,

237 
­p_’Œy_p
->
cbk_¬g2


240 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"nw…ort‡dded ");

243 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

244 if(
»t_v®
 !ğ
CRM_SUCCESS
)

246 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "failedo‡dd crm…ortohe .");

248 if(
üm_pÜt_node_p
)

249 
	`mempoŞ_»Ëa£_mem_block
(
üm_pÜt_mempoŞ_g
,(
uch¬8_t
*)
üm_pÜt_node_p
, crm_pÜt_node_p->
h—p_b
);

250  
CRM_FAILURE
;

252 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm‚wport‡ddition successful");

253  
CRM_SUCCESS
;

254 
	}
}

256 
št32_t
 
	$üm_g‘_fœ¡_nw_üm_pÜt
(* 
pÜt_Çme
,

257 
üm_nwpÜt_cÚfig_šfo
 *
üm_nwpÜt_šfo
)

259 
üm_pÜt
 *
üm_pÜt_node_p
=
NULL
;

260 
ušt32_t
 
hashkey
;

261 
uch¬8_t
 
off£t
;

263 if(
üm_pÜt_bË_g
 =ğ
NULL
)

265 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "no memory…ool created for crm…orts");

266  
CRM_FAILURE
;

269 
	`CNTLR_RCU_READ_LOCK_TAKE
();

271 
off£t
 = 
CRM_PORT_NODE_PORT_TBL_OFFSET
;

272 
	`MCHASH_TABLE_SCAN
(
üm_pÜt_bË_g
,
hashkey
)

274 
	`MCHASH_BUCKET_SCAN
(
üm_pÜt_bË_g
,
hashkey
, 
üm_pÜt_node_p
,
üm_pÜt
 *,
off£t
)

276 if((
üm_pÜt_node_p
->
üm_pÜt_ty³
==
NW_UNICAST_PORT
)||(üm_pÜt_node_p->üm_pÜt_ty³==
NW_BROADCAST_PORT
))

279 
	`¡rıy
(
üm_nwpÜt_šfo
->
pÜt_Çme
, 
üm_pÜt_node_p
->port_name);

280 
	`¡rıy
(
pÜt_Çme
, 
üm_pÜt_node_p
->port_name);

281 
üm_nwpÜt_šfo
->
pÜt_ty³
ğ
üm_pÜt_node_p
->
üm_pÜt_ty³
;

282 
üm_nwpÜt_šfo
->
pÜtId
ğ
üm_pÜt_node_p
->
pÜt_id
;

283 
üm_nwpÜt_šfo
->
nw_ty³
ğ
üm_pÜt_node_p
->nw_type;

284 
	`¡rıy
(
üm_nwpÜt_šfo
->
sw™ch_Çme
, 
üm_pÜt_node_p
->switch_name);

285 
	`¡rıy
(
üm_nwpÜt_šfo
->
br_Çme
, 
üm_pÜt_node_p
->
br1_Çme
);

287 if(
üm_nwpÜt_šfo
->
nw_ty³
 =ğ
VLAN_TYPE
)

289 (
üm_nwpÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
vÏn_šfo
.
vÏn_id
 = (
üm_pÜt_node_p
->
nw_·¿ms
).
vÏn_nw
.vlan_id;

291 if(
üm_nwpÜt_šfo
->
nw_ty³
 =ğ
VXLAN_TYPE
)

293 (
üm_nwpÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
vxÏn_šfo
.
£rviû_pÜt
 = (
üm_pÜt_node_p
->
nw_·¿ms
).
vxÏn_nw
.service_port;

294 (
üm_nwpÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
vxÏn_šfo
.
»mÙe_
ğ(
üm_pÜt_node_p
->
nw_·¿ms
).
vxÏn_nw
.remote_ip;

295 (
üm_nwpÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
vxÏn_šfo
.
nid
ğ(
üm_pÜt_node_p
->
nw_·¿ms
).
vxÏn_nw
.nid;

297 if(
üm_nwpÜt_šfo
->
nw_ty³
 =ğ
NVGRE_TYPE
)

299 (
üm_nwpÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
nvg»_šfo
.
£rviû_pÜt
 = (
üm_pÜt_node_p
->
nw_·¿ms
).
nvg»_nw
.service_port;

300 (
üm_nwpÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
nvg»_šfo
.
»mÙe_
ğ(
üm_pÜt_node_p
->
nw_·¿ms
).
nvg»_nw
.remote_ip;

301 (
üm_nwpÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
nvg»_šfo
.
nid
ğ(
üm_pÜt_node_p
->
nw_·¿ms
).
nvg»_nw
.nid;

304 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "pÜt_Çme:%s,pÜt_ty³:%d,br_Çme:%s,sw™ch_Çme:%s,pÜtId:%d,vÏn_id:%d,vxid:%d,£rviûpÜt:%d,»mÙe:%x",
üm_pÜt_node_p
->
pÜt_Çme
,üm_pÜt_node_p->
üm_pÜt_ty³
,üm_pÜt_node_p->
br1_Çme
,üm_pÜt_node_p->
sw™ch_Çme
,üm_pÜt_node_p->
pÜt_id
,(
üm_nwpÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
vÏn_šfo
.
vÏn_id
,(üm_nwpÜt_šfo->nw_pÜt_cÚfig_šfo).
vxÏn_šfo
.
nid
,(üm_nwpÜt_šfo->nw_pÜt_cÚfig_šfo).vxÏn_šfo.
£rviû_pÜt
,(üm_nwpÜt_šfo->nw_pÜt_cÚfig_šfo).vxÏn_šfo.
»mÙe_
);

306 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

307  
CRM_SUCCESS
;

312 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

313  
CRM_ERROR_NO_MORE_ENTRIES
;

314 
	}
}

316 
št32_t
 
	$üm_g‘_Ãxt_nw_üm_pÜt
(* 
pÜt_Çme
,

317 
üm_nwpÜt_cÚfig_šfo
 *
üm_nwpÜt_šfo
)

319 
üm_pÜt
 *
üm_pÜt_node_p
=
NULL
;

320 
ušt32_t
 
hashkey
;

321 
uch¬8_t
 
off£t
;

322 
ušt8_t
 
cu¼’t_’Œy_found_b
=
FALSE
;

325 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "entered");

326 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "pÜt_Çme:%s",
pÜt_Çme
);

328 if(
üm_pÜt_bË_g
 =ğ
NULL
)

330 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "no memory…ool created for crm…orts");

331  
CRM_FAILURE
;

334 if((
pÜt_Çme
==
NULL
))

336 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "names‡re NULL\n");

337  
CRM_FAILURE
;

340 
	`CNTLR_RCU_READ_LOCK_TAKE
();

341 
	`MCHASH_TABLE_SCAN
(
üm_pÜt_bË_g
,
hashkey
)

343 
off£t
 = 
CRM_PORT_NODE_PORT_TBL_OFFSET
;

344 
	`MCHASH_BUCKET_SCAN
(
üm_pÜt_bË_g
,
hashkey
, 
üm_pÜt_node_p
, 
üm_pÜt
 *,
off£t
)

346 if(
cu¼’t_’Œy_found_b
 =ğ
FALSE
)

348 if(
	`¡rcmp
(
pÜt_Çme
,
üm_pÜt_node_p
->port_name)!=0)

352 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "portƒntry found .search for‚ext‚w…ort.");

353 
cu¼’t_’Œy_found_b
 = 
TRUE
;

357 if((
üm_pÜt_node_p
->
üm_pÜt_ty³
==
NW_UNICAST_PORT
)||(üm_pÜt_node_p->üm_pÜt_ty³==
NW_BROADCAST_PORT
))

360 
	`¡rıy
(
üm_nwpÜt_šfo
->
pÜt_Çme
, 
üm_pÜt_node_p
->port_name);

361 
	`¡rıy
(
pÜt_Çme
, 
üm_pÜt_node_p
->port_name);

362 
üm_nwpÜt_šfo
->
pÜt_ty³
ğ
üm_pÜt_node_p
->
üm_pÜt_ty³
;

363 
üm_nwpÜt_šfo
->
pÜtId
ğ
üm_pÜt_node_p
->
pÜt_id
;

364 
üm_nwpÜt_šfo
->
nw_ty³
ğ
üm_pÜt_node_p
->nw_type;

365 
	`¡rıy
(
üm_nwpÜt_šfo
->
br_Çme
, 
üm_pÜt_node_p
->
br1_Çme
);

366 
	`¡rıy
(
üm_nwpÜt_šfo
->
sw™ch_Çme
, 
üm_pÜt_node_p
->switch_name);

368 if(
üm_nwpÜt_šfo
->
nw_ty³
 =ğ
VLAN_TYPE
)

370 (
üm_nwpÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
vÏn_šfo
.
vÏn_id
 = (
üm_pÜt_node_p
->
nw_·¿ms
).
vÏn_nw
.vlan_id;

372 if(
üm_nwpÜt_šfo
->
nw_ty³
 =ğ
VXLAN_TYPE
)

374 (
üm_nwpÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
vxÏn_šfo
.
£rviû_pÜt
 = (
üm_pÜt_node_p
->
nw_·¿ms
).
vxÏn_nw
.service_port;

375 (
üm_nwpÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
vxÏn_šfo
.
»mÙe_
ğ(
üm_pÜt_node_p
->
nw_·¿ms
).
vxÏn_nw
.remote_ip;

376 (
üm_nwpÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
vxÏn_šfo
.
nid
ğ(
üm_pÜt_node_p
->
nw_·¿ms
).
vxÏn_nw
.nid;

378 if(
üm_nwpÜt_šfo
->
nw_ty³
 =ğ
NVGRE_TYPE
)

380 (
üm_nwpÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
nvg»_šfo
.
£rviû_pÜt
 = (
üm_pÜt_node_p
->
nw_·¿ms
).
nvg»_nw
.service_port;

381 (
üm_nwpÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
nvg»_šfo
.
»mÙe_
ğ(
üm_pÜt_node_p
->
nw_·¿ms
).
nvg»_nw
.remote_ip;

382 (
üm_nwpÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
nvg»_šfo
.
nid
ğ(
üm_pÜt_node_p
->
nw_·¿ms
).
nvg»_nw
.nid;

385 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "pÜt_Çme:%s,pÜt_ty³:%d,br_Çme:%s,sw™ch_Çme:%s,pÜtId:%d,vÏn_id:%d,vxid:%d,£rviûpÜt:%d,»mÙe:%x",
üm_pÜt_node_p
->
pÜt_Çme
,üm_pÜt_node_p->
üm_pÜt_ty³
,üm_pÜt_node_p->
br1_Çme
,üm_pÜt_node_p->
sw™ch_Çme
,üm_pÜt_node_p->
pÜt_id
,(
üm_nwpÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
vÏn_šfo
.
vÏn_id
,(üm_nwpÜt_šfo->nw_pÜt_cÚfig_šfo).
vxÏn_šfo
.
nid
,(üm_nwpÜt_šfo->nw_pÜt_cÚfig_šfo).vxÏn_šfo.
£rviû_pÜt
,(üm_nwpÜt_šfo->nw_pÜt_cÚfig_šfo).vxÏn_šfo.
»mÙe_
);

388 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

389  
CRM_SUCCESS
;

394 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

395  
CRM_ERROR_NO_MORE_ENTRIES
;

396 
	}
}

398 
št32_t
 
	$üm_g‘_exaù_nwpÜt
(
ušt64_t
 
hªdË
,

399 
üm_nwpÜt_cÚfig_šfo
 *
üm_nwpÜt_šfo_p
)

401 
ušt32_t
 
šdex
,
magic
;

402 
üm_pÜt
 *
üm_pÜt_node_p
;

403 
ušt8_t
 
¡©us_b
;

405 
magic
 = (
ušt32_t
)(
hªdË
 >>32);

406 
šdex
 = (
ušt32_t
)
hªdË
;

408 
	`CNTLR_RCU_READ_LOCK_TAKE
();

410 
	`MCHASH_ACCESS_NODE
(
üm_pÜt_bË_g
,
šdex
,
magic
,
üm_pÜt_node_p
,
¡©us_b
);

411 if(
TRUE
 =ğ
¡©us_b
)

413 if((
üm_pÜt_node_p
->
üm_pÜt_ty³
==
NW_UNICAST_PORT
)||(üm_pÜt_node_p->üm_pÜt_ty³==
NW_BROADCAST_PORT
))

416 
	`¡rıy
(
üm_nwpÜt_šfo_p
->
pÜt_Çme
, 
üm_pÜt_node_p
->port_name);

417 
üm_nwpÜt_šfo_p
->
pÜt_ty³
ğ
üm_pÜt_node_p
->
üm_pÜt_ty³
;

418 
üm_nwpÜt_šfo_p
->
pÜtId
ğ
üm_pÜt_node_p
->
pÜt_id
;

419 
üm_nwpÜt_šfo_p
->
nw_ty³
ğ
üm_pÜt_node_p
->nw_type;

420 
	`¡rıy
(
üm_nwpÜt_šfo_p
->
br_Çme
, 
üm_pÜt_node_p
->
br1_Çme
);

421 if(
üm_nwpÜt_šfo_p
->
nw_ty³
 =ğ
VLAN_TYPE
)

423 (
üm_nwpÜt_šfo_p
->
nw_pÜt_cÚfig_šfo
).
vÏn_šfo
.
vÏn_id
 = (
üm_pÜt_node_p
->
nw_·¿ms
).
vÏn_nw
.vlan_id;

425 if(
üm_nwpÜt_šfo_p
->
nw_ty³
 =ğ
VXLAN_TYPE
)

427 (
üm_nwpÜt_šfo_p
->
nw_pÜt_cÚfig_šfo
).
vxÏn_šfo
.
£rviû_pÜt
 = (
üm_pÜt_node_p
->
nw_·¿ms
).
vxÏn_nw
.service_port;

428 (
üm_nwpÜt_šfo_p
->
nw_pÜt_cÚfig_šfo
).
vxÏn_šfo
.
»mÙe_
ğ(
üm_pÜt_node_p
->
nw_·¿ms
).
vxÏn_nw
.remote_ip;

429 (
üm_nwpÜt_šfo_p
->
nw_pÜt_cÚfig_šfo
).
vxÏn_šfo
.
nid
ğ(
üm_pÜt_node_p
->
nw_·¿ms
).
vxÏn_nw
.nid;

431 if(
üm_nwpÜt_šfo_p
->
nw_ty³
 =ğ
NVGRE_TYPE
)

433 (
üm_nwpÜt_šfo_p
->
nw_pÜt_cÚfig_šfo
).
nvg»_šfo
.
£rviû_pÜt
 = (
üm_pÜt_node_p
->
nw_·¿ms
).
nvg»_nw
.service_port;

434 (
üm_nwpÜt_šfo_p
->
nw_pÜt_cÚfig_šfo
).
nvg»_šfo
.
»mÙe_
ğ(
üm_pÜt_node_p
->
nw_·¿ms
).
nvg»_nw
.remote_ip;

435 (
üm_nwpÜt_šfo_p
->
nw_pÜt_cÚfig_šfo
).
nvg»_šfo
.
nid
ğ(
üm_pÜt_node_p
->
nw_·¿ms
).
nvg»_nw
.nid;

439 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "pÜt_Çme:%s,pÜt_ty³:%d,br_Çme:%s,sw™ch_Çme:%s,pÜtId:%d",
üm_pÜt_node_p
->
pÜt_Çme
,üm_pÜt_node_p->
üm_pÜt_ty³
,üm_pÜt_node_p->
br1_Çme
,üm_pÜt_node_p->
sw™ch_Çme
,üm_pÜt_node_p->
pÜt_id
);

441 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

442  
CRM_SUCCESS
;

446 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

447  
CRM_ERROR_INVALID_SWITCH_HANDLE
;

448 
	}
}

450 
št32_t
 
	$üm_d–_üm_nwpÜt
(* 
nwpÜt_Çme_p
)

452 
št32_t
 
»t_v®
;

453 
št32_t
 
nwpÜt_node_found
=0;

454 
ušt32_t
 
off£t
, 
hashkey
,
magic
,
šdex
;

455 
ušt8_t
 
¡©us_b
;

456 
üm_pÜt
 *
üm_nwpÜt_sÿn_p
=
NULL
;

457 
üm_pÜt_nÙifiÿtiÚ_d©a
 
nÙifiÿtiÚ_d©a
={};

458 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *
­p_’Œy_p
=
NULL
;

460 
ušt32_t
 
­phookoff£t
 = 0;

462 if(
nwpÜt_Çme_p
 =ğ
NULL
)

463  
CRM_ERROR_NWPORT_NAME_NULL
;

465 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "nwpÜt_Çme_°%s",
nwpÜt_Çme_p
);

467 if(
»t_v®
 !ğ
RRM_SUCCESS
)

469 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Incomplete Relationships");

470  
CRM_ERROR_INCOMPLETE_RESOURCE_RELATIONSHIPS
;

476 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
nwpÜt_Çme_p
, 
üm_no_of_pÜt_buck‘s_g
);

477 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "hashkey:%d\r\n",
hashkey
);

479 
off£t
 = 
CRM_PORT_NODE_PORT_TBL_OFFSET
;

481 
	`CNTLR_RCU_READ_LOCK_TAKE
();

482 
	`MCHASH_BUCKET_SCAN
(
üm_pÜt_bË_g
, 
hashkey
, 
üm_nwpÜt_sÿn_p
, 
üm_pÜt
*, 
off£t
)

484 if(!
	`¡rcmp
(
nwpÜt_Çme_p
, 
üm_nwpÜt_sÿn_p
->
pÜt_Çme
))

486 if((
üm_nwpÜt_sÿn_p
->
üm_pÜt_ty³
 !ğ
NW_UNICAST_PORT
)&&

487 (
üm_nwpÜt_sÿn_p
->
üm_pÜt_ty³
 !ğ
NW_BROADCAST_PORT
))

489 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm‚etwork…ortype is‚ot unicast or broadcast");

490 
»t_v®
 = 
CRM_FAILURE
;

494 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm‚etwork…ort foundo delete");

495 
nwpÜt_node_found
 = 1;

496 
magic
 = (
üm_nwpÜt_sÿn_p
->magic);

497 
šdex
 = (
üm_nwpÜt_sÿn_p
->index);

501 if(
nwpÜt_node_found
 == 0)

503 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "network…ort‚ode‚ot foundo delete");

504 
»t_v®
ğ
CRM_FAILURE
;

510 
	`¡ºıy
(
nÙifiÿtiÚ_d©a
.
pÜt_Çme
 , 
üm_nwpÜt_sÿn_p
->pÜt_Çme, 
CRM_MAX_PORT_NAME_LEN
);

512 
nÙifiÿtiÚ_d©a
.
Ãw_pÜt_id
 = 
üm_nwpÜt_sÿn_p
->
pÜt_id
;

513 
nÙifiÿtiÚ_d©a
.
üm_pÜt_ty³
 = 
üm_nwpÜt_sÿn_p
->crm_port_type;

514 
nÙifiÿtiÚ_d©a
.
üm_pÜt_¡©us
 = 
üm_nwpÜt_sÿn_p
->
pÜt_¡©us
;

515 
nÙifiÿtiÚ_d©a
.
üm_pÜt_hªdË
 = 
magic
;

516 
nÙifiÿtiÚ_d©a
.
üm_pÜt_hªdË
 = (ÒÙifiÿtiÚ_d©a.üm_pÜt_hªdË<<32)|(
šdex
));

517 
nÙifiÿtiÚ_d©a
.
dp_hªdË
 = 
üm_nwpÜt_sÿn_p
->
sy¡em_br_§ã»f
;

519 
	`OF_LIST_SCAN
(
üm_pÜt_nÙifiÿtiÚs
[
CRM_PORT_DELETE
], 
­p_’Œy_p
, 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *, 
­phookoff£t
 )

521 ((
üm_pÜt_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_PORT_DELETE
,

522 
nÙifiÿtiÚ_d©a
.
üm_pÜt_hªdË
,

523 
nÙifiÿtiÚ_d©a
,

524 
­p_’Œy_p
->
cbk_¬g1
,

525 
­p_’Œy_p
->
cbk_¬g2
);

528 
	`OF_LIST_SCAN
(
üm_pÜt_nÙifiÿtiÚs
[
CRM_VN_ALL_NOTIFICATIONS
], 
­p_’Œy_p
, 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *, 
­phookoff£t
 )

530 ((
üm_pÜt_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_PORT_DELETE
,

531 
nÙifiÿtiÚ_d©a
.
üm_pÜt_hªdË
,

532 
nÙifiÿtiÚ_d©a
,

533 
­p_’Œy_p
->
cbk_¬g1
,

534 
­p_’Œy_p
->
cbk_¬g2
);

539 
¡©us_b
 = 
FALSE
;

540 
off£t
 = 
CRM_PORT_NODE_PORT_TBL_OFFSET
;

542 
	`MCHASH_DELETE_NODE_BY_REF
(
üm_pÜt_bË_g
,
šdex
,
magic
,
üm_pÜt
*, 
off£t
, 
¡©us_b
);

543 if(
¡©us_b
 =ğ
TRUE
)

544 
»t_v®
 = 
CRM_SUCCESS
;

546 
»t_v®
 = 
CRM_FAILURE
;

550 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

551  
»t_v®
;

552 
	}
}

554 
št32_t
 
	$üm_add_gue¡_üm_vmpÜt
(
ušt8_t
* 
mac_p
,
ušt32_t
 
addr
,

555 
ušt64_t
* 
ouut_üm_pÜt_hªdË_p
)

557 
ušt8_t
 
pÜt_ty³
 = 
VM_GUEST_PORT
;

558 
pÜt_Çme
[16];

559 
üm_pÜt
* 
üm_pÜt_node_p
;

560 
üm_pÜt
* 
üm_pÜt_node_sÿn_p
=
NULL
;

561 
ušt8_t
 
h—p_b
;

563 
uch¬8_t
* 
hashobj_p
 = 
NULL
;

564 
št32_t
 
¡©us_b
,
»t_v®
=
CRM_SUCCESS
;

565 
ušt32_t
 
šdex
,
magic
,
hashkey
,
off£t
;

567 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"generate‡‚ew guest…ort‚ame");

569 
	`¡rıy
(
pÜt_Çme
,"guestport");

571 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"gue¡…ÜˆÇmğ%s",
pÜt_Çme
);

574 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
pÜt_Çme
, 
üm_no_of_pÜt_buck‘s_g
);

575 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "hashkey:%d\r\n",
hashkey
);

577 
off£t
 = 
CRM_PORT_NODE_PORT_TBL_OFFSET
;

579 
	`CNTLR_RCU_READ_LOCK_TAKE
();

583 
	`MCHASH_BUCKET_SCAN
(
üm_pÜt_bË_g
, 
hashkey
, 
üm_pÜt_node_sÿn_p
, 
üm_pÜt
*, 
off£t
)

585 if(
	`¡rcmp
(
pÜt_Çme
, 
üm_pÜt_node_sÿn_p
->port_name) != 0)

587 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"du¶iÿ‹ crm…ÜˆÇm%s", 
pÜt_Çme
);

588 
»t_v®
 = 
CRM_ERROR_DUPLICATE_CRM_PORT_RESOURCE
;

593 
»t_v®
 = 
	`mempoŞ_g‘_mem_block
(
üm_pÜt_mempoŞ_g
, (
uch¬8_t
 **)&
üm_pÜt_node_p
, &
h—p_b
);

594 if(
»t_v®
 !ğ
MEMPOOL_SUCCESS
)

596 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"failedo‡llocate memory block forhe crm…ort‚ode.");

597 
»t_v®
 = 
CRM_FAILURE
;

600 
üm_pÜt_node_p
->
h—p_b
 = heap_b;

603 
	`¡rıy
(
üm_pÜt_node_p
->
pÜt_Çme
,…ort_name);

604 
üm_pÜt_node_p
->
üm_pÜt_ty³
 = 
pÜt_ty³
;

605 
üm_pÜt_node_p
->
sw™ch_
 = 
addr
;

606 
	`memıy
(
üm_pÜt_node_p
->
vmInfo
.
vm_pÜt_mac
, 
mac_p
,6);

609 
hashobj_p
 = (
uch¬8_t
 *)
üm_pÜt_node_p
 + 
CRM_PORT_NODE_PORT_TBL_OFFSET
;

610 
	`MCHASH_APPEND_NODE
(
üm_pÜt_bË_g
, 
hashkey
, 
üm_pÜt_node_p
, 
šdex
, 
magic
, 
hashobj_p
, 
¡©us_b
);

611 if(
FALSE
 =ğ
¡©us_b
)

613 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"çedØ­³nd crm…Üˆ‚odtØhashabË\r\n", 
__FUNCTION__
, 
__LINE__
);

614 
»t_v®
 = 
CRM_FAILURE
;

617 *
ouut_üm_pÜt_hªdË_p
 = 
magic
;

618 *
ouut_üm_pÜt_hªdË_p
 = (((*ouut_üm_pÜt_hªdË_pè<<32)|(
šdex
));

620 
üm_pÜt_node_p
->
magic
 = magic;

621 
üm_pÜt_node_p
->
šdex
 = index;

622 
üm_pÜt_node_p
->
üm_pÜt_hªdË
 = *
ouut_üm_pÜt_hªdË_p
;

625 if(
»t_v®
 !ğ
CRM_SUCCESS
)

627 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "çedØadd VM_GUEST_PORTØth.üm_pÜt_node_p%x",
üm_pÜt_node_p
);

629 if(
üm_pÜt_node_p
)

630 
	`mempoŞ_»Ëa£_mem_block
(
üm_pÜt_mempoŞ_g
,(
uch¬8_t
*)
üm_pÜt_node_p
, crm_pÜt_node_p->
h—p_b
);

632 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

634  
CRM_FAILURE
;

636 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm vm…ort‡ddition successfull");

637 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

639  
CRM_SUCCESS
;

640 
	}
}

645 
št32_t
 
	$üm_add_üm_vmpÜt
(* 
pÜt_Çme
,

646 * 
sw™ch_Çme
,

647 * 
br_Çme
,

648 
št32_t
 
pÜt_ty³
,

649 * 
vn_Çme
,

650 * 
vm_Çme
,

651 
ušt8_t
* 
vm_pÜt_mac_p
,

652 
ušt64_t
* 
ouut_üm_pÜt_hªdË_p
)

654 
ušt64_t
 
sw™ch_hªdË
,
vn_hªdË
,
vm_hªdË
,
logiÿl_sw™ch_hªdË
;

655 
uch¬8_t
 
h—p_b
;

656 
uch¬8_t
* 
hashobj_p
 = 
NULL
;

657 
št32_t
 
¡©us_b
,
»t_v®
=
CRM_FAILURE
;

658 
ušt32_t
 
šdex
,
magic
,
­phookoff£t
,
hashkey
,
off£t
;

660 
üm_pÜt
 *
üm_pÜt_node_p
 = 
NULL
, *
üm_pÜt_node_sÿn_p
 = NULL;

661 
üm_pÜt_nÙifiÿtiÚ_d©a
 
nÙifiÿtiÚ_d©a
 = {};

662 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *
­p_’Œy_p
 = 
NULL
;

664 
ušt32_t
 
sw™ch_
;

665 
ušt8_t
 
nw_ty³
,
pÜt_¡©us
 = 0;

667 if((
pÜt_Çme
 =ğ
NULL
è|| (
	`¡¾’
ÕÜt_Çme)>ğ
CRM_MAX_PORT_NAME_LEN
)||

668 (
vn_Çme
 =ğ
NULL
è|| (
sw™ch_Çme
 =ğNULLè|| (
br_Çme
 == NULL))

670 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Invalid input…arameters for crm…ort‡dd");

671  
CRM_FAILURE
;

674 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"pÜt_Çm = %s",
pÜt_Çme
);

675 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"sw™ch_Çmğ%s",
sw™ch_Çme
);

676 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"br_Çm = %s",
br_Çme
);

677 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"pÜt_ty³ = %d",
pÜt_ty³
);

678 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"vn_Çm = %s",
vn_Çme
);

679 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"vm_Çm = %s",
vm_Çme
);

680 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"pÜt_maø = %x",
vm_pÜt_mac_p
[5]);

684 if(!((
pÜt_ty³
 =ğ
VMNS_PORT
)||ÕÜt_ty³ =ğ
VM_PORT
)))

686 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
, "Invalid CRM Port Type");

687 
»t_v®
 = 
CRM_FAILURE
;

691 
»t_v®
 = 
	`¼m_check_ümpÜt_»sourû_»ÏtiÚshs
(
sw™ch_Çme
,
br_Çme
,

692 
vn_Çme
, 
vm_Çme
,

693 &
sw™ch_hªdË
,&
logiÿl_sw™ch_hªdË
,

694 &
vn_hªdË
,&
vm_hªdË
,

695 &
sw™ch_
,&
nw_ty³
);

696 if(
»t_v®
 !ğ
RRM_SUCCESS
)

698 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Incomplete Relationships");

699 
»t_v®
ğ
CRM_ERROR_INCOMPLETE_RESOURCE_RELATIONSHIPS
;

703 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
pÜt_Çme
, 
üm_no_of_pÜt_buck‘s_g
);

704 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "hashkey = %d",
hashkey
);

706 
off£t
 = 
CRM_PORT_NODE_PORT_TBL_OFFSET
;

709 
	`MCHASH_BUCKET_SCAN
(
üm_pÜt_bË_g
, 
hashkey
, 
üm_pÜt_node_sÿn_p
, 
üm_pÜt
*, 
off£t
)

711 if(
	`¡rcmp
(
pÜt_Çme
, 
üm_pÜt_node_sÿn_p
->port_name) != 0)

714 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Du¶iÿ‹ crm…ÜˆÇm%s", 
pÜt_Çme
);

715 
»t_v®
 = 
CRM_ERROR_DUPLICATE_CRM_PORT_RESOURCE
;

720 
»t_v®
 = 
	`mempoŞ_g‘_mem_block
(
üm_pÜt_mempoŞ_g
, (
uch¬8_t
 **)&
üm_pÜt_node_p
, &
h—p_b
);

721 if(
»t_v®
 !ğ
MEMPOOL_SUCCESS
)

723 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"failedo‡llocate memory block forhe crm…ort‚ode.");

724 
»t_v®
 = 
CRM_FAILURE
;

728 
üm_pÜt_node_p
->
h—p_b
 = heap_b;

731 
	`¡rıy
(
üm_pÜt_node_p
->
vn_Çme
,vn_name);

732 
	`¡rıy
(
üm_pÜt_node_p
->
br1_Çme
,
br_Çme
);

733 
	`¡rıy
(
üm_pÜt_node_p
->
pÜt_Çme
,port_name);

734 
	`¡rıy
(
üm_pÜt_node_p
->
sw™ch_Çme
,switch_name);

735 
	`¡rıy
(
üm_pÜt_node_p
->
vmInfo
.
vm_Çme
,vm_name);

737 
üm_pÜt_node_p
->
üm_pÜt_ty³
 = 
pÜt_ty³
;

738 
üm_pÜt_node_p
->
sw™ch_hªdË
 = switch_handle;

739 
üm_pÜt_node_p
->
§ã»f_vn
 = 
vn_hªdË
;

740 
üm_pÜt_node_p
->
sy¡em_br_§ã»f
 = 
logiÿl_sw™ch_hªdË
;

741 
üm_pÜt_node_p
->
vmInfo
.
§ã»f_vm
 = 
vm_hªdË
;

742 
üm_pÜt_node_p
->
sw™ch_
 = switch_ip;

743 
üm_pÜt_node_p
->
nw_ty³
 =‚w_type;

745 
	`memıy
(
üm_pÜt_node_p
->
vmInfo
.
vm_pÜt_mac
, 
vm_pÜt_mac_p
, (crm_port_node_p->vmInfo.vm_port_mac));

747 
pÜt_¡©us
 = 
SYSTEM_PORT_NOT_READY
;

748 if(
pÜt_¡©us
 =ğ
SYSTEM_PORT_NOT_READY
)

750 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Before‡ppending‚odeo hashable");

752 
üm_pÜt_node_p
->
pÜt_id
 = 0;

755 
hashobj_p
 = (
uch¬8_t
 *)
üm_pÜt_node_p
 + 
CRM_PORT_NODE_PORT_TBL_OFFSET
;

756 
	`MCHASH_APPEND_NODE
(
üm_pÜt_bË_g
, 
hashkey
, 
üm_pÜt_node_p
, 
šdex
, 
magic
, 
hashobj_p
, 
¡©us_b
);

757 if(
FALSE
 =ğ
¡©us_b
)

759 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"çedØ­³nd crm…Üˆ‚odtØhashabË\r\n", 
__FUNCTION__
, 
__LINE__
);

760 
»t_v®
 = 
CRM_FAILURE
;

763 *
ouut_üm_pÜt_hªdË_p
 = 
magic
;

764 *
ouut_üm_pÜt_hªdË_p
 = (((*ouut_üm_pÜt_hªdË_pè<<32)|(
šdex
));

765 
üm_pÜt_node_p
->
magic
 = magic;

766 
üm_pÜt_node_p
->
šdex
 = index;

767 
üm_pÜt_node_p
->
üm_pÜt_hªdË
 = *
ouut_üm_pÜt_hªdË_p
;

769 
	`OF_LIST_INIT
(
üm_pÜt_node_p
->
©Œibu‹s
,
üm_©Œibu‹s_ä“_©Œibu‹_’Œy_rcu
);

770 
»t_v®
 = 
	`¼m_£tup_üm_vmpÜt_»sourû_»ÏtiÚshs
(
pÜt_Çme
,
üm_pÜt_node_p
->
üm_pÜt_hªdË
,

771 
üm_pÜt_node_p
->
üm_pÜt_ty³
,

772 
vm_Çme
,
vn_Çme
,

773 
sw™ch_Çme
,
br_Çme
);

774 if(
»t_v®
 !ğ
RRM_SUCCESS
)

776 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Resource Relationship Manager„eturnedƒrror");

781 
­phookoff£t
 = 
CRM_NOTIFICATION_APP_HOOK_OFFSET
;

783 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
vn_Çme
,vn_name);

784 
nÙifiÿtiÚ_d©a
.
Ãw_pÜt_id
 = 
üm_pÜt_node_p
->
pÜt_id
;

785 
nÙifiÿtiÚ_d©a
.
üm_pÜt_ty³
 = 
üm_pÜt_node_p
->crm_port_type;

786 
nÙifiÿtiÚ_d©a
.
üm_pÜt_¡©us
 = 
üm_pÜt_node_p
->
pÜt_¡©us
;

787 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
pÜt_Çme
 , 
üm_pÜt_node_p
->port_name);

788 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
swÇme
 , 
üm_pÜt_node_p
->
sw™ch_Çme
);

789 
nÙifiÿtiÚ_d©a
.
üm_pÜt_hªdË
 = 
üm_pÜt_node_p
->
magic
;

790 
nÙifiÿtiÚ_d©a
.
üm_pÜt_hªdË
 = (ÒÙifiÿtiÚ_d©a.üm_pÜt_hªdË<<32)|(
üm_pÜt_node_p
->
šdex
));

791 
nÙifiÿtiÚ_d©a
.
üm_vn_hªdË
 = 
üm_pÜt_node_p
->
§ã»f_vn
;

792 
nÙifiÿtiÚ_d©a
.
dp_hªdË
 = 
üm_pÜt_node_p
->
sy¡em_br_§ã»f
;

793 
nÙifiÿtiÚ_d©a
.
üm_vm_hªdË
 = 
üm_pÜt_node_p
->
vmInfo
.
§ã»f_vm
;

796 
	`OF_LIST_SCAN
(
üm_pÜt_nÙifiÿtiÚs
[
CRM_PORT_STATUS
], 
­p_’Œy_p
, 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *, 
­phookoff£t
)

798 ((
üm_pÜt_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_PORT_STATUS
,

799 
nÙifiÿtiÚ_d©a
.
üm_pÜt_hªdË
,

800 
nÙifiÿtiÚ_d©a
,

801 
­p_’Œy_p
->
cbk_¬g1
,

802 
­p_’Œy_p
->
cbk_¬g2
);

806 if(
»t_v®
 !ğ
CRM_SUCCESS
)

808 if(
üm_pÜt_node_p
)

809 
	`mempoŞ_»Ëa£_mem_block
(
üm_pÜt_mempoŞ_g
,(
uch¬8_t
*)
üm_pÜt_node_p
, crm_pÜt_node_p->
h—p_b
);

811 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

812  
CRM_FAILURE
;

815 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "CRM VM Port Addition Successful");

816 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

818  
CRM_SUCCESS
;

819 
	}
}

821 
št32_t
 
	$üm_g‘_fœ¡_üm_vmpÜt
(* 
vn_Çme
, * 
sw™ch_Çme
,

822 * 
logiÿl_sw™ch_Çme
, * 
pÜt_Çme
,

823 
üm_pÜt_cÚfig_šfo
 *
üm_pÜt_šfo
)

825 
üm_pÜt
 *
üm_pÜt_node_p
=
NULL
;

826 
ušt32_t
 
hashkey
;

827 
uch¬8_t
 
off£t
;

829 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "vn_Çme:%s,sw™ch_Çme:%s",
vn_Çme
,
sw™ch_Çme
);

831 if(
üm_pÜt_bË_g
 =ğ
NULL
)

833 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "no memory…ool created for crm…orts");

834  
CRM_FAILURE
;

837 if((
vn_Çme
==
NULL
)|| (
sw™ch_Çme
 == NULL))

839 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "names‡re NULL\n");

840  
CRM_FAILURE
;

843 
	`CNTLR_RCU_READ_LOCK_TAKE
();

844 
off£t
 = 
CRM_PORT_NODE_PORT_TBL_OFFSET
;

845 
	`MCHASH_TABLE_SCAN
(
üm_pÜt_bË_g
,
hashkey
)

847 
	`MCHASH_BUCKET_SCAN
(
üm_pÜt_bË_g
,
hashkey
, 
üm_pÜt_node_p
,
üm_pÜt
 *,
off£t
)

849 if((
üm_pÜt_node_p
->
üm_pÜt_ty³
==
VM_PORT
)||(üm_pÜt_node_p->üm_pÜt_ty³==
VMNS_PORT
))

851 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "entered");

852 if((!
	`¡rcmp
(
vn_Çme
,
üm_pÜt_node_p
->vn_Çme))&&(!¡rcmp(
sw™ch_Çme
,crm_port_node_p->switch_name)))

854 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "entered");

855 
	`¡rıy
(
üm_pÜt_šfo
->
pÜt_Çme
, 
üm_pÜt_node_p
->port_name);

856 
	`¡rıy
(
pÜt_Çme
, 
üm_pÜt_node_p
->port_name);

857 
üm_pÜt_šfo
->
pÜt_ty³
ğ
üm_pÜt_node_p
->
üm_pÜt_ty³
;

858 
üm_pÜt_šfo
->
pÜtId
ğ
üm_pÜt_node_p
->
pÜt_id
;

859 
	`¡rıy
(
üm_pÜt_šfo
->
vm_Çme
, 
üm_pÜt_node_p
->
vmInfo
.vm_name);

860 
	`memıy
(
üm_pÜt_šfo
->
vm_pÜt_mac_p
, 
üm_pÜt_node_p
->
vmInfo
.
vm_pÜt_mac
, (crm_port_node_p->vmInfo.vm_port_mac));

861 
	`¡rıy
(
üm_pÜt_šfo
->
br_Çme
, 
üm_pÜt_node_p
->
br1_Çme
);

862 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "pÜt_Çme:%s,pÜt_ty³:%d,vm_Çme:%s,max:%s,br_Çme:%s",
üm_pÜt_node_p
->
pÜt_Çme
,üm_pÜt_node_p->
üm_pÜt_ty³
,üm_pÜt_node_p->
vmInfo
.
vm_Çme
,üm_pÜt_node_p->vmInfo.
vm_pÜt_mac
,üm_pÜt_node_p->
br1_Çme
);

864 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

865  
CRM_SUCCESS
;

870 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

871  
CRM_ERROR_NO_MORE_ENTRIES
;

872 
	}
}

874 
št32_t
 
	$üm_g‘_Ãxt_üm_vmpÜt
(* 
vn_Çme
, * 
sw™ch_Çme
,

875 * 
logiÿl_sw™ch_Çme
, * 
pÜt_Çme
,

876 
üm_pÜt_cÚfig_šfo
 *
üm_pÜt_šfo
)

878 
üm_pÜt
 *
üm_pÜt_node_p
=
NULL
;

879 
ušt32_t
 
hashkey
;

880 
uch¬8_t
 
off£t
;

881 
ušt8_t
 
cu¼’t_’Œy_found_b
=
FALSE
;

883 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "vn_Çme:%s,sw™ch_Çme:%s,logiÿl_sw™ch_Çme:%s,pÜt_Çme:%s",
vn_Çme
,
sw™ch_Çme
,
logiÿl_sw™ch_Çme
,
pÜt_Çme
);

885 if(
üm_pÜt_bË_g
 =ğ
NULL
)

887 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "no memory…ool created for crm…orts");

888  
CRM_FAILURE
;

891 if((
vn_Çme
==
NULL
è|| (
sw™ch_Çme
 =ğNULLè|| (
logiÿl_sw™ch_Çme
 == NULL))

893 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "names‡re NULL\n");

894  
CRM_FAILURE
;

897 
	`CNTLR_RCU_READ_LOCK_TAKE
();

898 
	`MCHASH_TABLE_SCAN
(
üm_pÜt_bË_g
,
hashkey
)

900 
off£t
 = 
CRM_PORT_NODE_PORT_TBL_OFFSET
;

901 
	`MCHASH_BUCKET_SCAN
(
üm_pÜt_bË_g
,
hashkey
, 
üm_pÜt_node_p
, 
üm_pÜt
 *,
off£t
)

903 if(
cu¼’t_’Œy_found_b
 =ğ
FALSE
)

905 if(
	`¡rcmp
(
pÜt_Çme
,
üm_pÜt_node_p
->port_name)!=0)

909 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "portƒntry found .search for‚ext vmorvmns…ort.");

910 
cu¼’t_’Œy_found_b
 = 
TRUE
;

914 if((
üm_pÜt_node_p
->
üm_pÜt_ty³
==
VM_PORT
)||((üm_pÜt_node_p->üm_pÜt_ty³==
VMNS_PORT
)))

916 if((!
	`¡rcmp
(
vn_Çme
,
üm_pÜt_node_p
->vn_Çme))&&(!¡rcmp(
sw™ch_Çme
,crm_port_node_p->switch_name)))

918 
	`¡rıy
(
üm_pÜt_šfo
->
pÜt_Çme
, 
üm_pÜt_node_p
->port_name);

919 
üm_pÜt_šfo
->
pÜt_ty³
ğ
üm_pÜt_node_p
->
üm_pÜt_ty³
;

920 
üm_pÜt_šfo
->
pÜtId
ğ
üm_pÜt_node_p
->
pÜt_id
;

921 
	`¡rıy
(
üm_pÜt_šfo
->
vm_Çme
, 
üm_pÜt_node_p
->
vmInfo
.vm_name);

922 
	`memıy
(
üm_pÜt_šfo
->
vm_pÜt_mac_p
, 
üm_pÜt_node_p
->
vmInfo
.
vm_pÜt_mac
, (crm_port_node_p->vmInfo.vm_port_mac));

923 
	`¡rıy
(
üm_pÜt_šfo
->
br_Çme
, 
üm_pÜt_node_p
->
br1_Çme
);

924 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "pÜt_Çme:%s,pÜt_ty³:%d,vm_Çme:%s,max:%s,br_Çme:%s",
üm_pÜt_node_p
->
pÜt_Çme
,üm_pÜt_node_p->
üm_pÜt_ty³
,üm_pÜt_node_p->
vmInfo
.
vm_Çme
,üm_pÜt_node_p->vmInfo.
vm_pÜt_mac
,üm_pÜt_node_p->
br1_Çme
);

927 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

928  
CRM_SUCCESS
;

933 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

934  
CRM_ERROR_NO_MORE_ENTRIES
;

935 
	}
}

937 
št32_t
 
	$üm_g‘_exaù_üm_vmpÜt
(* 
vn_Çme
, * 
sw™ch_Çme
,

938 * 
logiÿl_sw™ch_Çme
, * 
pÜt_Çme
,

939 
üm_pÜt_cÚfig_šfo
 *
üm_pÜt_šfo
)

942 
ušt64_t
 
vn_hªdË
;

943 
št32_t
 
»t_v®
 = 
CRM_FAILURE
;

944 
ušt32_t
 
üm_compu‹_node_found
 = 
FALSE
,
šdex
 = 0;

945 
ušt32_t
 
pÜt_node_found
 = 
FALSE
;

947 
üm_vœtu®_ÃtwÜk
* 
üm_vn_šfo_p
=
NULL
;

948 
üm_compu‹_node
* 
üm_compu‹_node_sÿn_’Œy_p
=
NULL
;

949 
üm_pÜt_»f
* 
üm_logiÿl_sw™ch_pÜts_node_p
=
NULL
;

951 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "vn_Çme:%s,sw™ch_Çme:%s,logiÿl_sw™ch_Çme:%s",
vn_Çme
,
sw™ch_Çme
,
logiÿl_sw™ch_Çme
);

953 if((
vn_Çme
==
NULL
)|| (
sw™ch_Çme
 == NULL))

955 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "names‡re NULL\n");

956  
CRM_FAILURE
;

960 
»t_v®
 = 
	`üm_g‘_vn_hªdË
(
vn_Çme
, &
vn_hªdË
);

961 if(
»t_v®
 !ğ
CRM_SUCCESS
)

963 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "virtual‚etwork‚ame invalid!.");

964  
CRM_ERROR_VN_NAME_INVALID
;

967 
»t_v®
 = 
	`üm_g‘_vn_byhªdË
(
vn_hªdË
, &
üm_vn_šfo_p
);

968 if(
»t_v®
 !ğ
CRM_SUCCESS
)

970 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "get virtual‚etwork info failed!.");

971  
CRM_ERROR_INVALID_VN_HANDLE
;

974 
	`CNTLR_RCU_READ_LOCK_TAKE
();

978 
	`OF_LIST_SCAN
(
üm_vn_šfo_p
->
üm_compu‹_nodes
,

979 
üm_compu‹_node_sÿn_’Œy_p
,

980 
üm_compu‹_node
*,

981 
CRM_VN_COMPUTE_NODE_ENTRY_LISTNODE_OFFSET


984 if(!
	`¡rcmp
(
üm_compu‹_node_sÿn_’Œy_p
->
sw™ch_Çme
, switch_name))

986 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm compute‚ode found");

987 
üm_compu‹_node_found
 = 1;

991 if(!
üm_compu‹_node_found
)

993 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm compute‚ode‚ot found!.");

994 
»t_v®
ğ
CRM_FAILURE
;

998 
»t_v®
 = 
CRM_ERROR_NO_MORE_ENTRIES
;

999 if(
üm_compu‹_node_sÿn_’Œy_p
->
no_of_bridges
 == 0)

1001 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "no bridges‡ttachedo computenode!.");

1005 
šdex
=0; index<(
üm_compu‹_node_sÿn_’Œy_p
->
no_of_bridges
); index++)

1007 
	`OF_LIST_SCAN
(((
üm_compu‹_node_sÿn_’Œy_p
->
dp_»ã»nûs
[
šdex
]).
vmside_pÜts
),

1008 
üm_logiÿl_sw™ch_pÜts_node_p
,

1009 
üm_pÜt_»f
 *,

1010 
CRM_LOGICAL_SWITCH_PORT_NODE_OFFSET
)

1012 if(!
	`¡rcmp
(
üm_logiÿl_sw™ch_pÜts_node_p
->
pÜt_Çme
,port_name))

1014 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm…ort found!");

1015 
pÜt_node_found
 =
TRUE
;

1019 if(
pÜt_node_found
 =ğ
TRUE
);

1021 if(
pÜt_node_found
 =ğ
FALSE
)

1023 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm…ort‚ot found!");

1024 
šdex
=0; index<(
üm_compu‹_node_sÿn_’Œy_p
->
no_of_bridges
); index++)

1026 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm…ort searching in vmns!");

1028 
	`OF_LIST_SCAN
(((
üm_compu‹_node_sÿn_’Œy_p
->
dp_»ã»nûs
[
šdex
]).
vmns_pÜts
),

1029 
üm_logiÿl_sw™ch_pÜts_node_p
,

1030 
üm_pÜt_»f
*,

1031 
CRM_LOGICAL_SWITCH_PORT_NODE_OFFSET
)

1033 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm…ort found in vmns!");

1035 if(!
	`¡rcmp
(
üm_logiÿl_sw™ch_pÜts_node_p
->
pÜt_Çme
,port_name))

1037 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm…ort found!");

1038 
pÜt_node_found
 =
TRUE
;

1042 if(
pÜt_node_found
 =ğ
TRUE
);

1046 if(
pÜt_node_found
 =ğ
FALSE
)

1048 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm…ortƒntry‚ot found!.");

1049 
»t_v®
ğ
CRM_FAILURE
;

1053 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "return success");

1054 
»t_v®
=
CRM_SUCCESS
;

1058 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1059  
»t_v®
;

1060 
	}
}

1066 
št32_t
 
	$üm_d–_üm_vmpÜt
(* 
pÜt_Çme
,

1067 
št32_t
 
pÜt_ty³
,

1068 * 
vn_Çme
,

1069 * 
sw™ch_Çme
,

1070 * 
vm_Çme
,

1071 * 
br_Çme
)

1073 
ušt64_t
 
vn_hªdË
;

1074 
ušt32_t
 
­phookoff£t
,
off£t
;

1075 
ušt64_t
 
sw™ch_hªdË
,
logiÿl_sw™ch_hªdË
,
vm_hªdË
,
pÜt_hªdË
 = 0;

1076 
üm_pÜt
* 
üm_pÜt_node_sÿn_p
 = 
NULL
;

1077 
üm_pÜt_nÙifiÿtiÚ_d©a
 
nÙifiÿtiÚ_d©a
 = {};

1078 
üm_nÙifiÿtiÚ_­p_hook_šfo
* 
­p_’Œy_p
 = 
NULL
;

1079 
ušt32_t
 
sw™ch_
;

1080 
ušt8_t
 
nw_ty³
;

1082 
št32_t
 
»t_v®
 = 
CRM_FAILURE
;

1083 
št32_t
 
¡©us_b
;

1085 if((
pÜt_Çme
 =ğ
NULL
)|| (
vn_Çme
==NULL)||(
sw™ch_Çme
 =ğNULLè|| (
br_Çme
 == NULL))

1087 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"invalid crm…orts data suppliedo delete.");

1088  
CRM_FAILURE
;

1091 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"pÜt_Çm = %s",
pÜt_Çme
);

1092 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"sw™ch_Çmğ%s",
sw™ch_Çme
);

1093 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"br_Çm = %s",
br_Çme
);

1094 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"pÜt_ty³ = %d",
pÜt_ty³
);

1095 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"vn_Çm = %s",
vn_Çme
);

1096 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"vm_Çm = %s",
vm_Çme
);

1098 
»t_v®
 = 
	`üm_g‘_pÜt_byÇme
(
pÜt_Çme
, &
üm_pÜt_node_sÿn_p
);

1099 if(
»t_v®
 !ğ
CRM_SUCCESS
)

1101 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "port‚ame invalid");

1102  
CRM_FAILURE
;

1105 
pÜt_ty³
 = 
üm_pÜt_node_sÿn_p
->
üm_pÜt_ty³
;

1106 
	`¼m_check_ümpÜt_»sourû_»ÏtiÚshs
(
sw™ch_Çme
,
br_Çme
,

1107 
vn_Çme
, 
vm_Çme
,

1108 &
sw™ch_hªdË
,&
logiÿl_sw™ch_hªdË
,

1109 &
vn_hªdË
,&
vm_hªdË
,&
sw™ch_
,&
nw_ty³
);

1110 if(
»t_v®
 !ğ
RRM_SUCCESS
)

1112 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Incomplete Relationships");

1113  
CRM_ERROR_INCOMPLETE_RESOURCE_RELATIONSHIPS
;

1116 
­phookoff£t
 = 
CRM_NOTIFICATION_APP_HOOK_OFFSET
;

1120 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
vn_Çme
,vn_name);

1121 
	`¡ºıy
(
nÙifiÿtiÚ_d©a
.
pÜt_Çme
 , 
üm_pÜt_node_sÿn_p
->pÜt_Çme, 
CRM_MAX_PORT_NAME_LEN
);

1122 
nÙifiÿtiÚ_d©a
.
Ãw_pÜt_id
 = 
üm_pÜt_node_sÿn_p
->
pÜt_id
;

1123 
nÙifiÿtiÚ_d©a
.
üm_pÜt_ty³
 = 
üm_pÜt_node_sÿn_p
->crm_port_type;

1124 
nÙifiÿtiÚ_d©a
.
üm_pÜt_¡©us
 = 
üm_pÜt_node_sÿn_p
->
pÜt_¡©us
;

1126 
nÙifiÿtiÚ_d©a
.
üm_pÜt_hªdË
 = 
üm_pÜt_node_sÿn_p
->
magic
;

1127 
nÙifiÿtiÚ_d©a
.
üm_pÜt_hªdË
 = (ÒÙifiÿtiÚ_d©a.üm_pÜt_hªdË<<32)|(
üm_pÜt_node_sÿn_p
->
šdex
));

1129 
nÙifiÿtiÚ_d©a
.
üm_vn_hªdË
 = 
üm_pÜt_node_sÿn_p
->
§ã»f_vn
;

1130 
nÙifiÿtiÚ_d©a
.
dp_hªdË
 = 
üm_pÜt_node_sÿn_p
->
sy¡em_br_§ã»f
;

1131 
nÙifiÿtiÚ_d©a
.
üm_vm_hªdË
 = 
üm_pÜt_node_sÿn_p
->
vmInfo
.
§ã»f_vm
;

1132 
nÙifiÿtiÚ_d©a
.
nw_ty³
 = 
üm_pÜt_node_sÿn_p
->nw_type;

1134 
	`OF_LIST_SCAN
(
üm_pÜt_nÙifiÿtiÚs
[
CRM_PORT_DELETE
], 
­p_’Œy_p
, 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *, 
­phookoff£t
 )

1136 ((
üm_pÜt_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_PORT_DELETE
,

1137 
nÙifiÿtiÚ_d©a
.
üm_pÜt_hªdË
,

1138 
nÙifiÿtiÚ_d©a
,

1139 
­p_’Œy_p
->
cbk_¬g1
,

1140 
­p_’Œy_p
->
cbk_¬g2
);

1142 
	`OF_LIST_SCAN
(
üm_pÜt_nÙifiÿtiÚs
[
CRM_VN_ALL_NOTIFICATIONS
], 
­p_’Œy_p
, 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *, 
­phookoff£t
 )

1144 ((
üm_pÜt_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_PORT_DELETE
,

1145 
nÙifiÿtiÚ_d©a
.
üm_pÜt_hªdË
,

1146 
nÙifiÿtiÚ_d©a
,

1147 
­p_’Œy_p
->
cbk_¬g1
,

1148 
­p_’Œy_p
->
cbk_¬g2
);

1151 
	`¼m_d–‘e_vmpÜt_»sourû_»ÏtiÚshs
(
pÜt_Çme
,
pÜt_hªdË
,
pÜt_ty³
,
sw™ch_Çme
,
vm_Çme
,
vn_Çme
,
vn_hªdË
,
logiÿl_sw™ch_hªdË
);

1153 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1155 
off£t
 = 
CRM_PORT_NODE_PORT_TBL_OFFSET
;

1156 
	`MCHASH_DELETE_NODE_BY_REF
(
üm_pÜt_bË_g
, 
üm_pÜt_node_sÿn_p
->
šdex
, crm_pÜt_node_sÿn_p->
magic
, 
üm_pÜt
 *, 
off£t
,
¡©us_b
);

1158 if(
¡©us_b
 =ğ
TRUE
)

1160 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm…ort deleted successfully fromheable");

1164 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm…ort failedo delete fromheable");

1165 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1166  
CRM_FAILURE
;

1169 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1170  
CRM_SUCCESS
;

1171 
	}
}

1173 
št32_t
 
	$üm_g‘_pÜt_byÇme
(* 
pÜt_Çme_p
, 
üm_pÜt
 ** 
pÜt_šfo_p_p
)

1175 
ušt32_t
 
hashkey
,
off£t
;

1176 
üm_pÜt
* 
pÜt_šfo1_p
;

1178 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "’‹»dÕÜŠame:%s)",
pÜt_Çme_p
);

1180 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1181 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
pÜt_Çme_p
, 
üm_no_of_pÜt_buck‘s_g
);

1182 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "hashkey:%d\r\n",
hashkey
);

1184 
off£t
 = 
CRM_PORT_NODE_PORT_TBL_OFFSET
;

1185 
	`MCHASH_BUCKET_SCAN
(
üm_pÜt_bË_g
, 
hashkey
, 
pÜt_šfo1_p
, 
üm_pÜt
 *, 
off£t
)

1187 if(!
	`¡rcmp
(
pÜt_šfo1_p
->
pÜt_Çme
,
pÜt_Çme_p
))

1189 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "pÜˆÇm% found iÀüm db",
pÜt_šfo1_p
->
pÜt_Çme
);

1190 *
pÜt_šfo_p_p
 = 
pÜt_šfo1_p
;

1191  
CRM_SUCCESS
;

1196 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1197  
CRM_FAILURE
;

1198 
	}
}

1204 
št32_t
 
	$üm_g‘_pÜt_byhªdË
(
ušt64_t
 
pÜt_hªdË
,
üm_pÜt
 **
üm_pÜt_šfo_p
)

1207 
ušt32_t
 
šdex
,
magic
;

1208 
ušt8_t
 
¡©us_b
;

1210 
magic
 = (
ušt32_t
)(
pÜt_hªdË
 >>32);

1211 
šdex
 = (
ušt32_t
)
pÜt_hªdË
;

1213 
	`MCHASH_ACCESS_NODE
(
üm_pÜt_bË_g
,
šdex
,
magic
,*
üm_pÜt_šfo_p
,
¡©us_b
);

1215 if(
TRUE
 =ğ
¡©us_b
)

1216  
CRM_SUCCESS
;

1217  
CRM_ERROR_INVALID_PORT_HANDLE
;

1218 
	}
}

1225 
št32_t
 
	$üm_g‘_pÜt_hªdË
(*
pÜt_Çme_p
, 
ušt64_t
 *
pÜt_hªdË_p
)

1227 
ušt32_t
 
hashkey
;

1228 
ušt32_t
 
off£t
;

1230 
üm_pÜt
 *
üm_pÜt_šfo_p
=
NULL
;

1232 if(
üm_pÜt_bË_g
 =ğ
NULL
)

1233  
CRM_FAILURE
;

1235 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
pÜt_Çme_p
,
üm_no_of_pÜt_buck‘s_g
);

1236 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "hashkey:%d\r\n",
hashkey
);

1237 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1238 
off£t
 = 
CRM_PORT_NODE_PORT_TBL_OFFSET
;

1240 
	`MCHASH_BUCKET_SCAN
(
üm_pÜt_bË_g
, 
hashkey
, 
üm_pÜt_šfo_p
, 
üm_pÜt
 *,
off£t
)

1242 if(
	`¡rcmp
(
üm_pÜt_šfo_p
->
pÜt_Çme
,
pÜt_Çme_p
))

1244 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1246 *
pÜt_hªdË_p
 = 
üm_pÜt_šfo_p
->
magic
;

1247 *
pÜt_hªdË_p
 = ((*pÜt_hªdË_°<<32è| (
üm_pÜt_šfo_p
->
šdex
));

1249 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "*pÜt_hªdË_p:%x\r\n",*
pÜt_hªdË_p
);

1250  
CRM_SUCCESS
;

1252 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1253  
CRM_ERROR_VN_NAME_INVALID
;

1254 
	}
}

1256 
	$üm_£t_pÜt_¡©us
(* 
üm_pÜt_Çme
, 
ušt64_t
 
üm_pÜt_hªdË
,

1257 
ušt64_t
 
sy¡em_pÜt_hªdË
,

1258 
ušt8_t
 
pÜt_¡©us
,

1259 
ušt32_t
 
sy¡em_pÜt_id
)

1261 
št32_t
 
»t_v®
;

1262 
ušt32_t
 
üm_nÙifiÿtiÚ_ty³
 = 0;

1263 
üm_pÜt
* 
üm_pÜt_node_p
;

1264 
üm_pÜt_nÙifiÿtiÚ_d©a
 
üm_nÙifiÿtiÚ_d©a
={};

1265 
ušt32_t
 
­phookoff£t
;

1266 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *
­p_’Œy_p
=
NULL
;

1268 if(
pÜt_¡©us
 =ğ
PORT_STATUS_CREATED
)

1270 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Sy¡em…Üˆw™h…ÜˆÇme(%sèi ü—‹d‡nd i nÙ„—dy",
üm_pÜt_Çme
);

1274 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1275 
»t_v®
 = 
	`üm_g‘_pÜt_byhªdË
(
üm_pÜt_hªdË
,&
üm_pÜt_node_p
);

1276 if(
»t_v®
 !ğ
CRM_SUCCESS
)

1278 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "pÜˆÇme(%sènÙ…»£Á iÀthüm d©aba£",
üm_pÜt_Çme
);

1279 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1283 if((
pÜt_¡©us
 =ğ
PORT_STATUS_UP
) &&

1284 (
üm_pÜt_node_p
->
pÜt_id
 == 0) &&

1285 (
üm_pÜt_node_p
->
pÜt_¡©us
 =ğ
SYSTEM_PORT_NOT_READY
))

1287 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "Datapath is connectedo Controller‡ndhe crm…ort is‚ow‡ctive");

1291 
üm_nÙifiÿtiÚ_ty³
 = 
CRM_PORT_ADDED
;

1292 
üm_pÜt_node_p
->
pÜt_id
 = 
sy¡em_pÜt_id
;

1293 
üm_pÜt_node_p
->
pÜt_¡©us
 = 
SYSTEM_PORT_READY
;

1295 
üm_pÜt_node_p
->
sy¡em_pÜt_hªdË
 = system_port_handle;

1298 
üm_nÙifiÿtiÚ_d©a
.
Ãw_pÜt_id
 = 
üm_pÜt_node_p
->
pÜt_id
;

1299 
üm_nÙifiÿtiÚ_d©a
.
üm_pÜt_ty³
 = 
üm_pÜt_node_p
->crm_port_type;

1300 
üm_nÙifiÿtiÚ_d©a
.
üm_pÜt_¡©us
 = 
SYSTEM_PORT_READY
;

1301 
üm_nÙifiÿtiÚ_d©a
.
üm_pÜt_hªdË
 = crm_port_handle;

1302 
üm_nÙifiÿtiÚ_d©a
.
üm_vn_hªdË
 = 
üm_pÜt_node_p
->
§ã»f_vn
;

1303 
üm_nÙifiÿtiÚ_d©a
.
dp_hªdË
 = 
üm_pÜt_node_p
->
sy¡em_br_§ã»f
;

1304 
üm_nÙifiÿtiÚ_d©a
.
üm_vm_hªdË
 = 
üm_pÜt_node_p
->
vmInfo
.
§ã»f_vm
;

1305 
üm_nÙifiÿtiÚ_d©a
.
nw_ty³
 = 
üm_pÜt_node_p
->nw_type;

1307 
	`¡ºıy
(
üm_nÙifiÿtiÚ_d©a
.
pÜt_Çme
 ,
üm_pÜt_node_p
->pÜt_Çme, 
CRM_MAX_PORT_NAME_LEN
);

1308 
	`¡rıy
(
üm_nÙifiÿtiÚ_d©a
.
swÇme
 ,
üm_pÜt_node_p
->
sw™ch_Çme
);

1310 if(
üm_nÙifiÿtiÚ_d©a
.
nw_ty³
 =ğ
VXLAN_TYPE
)

1312 
üm_nÙifiÿtiÚ_d©a
.
nw_·¿ms
.
vxÏn_nw
.
£rviû_pÜt
 = 
üm_pÜt_node_p
->nw_params.vxlan_nw.service_port;

1313 
üm_nÙifiÿtiÚ_d©a
.
nw_·¿ms
.
vxÏn_nw
.
nid
 = 
üm_pÜt_node_p
->nw_params.vxlan_nw.nid;

1314 
üm_nÙifiÿtiÚ_d©a
.
nw_·¿ms
.
vxÏn_nw
.
»mÙe_
 = 
üm_pÜt_node_p
->nw_params.vxlan_nw.remote_ip;

1317 if(
üm_nÙifiÿtiÚ_d©a
.
nw_ty³
 =ğ
NVGRE_TYPE
)

1319 
üm_nÙifiÿtiÚ_d©a
.
nw_·¿ms
.
nvg»_nw
.
£rviû_pÜt
 = 
üm_pÜt_node_p
->nw_params.nvgre_nw.service_port;

1320 
üm_nÙifiÿtiÚ_d©a
.
nw_·¿ms
.
nvg»_nw
.
nid
 = 
üm_pÜt_node_p
->nw_params.nvgre_nw.nid;

1321 
üm_nÙifiÿtiÚ_d©a
.
nw_·¿ms
.
nvg»_nw
.
»mÙe_
 = 
üm_pÜt_node_p
->nw_params.nvgre_nw.remote_ip;

1325 if((
pÜt_¡©us
 =ğ
PORT_STATUS_DOWN
) &&

1326 (
üm_pÜt_node_p
->
pÜt_id
 != 0) &&

1327 (
üm_pÜt_node_p
->
pÜt_id
 =ğ
sy¡em_pÜt_id
) &&

1328 (
üm_pÜt_node_p
->
pÜt_¡©us
 =ğ
SYSTEM_PORT_READY
))

1330 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "port…resent‡ndready inhe crm db, but…ort deleted in system module");

1332 
üm_nÙifiÿtiÚ_ty³
 = 
CRM_PORT_DELETE
;

1333 
üm_nÙifiÿtiÚ_d©a
.
Ãw_pÜt_id
 = 
üm_pÜt_node_p
->
pÜt_id
;

1334 
üm_nÙifiÿtiÚ_d©a
.
üm_pÜt_ty³
 = 
üm_pÜt_node_p
->crm_port_type;

1335 
üm_pÜt_node_p
->
pÜt_id
 = 0;

1336 
üm_pÜt_node_p
->
pÜt_¡©us
 = 
SYSTEM_PORT_NOT_READY
;

1339 
üm_nÙifiÿtiÚ_d©a
.
üm_pÜt_¡©us
 = 
SYSTEM_PORT_NOT_READY
;

1340 
üm_nÙifiÿtiÚ_d©a
.
üm_pÜt_hªdË
 = 
üm_pÜt_node_p
->
magic
;

1341 
üm_nÙifiÿtiÚ_d©a
.
üm_pÜt_hªdË
 = ((üm_nÙifiÿtiÚ_d©a.üm_pÜt_hªdË<<32)|(
üm_pÜt_node_p
->
šdex
));

1342 
üm_nÙifiÿtiÚ_d©a
.
üm_vn_hªdË
 = 
üm_pÜt_node_p
->
§ã»f_vn
;

1343 
üm_nÙifiÿtiÚ_d©a
.
dp_hªdË
 = 
üm_pÜt_node_p
->
sy¡em_br_§ã»f
;

1344 
üm_nÙifiÿtiÚ_d©a
.
üm_vm_hªdË
 = 
üm_pÜt_node_p
->
vmInfo
.
§ã»f_vm
;

1345 
üm_pÜt_node_p
->
sy¡em_pÜt_hªdË
 = 0;

1346 
üm_nÙifiÿtiÚ_d©a
.
nw_ty³
 = 
üm_pÜt_node_p
->nw_type;

1348 
	`¡rıy
(
üm_nÙifiÿtiÚ_d©a
.
pÜt_Çme
 ,
üm_pÜt_node_p
->port_name);

1349 
	`¡rıy
(
üm_nÙifiÿtiÚ_d©a
.
swÇme
 ,
üm_pÜt_node_p
->
sw™ch_Çme
);

1351 if(
üm_nÙifiÿtiÚ_d©a
.
nw_ty³
 =ğ
VXLAN_TYPE
)

1353 
üm_nÙifiÿtiÚ_d©a
.
nw_·¿ms
.
vxÏn_nw
.
£rviû_pÜt
 = 
üm_pÜt_node_p
->nw_params.vxlan_nw.service_port;

1354 
üm_nÙifiÿtiÚ_d©a
.
nw_·¿ms
.
vxÏn_nw
.
nid
 = 
üm_pÜt_node_p
->nw_params.vxlan_nw.nid;

1355 
üm_nÙifiÿtiÚ_d©a
.
nw_·¿ms
.
vxÏn_nw
.
»mÙe_
 = 
üm_pÜt_node_p
->nw_params.vxlan_nw.remote_ip;

1358 if(
üm_nÙifiÿtiÚ_d©a
.
nw_ty³
 =ğ
NVGRE_TYPE
)

1360 
üm_nÙifiÿtiÚ_d©a
.
nw_·¿ms
.
nvg»_nw
.
£rviû_pÜt
 = 
üm_pÜt_node_p
->nw_params.nvgre_nw.service_port;

1361 
üm_nÙifiÿtiÚ_d©a
.
nw_·¿ms
.
nvg»_nw
.
nid
 = 
üm_pÜt_node_p
->nw_params.nvgre_nw.nid;

1362 
üm_nÙifiÿtiÚ_d©a
.
nw_·¿ms
.
nvg»_nw
.
»mÙe_
 = 
üm_pÜt_node_p
->nw_params.nvgre_nw.remote_ip;

1366 if(
pÜt_¡©us
 =ğ
PORT_STATUS_UPDATE
)

1368 if((
üm_pÜt_node_p
->
pÜt_id
 == 0) &&

1369 (
üm_pÜt_node_p
->
pÜt_¡©us
 =ğ
SYSTEM_PORT_NOT_READY
) &&

1370 (
sy¡em_pÜt_id
 != 0))

1372 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "port…resents in system‡nd crm .‚ow…ort„eady inhe system database.");

1373 
üm_nÙifiÿtiÚ_ty³
 = 
CRM_PORT_ADDED
;

1374 
üm_pÜt_node_p
->
pÜt_¡©us
 = 
SYSTEM_PORT_READY
;

1376 if((
üm_pÜt_node_p
->
pÜt_id
 != 0) &&

1377 (
üm_pÜt_node_p
->
pÜt_¡©us
 =ğ
SYSTEM_PORT_READY
) &&

1378 (
sy¡em_pÜt_id
 != 0)&&

1379 (
üm_pÜt_node_p
->
pÜt_id
 !ğ
sy¡em_pÜt_id
)

1382 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "port…resents in crm‡nd system .‡lready…ort„eady inhe system database. but‚ow…ort id value changed.");

1384 
üm_nÙifiÿtiÚ_d©a
.
Şd_pÜt_id
 = 
üm_pÜt_node_p
->
pÜt_id
;

1385 
üm_nÙifiÿtiÚ_ty³
 = 
CRM_PORT_MODIFIED
;

1388 if((
üm_pÜt_node_p
->
pÜt_id
 != 0) &&

1389 (
üm_pÜt_node_p
->
pÜt_¡©us
 =ğ
SYSTEM_PORT_READY
) &&

1390 (
sy¡em_pÜt_id
 != 0) &&

1391 (
üm_pÜt_node_p
->
pÜt_id
 =ğ
sy¡em_pÜt_id
)

1394 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "port…resentin crm‡nd system.datapath„econnected.port id is same‡s…revious if-elseakes care of it.");

1398 
üm_nÙifiÿtiÚ_ty³
 = 
CRM_PORT_ADDED
;

1402 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "*** Explore more ***");

1403 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1407 
üm_pÜt_node_p
->
pÜt_id
 = 
sy¡em_pÜt_id
;

1408 
üm_pÜt_node_p
->
pÜt_¡©us
 = 
SYSTEM_PORT_READY
;

1411 
üm_nÙifiÿtiÚ_d©a
.
Ãw_pÜt_id
 = 
üm_pÜt_node_p
->
pÜt_id
;

1412 
üm_nÙifiÿtiÚ_d©a
.
üm_pÜt_ty³
 = 
üm_pÜt_node_p
->crm_port_type;

1413 
üm_nÙifiÿtiÚ_d©a
.
üm_pÜt_¡©us
 = 
SYSTEM_PORT_READY
;

1414 
üm_nÙifiÿtiÚ_d©a
.
üm_pÜt_hªdË
 = 
üm_pÜt_node_p
->
magic
;

1415 
üm_nÙifiÿtiÚ_d©a
.
üm_pÜt_hªdË
 = ((üm_nÙifiÿtiÚ_d©a.üm_pÜt_hªdË<<32)|(
üm_pÜt_node_p
->
šdex
));

1416 
üm_nÙifiÿtiÚ_d©a
.
üm_vn_hªdË
 = 
üm_pÜt_node_p
->
§ã»f_vn
;

1417 
üm_nÙifiÿtiÚ_d©a
.
dp_hªdË
 = 
üm_pÜt_node_p
->
sy¡em_br_§ã»f
;

1418 
üm_nÙifiÿtiÚ_d©a
.
üm_vm_hªdË
 = 
üm_pÜt_node_p
->
vmInfo
.
§ã»f_vm
;

1419 
üm_nÙifiÿtiÚ_d©a
.
nw_ty³
 = 
üm_pÜt_node_p
->nw_type;

1421 
	`¡ºıy
(
üm_nÙifiÿtiÚ_d©a
.
pÜt_Çme
 ,
üm_pÜt_node_p
->pÜt_Çme, 
CRM_MAX_PORT_NAME_LEN
);

1422 
	`¡rıy
(
üm_nÙifiÿtiÚ_d©a
.
swÇme
 ,
üm_pÜt_node_p
->
sw™ch_Çme
);

1424 if(
üm_nÙifiÿtiÚ_d©a
.
nw_ty³
 =ğ
VXLAN_TYPE
)

1426 
üm_nÙifiÿtiÚ_d©a
.
nw_·¿ms
.
vxÏn_nw
.
£rviû_pÜt
 = 
üm_pÜt_node_p
->nw_params.vxlan_nw.service_port;

1427 
üm_nÙifiÿtiÚ_d©a
.
nw_·¿ms
.
vxÏn_nw
.
nid
 = 
üm_pÜt_node_p
->nw_params.vxlan_nw.nid;

1428 
üm_nÙifiÿtiÚ_d©a
.
nw_·¿ms
.
vxÏn_nw
.
»mÙe_
 = 
üm_pÜt_node_p
->nw_params.vxlan_nw.remote_ip;

1431 if(
üm_nÙifiÿtiÚ_d©a
.
nw_ty³
 =ğ
NVGRE_TYPE
)

1433 
üm_nÙifiÿtiÚ_d©a
.
nw_·¿ms
.
nvg»_nw
.
£rviû_pÜt
 = 
üm_pÜt_node_p
->nw_params.nvgre_nw.service_port;

1434 
üm_nÙifiÿtiÚ_d©a
.
nw_·¿ms
.
nvg»_nw
.
nid
 = 
üm_pÜt_node_p
->nw_params.nvgre_nw.nid;

1435 
üm_nÙifiÿtiÚ_d©a
.
nw_·¿ms
.
nvg»_nw
.
»mÙe_
 = 
üm_pÜt_node_p
->nw_params.nvgre_nw.remote_ip;

1438 
­phookoff£t
 = 
CRM_NOTIFICATION_APP_HOOK_OFFSET
;

1439 
	`OF_LIST_SCAN
(
üm_pÜt_nÙifiÿtiÚs
[
üm_nÙifiÿtiÚ_ty³
], 
­p_’Œy_p
, 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *, 
­phookoff£t
 )

1441 ((
üm_pÜt_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
üm_nÙifiÿtiÚ_ty³
,

1442 
üm_nÙifiÿtiÚ_d©a
.
üm_pÜt_hªdË
,

1443 
üm_nÙifiÿtiÚ_d©a
,

1444 
­p_’Œy_p
->
cbk_¬g1
,

1445 
­p_’Œy_p
->
cbk_¬g2
);

1448 
	`OF_LIST_SCAN
(
üm_pÜt_nÙifiÿtiÚs
[
CRM_VN_ALL_NOTIFICATIONS
], 
­p_’Œy_p
, 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *, 
­phookoff£t
 )

1450 ((
üm_pÜt_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
üm_nÙifiÿtiÚ_ty³
,

1451 
üm_nÙifiÿtiÚ_d©a
.
üm_pÜt_hªdË
,

1452 
üm_nÙifiÿtiÚ_d©a
,

1453 
­p_’Œy_p
->
cbk_¬g1
,

1454 
­p_’Œy_p
->
cbk_¬g2
);

1456 
	}
}

1461 
št32_t
 
	$üm_»gi¡”_pÜt_nÙifiÿtiÚs
 (
ušt32_t
 
nÙifiÿtiÚ_ty³
,

1462 
üm_pÜt_nÙif›r_â
 
pÜt_nÙif›r_â
,

1463 * 
ÿÎback_¬g1
,

1464 * 
ÿÎback_¬g2
)

1466 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *
­p_’Œy_p
;

1467 
ušt8_t
 
h—p_b
;

1468 
št32_t
 
»tv®
 = 
CRM_SUCCESS
;

1469 
uch¬8_t
 
l¡off£t
;

1470 
l¡off£t
 = 
CRM_NOTIFICATION_APP_HOOK_OFFSET
;

1472 if((
nÙifiÿtiÚ_ty³
 < 
CRM_PORT_FIRST_NOTIFICATION_TYPE
) ||

1473 (
nÙifiÿtiÚ_ty³
 > 
CRM_PORT_LAST_NOTIFICATION_TYPE
))

1475 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "šv®id‚ÙifiÿtiÚy³:%d", 
nÙifiÿtiÚ_ty³
);

1476  
CRM_FAILURE
;

1479 if(
pÜt_nÙif›r_â
 =ğ
NULL
)

1481 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "callback function is NULL");

1482  
CRM_FAILURE
;

1485 
»tv®
 = 
	`mempoŞ_g‘_mem_block
(
üm_nÙifiÿtiÚs_mempoŞ_g
, (
uch¬8_t
**)&
­p_’Œy_p
, &
h—p_b
);

1486 if(
»tv®
 !ğ
MEMPOOL_SUCCESS
)

1488 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "failedo get mempool");

1489  
CRM_FAILURE
;

1492 
­p_’Œy_p
->
ÿÎ_back
 = (*)
pÜt_nÙif›r_â
;

1493 
­p_’Œy_p
->
cbk_¬g1
 = 
ÿÎback_¬g1
;

1494 
­p_’Œy_p
->
cbk_¬g2
 = 
ÿÎback_¬g2
;

1495 
­p_’Œy_p
->
h—p_b
 = heap_b;

1498 
	`OF_APPEND_NODE_TO_LIST
(
üm_pÜt_nÙifiÿtiÚs
[
nÙifiÿtiÚ_ty³
], 
­p_’Œy_p
, 
l¡off£t
);

1500 if(
»tv®
 !ğ
CRM_SUCCESS
)

1501 
	`mempoŞ_»Ëa£_mem_block
(
üm_nÙifiÿtiÚs_mempoŞ_g
, (
uch¬8_t
*)
­p_’Œy_p
,‡µ_’Œy_p->
h—p_b
);

1502  
»tv®
;

1503 
	}
}

1505 
št32_t
 
	$üm_d”egi¡”_pÜt_nÙifiÿtiÚs
(
ušt32_t
 
nÙifiÿtiÚ_ty³
,

1506 
üm_pÜt_nÙif›r_â
 
pÜt_nÙif›r_â
)

1508 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *
­p_’Œy_p
,*
´ev_­p_’Œy_p
 = 
NULL
;

1509 
uch¬8_t
 
l¡off£t
;

1510 
l¡off£t
 = 
CRM_NOTIFICATION_APP_HOOK_OFFSET
;

1512 if((
nÙifiÿtiÚ_ty³
 < 
CRM_PORT_FIRST_NOTIFICATION_TYPE
) ||

1513 (
nÙifiÿtiÚ_ty³
 > 
CRM_PORT_LAST_NOTIFICATION_TYPE
))

1515 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "šv®id…ÜˆnÙifiÿtiÚy³:%d", 
nÙifiÿtiÚ_ty³
);

1516  
CRM_FAILURE
;

1519 if(
pÜt_nÙif›r_â
 =ğ
NULL
)

1521 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "callback function is NULL");

1522  
CRM_FAILURE
;

1525 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1526 
	`OF_LIST_SCAN
(
üm_pÜt_nÙifiÿtiÚs
[
nÙifiÿtiÚ_ty³
],
­p_’Œy_p
,
üm_nÙifiÿtiÚ_­p_hook_šfo
 *,
l¡off£t
 )

1528 if(
­p_’Œy_p
->
ÿÎ_back
 !ğ
pÜt_nÙif›r_â
)

1530 
´ev_­p_’Œy_p
 = 
­p_’Œy_p
;

1533 
	`OF_REMOVE_NODE_FROM_LIST
(
üm_pÜt_nÙifiÿtiÚs
[
nÙifiÿtiÚ_ty³
],
­p_’Œy_p
,
´ev_­p_’Œy_p
,
l¡off£t
 );

1534 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1535  
CRM_SUCCESS
;

1537 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1538  
CRM_FAILURE
;

1539 
	}
}

1542 
TBD
 
NSM
 
g‘
 
fœ¡
 
vmside
 
pÜt
 
ªd
 
Ãxt
 vmsidpÜˆ
	gäom


1544 1. 
	gvn
->
	gcompu‹node
->
	glogiÿlsw™ch
->
	gvm_pÜts


1545 2. 
	gvn
->
	gcompu‹node
->
	glogiÿlsw™ch
->
vmns_pÜts


1547 
API
 
is
 
to
 
be
 
defšed
 
	gh”e
. 
But
 
Aùu®
 
im¶em’tiÚ
 i 
š
 
	g»sourû_»ÏtiÚshs_mgr
.
c


1548 
as
 
™
 
Ãeds
 
to
 
ãtch
 
usšg
 
vn
 
	gAPI
.

1551 
št32_t
 
	$üm_add_©Œibu‹_to_pÜt
(* 
pÜt_Çme_p
, 
üm_©Œibu‹_Çme_v®ue_·œ
* 
©Œibu‹_šfo_p
)

1553 
üm_pÜt
 *
pÜt_’Œy_p
;

1554 
üm_pÜt_nÙifiÿtiÚ_d©a
 
nÙifiÿtiÚ_d©a
;

1555 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *
­p_’Œy_p
;

1556 
št32_t
 
»tv®
;

1557 
ušt64_t
 
pÜt_hªdË
;

1558 
ušt32_t
 
l¡off£t
;

1560 
l¡off£t
 = 
CRM_NOTIFICATION_APP_HOOK_OFFSET
;

1562 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1565 
»tv®
 = 
	`üm_g‘_pÜt_hªdË
(
pÜt_Çme_p
 ,&
pÜt_hªdË
);

1566 if(
»tv®
 !ğ
CRM_SUCCESS
)

1568 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1571 
»tv®
 = 
	`üm_g‘_pÜt_byhªdË
(
pÜt_hªdË
, &
pÜt_’Œy_p
);

1572 if(
»tv®
 !ğ
CRM_SUCCESS
)

1574 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1577 
»tv®
 = 
	`üm_add_©Œibu‹
(&(
pÜt_’Œy_p
->
©Œibu‹s
),
©Œibu‹_šfo_p
);

1578 if(
»tv®
 !ğ
CRM_SUCCESS
)

1580 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1583 
pÜt_’Œy_p
->
numb”_of_©Œibu‹s
++;

1584 
	`üm_ü—‹_pÜt_v›w_’Œy
(
pÜt_hªdË
, 
©Œibu‹_šfo_p
->
Çme_¡ršg
,‡‰ribu‹_šfo_p->
v®ue_¡ršg
);

1585 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
pÜt_Çme
, 
pÜt_’Œy_p
->port_name);

1586 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
©Œibu‹_Çme
,
©Œibu‹_šfo_p
->
Çme_¡ršg
);

1587 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
©Œibu‹_v®ue
,
©Œibu‹_šfo_p
->
v®ue_¡ršg
);

1588 
	`OF_LIST_SCAN
(
üm_pÜt_nÙifiÿtiÚs
[
CRM_PORT_ATTRIBUTE_ADDED
],
­p_’Œy_p
,
üm_nÙifiÿtiÚ_­p_hook_šfo
*,
l¡off£t
 )

1590 ((
üm_pÜt_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_PORT_ATTRIBUTE_ADDED
,

1591 
pÜt_hªdË
,

1592 
nÙifiÿtiÚ_d©a
,

1593 
­p_’Œy_p
->
cbk_¬g1
,

1594 
­p_’Œy_p
->
cbk_¬g2
);

1596 
	`OF_LIST_SCAN
(
üm_pÜt_nÙifiÿtiÚs
[
CRM_PORT_ALL_NOTIFICATIONS
],
­p_’Œy_p
,
üm_nÙifiÿtiÚ_­p_hook_šfo
*,
l¡off£t
 )

1598 ((
üm_pÜt_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_PORT_ATTRIBUTE_ADDED
,

1599 
pÜt_hªdË
,

1600 
nÙifiÿtiÚ_d©a
,

1601 
­p_’Œy_p
->
cbk_¬g1
,

1602 
­p_’Œy_p
->
cbk_¬g2
);

1606 if(
»tv®
 !ğ
CRM_SUCCESS
)

1608 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
,"Attribute‡ddition failed");

1609 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1610  
»tv®
;

1612 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1613 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
,"Attribute‡ddition succesful");

1614  
»tv®
;

1615 
	}
}

1618 
št32_t
 
	$üm_d–‘e_©Œibu‹_äom_pÜt
(* 
pÜt_Çme_p
, 
üm_©Œibu‹_Çme_v®ue_·œ
 *
©Œibu‹_šfo_p
)

1621 
üm_pÜt
 *
pÜt_’Œy_p
;

1622 
üm_»sourû_©Œibu‹_’Œy
 *
©Œibu‹_’Œy_p
, *
´ev_­p_’Œy_p
 = 
NULL
;

1623 
üm_pÜt_nÙifiÿtiÚ_d©a
 
nÙifiÿtiÚ_d©a
;

1624 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *
­p_’Œy_p
;

1626 
št32_t
 
»tv®
;

1627 
ušt64_t
 
pÜt_hªdË
;

1628 
ušt32_t
 
l¡off£t
;

1630 
l¡off£t
 = 
CRM_RESOURCE_ATTRIBUTE_ENTRY_LISTNODE_OFFSET
;

1632 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1633 
»tv®
 = 
	`üm_g‘_pÜt_hªdË
(
pÜt_Çme_p
 ,&
pÜt_hªdË
);

1634 if(
»tv®
 !ğ
CRM_SUCCESS
)

1636 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1637  
»tv®
;

1639 
»tv®
 = 
	`üm_g‘_pÜt_byhªdË
(
pÜt_hªdË
, &
pÜt_’Œy_p
);

1640 if(
»tv®
 !ğ
CRM_SUCCESS
)

1642 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1643  
»tv®
;

1646 
	`OF_LIST_SCAN
(
pÜt_’Œy_p
->
©Œibu‹s
, 
©Œibu‹_’Œy_p
, 
üm_»sourû_©Œibu‹_’Œy
*,
l¡off£t
)

1648 if(!
	`¡rcmp
(
©Œibu‹_’Œy_p
->
Çme
, 
©Œibu‹_šfo_p
->
Çme_¡ršg
))

1650 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
pÜt_Çme
, 
pÜt_’Œy_p
->port_name);

1651 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
©Œibu‹_Çme
,
©Œibu‹_’Œy_p
->
Çme
);

1652 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
©Œibu‹_v®ue
,
©Œibu‹_’Œy_p
->
v®ue
);

1653 
	`OF_LIST_SCAN
(
üm_pÜt_nÙifiÿtiÚs
[
CRM_PORT_ATTRIBUTE_DELETE
], 
­p_’Œy_p
,

1654 
üm_nÙifiÿtiÚ_­p_hook_šfo
*,
l¡off£t
 )

1656 ((
üm_pÜt_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_PORT_ATTRIBUTE_DELETE
,

1657 
pÜt_hªdË
,

1658 
nÙifiÿtiÚ_d©a
,

1659 
­p_’Œy_p
->
cbk_¬g1
,

1660 
­p_’Œy_p
->
cbk_¬g2
);

1662 
	`OF_LIST_SCAN
(
üm_pÜt_nÙifiÿtiÚs
[
CRM_PORT_ALL_NOTIFICATIONS
],
­p_’Œy_p
,

1663 
üm_nÙifiÿtiÚ_­p_hook_šfo
*,
l¡off£t
)

1665 ((
üm_pÜt_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_PORT_ATTRIBUTE_DELETE
,

1666 
pÜt_hªdË
,

1667 
nÙifiÿtiÚ_d©a
,

1668 
­p_’Œy_p
->
cbk_¬g1
,

1669 
­p_’Œy_p
->
cbk_¬g2
);

1671 
	`OF_REMOVE_NODE_FROM_LIST
(
pÜt_’Œy_p
->
©Œibu‹s
,
©Œibu‹_’Œy_p
,
´ev_­p_’Œy_p
,
l¡off£t
);

1672 
pÜt_’Œy_p
->
numb”_of_©Œibu‹s
--;

1674 
	`üm_»move_pÜt_v›w_’Œy
(
©Œibu‹_’Œy_p
->
Çme
,‡‰ribu‹_’Œy_p->
v®ue
);

1675 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1676 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
,"Attribute deletion successful");

1677  
CRM_SUCCESS
;

1679 
´ev_­p_’Œy_p
 = 
©Œibu‹_’Œy_p
;

1682 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1683 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
,"Attribute deletion failed");

1684  
CRM_FAILURE
;

1685 
	}
}

1688 
št32_t
 
	$üm_g‘_pÜt_fœ¡_©Œibu‹
(* 
pÜt_Çme_p
,

1689 
üm_©Œibu‹_Çme_v®ue_ouut_šfo
 *
©Œibu‹_ouut_p
)

1691 
üm_pÜt
 *
pÜt_’Œy_p
;

1692 
št32_t
 
»tv®
;

1693 
ušt64_t
 
pÜt_hªdË
;

1695 if(
©Œibu‹_ouut_p
 =ğ
NULL
)

1696  
CRM_FAILURE
;

1698 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1701 
»tv®
 = 
	`üm_g‘_pÜt_hªdË
(
pÜt_Çme_p
 ,&
pÜt_hªdË
);

1702 if(
»tv®
 !ğ
CRM_SUCCESS
)

1704 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
,"crm_get_port_handle failed");

1705 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1708 
»tv®
 = 
	`üm_g‘_pÜt_byhªdË
(
pÜt_hªdË
, &
pÜt_’Œy_p
);

1709 if(
»tv®
 !ğ
CRM_SUCCESS
)

1711 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
,"crm_get_port_byhandle failed");

1712 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1715 
»tv®
 = 
	`üm_g‘_fœ¡_©Œibu‹
(&(
pÜt_’Œy_p
->
©Œibu‹s
), 
©Œibu‹_ouut_p
);

1717 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1718  
»tv®
;

1719 
	}
}

1722 
št32_t
 
	$üm_g‘_pÜt_Ãxt_©Œibu‹
(* 
pÜt_Çme_p
,

1723 * 
cu¼’t_©Œibu‹_Çme
,

1724 
üm_©Œibu‹_Çme_v®ue_ouut_šfo
 *
©Œibu‹_ouut_p
)

1726 
üm_pÜt
 *
pÜt_’Œy_p
;

1727 
št32_t
 
»tv®
;

1728 
ušt64_t
 
pÜt_hªdË
;

1730 if((
©Œibu‹_ouut_p
 =ğ
NULL
è|| (
cu¼’t_©Œibu‹_Çme
 == NULL))

1731  
CRM_FAILURE
;

1733 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1736 
»tv®
 = 
	`üm_g‘_pÜt_hªdË
(
pÜt_Çme_p
 ,&
pÜt_hªdË
);

1737 if(
»tv®
 !ğ
CRM_SUCCESS
)

1739 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1742 
»tv®
 = 
	`üm_g‘_pÜt_byhªdË
(
pÜt_hªdË
, &
pÜt_’Œy_p
);

1743 if(
»tv®
 !ğ
CRM_SUCCESS
)

1745 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1748 
»tv®
 = 
	`üm_g‘_Ãxt_©Œibu‹
(&(
pÜt_’Œy_p
->
©Œibu‹s
), 
cu¼’t_©Œibu‹_Çme
,

1749 
©Œibu‹_ouut_p
);

1751 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1752  
»tv®
;

1753 
	}
}

1755 
št32_t
 
	$üm_g‘_pÜt_exaù_©Œibu‹
(* 
pÜt_Çme_p
,

1756 * 
©Œibu‹_Çme_¡ršg
,

1757 
üm_©Œibu‹_Çme_v®ue_ouut_šfo
 *
©Œibu‹_ouut
)

1760 
üm_pÜt
 *
pÜt_’Œy_p
;

1761 
št32_t
 
»tv®
;

1762 
ušt64_t
 
pÜt_hªdË
;

1764 if(
©Œibu‹_Çme_¡ršg
 =ğ
NULL
)

1765  
CRM_ERROR_ATTRIBUTE_NAME_NULL
;

1766 if(
	`¡¾’
(
©Œibu‹_Çme_¡ršg
è> 
CRM_MAX_ATTRIBUTE_NAME_LEN
)

1767  
CRM_ERROR_INVALID_ATTRIBUTE_NAME_LEN
;

1769 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1772 
»tv®
 = 
	`üm_g‘_pÜt_hªdË
(
pÜt_Çme_p
 ,&
pÜt_hªdË
);

1773 if(
»tv®
 !ğ
CRM_SUCCESS
)

1775 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1778 
»tv®
 = 
	`üm_g‘_pÜt_byhªdË
(
pÜt_hªdË
, &
pÜt_’Œy_p
);

1779 if(
»tv®
 !ğ
CRM_SUCCESS
)

1781 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1784 
»tv®
 = 
	`üm_g‘_exaù_©Œibu‹
(&(
pÜt_’Œy_p
->
©Œibu‹s
), 
©Œibu‹_Çme_¡ršg
,
©Œibu‹_ouut
);

1786 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1787  
»tv®
;

1788 
	}
}

1790 
št32_t
 
	$üm_ü—‹_pÜt_v›w
(*
v›w_Çme
)

1792 
št32_t
 
šdex
 = 0, 
ii
;

1793 
ušt8_t
 
em±y_šdex_b
 = 0;

1795 
ii
 = 0;ii<
CRM_MAX_VIEW_DATABASE
 ; ii++)

1797 if(!
	`¡rcmp
(
pÜt_db_v›w
[
ii
].
v›w
 , 
v›w_Çme
))

1799 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"View‡lready created");

1800  
CRM_FAILURE
;

1802 if((
em±y_šdex_b
 =ğ0è&& (!
	`¡rcmp
(
pÜt_db_v›w
[
ii
].
v›w
 ,"")))

1804 
em±y_šdex_b
 = 1;

1805 
šdex
 = 
ii
;

1808 
	`¡rıy
(
pÜt_db_v›w
[
šdex
].
v›w
,
v›w_Çme
);

1809 
	`üm_v›w_hash_bË_š™
(&
pÜt_db_v›w
[
šdex
].
db_v›wtbl_p
);

1810 
pÜt_db_v›w
[
šdex
].
uniqu’ess_æag
 = 
FALSE
;

1811 
pÜt_db_v›w
[
šdex
].
v®id_b
 = 
TRUE
;

1813 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_DEBUG
, "View‚ode created succesfully");

1814  
CRM_SUCCESS
;

1815 
	}
}

1818 
št32_t
 
	$üm_ü—‹_pÜt_v›w_’Œy
(
ušt64_t
 
vm_hªdË
 , * 
v›w_Çme
 ,* 
v›w_v®ue
)

1820 
d©aba£_v›w_node
 *
v›w_node_’Œy_p
;

1821 
št32_t
 
v›w_šdex
;

1822 
ušt32_t
 
šdex
,
magic
;

1823 
št32_t
 
¡©us
 = 
CRM_SUCCESS
;

1824 
ušt32_t
 
hashkey
;

1825 
ušt8_t
 
¡©us_b
,
v›w_found_b
 = 0;

1829 
v›w_šdex
 = 0;v›w_šdex < 
CRM_MAX_VIEW_DATABASE
 ; view_index++)

1831 if(!
	`¡rcmp
(
pÜt_db_v›w
[
v›w_šdex
].
v›w
 ,
v›w_Çme
))

1833 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_DEBUG
, "Viewƒntry can be made.");

1834 
v›w_found_b
 = 1;

1838 if(
v›w_found_b
 == 0)

1840 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_ERROR
,"View hashable‚ot initialized");

1841 
¡©us
 = 
CRM_FAILURE
;

1844 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
v›w_v®ue
,
üm_no_of_pÜt_buck‘s_g
);

1845 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1846 
v›w_node_’Œy_p
 = 
	`üm_®loc_v›w_’Œy_ªd_£t_v®ues
(
vm_hªdË
, 
v›w_Çme
, 
v›w_v®ue
);

1847 ià(
v›w_node_’Œy_p
 =ğ
NULL
)

1849 
¡©us
 = 
CRM_FAILURE
;

1852 
	`MCHASH_APPEND_NODE
(
pÜt_db_v›w
[
v›w_šdex
].
db_v›wtbl_p
,
hashkey
,
v›w_node_’Œy_p
,
šdex
,
magic
,v›w_node_’Œy_p,
¡©us_b
);

1853 if(
FALSE
 =ğ
¡©us_b
)

1855 
¡©us
 = 
CRM_FAILURE
;

1856 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1859 
v›w_node_’Œy_p
->
magic
 = magic;

1860 
v›w_node_’Œy_p
->
šdex
 = index;

1861 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_DEBUG
,"Viewƒntry succesfuuly‡dded");

1862 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1865  
¡©us
;

1866 
	}
}

1869 
št32_t
 
	$üm_»move_pÜt_v›w_’Œy
(* 
v›w_Çme
,* 
v›w_v®ue
)

1871 
d©aba£_v›w_node
 *
v›w_node_’Œy_p
;

1872 
št32_t
 
šdex
 , 
off£t
 = 0;

1873 
št32_t
 
¡©us
 = 
CRM_SUCCESS
;

1874 
ušt32_t
 
hashkey
;

1875 
ušt8_t
 
¡©us_b
,
v›w_found_b
 = 0;

1879 
šdex
 = 0;šdex<
CRM_MAX_VIEW_DATABASE
;index++)

1881 if(!
	`¡rcmp
(
pÜt_db_v›w
[
šdex
].
v›w
,
v›w_Çme
))

1883 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_DEBUG
,"View found forhis view‚ame");

1884 
v›w_found_b
 = 1;

1888 if(
v›w_found_b
 == 0)

1890 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_ERROR
,"View‚ot initiliazed forhe view‚ame.So‚oƒntriesƒxist");

1891 
¡©us
 = 
CRM_FAILURE
;

1893 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
v›w_v®ue
,
üm_no_of_pÜt_buck‘s_g
);

1894 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1895 
	`MCHASH_BUCKET_SCAN
(
pÜt_db_v›w
[
šdex
].
db_v›wtbl_p
,
hashkey
, 
v›w_node_’Œy_p
,
d©aba£_v›w_node
 *,
off£t
)

1897 ià((!
	`¡rcmp
(
v›w_node_’Œy_p
->
v›w_v®ue
, view_value)) &&

1898 (!
	`¡rcmp
(
v›w_node_’Œy_p
->
node_Çme
, 
v›w_Çme
)))

1900 
¡©us_b
 = 
FALSE
;

1901 
off£t
 = 0;

1902 
	`MCHASH_DELETE_NODE_BY_REF
(
pÜt_db_v›w
[
šdex
].
db_v›wtbl_p
,
v›w_node_’Œy_p
->šdex,v›w_node_’Œy_p->
magic
,
d©aba£_v›w_node
 *,
off£t
,
¡©us_b
);

1903 ià(
¡©us_b
 =ğ
FALSE
)

1905 
¡©us
 = 
CRM_FAILURE
;

1908 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_DEBUG
,"Viewƒntry deleted successfully");

1909 
¡©us
 = 
CRM_SUCCESS
;

1915 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1916  
¡©us
;

1917 
	}
}

1919 
št32_t
 
	$üm_»move_pÜt_v›w
(*
v›w_Çme
)

1921 
d©aba£_v›w_node
 *
v›w_node_’Œy_p
;

1922 
št32_t
 
šdex
 , 
hashkey
 , 
off£t
, 
»t_v®
;

1923 
ušt8_t
 
node_found_b
 = 0;

1925 
šdex
 = 0;šdex<
CRM_MAX_VIEW_DATABASE
 ; index++)

1927 if(!
	`¡rcmp
(
pÜt_db_v›w
[
šdex
].
v›w
 , 
v›w_Çme
))

1929 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"View foundo deleted");

1930 
node_found_b
 = 1;

1934 if(
node_found_b
 == 0)

1936 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Node‚ot found ");

1937  
CRM_FAILURE
;

1940 
node_found_b
 = 0;

1941 
off£t
 = 0;

1942 
	`MCHASH_TABLE_SCAN
(
pÜt_db_v›w
[
šdex
].
db_v›wtbl_p
,
hashkey
)

1944 
	`MCHASH_BUCKET_SCAN
(
pÜt_db_v›w
[
šdex
].
db_v›wtbl_p
,
hashkey
, 
v›w_node_’Œy_p
,
d©aba£_v›w_node
 *,
off£t
)

1946 if(
	`¡rcmp
(
v›w_node_’Œy_p
->
v›w_v®ue
 , ""))

1948 
node_found_b
 = 1;

1953 if(
node_found_b
 == 1)

1955 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Remove viewƒntireso„emoveheƒntire view");

1956  
CRM_FAILURE
;

1958 
»t_v®
 = 
	`üm_v›w_hash_bË_deš™
(
pÜt_db_v›w
[
šdex
].
db_v›wtbl_p
);

1959 if(
»t_v®
 !ğ
CRM_SUCCESS
)

1961 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Hash Table deinit failed");

1962  
CRM_FAILURE
;

1964 
	`¡rıy
(
pÜt_db_v›w
[
šdex
].
v›w
,"");

1965 
pÜt_db_v›w
[
šdex
].
uniqu’ess_æag
 = 
FALSE
;

1966 
pÜt_db_v›w
[
šdex
].
v®id_b
 = 
FALSE
;

1968 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_DEBUG
, "View‚ode deleted succesfully");

1969  
CRM_SUCCESS
;

1970 
	}
}

1972 
št32_t
 
	$üm_g‘_fœ¡_pÜt_v›w_’Œy
(*
v›w_Çme
 , 
d©aba£_v›w_node
 *
pÜt_v›w_node
)

1974 
št32_t
 
šdex
;

1975 
ušt8_t
 
node_found_b
 = 0 ;

1976 
št32_t
 
hashkey
 ,
off£t
 ;

1977 
d©aba£_v›w_node
 *
v›w_node_’Œy_p
;

1979 
šdex
 = 0;šdex<
CRM_MAX_VIEW_DATABASE
 ; index++)

1981 if(!
	`¡rcmp
(
pÜt_db_v›w
[
šdex
].
v›w
 , 
v›w_Çme
))

1983 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"View found ");

1984 
node_found_b
 = 1;

1988 if(
node_found_b
 == 0)

1990 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Node‚ot found ");

1991  
CRM_FAILURE
;

1993 
node_found_b
 = 0;

1994 
off£t
 = 0;

1995 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1996 
	`MCHASH_TABLE_SCAN
(
pÜt_db_v›w
[
šdex
].
db_v›wtbl_p
 ,
hashkey
)

1998 
	`MCHASH_BUCKET_SCAN
(
pÜt_db_v›w
[
šdex
].
db_v›wtbl_p
,
hashkey
, 
v›w_node_’Œy_p
,
d©aba£_v›w_node
 *,
off£t
)

2000 
	`¡rıy
(
pÜt_v›w_node
->
v›w_v®ue
 , 
v›w_node_’Œy_p
->view_value);

2001 
	`¡rıy
(
pÜt_v›w_node
->
node_Çme
 , 
v›w_node_’Œy_p
->node_name);

2002 
node_found_b
 = 1;

2005 if(
node_found_b
)

2008 if(
node_found_b
 == 0)

2010 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2011 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Nodeƒntry NOT found");

2012  
CRM_FAILURE
;

2014 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2015 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Nodeƒntry found");

2016  
CRM_SUCCESS
;

2017 
	}
}

2019 
št32_t
 
	$üm_g‘_Ãxt_pÜt_v›w_’Œy
(*
v›w_Çme
 , *
v›w_v®ue
 ,
d©aba£_v›w_node
 *
pÜt_v›w_node
)

2022 
št32_t
 
šdex
;

2023 
ušt8_t
 
node_found_b
 = 0 ;

2024 
št32_t
 
hashkey
 ,
off£t
 ;

2025 
d©aba£_v›w_node
 *
v›w_node_’Œy_p
;

2027 
šdex
 = 0;šdex<
CRM_MAX_VIEW_DATABASE
 ; index++)

2029 if(!
	`¡rcmp
(
pÜt_db_v›w
[
šdex
].
v›w
 , 
v›w_Çme
))

2031 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"View found ");

2032 
node_found_b
 = 1;

2036 if(
node_found_b
 == 0)

2038 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Node‚ot found ");

2039  
CRM_FAILURE
;

2041 
node_found_b
 =0;

2042 
off£t
 = 0;

2043 
	`CNTLR_RCU_READ_LOCK_TAKE
();

2044 
	`MCHASH_TABLE_SCAN
(
pÜt_db_v›w
[
šdex
].
db_v›wtbl_p
 ,
hashkey
)

2046 
	`MCHASH_BUCKET_SCAN
(
pÜt_db_v›w
[
šdex
].
db_v›wtbl_p
,
hashkey
, 
v›w_node_’Œy_p
,
d©aba£_v›w_node
 *,
off£t
)

2048 if(
node_found_b
 == 0)

2050 if(!
	`¡rcmp
(
v›w_node_’Œy_p
->
node_Çme
 , 
v›w_Çme
) &&

2051 (!
	`¡rcmp
(
v›w_node_’Œy_p
->
v›w_v®ue
 , view_value)))

2053 
node_found_b
 = 1;

2061 
	`¡rıy
(
pÜt_v›w_node
->
v›w_v®ue
 , 
v›w_node_’Œy_p
->view_value);

2062 
	`¡rıy
(
pÜt_v›w_node
->
node_Çme
 , 
v›w_node_’Œy_p
->node_name);

2066 if(
node_found_b
 == 0)

2068 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2069 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Nodeƒntry NOT found");

2070  
CRM_FAILURE
;

2072 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2073 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Nodeƒntry found");

2074  
CRM_SUCCESS
;

2075 
	}
}

2077 
št32_t
 
	$üm_g‘_exaù_pÜt_v›w_’Œy
(*
v›w_Çme
 , *
v›w_v®ue
 ,
d©aba£_v›w_node
 *
pÜt_v›w_node
)

2080 
št32_t
 
šdex
;

2081 
ušt8_t
 
node_found_b
 = 0 ;

2082 
št32_t
 
hashkey
 ,
off£t
 ;

2083 
d©aba£_v›w_node
 *
v›w_node_’Œy_p
;

2085 
šdex
 = 0;šdex<
CRM_MAX_VIEW_DATABASE
 ; index++)

2087 if(!
	`¡rcmp
(
pÜt_db_v›w
[
šdex
].
v›w
 , 
v›w_Çme
))

2089 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"View found ");

2090 
node_found_b
 = 1;

2094 if(
node_found_b
 == 0)

2096 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Node‚ot found ");

2097  
CRM_FAILURE
;

2099 
node_found_b
 =0;

2100 
off£t
 = 0;

2101 
	`CNTLR_RCU_READ_LOCK_TAKE
();

2102 
	`MCHASH_TABLE_SCAN
(
pÜt_db_v›w
[
šdex
].
db_v›wtbl_p
 ,
hashkey
)

2104 
	`MCHASH_BUCKET_SCAN
(
pÜt_db_v›w
[
šdex
].
db_v›wtbl_p
,
hashkey
, 
v›w_node_’Œy_p
,
d©aba£_v›w_node
 *,
off£t
)

2106 if(!
	`¡rcmp
(
v›w_node_’Œy_p
->
node_Çme
 , 
v›w_Çme
) &&

2107 (!
	`¡rcmp
(
v›w_node_’Œy_p
->
v›w_v®ue
 , view_value)))

2109 
node_found_b
 = 1;

2113 if(
node_found_b
)

2116 if(
node_found_b
 == 0)

2118 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2119 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Nodeƒntry NOT found");

2120  
CRM_FAILURE
;

2122 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2123 
	`¡rıy
(
pÜt_v›w_node
->
v›w_v®ue
 , 
v›w_node_’Œy_p
->view_value);

2124 
	`¡rıy
(
pÜt_v›w_node
->
node_Çme
 , 
v›w_node_’Œy_p
->node_name);

2125 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Nodeƒntry found");

2126  
CRM_SUCCESS
;

2127 
	}
}

2128 
št32_t
 
	$üm_g‘_vmpÜt_by_v›w
(*
v›w_Çme
 , *
v›w_v®ue
 ,
üm_pÜt_cÚfig_šfo
 *
üm_pÜt_šfo
)

2130 
št32_t
 
šdex
 , 
»t_v®
;

2131 
ušt8_t
 
node_found_b
 = 0 ;

2132 
št32_t
 
hashkey
 ,
off£t
 ;

2133 
d©aba£_v›w_node
 *
v›w_node_’Œy_p
;

2134 
üm_pÜt
 *
üm_pÜt_node_p
 = 
NULL
;

2136 
šdex
 = 0;šdex<
CRM_MAX_VIEW_DATABASE
 ; index++)

2138 if(!
	`¡rcmp
(
pÜt_db_v›w
[
šdex
].
v›w
 , 
v›w_Çme
))

2140 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"View found ");

2141 
node_found_b
 = 1;

2145 if(
node_found_b
 == 0)

2147 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Node‚ot found ");

2148  
CRM_FAILURE
;

2150 
node_found_b
 =0;

2151 
off£t
 = 0;

2152 
	`CNTLR_RCU_READ_LOCK_TAKE
();

2153 
	`MCHASH_TABLE_SCAN
(
pÜt_db_v›w
[
šdex
].
db_v›wtbl_p
 ,
hashkey
)

2155 
	`MCHASH_BUCKET_SCAN
(
pÜt_db_v›w
[
šdex
].
db_v›wtbl_p
,
hashkey
, 
v›w_node_’Œy_p
,
d©aba£_v›w_node
 *,
off£t
)

2157 if(!
	`¡rcmp
(
v›w_node_’Œy_p
->
node_Çme
 , 
v›w_Çme
) &&

2158 (!
	`¡rcmp
(
v›w_node_’Œy_p
->
v›w_v®ue
 , view_value)))

2160 
node_found_b
 = 1;

2164 if(
node_found_b
)

2167 if(
node_found_b
 == 0)

2169 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2170 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Nodeƒntry NOT found");

2171  
CRM_FAILURE
;

2174 
»t_v®
 = 
	`üm_g‘_pÜt_byhªdË
(
v›w_node_’Œy_p
->
node_§ã»f
 , &
üm_pÜt_node_p
);

2175 if(
»t_v®
 !ğ
CRM_SUCCESS
)

2177 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"No…ortƒxists");

2178  
CRM_FAILURE
;

2180 
	`¡rıy
(
üm_pÜt_šfo
->
pÜt_Çme
, 
üm_pÜt_node_p
->port_name);

2181 
üm_pÜt_šfo
->
pÜt_ty³
 = 
üm_pÜt_node_p
->
üm_pÜt_ty³
;

2182 
üm_pÜt_šfo
->
pÜtId
 = 
üm_pÜt_node_p
->
pÜt_id
;

2183 
	`¡rıy
(
üm_pÜt_šfo
->
vm_Çme
, 
üm_pÜt_node_p
->
vmInfo
.vm_name);

2184 
	`memıy
(
üm_pÜt_šfo
->
vm_pÜt_mac_p
, 
üm_pÜt_node_p
->
vmInfo
.
vm_pÜt_mac
, (crm_port_node_p->vmInfo.vm_port_mac));

2185 
	`¡rıy
(
üm_pÜt_šfo
->
br_Çme
, 
üm_pÜt_node_p
->
br1_Çme
);

2187 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2188  
CRM_SUCCESS
;

2189 
	}
}

2191 
št32_t
 
	$üm_g‘_nwpÜt_by_v›w
(*
v›w_Çme
 , *
v›w_v®ue
 ,
üm_nwpÜt_cÚfig_šfo
 *
üm_nwpÜt_šfo
)

2193 
št32_t
 
šdex
 , 
»t_v®
;

2194 
ušt8_t
 
node_found_b
 = 0 ;

2195 
št32_t
 
hashkey
 ,
off£t
 ;

2196 
d©aba£_v›w_node
 *
v›w_node_’Œy_p
;

2197 
üm_pÜt
 *
üm_pÜt_node_p
 = 
NULL
;

2199 
šdex
 = 0;šdex<
CRM_MAX_VIEW_DATABASE
 ; index++)

2201 if(!
	`¡rcmp
(
pÜt_db_v›w
[
šdex
].
v›w
 , 
v›w_Çme
))

2203 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"View found ");

2204 
node_found_b
 = 1;

2208 if(
node_found_b
 == 0)

2210 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Node‚ot found ");

2211  
CRM_FAILURE
;

2213 
node_found_b
 =0;

2214 
off£t
 = 0;

2215 
	`CNTLR_RCU_READ_LOCK_TAKE
();

2216 
	`MCHASH_TABLE_SCAN
(
pÜt_db_v›w
[
šdex
].
db_v›wtbl_p
 ,
hashkey
)

2218 
	`MCHASH_BUCKET_SCAN
(
pÜt_db_v›w
[
šdex
].
db_v›wtbl_p
,
hashkey
, 
v›w_node_’Œy_p
,
d©aba£_v›w_node
 *,
off£t
)

2220 if(!
	`¡rcmp
(
v›w_node_’Œy_p
->
node_Çme
 , 
v›w_Çme
) &&

2221 (!
	`¡rcmp
(
v›w_node_’Œy_p
->
v›w_v®ue
 , view_value)))

2223 
node_found_b
 = 1;

2227 if(
node_found_b
)

2230 if(
node_found_b
 == 0)

2232 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2233 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Nodeƒntry NOT found");

2234  
CRM_FAILURE
;

2237 
»t_v®
 = 
	`üm_g‘_pÜt_byhªdË
(
v›w_node_’Œy_p
->
node_§ã»f
 , &
üm_pÜt_node_p
);

2238 if(
»t_v®
 !ğ
CRM_SUCCESS
)

2240 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"No…ortƒxists");

2241  
CRM_FAILURE
;

2243 
	`¡rıy
(
üm_nwpÜt_šfo
->
pÜt_Çme
, 
üm_pÜt_node_p
->port_name);

2244 
üm_nwpÜt_šfo
->
pÜt_ty³
ğ
üm_pÜt_node_p
->
üm_pÜt_ty³
;

2245 
üm_nwpÜt_šfo
->
pÜtId
ğ
üm_pÜt_node_p
->
pÜt_id
;

2246 
üm_nwpÜt_šfo
->
nw_ty³
ğ
üm_pÜt_node_p
->nw_type;

2247 
	`¡rıy
(
üm_nwpÜt_šfo
->
sw™ch_Çme
, 
üm_pÜt_node_p
->switch_name);

2248 
	`¡rıy
(
üm_nwpÜt_šfo
->
br_Çme
, 
üm_pÜt_node_p
->
br1_Çme
);

2250 if(
üm_nwpÜt_šfo
->
nw_ty³
 =ğ
VLAN_TYPE
)

2252 (
üm_nwpÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
vÏn_šfo
.
vÏn_id
 = (
üm_pÜt_node_p
->
nw_·¿ms
).
vÏn_nw
.vlan_id;

2254 if(
üm_nwpÜt_šfo
->
nw_ty³
 =ğ
VXLAN_TYPE
)

2256 (
üm_nwpÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
vxÏn_šfo
.
£rviû_pÜt
 = (
üm_pÜt_node_p
->
nw_·¿ms
).
vxÏn_nw
.service_port;

2257 (
üm_nwpÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
vxÏn_šfo
.
»mÙe_
ğ(
üm_pÜt_node_p
->
nw_·¿ms
).
vxÏn_nw
.remote_ip;

2258 (
üm_nwpÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
vxÏn_šfo
.
nid
ğ(
üm_pÜt_node_p
->
nw_·¿ms
).
vxÏn_nw
.nid;

2260 if(
üm_nwpÜt_šfo
->
nw_ty³
 =ğ
NVGRE_TYPE
)

2262 (
üm_nwpÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
nvg»_šfo
.
£rviû_pÜt
 = (
üm_pÜt_node_p
->
nw_·¿ms
).
nvg»_nw
.service_port;

2263 (
üm_nwpÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
nvg»_šfo
.
»mÙe_
ğ(
üm_pÜt_node_p
->
nw_·¿ms
).
nvg»_nw
.remote_ip;

2264 (
üm_nwpÜt_šfo
->
nw_pÜt_cÚfig_šfo
).
nvg»_šfo
.
nid
ğ(
üm_pÜt_node_p
->
nw_·¿ms
).
nvg»_nw
.nid;

2267 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2268  
CRM_SUCCESS
;

2269 
	}
}

	@crm_subnet_api.c

30 
	~"üm_sy¡em_d•’d’c›s.h
"

31 
	~"üm_subÃt_­i.h
"

33 *
üm_subÃt_mempoŞ_g
;

34 
ušt32_t
 
üm_no_of_subÃt_buck‘s_g
;

35 
mchash_bË
* 
üm_subÃt_bË_g
;

36 
of_li¡_t
 
üm_subÃt_nÙifiÿtiÚs
[];

44 
št32_t
 
	$üm_g‘_subÃt_hªdË
(*
subÃt_Çme_p
, 
ušt64_t
 *
subÃt_hªdË_p
)

46 
ušt32_t
 
hashkey
;

47 
ušt32_t
 
off£t
;

49 
üm_subÃt
 *
subÃt_’Œy_p
 = 
NULL
;

51 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "crm_get_subnet_handle");

52 if(
üm_subÃt_bË_g
 =ğ
NULL
)

54 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "There is‚o subnet hashable!.");

55  
CRM_FAILURE
;

58 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
subÃt_Çme_p
, 
üm_no_of_subÃt_buck‘s_g
);

59 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "buck‘ = %d",
hashkey
);

62 
	`CNTLR_RCU_READ_LOCK_TAKE
();

63 
off£t
 = 
SUBNETNODE_SUBNETTBL_OFFSET
;

64 
	`MCHASH_BUCKET_SCAN
(
üm_subÃt_bË_g
,

65 
hashkey
,

66 
subÃt_’Œy_p
,

67 
üm_subÃt
*,

68 
off£t


71 if(
	`¡rcmp
(
subÃt_’Œy_p
->
subÃt_Çme
, 
subÃt_Çme_p
))

73 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

74 *
subÃt_hªdË_p
 = 
subÃt_’Œy_p
->
magic
;

75 *
subÃt_hªdË_p
 = ((*subÃt_hªdË_p<<32è| (
subÃt_’Œy_p
->
šdex
));

76 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "subÃˆÇmfound‡nd subÃˆhªdË:%Îx",*
subÃt_hªdË_p
);

77  
CRM_SUCCESS
;

79 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

80 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "subnet‚ame‚ot found!.");

81  
CRM_ERROR_SUBNET_NAME_INVALID
;

82 
	}
}

88 
št32_t
 
	$g‘_subÃt_byhªdË
(
ušt64_t
 
subÃt_hªdË
,
üm_subÃt
 **
üm_subÃt_šfo_p
)

91 
ušt32_t
 
šdex
,
magic
;

92 
ušt8_t
 
¡©us_b
;

94 
magic
 = (
ušt32_t
)(
subÃt_hªdË
 >>32);

95 
šdex
 = (
ušt32_t
)
subÃt_hªdË
;

97 
	`MCHASH_ACCESS_NODE
(
üm_subÃt_bË_g
,
šdex
,
magic
,*
üm_subÃt_šfo_p
,
¡©us_b
);

98 if(
TRUE
 =ğ
¡©us_b
)

99  
CRM_SUCCESS
;

100  
CRM_ERROR_INVALID_SUBNET_HANDLE
;

101 
	}
}

105 
št32_t
 
	$üm_add_subÃt
(
üm_subÃt_cÚfig_šfo
 *
sub_cÚfig_šfo_p
,

106 
ušt64_t
 *
ouut_subÃt_hªdË_p
)

110 
üm_subÃt
 *
üm_subÃt_node_p
=
NULL
;

111 
üm_subÃt
 *
üm_subÃt_node_sÿn_p
=
NULL
;

112 
ušt32_t
 
hashkey
 , 
šdex
 = 0, 
magic
 = 0 ;

113 
ušt32_t
 
subÃtoff£t
;

114 
št32_t
 
»t_v®ue
;

115 
ušt8_t
 
h—p_b
, 
¡©us_b
 = 
FALSE
;

116 
uch¬8_t
* 
hashobj_p
 = 
NULL
;

117 
ušt64_t
 
vn_hªdË
;

119 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Entered");

121 if(
üm_subÃt_bË_g
 =ğ
NULL
)

123 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "There is‚o subnet hashable!.")

124  
CRM_FAILURE
;

127 if((
sub_cÚfig_šfo_p
->
subÃt_Çme
 =ğ
NULL
)||

128 (
	`¡¾’
(
sub_cÚfig_šfo_p
->
subÃt_Çme
)>=
CRM_MAX_SUBNET_NAME_LEN
)

131 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Subnetwork‚ame is invalid");

132  
CRM_ERROR_SUBNET_NAME_INVALID
;

135 
»t_v®ue
 = 
	`üm_g‘_vn_hªdË
(
sub_cÚfig_šfo_p
->
vn_Çme
, &
vn_hªdË
);

136 if(
»t_v®ue
!=
CRM_SUCCESS
)

138 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Virtual‚etwork‚ame is invalid");

139  
CRM_ERROR_VN_NAME_INVALID
;

144 
	`CNTLR_RCU_READ_LOCK_TAKE
();

147 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
sub_cÚfig_šfo_p
->
subÃt_Çme
,

148 
üm_no_of_subÃt_buck‘s_g


150 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "buck‘ = %d",
hashkey
);

151 
subÃtoff£t
 = 
SUBNETNODE_SUBNETTBL_OFFSET
;

154 
	`MCHASH_BUCKET_SCAN
(
üm_subÃt_bË_g
, 
hashkey
, 
üm_subÃt_node_sÿn_p
, 
üm_subÃt
*, 
subÃtoff£t
)

156 if(
	`¡rcmp
(
sub_cÚfig_šfo_p
->
subÃt_Çme
, 
üm_subÃt_node_sÿn_p
->subnet_name) != 0)

158 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Du¶iÿ‹ subÃtwÜk‚ame(%s)", 
sub_cÚfig_šfo_p
->
subÃt_Çme
);

159 
»t_v®ue
 = 
CRM_ERROR_DUPLICATE_SUBNET_RESOURCE
;

160 
CRM_ADD_SUBNET_EXIT
;

164 
»t_v®ue
 = 
	`mempoŞ_g‘_mem_block
(
üm_subÃt_mempoŞ_g
, (
uch¬8_t
 **)&
üm_subÃt_node_p
, &
h—p_b
);

165 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

167 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Failedo‡llocate memory for subnetwork‚ode");

168 
CRM_ADD_SUBNET_EXIT
;

171 
üm_subÃt_node_p
->
h—p_b
 = heap_b;

174 
	`¡ºıy
(
üm_subÃt_node_p
->
subÃt_Çme
, 
sub_cÚfig_šfo_p
->subÃt_Çme, 
CRM_MAX_SUBNET_NAME_LEN
);

175 
	`¡ºıy
(
üm_subÃt_node_p
->
nw_Çme
, 
sub_cÚfig_šfo_p
->
vn_Çme
, 
CRM_MAX_VN_NAME_LEN
);

176 
üm_subÃt_node_p
->
’abË_dhı_b
 = 
sub_cÚfig_šfo_p
->enable_dhcp_b;

178 
üm_subÃt_node_p
->
poŞ_¡¬t_add»ss
 = 
sub_cÚfig_šfo_p
->pool_start_address;

179 
üm_subÃt_node_p
->
poŞ_’d_add»ss
 = 
sub_cÚfig_šfo_p
->pool_end_address;

180 
üm_subÃt_node_p
->
_v”siÚ
 = 
sub_cÚfig_šfo_p
->ip_version;

181 
üm_subÃt_node_p
->
g©eway_
 = 
sub_cÚfig_šfo_p
->gateway_ip;

182 
üm_subÃt_node_p
->
cidr_
 = 
sub_cÚfig_šfo_p
->cidr_ip;

183 
üm_subÃt_node_p
->
cidr_mask
 = 
sub_cÚfig_šfo_p
->cidr_mask;

185 
	`memıy
(&(
üm_subÃt_node_p
->
dns_Çme£rv”s
), &(
sub_cÚfig_šfo_p
->dns_nameservers), (sub_config_info_p->dns_nameservers));

187 
hashobj_p
=(
uch¬8_t
 *)
üm_subÃt_node_p
 + 
SUBNETNODE_SUBNETTBL_OFFSET
;

189 
	`MCHASH_APPEND_NODE
(
üm_subÃt_bË_g
, 
hashkey
, 
üm_subÃt_node_p
, 
šdex
, 
magic
, 
hashobj_p
, 
¡©us_b
);

190 if(
FALSE
 =ğ
¡©us_b
)

192 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
," Failedo‡ppend sub-network‚odeo Hashable");

193 
»t_v®ue
 = 
CRM_ERROR_SUBNET_ADD_FAIL
;

194 
CRM_ADD_SUBNET_EXIT
;

196 
	`OF_LIST_INIT
(
üm_subÃt_node_p
->
©Œibu‹s
, 
üm_©Œibu‹s_ä“_©Œibu‹_’Œy_rcu
);

198 *
ouut_subÃt_hªdË_p
 = 
magic
;

199 *
ouut_subÃt_hªdË_p
 = ((*ouut_subÃt_hªdË_°<<32è| (
šdex
));

201 
üm_subÃt_node_p
->
magic
 = magic;

202 
üm_subÃt_node_p
->
šdex
 = index;

203 (
üm_subÃt_node_p
->
subÃt_hªdË
èğ*
ouut_subÃt_hªdË_p
;

205 if(
	`üm_©ch_subÃt_hªdË_to_vn
(
vn_hªdË
,

206 
sub_cÚfig_šfo_p
->
subÃt_Çme
,

207 (
üm_subÃt_node_p
->
subÃt_hªdË
)

208 )!=
CRM_SUCCESS
)

210 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Attach subnet handleo vn failed!.");

212 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Attach subnet handleo vn successfully!.");

213 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Subnet Record‡ddedohe DB");

214 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

215  
CRM_SUCCESS
;

218 
CRM_ADD_SUBNET_EXIT
:

219 if(
üm_subÃt_node_p
)

221 if(
	`mempoŞ_»Ëa£_mem_block
(
üm_subÃt_mempoŞ_g
,

222 (
uch¬8_t
 *)
üm_subÃt_node_p
,

223 
üm_subÃt_node_p
->
h—p_b
)!=
MEMPOOL_SUCCESS
)

226 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Failedo„elease‡llocated memory block.");

230 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

231  
»t_v®ue
;

232 
	}
}

233 
št32_t
 
	$üm_modify_subÃt
(
üm_subÃt_cÚfig_šfo
 *
sub_cÚfig_šfo_p
,

234 
ušt64_t
 *
ouut_subÃt_hªdË_p
)

237 
üm_subÃt
 *
üm_subÃt_node_sÿn_p
=
NULL
;

238 
ušt32_t
 
hashkey
;

239 
ušt32_t
 
subÃtoff£t
,
subÃt_node_found
=0;

240 
št32_t
 
»t_v®ue
;

241 
ušt64_t
 
vn_hªdË
;

243 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Entered");

245 if(
üm_subÃt_bË_g
 =ğ
NULL
)

247 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "There is‚o subnet hashable!.")

248  
CRM_FAILURE
;

251 if((
sub_cÚfig_šfo_p
->
subÃt_Çme
 =ğ
NULL
)||

252 (
	`¡¾’
(
sub_cÚfig_šfo_p
->
subÃt_Çme
)>=
CRM_MAX_SUBNET_NAME_LEN
)

255 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Subnetwork‚ame is invalid");

256  
CRM_ERROR_SUBNET_NAME_INVALID
;

259 
»t_v®ue
 = 
	`üm_g‘_vn_hªdË
(
sub_cÚfig_šfo_p
->
vn_Çme
, &
vn_hªdË
);

260 if(
»t_v®ue
!=
CRM_SUCCESS
)

262 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Virtual‚etwork‚ame is invalid");

263  
CRM_ERROR_VN_NAME_INVALID
;

266 
	`CNTLR_RCU_READ_LOCK_TAKE
();

269 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
sub_cÚfig_šfo_p
->
subÃt_Çme
,

270 
üm_no_of_subÃt_buck‘s_g


272 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "buck‘ = %d",
hashkey
);

273 
subÃtoff£t
 = 
SUBNETNODE_SUBNETTBL_OFFSET
;

276 
	`MCHASH_BUCKET_SCAN
(
üm_subÃt_bË_g
, 
hashkey
, 
üm_subÃt_node_sÿn_p
, 
üm_subÃt
*, 
subÃtoff£t
)

278 if(!
	`¡rcmp
(
sub_cÚfig_šfo_p
->
subÃt_Çme
, 
üm_subÃt_node_sÿn_p
->subnet_name))

280 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "subÃtwÜk‚ame(%sèfoundØmodify", 
sub_cÚfig_šfo_p
->
subÃt_Çme
);

281 
subÃt_node_found
 =1;

285 if(!
subÃt_node_found
)

287 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "subÃtwÜk‚ame(%sènÙ foundØmodify", 
sub_cÚfig_šfo_p
->
subÃt_Çme
);

288 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

289  
CRM_ERROR_DUPLICATE_SUBNET_RESOURCE
;

292 if(
	`üm_d‘ach_subÃt_hªdË_äom_vn
(
üm_subÃt_node_sÿn_p
->
subÃt_Çme
, crm_subÃt_node_sÿn_p->
nw_Çme
)!=
CRM_SUCCESS
)

294 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

295 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Detach subnet handle from vn failed!.");

296  
CRM_FAILURE
;

298 if(
	`üm_©ch_subÃt_hªdË_to_vn
(
vn_hªdË
,

299 
sub_cÚfig_šfo_p
->
subÃt_Çme
,

300 (
üm_subÃt_node_sÿn_p
->
subÃt_hªdË
)

301 )!=
CRM_SUCCESS
)

303 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

304 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Attach subnet handleo vn failed!.");

305  
CRM_FAILURE
;

308 
	`¡ºıy
(
üm_subÃt_node_sÿn_p
->
nw_Çme
, 
sub_cÚfig_šfo_p
->
vn_Çme
, 
CRM_MAX_VN_NAME_LEN
);

309 
üm_subÃt_node_sÿn_p
->
’abË_dhı_b
 = 
sub_cÚfig_šfo_p
->enable_dhcp_b;

310 
	`memıy
(&(
üm_subÃt_node_sÿn_p
->
dns_Çme£rv”s
), &(
sub_cÚfig_šfo_p
->dns_nameservers), (sub_config_info_p->dns_nameservers));

312 
üm_subÃt_node_sÿn_p
->
poŞ_¡¬t_add»ss
 = 
sub_cÚfig_šfo_p
->pool_start_address;

313 
üm_subÃt_node_sÿn_p
->
poŞ_’d_add»ss
 = 
sub_cÚfig_šfo_p
->pool_end_address;

314 
üm_subÃt_node_sÿn_p
->
_v”siÚ
 = 
sub_cÚfig_šfo_p
->ip_version;

315 
üm_subÃt_node_sÿn_p
->
g©eway_
 = 
sub_cÚfig_šfo_p
->gateway_ip;

316 
üm_subÃt_node_sÿn_p
->
cidr_
 = 
sub_cÚfig_šfo_p
->cidr_ip;

317 
üm_subÃt_node_sÿn_p
->
cidr_mask
 = 
sub_cÚfig_šfo_p
->cidr_mask;

319 *
ouut_subÃt_hªdË_p
 = 
üm_subÃt_node_sÿn_p
->
subÃt_hªdË
;

321 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Subnet Modified Successfully!");

322 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

323  
CRM_SUCCESS
;

326 
	}
}

333 
št32_t
 
	$üm_d–_subÃt
(* 
subÃt_Çme_p
)

335 
üm_subÃt
 *
üm_subÃt_node_sÿn_p
=
NULL
;

336 
ušt32_t
 
hashkey
, 
off£t
;

337 
ušt8_t
 
¡©us_b
 = 
FALSE
;

338 
ušt8_t
 
subÃt_node_found
=0;

339 
št32_t
 
»t_v®
;

341 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Entered");

343 if(
üm_subÃt_bË_g
 =ğ
NULL
)

345 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "There is‚o subnet hashable!.")

346  
CRM_FAILURE
;

349 if((
subÃt_Çme_p
 =ğ
NULL
))

351 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Subnetwork‚ame is invalid");

352  
CRM_ERROR_SUBNET_NAME_INVALID
;

357 
	`CNTLR_RCU_READ_LOCK_TAKE
();

360 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
subÃt_Çme_p
, 
üm_no_of_subÃt_buck‘s_g
);

362 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "buck‘ = %d",
hashkey
);

363 
off£t
 = 
SUBNETNODE_SUBNETTBL_OFFSET
;

366 
	`MCHASH_BUCKET_SCAN
(
üm_subÃt_bË_g
, 
hashkey
, 
üm_subÃt_node_sÿn_p
, 
üm_subÃt
*, 
off£t
)

368 if(!
	`¡rcmp
(
subÃt_Çme_p
, 
üm_subÃt_node_sÿn_p
->
subÃt_Çme
))

370 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Subnetwork‚ame foundo delete");

371 
subÃt_node_found
 = 1;

377 if(
subÃt_node_found
 == 1)

379 if(
	`üm_d‘ach_subÃt_hªdË_äom_vn
(
subÃt_Çme_p
,(
üm_subÃt_node_sÿn_p
->
nw_Çme
))!=
CRM_SUCCESS
)

381 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "dettach subnet handle from vn failed!.");

384 
¡©us_b
 = 
FALSE
;

385 
off£t
 = 
SUBNETNODE_SUBNETTBL_OFFSET
;

386 
	`MCHASH_DELETE_NODE_BY_REF
(
üm_subÃt_bË_g
,

387 
üm_subÃt_node_sÿn_p
->
šdex
,

388 
üm_subÃt_node_sÿn_p
->
magic
,

389 
üm_subÃt
 *,

390 
off£t
,

391 
¡©us_b
);

393 if(
¡©us_b
 =ğ
TRUE
)

395 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Subnet deleted successfully!");

396 
»t_v®
 = 
CRM_SUCCESS
;

400 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Subnet deletion failed!");

401 
»t_v®
ğ
CRM_FAILURE
;

407 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Subnetwork‚ame‚ot foundo delete!");

408 
»t_v®
=
CRM_ERROR_SUBNET_NAME_INVALID
;

411 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

412 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
," Subnetwork deleted successfully");

413  
»t_v®
;

414 
	}
}

418 
št32_t
 
	$üm_g‘_subÃt_by_Çme
(* 
subÃt_Çme_p
,

419 
üm_subÃt_cÚfig_šfo
* 
üm_subÃt_cÚfig_šfo_p
,

420 
subÃt_ruÁime_šfo
 *
ruÁime_šfo
)

422 
št32_t
 
»t_v®
=
CRM_FAILURE
;

423 
ušt8_t
 
subÃt_node_found
=0;

424 
üm_subÃt
 *
üm_subÃt_node_sÿn_p
=
NULL
;

425 
ušt32_t
 
hashkey
, 
off£t
;

427 if(
üm_subÃt_bË_g
 =ğ
NULL
)

428  
CRM_FAILURE
;

430 if(
subÃt_Çme_p
 =ğ
NULL
)

431  
CRM_ERROR_SUBNET_NAME_INVALID
;

433 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "subÃt_Çm%s",
subÃt_Çme_p
);

434 
	`CNTLR_RCU_READ_LOCK_TAKE
();

437 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
subÃt_Çme_p
, 
üm_no_of_subÃt_buck‘s_g
);

438 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "buck‘ = %d",
hashkey
);

440 
off£t
 = 
SUBNETNODE_SUBNETTBL_OFFSET
;

443 
	`MCHASH_BUCKET_SCAN
(
üm_subÃt_bË_g
, 
hashkey
, 
üm_subÃt_node_sÿn_p
, 
üm_subÃt
*, 
off£t
)

445 if(!
	`¡rcmp
(
subÃt_Çme_p
, 
üm_subÃt_node_sÿn_p
->
subÃt_Çme
))

447 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Subnetwork found");

448 
subÃt_node_found
 = 1;

454 if(
subÃt_node_found
 == 1)

456 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Copying Subnetwork Info...");

457 
	`¡ºıy
(
üm_subÃt_cÚfig_šfo_p
->
subÃt_Çme
, 
üm_subÃt_node_sÿn_p
->subÃt_Çme,
CRM_MAX_SUBNET_NAME_LEN
);

458 
	`¡ºıy
(
üm_subÃt_cÚfig_šfo_p
->
vn_Çme
, 
üm_subÃt_node_sÿn_p
->
nw_Çme
,
CRM_MAX_VN_NAME_LEN
);

459 
üm_subÃt_cÚfig_šfo_p
->
’abË_dhı_b
 = 
üm_subÃt_node_sÿn_p
->enable_dhcp_b;

461 
	`mempıy
(&(
üm_subÃt_cÚfig_šfo_p
->
dns_Çme£rv”s
), &(
üm_subÃt_node_sÿn_p
->dns_nameservers),

462 (
üm_subÃt_node_sÿn_p
->
dns_Çme£rv”s
));

464 
üm_subÃt_cÚfig_šfo_p
->
poŞ_¡¬t_add»ss
 = 
üm_subÃt_node_sÿn_p
->pool_start_address;

465 
üm_subÃt_cÚfig_šfo_p
->
poŞ_’d_add»ss
 = 
üm_subÃt_node_sÿn_p
->pool_end_address;

466 
üm_subÃt_cÚfig_šfo_p
->
_v”siÚ
 = 
üm_subÃt_node_sÿn_p
->ip_version;

467 
üm_subÃt_cÚfig_šfo_p
->
g©eway_
 = 
üm_subÃt_node_sÿn_p
->gateway_ip;

468 
üm_subÃt_cÚfig_šfo_p
->
cidr_
 = 
üm_subÃt_node_sÿn_p
->cidr_ip;

469 
üm_subÃt_cÚfig_šfo_p
->
cidr_mask
 = 
üm_subÃt_node_sÿn_p
->cidr_mask;

472 
»t_v®
 = 
CRM_SUCCESS
;

477 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "SubÃtwÜk‚Ù found\r\n",
__FUNCTION__
, 
__LINE__
);

478 
»t_v®
 = 
CRM_ERROR_SUBNET_NAME_INVALID
;

480 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

481  
»t_v®
;

482 
	}
}

486 
št32_t
 
	$üm_g‘_fœ¡_subÃt
 (
üm_subÃt_cÚfig_šfo
* 
üm_subÃt_cÚfig_šfo_p
,

487 
subÃt_ruÁime_šfo
 *
ruÁime_šfo
,

488 
ušt64_t
 *
subÃt_hªdË_p
)

490 
üm_subÃt
 *
üm_subÃt_node_sÿn_p
=
NULL
;

491 
ušt32_t
 
hashkey
;

493 
ušt32_t
 
off£t
;

495 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Entered");

497 if(
üm_subÃt_bË_g
 =ğ
NULL
)

498  
CRM_FAILURE
;

500 
	`CNTLR_RCU_READ_LOCK_TAKE
();

502 
	`MCHASH_TABLE_SCAN
(
üm_subÃt_bË_g
, 
hashkey
)

504 
off£t
 = 
SUBNETNODE_SUBNETTBL_OFFSET
;

505 
	`MCHASH_BUCKET_SCAN
(
üm_subÃt_bË_g
, 
hashkey
, 
üm_subÃt_node_sÿn_p
, 
üm_subÃt
 *, 
off£t
)

507 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Copying Subnetwork Info...");

508 
	`¡ºıy
(
üm_subÃt_cÚfig_šfo_p
->
subÃt_Çme
, 
üm_subÃt_node_sÿn_p
->subÃt_Çme,
CRM_MAX_SUBNET_NAME_LEN
);

510 
	`¡ºıy
(
üm_subÃt_cÚfig_šfo_p
->
vn_Çme
, 
üm_subÃt_node_sÿn_p
->
nw_Çme
,
CRM_MAX_VN_NAME_LEN
);

511 
üm_subÃt_cÚfig_šfo_p
->
’abË_dhı_b
 = 
üm_subÃt_node_sÿn_p
->enable_dhcp_b;

513 
	`mempıy
(&(
üm_subÃt_cÚfig_šfo_p
->
dns_Çme£rv”s
), &(
üm_subÃt_node_sÿn_p
->dns_nameservers),

514 (
üm_subÃt_node_sÿn_p
->
dns_Çme£rv”s
));

516 
üm_subÃt_cÚfig_šfo_p
->
poŞ_¡¬t_add»ss
 = 
üm_subÃt_node_sÿn_p
->pool_start_address;

517 
üm_subÃt_cÚfig_šfo_p
->
poŞ_’d_add»ss
 = 
üm_subÃt_node_sÿn_p
->pool_end_address;

518 
üm_subÃt_cÚfig_šfo_p
->
_v”siÚ
 = 
üm_subÃt_node_sÿn_p
->ip_version;

519 
üm_subÃt_cÚfig_šfo_p
->
g©eway_
 = 
üm_subÃt_node_sÿn_p
->gateway_ip;

520 
üm_subÃt_cÚfig_šfo_p
->
cidr_
 = 
üm_subÃt_node_sÿn_p
->cidr_ip;

521 
üm_subÃt_cÚfig_šfo_p
->
cidr_mask
 = 
üm_subÃt_node_sÿn_p
->cidr_mask;

527 *
subÃt_hªdË_p
 = 
üm_subÃt_node_sÿn_p
->
magic
;

528 *
subÃt_hªdË_p
 = ((*subÃt_hªdË_°<<32è| (
üm_subÃt_node_sÿn_p
->
šdex
));

530 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

531  
CRM_SUCCESS
;

534 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

535  
CRM_ERROR_NO_MORE_ENTRIES
;

537 
	}
}

539 
št32_t
 
	$üm_g‘_Ãxt_subÃt
 (
üm_subÃt_cÚfig_šfo
* 
üm_subÃt_cÚfig_šfo_p
,

540 
subÃt_ruÁime_šfo
 *
ruÁime_šfo
,

541 
ušt64_t
 *
subÃt_hªdË_p
)

543 
üm_subÃt
 *
üm_subÃt_node_sÿn_p
=
NULL
;

544 
ušt32_t
 
hashkey
;

545 
ušt8_t
 
cu¼’t_’Œy_found_b
;

547 
ušt32_t
 
off£t
 = 
SUBNETNODE_SUBNETTBL_OFFSET
;

548 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Entered");

550 
	`CNTLR_RCU_READ_LOCK_TAKE
();

551 
cu¼’t_’Œy_found_b
 = 
FALSE
;

553 
	`MCHASH_TABLE_SCAN
(
üm_subÃt_bË_g
, 
hashkey
)

555 
off£t
 = 
SUBNETNODE_SUBNETTBL_OFFSET
;

556 
	`MCHASH_BUCKET_SCAN
(
üm_subÃt_bË_g
, 
hashkey
, 
üm_subÃt_node_sÿn_p
, 
üm_subÃt
 *,
off£t
)

558 if(
cu¼’t_’Œy_found_b
 =ğ
FALSE
)

560 if(*
subÃt_hªdË_p
 !ğ(
üm_subÃt_node_sÿn_p
->
subÃt_hªdË
))

565 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Subnetworkƒntry found copy‚ext subnetwork!.");

566 
cu¼’t_’Œy_found_b
 = 
TRUE
;

572 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Copying Subnetwork Info...");

573 
	`¡ºıy
(
üm_subÃt_cÚfig_šfo_p
->
subÃt_Çme
, 
üm_subÃt_node_sÿn_p
->subÃt_Çme,
CRM_MAX_SUBNET_NAME_LEN
);

574 
üm_subÃt_cÚfig_šfo_p
->
’abË_dhı_b
 = 
üm_subÃt_node_sÿn_p
->enable_dhcp_b;

575 
	`¡ºıy
(
üm_subÃt_cÚfig_šfo_p
->
vn_Çme
, 
üm_subÃt_node_sÿn_p
->
nw_Çme
,
CRM_MAX_VN_NAME_LEN
);

577 
	`mempıy
(&(
üm_subÃt_cÚfig_šfo_p
->
dns_Çme£rv”s
), &(
üm_subÃt_node_sÿn_p
->dns_nameservers),

578 (
üm_subÃt_node_sÿn_p
->
dns_Çme£rv”s
));

580 
üm_subÃt_cÚfig_šfo_p
->
poŞ_¡¬t_add»ss
 = 
üm_subÃt_node_sÿn_p
->pool_start_address;

581 
üm_subÃt_cÚfig_šfo_p
->
poŞ_’d_add»ss
 = 
üm_subÃt_node_sÿn_p
->pool_end_address;

582 
üm_subÃt_cÚfig_šfo_p
->
_v”siÚ
 = 
üm_subÃt_node_sÿn_p
->ip_version;

583 
üm_subÃt_cÚfig_šfo_p
->
g©eway_
 = 
üm_subÃt_node_sÿn_p
->gateway_ip;

584 
üm_subÃt_cÚfig_šfo_p
->
cidr_
 = 
üm_subÃt_node_sÿn_p
->cidr_ip;

585 
üm_subÃt_cÚfig_šfo_p
->
cidr_mask
 = 
üm_subÃt_node_sÿn_p
->cidr_mask;

591 *
subÃt_hªdË_p
 = 
üm_subÃt_node_sÿn_p
->
magic
;

592 *
subÃt_hªdË_p
 = ((*subÃt_hªdË_°<<32è| (
üm_subÃt_node_sÿn_p
->
šdex
));

595 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

596  
CRM_SUCCESS
;

599 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

600 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Failedo copy Subnetwork Info.....");

601 if(
cu¼’t_’Œy_found_b
 =ğ
TRUE
)

602  
CRM_ERROR_NO_MORE_ENTRIES
;

604  
CRM_ERROR_INVALID_SUBNET_HANDLE
;

606 
	}
}

608 
št32_t
 
	$üm_add_©Œibu‹_to_subÃt
(
ušt64_t
 
subÃt_hªdË
, 
üm_©Œibu‹_Çme_v®ue_·œ
* 
©Œibu‹_šfo_p
)

610 
št32_t
 
»tv®
;

611 
üm_subÃt
 *
subÃt_’Œy_p
;

612 
üm_subÃt_nÙifiÿtiÚ_d©a
 
nÙifiÿtiÚ_d©a
={};

613 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *
­p_’Œy_p
;

614 
uch¬8_t
 
l¡off£t
;

615 
l¡off£t
 = 
CRM_NOTIFICATION_APP_HOOK_OFFSET
;

618 
	`CNTLR_RCU_READ_LOCK_TAKE
();

620 
»tv®
 = 
	`g‘_subÃt_byhªdË
(
subÃt_hªdË
, &
subÃt_’Œy_p
);

621 if(
»tv®
 !ğ
CRM_SUCCESS
)

623 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

624  
»tv®
;

627 
»tv®
 = 
	`üm_add_©Œibu‹
(&(
subÃt_’Œy_p
->
©Œibu‹s
),
©Œibu‹_šfo_p
);

628 if(
»tv®
 !ğ
CRM_SUCCESS
)

630 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

631  
»tv®
;

634 
subÃt_’Œy_p
->
numb”_of_©Œibu‹s
++;

635 
	`of_ü—‹_üm_v›w_’Œy
(
subÃt_hªdË
, 
©Œibu‹_šfo_p
->
Çme_¡ršg
,‡‰ribu‹_šfo_p->
v®ue_¡ršg
);

637 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
subÃt_Çme
, 
subÃt_’Œy_p
->subnet_name);

638 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
©Œibu‹_Çme
,
©Œibu‹_šfo_p
->
Çme_¡ršg
);

639 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
©Œibu‹_v®ue
,
©Œibu‹_šfo_p
->
v®ue_¡ršg
);

640 
	`OF_LIST_SCAN
(
üm_subÃt_nÙifiÿtiÚs
[
CRM_SUBNET_ATTRIBUTE_ADDED
],
­p_’Œy_p
,
üm_nÙifiÿtiÚ_­p_hook_šfo
*,
l¡off£t
 )

642 ((
üm_subÃt_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_SUBNET_ATTRIBUTE_ADDED
,

643 
subÃt_hªdË
,

644 
nÙifiÿtiÚ_d©a
,

645 
­p_’Œy_p
->
cbk_¬g1
,

646 
­p_’Œy_p
->
cbk_¬g2
);

649 
	`OF_LIST_SCAN
(
üm_subÃt_nÙifiÿtiÚs
[
CRM_SUBNET_ALL_NOTIFICATIONS
],
­p_’Œy_p
,
üm_nÙifiÿtiÚ_­p_hook_šfo
*,
l¡off£t
 )

651 ((
üm_subÃt_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_SUBNET_ATTRIBUTE_ADDED
,

652 
subÃt_hªdË
,

653 
nÙifiÿtiÚ_d©a
,

654 
­p_’Œy_p
->
cbk_¬g1
,

655 
­p_’Œy_p
->
cbk_¬g2
);

657 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

658  
CRM_SUCCESS
;

659 
	}
}

662 
št32_t
 
	$üm_d–‘e_©Œibu‹_äom_subÃt
(
ušt64_t
 
subÃt_hªdË
, 
üm_©Œibu‹_Çme_v®ue_·œ
 *
©Œibu‹_šfo_p
)

665 
št32_t
 
»tv®
;

666 
üm_subÃt
 *
subÃt_’Œy_p
;

667 
üm_»sourû_©Œibu‹_’Œy
 *
©Œibu‹_’Œy_p
,*
´ev_­p_’Œy_p
 = 
NULL
;

669 
üm_subÃt_nÙifiÿtiÚ_d©a
 
nÙifiÿtiÚ_d©a
={};

670 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *
­p_’Œy_p
;

671 
uch¬8_t
 
l¡©ŒÇmeoff£t
;

672 
l¡©ŒÇmeoff£t
 = 
CRM_RESOURCE_ATTRIBUTE_ENTRY_LISTNODE_OFFSET
;

675 
	`CNTLR_RCU_READ_LOCK_TAKE
();

677 
»tv®
 = 
	`g‘_subÃt_byhªdË
(
subÃt_hªdË
, &
subÃt_’Œy_p
);

678 if(
»tv®
 !ğ
CRM_SUCCESS
)

680 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

681  
»tv®
;

683 
	`OF_LIST_SCAN
(
subÃt_’Œy_p
->
©Œibu‹s
, 
©Œibu‹_’Œy_p
, 
üm_»sourû_©Œibu‹_’Œy
*,
l¡©ŒÇmeoff£t
)

685 if(!
	`¡rcmp
(
©Œibu‹_’Œy_p
->
Çme
, 
©Œibu‹_šfo_p
->
Çme_¡ršg
))

688 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
subÃt_Çme
, 
subÃt_’Œy_p
->subnet_name);

689 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
©Œibu‹_Çme
,
©Œibu‹_’Œy_p
->
Çme
);

690 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
©Œibu‹_v®ue
,
©Œibu‹_’Œy_p
->
v®ue
);

691 
	`OF_LIST_SCAN
(
üm_subÃt_nÙifiÿtiÚs
[
CRM_SUBNET_ATTRIBUTE_DELETE
],
­p_’Œy_p
,
üm_nÙifiÿtiÚ_­p_hook_šfo
*, 
l¡©ŒÇmeoff£t
 )

693 ((
üm_subÃt_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_SUBNET_ATTRIBUTE_DELETE
,

694 
subÃt_hªdË
,

695 
nÙifiÿtiÚ_d©a
,

696 
­p_’Œy_p
->
cbk_¬g1
,

697 
­p_’Œy_p
->
cbk_¬g2
);

700 
	`OF_LIST_SCAN
(
üm_subÃt_nÙifiÿtiÚs
[
CRM_SUBNET_ALL_NOTIFICATIONS
],
­p_’Œy_p
,
üm_nÙifiÿtiÚ_­p_hook_šfo
*,
l¡©ŒÇmeoff£t
)

702 ((
üm_subÃt_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_SUBNET_ATTRIBUTE_DELETE
,

703 
subÃt_hªdË
,

704 
nÙifiÿtiÚ_d©a
,

705 
­p_’Œy_p
->
cbk_¬g1
,

706 
­p_’Œy_p
->
cbk_¬g2
);

710 
	`OF_REMOVE_NODE_FROM_LIST
(
subÃt_’Œy_p
->
©Œibu‹s
,
©Œibu‹_’Œy_p
,
´ev_­p_’Œy_p
, 
l¡©ŒÇmeoff£t
);

711 
subÃt_’Œy_p
->
numb”_of_©Œibu‹s
--;

712 
	`of_»move_üm_v›w_’Œy
(
©Œibu‹_’Œy_p
->
Çme
,‡‰ribu‹_’Œy_p->
v®ue
);

713 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

714  
CRM_SUCCESS
;

716 
´ev_­p_’Œy_p
 = 
©Œibu‹_’Œy_p
;

719 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

720  
CRM_FAILURE
;

721 
	}
}

724 
št32_t
 
	$üm_g‘_subÃt_fœ¡_©Œibu‹
(
ušt64_t
 
subÃt_hªdË
,

725 
üm_©Œibu‹_Çme_v®ue_ouut_šfo
 *
©Œibu‹_ouut_p
)

727 
št32_t
 
»tv®
;

728 
üm_subÃt
 *
üm_subÃt_’Œy_p
=
NULL
;

729 if(
©Œibu‹_ouut_p
 =ğ
NULL
)

730  
CRM_FAILURE
;

734 
	`CNTLR_RCU_READ_LOCK_TAKE
();

737 
»tv®
 = 
	`g‘_subÃt_byhªdË
(
subÃt_hªdË
, &
üm_subÃt_’Œy_p
);

738 if(
»tv®
 !ğ
CRM_SUCCESS
)

740 
»tv®
 = 
CRM_ERROR_INVALID_SUBNET_HANDLE
;

743 
»tv®
 = 
	`üm_g‘_fœ¡_©Œibu‹
(&(
üm_subÃt_’Œy_p
->
©Œibu‹s
), 
©Œibu‹_ouut_p
);

746 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

747  
»tv®
;

748 
	}
}

751 
št32_t
 
	$üm_g‘_subÃt_Ãxt_©Œibu‹
(
ušt64_t
 
subÃt_hªdË
,

752 * 
cu¼’t_©Œibu‹_Çme
,

753 
üm_©Œibu‹_Çme_v®ue_ouut_šfo
 *
©Œibu‹_ouut_p
)

755 
št32_t
 
»tv®
;

756 
üm_subÃt
 *
üm_subÃt_’Œy_p
=
NULL
;

758 if((
©Œibu‹_ouut_p
 =ğ
NULL
è|| (
cu¼’t_©Œibu‹_Çme
 == NULL))

759  
CRM_FAILURE
;

761 
	`CNTLR_RCU_READ_LOCK_TAKE
();

764 
»tv®
 = 
	`g‘_subÃt_byhªdË
(
subÃt_hªdË
,&
üm_subÃt_’Œy_p
);

765 if(
»tv®
 !ğ
CRM_SUCCESS
)

767 
»tv®
ğ
CRM_ERROR_INVALID_SUBNET_HANDLE
;

770 
»tv®
 = 
	`üm_g‘_Ãxt_©Œibu‹
(&(
üm_subÃt_’Œy_p
->
©Œibu‹s
), 
cu¼’t_©Œibu‹_Çme
, 
©Œibu‹_ouut_p
);

772 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

773  
»tv®
;

774 
	}
}

777 
št32_t
 
	$üm_g‘_subÃt_exaù_©Œibu‹
(
ušt64_t
 
subÃt_hªdË
,

778 *
©Œibu‹_Çme_¡ršg
,
üm_©Œibu‹_Çme_v®ue_ouut_šfo
 *
©Œibu‹_ouut
)

780 
üm_subÃt
 *
üm_subÃt_’Œy_p
=
NULL
;

781 
št32_t
 
»tv®
;

783 if(
©Œibu‹_Çme_¡ršg
 =ğ
NULL
)

784  
CRM_ERROR_ATTRIBUTE_NAME_NULL
;

786 if(
	`¡¾’
(
©Œibu‹_Çme_¡ršg
è> 
CRM_MAX_ATTRIBUTE_NAME_LEN
)

787  
CRM_ERROR_INVALID_ATTRIBUTE_NAME_LEN
;

789 
	`CNTLR_RCU_READ_LOCK_TAKE
();

792 
»tv®
 = 
	`g‘_subÃt_byhªdË
(
subÃt_hªdË
, &
üm_subÃt_’Œy_p
);

793 if(
»tv®
 !ğ
CRM_SUCCESS
)

795 
»tv®
ğ
CRM_ERROR_INVALID_SUBNET_HANDLE
;

798 
»tv®
 = 
	`üm_g‘_exaù_©Œibu‹
(&(
üm_subÃt_’Œy_p
->
©Œibu‹s
), 
©Œibu‹_Çme_¡ršg
,
©Œibu‹_ouut
);

800 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

801  
»tv®
;

802 
	}
}

	@crm_tenant_api.c

26 
	~"üm_sy¡em_d•’d’c›s.h
"

27 
	~"üm_‹ÇÁ_­i.h
"

31 *
üm_‹ÇÁ_mempoŞ_g
;

32 *
üm_‹ÇÁ_ns_chaš_mempoŞ_g
;

33 *
üm_‹ÇÁ_vÂames_mempoŞ_g
;

34 *
üm_nÙifiÿtiÚs_mempoŞ_g
;

35 
ušt32_t
 
üm_no_of_‹ÇÁ_buck‘s_g
;

36 
mchash_bË
* 
üm_‹ÇÁ_bË_g
;

38 
of_li¡_t
 
üm_‹ÇÁ_nÙifiÿtiÚs
[];

40 *
n¤m_‹ÇÁ_ns_chaš_mempoŞ_g
;

43 
üm_‹ÇÁ_vÂames_hªdË_ä“_’Œy_rcu
(
rcu_h—d
 *
vn_Çmes_’Œy_p
);

45 #ifdeà
NSRM


46 
	$üm_‹ÇÁ_ns_chaš_ä“_’Œy_rcu
(
rcu_h—d
 *
£rviû_chaš_’Œy_p
)

48 
üm_‹ÇÁ_ns_chaš_li¡
 *
ns_chaš_šfo_p
=
NULL
;

49 
št32_t
 
»t_v®ue
;

51 if(
£rviû_chaš_’Œy_p
)

53 
ns_chaš_šfo_p
 = (
üm_‹ÇÁ_ns_chaš_li¡
 *)(((*ês_chaš_šfo_pè- (
of_li¡_node_t
));

54 
»t_v®ue
 = 
	`mempoŞ_»Ëa£_mem_block
(
n¤m_‹ÇÁ_ns_chaš_mempoŞ_g
,

55 (
uch¬8_t
*)
ns_chaš_šfo_p
,

56 
ns_chaš_šfo_p
->
h—p_b
);

57 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

59 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_DEBUG
, "Failedo„elease memory block");

63 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_DEBUG
, "node deleted succesfully fromhe database");

68 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_DEBUG
, "NULL…assed for deletion");

70 
	}
}

80 
št32_t
 
	$üm_g‘_‹ÇÁ_hªdË
(*
‹ÇÁ_Çme_p
, 
ušt64_t
 *
‹ÇÁ_hªdË_p
)

82 
ušt32_t
 
hashkey
;

83 
ušt32_t
 
off£t
;

84 
üm_‹ÇÁ
 *
‹ÇÁ_’Œy_p
 = 
NULL
;

86 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "crm_get_tenant_handle");

87 if(
üm_‹ÇÁ_bË_g
 =ğ
NULL
)

89 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "There is‚oenant hashable!.");

90  
CRM_FAILURE
;

93 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
‹ÇÁ_Çme_p
, 
üm_no_of_‹ÇÁ_buck‘s_g
);

94 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "buck‘ = %d",
hashkey
);

97 
	`CNTLR_RCU_READ_LOCK_TAKE
();

98 
off£t
 = 
TENANT_NODE_TENANT_TBL_OFFSET
;

99 
	`MCHASH_BUCKET_SCAN
(
üm_‹ÇÁ_bË_g
, 
hashkey
, 
‹ÇÁ_’Œy_p
,
üm_‹ÇÁ
*,
off£t
)

101 if(
	`¡rcmp
(
‹ÇÁ_’Œy_p
->
‹ÇÁ_Çme
, 
‹ÇÁ_Çme_p
))

104 *
‹ÇÁ_hªdË_p
 = 
‹ÇÁ_’Œy_p
->
magic
;

105 *
‹ÇÁ_hªdË_p
 = ((*‹ÇÁ_hªdË_p<<32è| (
‹ÇÁ_’Œy_p
->
šdex
));

107 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "‹ÇÁ‚amfound‡nd’ªˆhªdË:%Îx",*
‹ÇÁ_hªdË_p
);

109 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

110  
CRM_SUCCESS
;

112 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

113 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "tenant‚ame‚ot found!.");

114  
CRM_ERROR_TENANT_NAME_INVALID
;

115 
	}
}

121 
št32_t
 
	$g‘_‹ÇÁ_byhªdË
(
ušt64_t
 
‹ÇÁ_hªdË
,
üm_‹ÇÁ
 **
üm_‹ÇÁ_šfo_p
)

124 
ušt32_t
 
šdex
,
magic
;

125 
ušt8_t
 
¡©us_b
;

127 
magic
 = (
ušt32_t
)(
‹ÇÁ_hªdË
 >>32);

128 
šdex
 = (
ušt32_t
)
‹ÇÁ_hªdË
;

130 
	`MCHASH_ACCESS_NODE
(
üm_‹ÇÁ_bË_g
,
šdex
,
magic
,*
üm_‹ÇÁ_šfo_p
,
¡©us_b
);

131 if(
TRUE
 =ğ
¡©us_b
)

132  
CRM_SUCCESS
;

133  
CRM_ERROR_INVALID_TENANT_HANDLE
;

134 
	}
}

139 
št32_t
 
	$üm_add_‹ÇÁ
(
üm_‹ÇÁ_cÚfig_šfo
 *
üm_‹ÇÁ_cÚfig_šfo_p
,

140 
ušt64_t
 *
ouut_‹ÇÁ_hªdË_p
)

143 
ušt32_t
 
hashkey
 ,
šdex
 = 0,
magic
 = 0 ;

144 
uch¬8_t
 
‹ÇÁoff£t
;

145 
uch¬8_t
 
­phookoff£t
;

146 
št32_t
 
»t_v®ue
;

147 
ušt8_t
 
h—p_b
, 
¡©us_b
 = 
FALSE
;

148 
uch¬8_t
* 
hashobj_p
 = 
NULL
;

150 
üm_‹ÇÁ
 *
üm_‹ÇÁ_node_p
=
NULL
;

151 
üm_‹ÇÁ
 *
üm_‹ÇÁ_node_sÿn_p
=
NULL
;

152 
üm_‹ÇÁ_nÙifiÿtiÚ_d©a
 
nÙifiÿtiÚ_d©a
={};

153 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *
­p_’Œy_p
=
NULL
;

156 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Entered");

158 if(
üm_‹ÇÁ_bË_g
 =ğ
NULL
)

160 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "noenant hashable!.")

161  
CRM_FAILURE
;

164 if((
üm_‹ÇÁ_cÚfig_šfo_p
->
‹ÇÁ_Çme
 =ğ
NULL
)||

165 (
	`¡¾’
(
üm_‹ÇÁ_cÚfig_šfo_p
->
‹ÇÁ_Çme
)>=
CRM_MAX_TENANT_NAME_LEN
)

168 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "tenant‚ame is invalid");

169  
CRM_ERROR_TENANT_NAME_INVALID
;

172 
	`CNTLR_RCU_READ_LOCK_TAKE
();

175 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
üm_‹ÇÁ_cÚfig_šfo_p
->
‹ÇÁ_Çme
,

176 
üm_no_of_‹ÇÁ_buck‘s_g
);

177 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "buck‘ = %d",
hashkey
);

179 
‹ÇÁoff£t
 = 
TENANT_NODE_TENANT_TBL_OFFSET
;

182 
	`MCHASH_BUCKET_SCAN
(
üm_‹ÇÁ_bË_g
, 
hashkey
,

183 
üm_‹ÇÁ_node_sÿn_p
,

184 
üm_‹ÇÁ
*,

185 
‹ÇÁoff£t


188 if(
	`¡rcmp
(
üm_‹ÇÁ_cÚfig_šfo_p
->
‹ÇÁ_Çme
, 
üm_‹ÇÁ_node_sÿn_p
->tenant_name) != 0)

190 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Du¶iÿ‹’ªtwÜk‚ame(%s)", 
üm_‹ÇÁ_cÚfig_šfo_p
->
‹ÇÁ_Çme
);

191 
»t_v®ue
 = 
CRM_ERROR_DUPLICATE_TENANT_RESOURCE
;

192 
CRM_ADD_TENANT_EXIT
;

196 
»t_v®ue
 = 
	`mempoŞ_g‘_mem_block
(
üm_‹ÇÁ_mempoŞ_g
,

197 (
uch¬8_t
 **)&
üm_‹ÇÁ_node_p
,

198 &
h—p_b


200 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

202 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Failedo get memory block");

203 
CRM_ADD_TENANT_EXIT
;

206 
üm_‹ÇÁ_node_p
->
h—p_b
 = heap_b;

208 
	`¡ºıy
(
üm_‹ÇÁ_node_p
->
‹ÇÁ_Çme
, 
üm_‹ÇÁ_cÚfig_šfo_p
->‹ÇÁ_Çme, 
CRM_MAX_TENANT_NAME_LEN
);

210 
hashobj_p
=(
uch¬8_t
 *)
üm_‹ÇÁ_node_p
 + 
TENANT_NODE_TENANT_TBL_OFFSET
;

211 
	`MCHASH_APPEND_NODE
(
üm_‹ÇÁ_bË_g
, 
hashkey
, 
üm_‹ÇÁ_node_p
, 
šdex
, 
magic
, 
hashobj_p
, 
¡©us_b
);

212 if(
FALSE
 =ğ
¡©us_b
)

214 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
," Failedo‡ppendenant‚odeo Hashable");

215 
»t_v®ue
 = 
CRM_ERROR_TENANT_ADD_FAIL
;

216 
CRM_ADD_TENANT_EXIT
;

219 *
ouut_‹ÇÁ_hªdË_p
 = 
magic
;

220 *
ouut_‹ÇÁ_hªdË_p
 = ((*ouut_‹ÇÁ_hªdË_°<<32è| (
šdex
));

222 
üm_‹ÇÁ_node_p
->
magic
 = magic;

223 
üm_‹ÇÁ_node_p
->
šdex
 = index;

224 (
üm_‹ÇÁ_node_p
->
‹ÇÁ_hªdË
èğ*
ouut_‹ÇÁ_hªdË_p
;

227 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "hªdË:%Îx",
üm_‹ÇÁ_node_p
->
‹ÇÁ_hªdË
);

229 
	`OF_LIST_INIT
(
üm_‹ÇÁ_node_p
->
li¡_of_vœtu®_ÃtwÜks
, 
üm_‹ÇÁ_vÂames_hªdË_ä“_’Œy_rcu
);

230 #ifdeà
NSRM


231 
	`OF_LIST_INIT
(
üm_‹ÇÁ_node_p
->
li¡_of_ns_chašs
, 
üm_‹ÇÁ_ns_chaš_ä“_’Œy_rcu
);

233 
	`OF_LIST_INIT
(
üm_‹ÇÁ_node_p
->
©Œibu‹s
, 
üm_©Œibu‹s_ä“_©Œibu‹_’Œy_rcu
);

236 
­phookoff£t
 = 
CRM_NOTIFICATION_APP_HOOK_OFFSET
;

237 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
‹ÇÁ_Çme
, 
üm_‹ÇÁ_node_p
->tenant_name);

239 
	`OF_LIST_SCAN
(
üm_‹ÇÁ_nÙifiÿtiÚs
[
CRM_TENANT_ADDED
],

240 
­p_’Œy_p
,

241 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *,

242 
­phookoff£t
 )

244 ((
üm_‹ÇÁ_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_TENANT_ADDED
,

245 *
ouut_‹ÇÁ_hªdË_p
,

246 
nÙifiÿtiÚ_d©a
,

247 
­p_’Œy_p
->
cbk_¬g1
,

248 
­p_’Œy_p
->
cbk_¬g2


252 
	`OF_LIST_SCAN
(
üm_‹ÇÁ_nÙifiÿtiÚs
[
CRM_TENANT_ALL_NOTIFICATIONS
],

253 
­p_’Œy_p
,

254 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *,

255 
­phookoff£t
 )

257 ((
üm_‹ÇÁ_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_TENANT_ADDED
,

258 *
ouut_‹ÇÁ_hªdË_p
,

259 
nÙifiÿtiÚ_d©a
,

260 
­p_’Œy_p
->
cbk_¬g1
,

261 
­p_’Œy_p
->
cbk_¬g2


264 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

265 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Tenant‡dded successfullyohe hashtable.");

266  
CRM_SUCCESS
;

268 
CRM_ADD_TENANT_EXIT
:

269 if(
üm_‹ÇÁ_node_p
)

271 if(
	`mempoŞ_»Ëa£_mem_block
(
üm_‹ÇÁ_mempoŞ_g
,

272 (
uch¬8_t
 *)
üm_‹ÇÁ_node_p
,

273 
üm_‹ÇÁ_node_p
->
h—p_b
)!=
MEMPOOL_SUCCESS
)

275 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Failedo„elease‡llocated memory block.");

279 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

280  
»t_v®ue
;

281 
	}
}

286 
	$üm_‹ÇÁ_vÂames_hªdË_ä“_’Œy_rcu
(
rcu_h—d
 *
vn_Çmes_’Œy_p
)

288 
üm_‹ÇÁ_vn_li¡
 *
vn_Çmes_šfo_p
=
NULL
;

289 
št32_t
 
»t_v®ue
;

291 if(
vn_Çmes_’Œy_p
)

293 
vn_Çmes_šfo_p
 = (
üm_‹ÇÁ_vn_li¡
 *)(((*)
vn_Çmes_’Œy_p
è- (
of_li¡_node_t
));

294 
»t_v®ue
 = 
	`mempoŞ_»Ëa£_mem_block
(
üm_‹ÇÁ_vÂames_mempoŞ_g
,

295 (
uch¬8_t
*)
vn_Çmes_šfo_p
,

296 
vn_Çmes_šfo_p
->
h—p_b
);

297 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

299 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Failedo„elease memory block");

303 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "node deleted succesfully fromhe database");

308 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "NULL…assed for deletion");

310 
	}
}

314 
št32_t
 
	$üm_add_vn_to_‹ÇÁ
(
ušt64_t
 
‹ÇÁ_hªdË
, *
vn_Çme_p
)

316 
št32_t
 
»t_v®ue
=
CRM_FAILURE
;

317 
ušt32_t
 
šdex
,
magic
;

318 
ušt8_t
 
h—p_b
, 
¡©us_b
 = 
FALSE
;

320 
üm_‹ÇÁ
 *
‹ÇÁ_šfo_p
=
NULL
;

321 
üm_‹ÇÁ_vn_li¡
 *
vn_li¡_p
=
NULL
;

322 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Entered");

326 
	`CNTLR_RCU_READ_LOCK_TAKE
();

329 
magic
 = (
ušt32_t
)(
‹ÇÁ_hªdË
 >>32);

330 
šdex
 = (
ušt32_t
)
‹ÇÁ_hªdË
;

332 
	`MCHASH_ACCESS_NODE
(
üm_‹ÇÁ_bË_g
,
šdex
,
magic
, 
‹ÇÁ_šfo_p
, 
¡©us_b
);

333 if(
TRUE
 !ğ
¡©us_b
)

334  
CRM_ERROR_INVALID_TENANT_HANDLE
;

337 
»t_v®ue
 = 
	`mempoŞ_g‘_mem_block
(
üm_‹ÇÁ_vÂames_mempoŞ_g
,

338 (
uch¬8_t
**)&
vn_li¡_p
,

339 &
h—p_b
);

340 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

342 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "failedo get mem block.");

343 
»t_v®ue
 = 
CRM_FAILURE
;

346 
vn_li¡_p
->
h—p_b
=heap_b;

348 
	`¡rıy
(
vn_li¡_p
->
nw_Çme
, 
vn_Çme_p
);

349 
vn_li¡_p
->
‹ÇÁ_’Œy_node_p
 = 
‹ÇÁ_šfo_p
;

350 
	`OF_APPEND_NODE_TO_LIST
((
‹ÇÁ_šfo_p
->
li¡_of_vœtu®_ÃtwÜks
),

351 
vn_li¡_p
,

352 
CRM_TENANT_VN_LIST_HANDLE_ENTRY_LISTNODE_OFFSET
);

353 
‹ÇÁ_šfo_p
->
numb”_of_vœtu®_ÃtwÜks
++;

354 
»t_v®ue
=
CRM_SUCCESS
;

356 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Added vnoheenant†ist successfully!.");

357 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

358  
»t_v®ue
;

359 
	}
}

362 
št32_t
 
	$üm_d–_vn_äom_‹ÇÁ
(
ušt64_t
 
‹ÇÁ_hªdË
, *
vn_Çme_p
)

364 
št32_t
 
»t_v®
=
CRM_FAILURE
;

365 
ušt32_t
 
šdex
,
magic
,
node_found
=0;

366 
ušt8_t
 
¡©us_b
 = 
FALSE
;

368 
üm_‹ÇÁ
 *
‹ÇÁ_šfo_p
=
NULL
;

369 
üm_‹ÇÁ_vn_li¡
 *
vn_li¡_sÿn_p
=
NULL
, *
vn_li¡_´ev_p
=NULL;

370 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Entered");

374 
	`CNTLR_RCU_READ_LOCK_TAKE
();

377 
magic
 = (
ušt32_t
)(
‹ÇÁ_hªdË
 >>32);

378 
šdex
 = (
ušt32_t
)
‹ÇÁ_hªdË
;

380 
	`MCHASH_ACCESS_NODE
(
üm_‹ÇÁ_bË_g
,
šdex
,
magic
, 
‹ÇÁ_šfo_p
, 
¡©us_b
);

381 if(
TRUE
 !ğ
¡©us_b
)

382  
CRM_ERROR_INVALID_TENANT_HANDLE
;

384 
	`OF_LIST_SCAN
((
‹ÇÁ_šfo_p
->
li¡_of_vœtu®_ÃtwÜks
), 
vn_li¡_sÿn_p
, 
üm_‹ÇÁ_vn_li¡
 *,

385 
CRM_TENANT_VN_LIST_HANDLE_ENTRY_LISTNODE_OFFSET
)

387 if(!
	`¡rcmp
(
vn_li¡_sÿn_p
->
nw_Çme
, 
vn_Çme_p
))

389 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "node foundo delete");

390 
node_found
=1;

393 
vn_li¡_´ev_p
 = 
vn_li¡_sÿn_p
;

395 if(
node_found
 == 0)

397 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "node‚ot foundo delete");

398 
»t_v®
=
CRM_FAILURE
;

402 
	`OF_REMOVE_NODE_FROM_LIST
((
‹ÇÁ_šfo_p
->
li¡_of_vœtu®_ÃtwÜks
),

403 
vn_li¡_sÿn_p
,

404 
vn_li¡_´ev_p
,

405 
CRM_TENANT_VN_LIST_HANDLE_ENTRY_LISTNODE_OFFSET
);

406 
‹ÇÁ_šfo_p
->
numb”_of_vœtu®_ÃtwÜks
--;

407 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "vn deleted successfully fromheenant");

408 
»t_v®
=
CRM_SUCCESS
;

410 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

411  
»t_v®
;

412 
	}
}

418 
št32_t
 
	$üm_d–_‹ÇÁ
(* 
‹ÇÁ_Çme_p
)

420 
üm_‹ÇÁ
 *
‹ÇÁ_šfo_p
=
NULL
;

421 
ušt32_t
 
l¡off£t
,
šdex
,
magic
,
off£t
;

422 
ušt8_t
 
¡©us_b
 = 
FALSE
;

423 
ušt64_t
 
‹ÇÁ_hªdË
;

424 
üm_‹ÇÁ_nÙifiÿtiÚ_d©a
 
nÙifiÿtiÚ_d©a
;

425 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *
­p_’Œy_p
=
NULL
;

428 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Entered");

429 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "‹ÇÁ_Çme:%s",
‹ÇÁ_Çme_p
);

431 if(
üm_‹ÇÁ_bË_g
 =ğ
NULL
)

433 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "There is‚oenant hashable!.")

434  
CRM_FAILURE
;

437 if((
‹ÇÁ_Çme_p
 =ğ
NULL
))

439 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Tenantwork‚ame is invalid");

440  
CRM_ERROR_TENANT_NAME_INVALID
;

444 if(
	`üm_g‘_‹ÇÁ_hªdË
(
‹ÇÁ_Çme_p
, &
‹ÇÁ_hªdË
è!=
CRM_SUCCESS
)

446 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "‹ÇÁ dÛ¢'ˆexi¡ w™h‚am%s",
‹ÇÁ_Çme_p
);

447  
CRM_ERROR_TENANT_NAME_INVALID
;

450 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "‹ÇÁ_hªdË:%Îx",
‹ÇÁ_hªdË
);

452 
magic
 = (
ušt32_t
)(
‹ÇÁ_hªdË
 >>32);

453 
šdex
 = (
ušt32_t
)
‹ÇÁ_hªdË
;

457 
	`CNTLR_RCU_READ_LOCK_TAKE
();

458 
	`MCHASH_ACCESS_NODE
(
üm_‹ÇÁ_bË_g
,
šdex
,
magic
,
‹ÇÁ_šfo_p
,
¡©us_b
);

459 if(
TRUE
 =ğ
¡©us_b
)

461 if((
‹ÇÁ_šfo_p
->
numb”_of_vœtu®_ÃtwÜks
)|| (‹ÇÁ_šfo_p->
numb”_of_©Œibu‹s
))

463 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
," Delete‡llhe vns‡nd‡ttributes‡ssociated withheenant before deletingheenant.");

464 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

465  
CRM_ERROR_RESOURCE_NOTEMPTY
;

468 #ifdeà
NSRM_SUPPORT


469 if(
‹ÇÁ_šfo_p
->
numb”_of_ns_chašs
)

471 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
," Delete‡ll‚s chains‡ssociated withheenant before deletingheenant.");

472 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

473  
CRM_ERROR_RESOURCE_NOTEMPTY
;

478 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
‹ÇÁ_Çme
, 
‹ÇÁ_šfo_p
->tenant_name);

480 
l¡off£t
 = 
CRM_NOTIFICATION_APP_HOOK_OFFSET
;

481 
	`OF_LIST_SCAN
(
üm_‹ÇÁ_nÙifiÿtiÚs
[
CRM_TENANT_DELETE
],
­p_’Œy_p
,
üm_nÙifiÿtiÚ_­p_hook_šfo
*,
l¡off£t
 )

483 ((
üm_‹ÇÁ_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_TENANT_DELETE
,

484 
‹ÇÁ_hªdË
,

485 
nÙifiÿtiÚ_d©a
,

486 
­p_’Œy_p
->
cbk_¬g1
,

487 
­p_’Œy_p
->
cbk_¬g2
);

490 
	`OF_LIST_SCAN
(
üm_‹ÇÁ_nÙifiÿtiÚs
[
CRM_TENANT_ALL_NOTIFICATIONS
],
­p_’Œy_p
,
üm_nÙifiÿtiÚ_­p_hook_šfo
*,
l¡off£t
 )

492 ((
üm_‹ÇÁ_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_TENANT_DELETE
,

493 
‹ÇÁ_hªdË
,

494 
nÙifiÿtiÚ_d©a
,

495 
­p_’Œy_p
->
cbk_¬g1
,

496 
­p_’Œy_p
->
cbk_¬g2
);

500 
¡©us_b
 = 
FALSE
;

501 
off£t
 = 
TENANT_NODE_TENANT_TBL_OFFSET
;

502 
	`MCHASH_DELETE_NODE_BY_REF
(
üm_‹ÇÁ_bË_g
,
šdex
,
magic
,
üm_‹ÇÁ_’Œy
 *,
off£t
,
¡©us_b
);

503 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

504 if(
¡©us_b
 =ğ
TRUE
)

506 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "tenant deleted successfully");

507  
CRM_SUCCESS
;

511 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "failedo deleteenant");

512  
CRM_FAILURE
;

515 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

516 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "invalidenant handle");

517  
CRM_ERROR_INVALID_TENANT_HANDLE
;

518 
	}
}

521 
št32_t
 
	$üm_g‘_‹ÇÁ_by_Çme
(* 
‹ÇÁ_Çme_p
,

522 
üm_‹ÇÁ_cÚfig_šfo
* 
üm_‹ÇÁ_cÚfig_šfo_p
,

523 
‹ÇÁ_ruÁime_šfo
 *
ruÁime_šfo
)

525 
št32_t
 
»t_v®
=
CRM_FAILURE
;

526 
ušt8_t
 
‹ÇÁ_node_found
=0;

527 
üm_‹ÇÁ
 *
üm_‹ÇÁ_node_sÿn_p
=
NULL
;

528 
ušt32_t
 
hashkey
, 
off£t
;

530 if(
üm_‹ÇÁ_bË_g
 =ğ
NULL
)

531  
CRM_FAILURE
;

533 if(
‹ÇÁ_Çme_p
 =ğ
NULL
)

534  
CRM_ERROR_TENANT_NAME_INVALID
;

536 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "‹ÇÁ_Çm%s",
‹ÇÁ_Çme_p
);

537 
	`CNTLR_RCU_READ_LOCK_TAKE
();

540 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
‹ÇÁ_Çme_p
, 
üm_no_of_‹ÇÁ_buck‘s_g
);

541 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "buck‘ = %d",
hashkey
);

543 
off£t
 = 
TENANT_NODE_TENANT_TBL_OFFSET
;

546 
	`MCHASH_BUCKET_SCAN
(
üm_‹ÇÁ_bË_g
, 
hashkey
, 
üm_‹ÇÁ_node_sÿn_p
, 
üm_‹ÇÁ
*, 
off£t
)

548 if(!
	`¡rcmp
(
‹ÇÁ_Çme_p
, 
üm_‹ÇÁ_node_sÿn_p
->
‹ÇÁ_Çme
))

550 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Tenant found");

551 
‹ÇÁ_node_found
 = 1;

557 if(
‹ÇÁ_node_found
 == 1)

559 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Copying Tenant Info...");

560 
	`¡ºıy
(
üm_‹ÇÁ_cÚfig_šfo_p
->
‹ÇÁ_Çme
, 
üm_‹ÇÁ_node_sÿn_p
->‹ÇÁ_Çme,
CRM_MAX_TENANT_NAME_LEN
);

562 
»t_v®
 = 
CRM_SUCCESS
;

567 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "T’ªˆnÙ found\r\n",
__FUNCTION__
, 
__LINE__
);

568 
»t_v®
 = 
CRM_ERROR_TENANT_NAME_INVALID
;

570 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

571  
»t_v®
;

572 
	}
}

576 
št32_t
 
	$üm_g‘_fœ¡_‹ÇÁ
 (
üm_‹ÇÁ_cÚfig_šfo
* 
üm_‹ÇÁ_cÚfig_šfo_p
,

577 
‹ÇÁ_ruÁime_šfo
 *
ruÁime_šfo
,

578 
ušt64_t
 *
‹ÇÁ_hªdË_p
)

580 
üm_‹ÇÁ
 *
üm_‹ÇÁ_node_sÿn_p
=
NULL
;

581 
ušt32_t
 
hashkey
;

583 
ušt32_t
 
off£t
;

585 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "crm_get_first_tenant");

587 if(
üm_‹ÇÁ_bË_g
 =ğ
NULL
)

588  
CRM_FAILURE
;

590 
	`CNTLR_RCU_READ_LOCK_TAKE
();

592 
	`MCHASH_TABLE_SCAN
(
üm_‹ÇÁ_bË_g
, 
hashkey
)

594 
off£t
 = 
TENANT_NODE_TENANT_TBL_OFFSET
;

595 
	`MCHASH_BUCKET_SCAN
(
üm_‹ÇÁ_bË_g
, 
hashkey
, 
üm_‹ÇÁ_node_sÿn_p
, 
üm_‹ÇÁ
 *, 
off£t
)

597 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Copying Tenant Info...");

598 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "‹ÇÁ‚ame:%s",
üm_‹ÇÁ_node_sÿn_p
->
‹ÇÁ_Çme
);

599 
	`¡ºıy
(
üm_‹ÇÁ_cÚfig_šfo_p
->
‹ÇÁ_Çme
, 
üm_‹ÇÁ_node_sÿn_p
->‹ÇÁ_Çme,
CRM_MAX_TENANT_NAME_LEN
);

602 *
‹ÇÁ_hªdË_p
 = 
üm_‹ÇÁ_node_sÿn_p
->
magic
;

603 *
‹ÇÁ_hªdË_p
 = ((*‹ÇÁ_hªdË_°<<32è| (
üm_‹ÇÁ_node_sÿn_p
->
šdex
));

605 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

606  
CRM_SUCCESS
;

609 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

610 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "No More Entries inheenantwork hashable!.");

611  
CRM_ERROR_NO_MORE_ENTRIES
;

613 
	}
}

615 
št32_t
 
	$üm_g‘_Ãxt_‹ÇÁ
 (
üm_‹ÇÁ_cÚfig_šfo
* 
üm_‹ÇÁ_cÚfig_šfo_p
,

616 
‹ÇÁ_ruÁime_šfo
 *
ruÁime_šfo
,

617 
ušt64_t
 *
‹ÇÁ_hªdË_p
)

619 
üm_‹ÇÁ
 *
üm_‹ÇÁ_node_sÿn_p
=
NULL
;

620 
ušt32_t
 
hashkey
;

621 
ušt8_t
 
cu¼’t_’Œy_found_b
;

623 
ušt32_t
 
off£t
 = 
TENANT_NODE_TENANT_TBL_OFFSET
;

624 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Entered");

626 
	`CNTLR_RCU_READ_LOCK_TAKE
();

627 
cu¼’t_’Œy_found_b
 = 
FALSE
;

629 
	`MCHASH_TABLE_SCAN
(
üm_‹ÇÁ_bË_g
, 
hashkey
)

631 
off£t
 = 
TENANT_NODE_TENANT_TBL_OFFSET
;

632 
	`MCHASH_BUCKET_SCAN
(
üm_‹ÇÁ_bË_g
, 
hashkey
, 
üm_‹ÇÁ_node_sÿn_p
, 
üm_‹ÇÁ
 *,
off£t
)

634 if(
cu¼’t_’Œy_found_b
 =ğ
FALSE
)

636 if(*
‹ÇÁ_hªdË_p
 !ğ(
üm_‹ÇÁ_node_sÿn_p
->
‹ÇÁ_hªdË
))

641 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Tenantƒntry found copy‚extenant.");

642 
cu¼’t_’Œy_found_b
 = 
TRUE
;

648 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Copying Tenant Info...");

649 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "‹ÇÁ‚ame:%s",
üm_‹ÇÁ_node_sÿn_p
->
‹ÇÁ_Çme
);

651 
	`¡ºıy
(
üm_‹ÇÁ_cÚfig_šfo_p
->
‹ÇÁ_Çme
, 
üm_‹ÇÁ_node_sÿn_p
->‹ÇÁ_Çme,
CRM_MAX_TENANT_NAME_LEN
);

654 *
‹ÇÁ_hªdË_p
 = 
üm_‹ÇÁ_node_sÿn_p
->
magic
;

655 *
‹ÇÁ_hªdË_p
 = ((*‹ÇÁ_hªdË_°<<32è| (
üm_‹ÇÁ_node_sÿn_p
->
šdex
));

658 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

659  
CRM_SUCCESS
;

662 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

663 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Failedo copy Tenant Info.....");

664 if(
cu¼’t_’Œy_found_b
 =ğ
TRUE
)

665  
CRM_ERROR_NO_MORE_ENTRIES
;

667  
CRM_ERROR_INVALID_TENANT_HANDLE
;

669 
	}
}

672 
št32_t
 
	$üm_»gi¡”_‹ÇÁ_nÙifiÿtiÚs
 (
ušt32_t
 
nÙifiÿtiÚ_ty³
,

673 
üm_‹ÇÁ_nÙif›r_â
 
‹ÇÁ_nÙif›r_â
,

674 *
ÿÎback_¬g1
,

675 *
ÿÎback_¬g2
)

677 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *
­p_’Œy_p
=
NULL
;

678 
ušt8_t
 
h—p_b
;

679 
št32_t
 
»tv®
 = 
CRM_SUCCESS
;

680 
uch¬8_t
 
l¡off£t
;

681 
l¡off£t
 = 
CRM_NOTIFICATION_APP_HOOK_OFFSET
;

683 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Entered");

684 if((
nÙifiÿtiÚ_ty³
 < 
CRM_TENANT_FIRST_NOTIFICATION_TYPE
) ||

685 (
nÙifiÿtiÚ_ty³
 > 
CRM_TENANT_LAST_NOTIFICATION_TYPE
)

688 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Inv®id NÙifiÿtiÚy³:%d", 
nÙifiÿtiÚ_ty³
);

689  
CRM_FAILURE
;

692 if(
‹ÇÁ_nÙif›r_â
 =ğ
NULL
)

694 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "callback function is‚ull");

695  
CRM_FAILURE
;

698 
»tv®
 = 
	`mempoŞ_g‘_mem_block
(
üm_nÙifiÿtiÚs_mempoŞ_g
, (
uch¬8_t
**)&
­p_’Œy_p
, &
h—p_b
);

699 if(
»tv®
 !ğ
MEMPOOL_SUCCESS
)

701 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Failedo get mempool");

702  
CRM_FAILURE
;

705 
­p_’Œy_p
->
ÿÎ_back
 = (*)
‹ÇÁ_nÙif›r_â
;

706 
­p_’Œy_p
->
cbk_¬g1
 = 
ÿÎback_¬g1
;

707 
­p_’Œy_p
->
cbk_¬g2
 = 
ÿÎback_¬g2
;

708 
­p_’Œy_p
->
h—p_b
 = heap_b;

711 
	`OF_APPEND_NODE_TO_LIST
(
üm_‹ÇÁ_nÙifiÿtiÚs
[
nÙifiÿtiÚ_ty³
], 
­p_’Œy_p
, 
l¡off£t
);

713 if(
»tv®
 !ğ
CRM_SUCCESS
)

714 
	`mempoŞ_»Ëa£_mem_block
(
üm_nÙifiÿtiÚs_mempoŞ_g
, (
uch¬8_t
*)
­p_’Œy_p
,‡µ_’Œy_p->
h—p_b
);

716 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "callback function„eg withenant success");

717  
»tv®
;

718 
	}
}

720 
št32_t
 
	$üm_add_©Œibu‹_to_‹ÇÁ
(
ušt64_t
 
‹ÇÁ_hªdË
, 
üm_©Œibu‹_Çme_v®ue_·œ
* 
©Œibu‹_šfo_p
)

722 
št32_t
 
»tv®
;

723 
üm_‹ÇÁ
 *
‹ÇÁ_’Œy_p
;

724 
üm_‹ÇÁ_nÙifiÿtiÚ_d©a
 
nÙifiÿtiÚ_d©a
={};

725 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *
­p_’Œy_p
;

726 
uch¬8_t
 
l¡off£t
;

727 
l¡off£t
 = 
CRM_NOTIFICATION_APP_HOOK_OFFSET
;

730 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Entered");

731 
	`CNTLR_RCU_READ_LOCK_TAKE
();

733 
»tv®
 = 
	`g‘_‹ÇÁ_byhªdË
(
‹ÇÁ_hªdË
, &
‹ÇÁ_’Œy_p
);

734 if(
»tv®
 !ğ
CRM_SUCCESS
)

736 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

737  
»tv®
;

740 
»tv®
 = 
	`üm_add_©Œibu‹
(&(
‹ÇÁ_’Œy_p
->
©Œibu‹s
),
©Œibu‹_šfo_p
);

741 if(
»tv®
 !ğ
CRM_SUCCESS
)

743 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

744  
»tv®
;

747 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "added‡ttr");

748 
‹ÇÁ_’Œy_p
->
numb”_of_©Œibu‹s
++;

749 
	`of_ü—‹_üm_v›w_’Œy
(
‹ÇÁ_hªdË
, 
©Œibu‹_šfo_p
->
Çme_¡ršg
,‡‰ribu‹_šfo_p->
v®ue_¡ršg
);

752 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
‹ÇÁ_Çme
, 
‹ÇÁ_’Œy_p
->tenant_name);

753 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
©Œibu‹_Çme
,
©Œibu‹_šfo_p
->
Çme_¡ršg
);

754 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
©Œibu‹_v®ue
,
©Œibu‹_šfo_p
->
v®ue_¡ršg
);

755 
	`OF_LIST_SCAN
(
üm_‹ÇÁ_nÙifiÿtiÚs
[
CRM_TENANT_ATTRIBUTE_ADDED
],
­p_’Œy_p
,
üm_nÙifiÿtiÚ_­p_hook_šfo
*,
l¡off£t
 )

757 ((
üm_‹ÇÁ_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_TENANT_ATTRIBUTE_ADDED
,

758 
‹ÇÁ_hªdË
,

759 
nÙifiÿtiÚ_d©a
,

760 
­p_’Œy_p
->
cbk_¬g1
,

761 
­p_’Œy_p
->
cbk_¬g2
);

764 
	`OF_LIST_SCAN
(
üm_‹ÇÁ_nÙifiÿtiÚs
[
CRM_TENANT_ALL_NOTIFICATIONS
],
­p_’Œy_p
,
üm_nÙifiÿtiÚ_­p_hook_šfo
*,
l¡off£t
 )

766 ((
üm_‹ÇÁ_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_TENANT_ATTRIBUTE_ADDED
,

767 
‹ÇÁ_hªdË
,

768 
nÙifiÿtiÚ_d©a
,

769 
­p_’Œy_p
->
cbk_¬g1
,

770 
­p_’Œy_p
->
cbk_¬g2
);

772 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "success");

773 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

774  
CRM_SUCCESS
;

775 
	}
}

778 
št32_t
 
	$üm_d–‘e_©Œibu‹_äom_‹ÇÁ
(
ušt64_t
 
‹ÇÁ_hªdË
, 
üm_©Œibu‹_Çme_v®ue_·œ
 *
©Œibu‹_šfo_p
)

781 
št32_t
 
»tv®
;

782 
ušt32_t
 
©Œ_node_found
=0;

783 
üm_‹ÇÁ
 *
‹ÇÁ_’Œy_p
;

784 
üm_»sourû_©Œibu‹_’Œy
 *
©Œibu‹_’Œy_p
,*
´ev_©Œ_’Œy_p
 = 
NULL
;

786 
üm_‹ÇÁ_nÙifiÿtiÚ_d©a
 
nÙifiÿtiÚ_d©a
={};

787 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *
­p_’Œy_p
;

788 
uch¬8_t
 
l¡©ŒÇmeoff£t
;

789 
l¡©ŒÇmeoff£t
 = 
CRM_RESOURCE_ATTRIBUTE_ENTRY_LISTNODE_OFFSET
;

791 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Entered");

793 
	`CNTLR_RCU_READ_LOCK_TAKE
();

795 
»tv®
 = 
	`g‘_‹ÇÁ_byhªdË
(
‹ÇÁ_hªdË
, &
‹ÇÁ_’Œy_p
);

796 if(
»tv®
 !ğ
CRM_SUCCESS
)

798 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "get_tenant_byhandle failed");

799 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

800  
»tv®
;

802 
	`OF_LIST_SCAN
(
‹ÇÁ_’Œy_p
->
©Œibu‹s
, 
©Œibu‹_’Œy_p
, 
üm_»sourû_©Œibu‹_’Œy
*,
l¡©ŒÇmeoff£t
)

804 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "©Œibu‹_’Œy_p->Çme:%s",
©Œibu‹_’Œy_p
->
Çme
);

805 if(!
	`¡rcmp
(
©Œibu‹_’Œy_p
->
Çme
, 
©Œibu‹_šfo_p
->
Çme_¡ršg
))

807 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "©Œ‚am% foundØd–‘e",
©Œibu‹_’Œy_p
->
Çme
);

808 
©Œ_node_found
 =1;

811 
´ev_©Œ_’Œy_p
 = 
©Œibu‹_’Œy_p
;

814 if(
©Œ_node_found
 == 0)

816 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "©Œ‚ame:% nÙ foundØd–‘e",
©Œibu‹_šfo_p
->
Çme_¡ršg
);

817 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

818  
CRM_FAILURE
;

821 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "©Œ‚am% foundØd–‘e",
©Œibu‹_’Œy_p
->
Çme
);

822 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
‹ÇÁ_Çme
, 
‹ÇÁ_’Œy_p
->tenant_name);

823 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
©Œibu‹_Çme
,
©Œibu‹_’Œy_p
->
Çme
);

824 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
©Œibu‹_v®ue
,
©Œibu‹_’Œy_p
->
v®ue
);

825 
	`OF_LIST_SCAN
(
üm_‹ÇÁ_nÙifiÿtiÚs
[
CRM_TENANT_ATTRIBUTE_DELETE
],
­p_’Œy_p
,
üm_nÙifiÿtiÚ_­p_hook_šfo
*, 
CRM_NOTIFICATION_APP_HOOK_OFFSET
)

827 ((
üm_‹ÇÁ_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_TENANT_ATTRIBUTE_DELETE
,

828 
‹ÇÁ_hªdË
,

829 
nÙifiÿtiÚ_d©a
,

830 
­p_’Œy_p
->
cbk_¬g1
,

831 
­p_’Œy_p
->
cbk_¬g2
);

834 
	`OF_LIST_SCAN
(
üm_‹ÇÁ_nÙifiÿtiÚs
[
CRM_TENANT_ALL_NOTIFICATIONS
],
­p_’Œy_p
,
üm_nÙifiÿtiÚ_­p_hook_šfo
*,
CRM_NOTIFICATION_APP_HOOK_OFFSET
)

836 ((
üm_‹ÇÁ_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_TENANT_ATTRIBUTE_DELETE
,

837 
‹ÇÁ_hªdË
,

838 
nÙifiÿtiÚ_d©a
,

839 
­p_’Œy_p
->
cbk_¬g1
,

840 
­p_’Œy_p
->
cbk_¬g2
);

844 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "d–‘šg‡‰¸%s",
©Œibu‹_’Œy_p
->
Çme
);

845 
	`OF_REMOVE_NODE_FROM_LIST
(
‹ÇÁ_’Œy_p
->
©Œibu‹s
,
©Œibu‹_’Œy_p
,
´ev_©Œ_’Œy_p
, 
l¡©ŒÇmeoff£t
);

846 
‹ÇÁ_’Œy_p
->
numb”_of_©Œibu‹s
--;

847 
	`of_»move_üm_v›w_’Œy
(
©Œibu‹_’Œy_p
->
Çme
,‡‰ribu‹_’Œy_p->
v®ue
);

850 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

851  
CRM_SUCCESS
;

852 
	}
}

855 
št32_t
 
	$üm_g‘_‹ÇÁ_fœ¡_©Œibu‹
(
ušt64_t
 
‹ÇÁ_hªdË
,

856 
üm_©Œibu‹_Çme_v®ue_ouut_šfo
 *
©Œibu‹_ouut_p
)

858 
št32_t
 
»tv®
;

859 
üm_‹ÇÁ
 *
üm_‹ÇÁ_’Œy_p
=
NULL
;

860 if(
©Œibu‹_ouut_p
 =ğ
NULL
)

861  
CRM_FAILURE
;

865 
	`CNTLR_RCU_READ_LOCK_TAKE
();

868 
»tv®
 = 
	`g‘_‹ÇÁ_byhªdË
(
‹ÇÁ_hªdË
, &
üm_‹ÇÁ_’Œy_p
);

869 if(
»tv®
 !ğ
CRM_SUCCESS
)

871 
»tv®
 = 
CRM_ERROR_INVALID_TENANT_HANDLE
;

874 
»tv®
 = 
	`üm_g‘_fœ¡_©Œibu‹
(&(
üm_‹ÇÁ_’Œy_p
->
©Œibu‹s
), 
©Œibu‹_ouut_p
);

877 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

878  
»tv®
;

879 
	}
}

882 
št32_t
 
	$üm_g‘_‹ÇÁ_Ãxt_©Œibu‹
(
ušt64_t
 
‹ÇÁ_hªdË
,

883 * 
cu¼’t_©Œibu‹_Çme
,

884 
üm_©Œibu‹_Çme_v®ue_ouut_šfo
 *
©Œibu‹_ouut_p
)

886 
št32_t
 
»tv®
;

887 
üm_‹ÇÁ
 *
üm_‹ÇÁ_’Œy_p
=
NULL
;

889 if((
©Œibu‹_ouut_p
 =ğ
NULL
è|| (
cu¼’t_©Œibu‹_Çme
 == NULL))

890  
CRM_FAILURE
;

892 
	`CNTLR_RCU_READ_LOCK_TAKE
();

895 
»tv®
 = 
	`g‘_‹ÇÁ_byhªdË
(
‹ÇÁ_hªdË
,&
üm_‹ÇÁ_’Œy_p
);

896 if(
»tv®
 !ğ
CRM_SUCCESS
)

898 
»tv®
ğ
CRM_ERROR_INVALID_TENANT_HANDLE
;

901 
»tv®
 = 
	`üm_g‘_Ãxt_©Œibu‹
(&(
üm_‹ÇÁ_’Œy_p
->
©Œibu‹s
), 
cu¼’t_©Œibu‹_Çme
, 
©Œibu‹_ouut_p
);

903 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

904  
»tv®
;

905 
	}
}

909 
št32_t
 
	$üm_g‘_‹ÇÁ_exaù_©Œibu‹
(
ušt64_t
 
‹ÇÁ_hªdË
,

910 *
©Œibu‹_Çme_¡ršg
 ,
üm_©Œibu‹_Çme_v®ue_ouut_šfo
 *
©Œibu‹_ouut_p
)

912 
üm_‹ÇÁ
 *
üm_‹ÇÁ_’Œy_p
=
NULL
;

913 
št32_t
 
»tv®
;

915 if(
©Œibu‹_Çme_¡ršg
 =ğ
NULL
)

916  
CRM_ERROR_ATTRIBUTE_NAME_NULL
;

918 if(
	`¡¾’
(
©Œibu‹_Çme_¡ršg
è> 
CRM_MAX_ATTRIBUTE_NAME_LEN
)

919  
CRM_ERROR_INVALID_ATTRIBUTE_NAME_LEN
;

921 
	`CNTLR_RCU_READ_LOCK_TAKE
();

924 
»tv®
 = 
	`g‘_‹ÇÁ_byhªdË
(
‹ÇÁ_hªdË
, &
üm_‹ÇÁ_’Œy_p
 );

925 if(
»tv®
 !ğ
CRM_SUCCESS
)

927 
»tv®
ğ
CRM_ERROR_INVALID_TENANT_HANDLE
;

930 
»tv®
 = 
	`üm_g‘_exaù_©Œibu‹
(&(
üm_‹ÇÁ_’Œy_p
->
©Œibu‹s
), 
©Œibu‹_Çme_¡ršg
,
©Œibu‹_ouut_p
);

932 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

933  
»tv®
;

934 
	}
}

	@crm_view_api.c

29 
	~"cÚŒŞËr.h
"

30 
	~"d´m.h
"

31 
	~"úr_•Şl.h
"

32 
	~"úŒl_queue.h
"

33 
	~"of_ut™›s.h
"

34 
	~"of_msg­i.h
"

35 
	~"of_muÉ¬t.h
"

36 
	~"úr_s.h
"

37 
	~"úr_Œª¥¹.h
"

38 
	~"úr_ev’t.h
"

39 
	~"v›wldef.h
"

40 
	~"of_v›w.h
"

46 
št32_t
 
	$of_ü—‹_üm_v›w_’Œy
(
ušt64_t
 
üm_hªdË
, *
v›w_Çme_p
, *
v›w_v®ue_p
)

48 
št32_t
 
¡©us
=
OF_SUCCESS
,
»t_v®ue
;

49 
št32_t
 
v›w_šdex
;

51 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "’‹»d v›w_Çme:%s,v›w_v®ue:%s",
v›w_Çme_p
,
v›w_v®ue_p
);

54 
v›w_šdex
ğ
	`of_g‘_v›w_šdex
(
v›w_Çme_p
);

55 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, " v›w_šdex = %d",
v›w_šdex
);

56 if(
v›w_šdex
 >ğ
DPRM_MAX_VIEW_DATABASE
 || view_index < 0 )

58 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "failedo get view index");

59  
OF_FAILURE
;

61 
»t_v®ue
ğ
	`of_ü—‹_v›w_’Œy
(
v›w_šdex
, 
v›w_Çme_p
, 
v›w_v®ue_p
, 
üm_hªdË
);

62 if(
»t_v®ue
 =ğ
OF_FAILURE
)

64 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "failedo create viewƒntry");

65 
¡©us
 = 
OF_FAILURE
;

69  
¡©us
;

70 
	}
}

73 
št32_t
 
	$of_»move_üm_v›w_’Œy
(*
v›w_Çme_p
, *
v›w_v®ue_p
 )

75 
št32_t
 
¡©us
=
OF_SUCCESS
,
»t_v®ue
;

76 
št32_t
 
v›w_šdex
;

78 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "’‹»d v›w_Çme:%s,v›w_v®ue:%s",
v›w_Çme_p
,
v›w_v®ue_p
);

81 
v›w_šdex
ğ
	`of_g‘_v›w_šdex
(
v›w_Çme_p
);

82 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, " v›w_šdex = %d",
v›w_šdex
);

83 if(
v›w_šdex
 >ğ
DPRM_MAX_VIEW_DATABASE
 || view_index < 0 )

85 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "failedo get view");

86 
¡©us
 = 
OF_FAILURE
;

90 
»t_v®ue
=
	`of_»move_v›w_’Œy
(
v›w_šdex
, 
v›w_Çme_p
, 
v›w_v®ue_p
);

91 if(
»t_v®ue
 =ğ
OF_FAILURE
)

93 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "failedo„emove viewƒntry");

94 
¡©us
 = 
OF_FAILURE
;

99  
¡©us
;

100 
	}
}

103 
št32_t
 
	$of_v›w_g‘_üm_v›w_hªdË_by_Çme
(
d©aba£_v›w_node_šfo
 *
db_v›w_node_šfo
, *
v›w_Çme_p
, 
ušt64_t
 *
v›w_hªdË_p
)

105 
št32_t
 
¡©us
=
OF_SUCCESS
,
»t_v®ue
;

106 
št32_t
 
v›w_šdex
;

108 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "’‹»d .v›w_Çme:%s",
v›w_Çme_p
);

111 
v›w_šdex
ğ
	`of_g‘_v›w_šdex
(
v›w_Çme_p
);

112 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, " v›w_šdex = %d",
v›w_šdex
);

113 if(
v›w_šdex
 >ğ
DPRM_MAX_VIEW_DATABASE
 || view_index < 0 )

115 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "failedo get view");

116 
¡©us
 = 
OF_FAILURE
;

119 
»t_v®ue
=
	`of_v›w_g‘_v›w_hªdË_by_Çme
(
v›w_šdex
, 
db_v›w_node_šfo
, 
v›w_hªdË_p
);

120 if(
»t_v®ue
 =ğ
OF_FAILURE
)

122 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "failedo get view");

123 
¡©us
 = 
OF_FAILURE
;

127  
¡©us
;

128 
	}
}

131 
št32_t
 
	$of_v›w_g‘_fœ¡_üm_v›w_’Œy
(
d©aba£_v›w_node_šfo
 *
db_v›w_node_šfo
,

132 *
v›w_Çme_p
, 
ušt64_t
 *
v›w_hªdË_p
)

134 
št32_t
 
¡©us
=
OF_SUCCESS
,
»t_v®ue
;

135 
št32_t
 
v›w_šdex
;

137 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "entered");

140 
v›w_šdex
ğ
	`of_g‘_v›w_šdex
(
v›w_Çme_p
);

141 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, " v›w_šdex = %d",
v›w_šdex
);

142 if(
v›w_šdex
 >ğ
DPRM_MAX_VIEW_DATABASE
 || view_index < 0 )

144 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "failedo get view");

145 
¡©us
 = 
OF_FAILURE
;

148 
»t_v®ue
=
	`of_v›w_g‘_fœ¡_v›w_’Œy
(
v›w_šdex
, 
db_v›w_node_šfo
, 
v›w_hªdË_p
);

149 if(
»t_v®ue
 =ğ
OF_FAILURE
)

151 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "failedo get view");

152 
¡©us
 = 
OF_FAILURE
;

158  
¡©us
;

159 
	}
}

162 
št32_t
 
	$of_v›w_g‘_Ãxt_üm_v›w_’Œy
(
d©aba£_v›w_node_šfo
 *
db_v›w_node_šfo
,

163 *
v›w_Çme_p
, 
ušt64_t
 *
v›w_hªdË_p
)

165 
št32_t
 
¡©us
=
OF_SUCCESS
,
»t_v®ue
;

166 
št32_t
 
v›w_šdex
;

168 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "entered");

171 
v›w_šdex
ğ
	`of_g‘_v›w_šdex
(
v›w_Çme_p
);

172 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, " v›w_šdex = %d",
v›w_šdex
);

173 if(
v›w_šdex
 >ğ
DPRM_MAX_VIEW_DATABASE
 || view_index < 0 )

175 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "failedo get view");

176 
¡©us
 = 
OF_FAILURE
;

179 
»t_v®ue
=
	`of_v›w_g‘_Ãxt_v›w_’Œy
(
v›w_šdex
, 
db_v›w_node_šfo
, 
v›w_hªdË_p
);

180 if(
»t_v®ue
 =ğ
OF_FAILURE
)

182 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "failedo get view");

183 
¡©us
 = 
OF_FAILURE
;

189  
¡©us
;

190 
	}
}

193 
št32_t
 
	$of_v›w_g‘_fœ¡_üm_v›w_usšg_v›w_v®ue
(*
v›w_Çme_p
, *
v›w_v®ue_p
, 
d©aba£_v›w_node_šfo
 *
db_v›w_node_šfo
, 
ušt64_t
 *
v›w_hªdË_p
)

195 
št32_t
 
¡©us
,
»t_v®ue
;

196 
št32_t
 
v›w_šdex
;

198 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "entered");

201 
v›w_šdex
ğ
	`of_g‘_v›w_šdex
(
v›w_Çme_p
);

202 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, " v›w_šdex = %d",
v›w_šdex
);

203 if(
v›w_šdex
 >ğ
DPRM_MAX_VIEW_DATABASE
 || view_index < 0 )

205 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "failedo get view");

206 
¡©us
 = 
OF_FAILURE
;

209 
»t_v®ue
=
	`of_v›w_g‘_fœ¡_v›w_’Œy_usšg_key
(
v›w_šdex
, 
v›w_v®ue_p
, 
db_v›w_node_šfo
, 
v›w_hªdË_p
);

211 if(
»t_v®ue
 =ğ
OF_FAILURE
)

213 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "failedo get view");

214 
¡©us
 = 
OF_FAILURE
;

220  
¡©us
;

221 
	}
}

224 
št32_t
 
	$of_v›w_g‘_Ãxt_üm_v›w_usšg_v®ue
Ğ*
v›w_Çme_p
, *
v›w_v®ue_p
, 
d©aba£_v›w_node_šfo
 *
db_v›w_node_šfo
, 
ušt64_t
 *
v›w_hªdË_p
)

226 
št32_t
 
¡©us
=
OF_SUCCESS
,
»t_v®ue
;

227 
št32_t
 
v›w_šdex
;

229 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "entered");

232 
v›w_šdex
ğ
	`of_g‘_v›w_šdex
(
v›w_Çme_p
);

233 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, " v›w_šdex = %d",
v›w_šdex
);

234 if(
v›w_šdex
 >ğ
DPRM_MAX_VIEW_DATABASE
 || view_index < 0 )

236 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "failedo get view");

237 
¡©us
 = 
OF_FAILURE
;

241 
»t_v®ue
=
	`of_v›w_g‘_Ãxt_v›w_’Œy_usšg_key
(
v›w_šdex
, 
v›w_v®ue_p
, 
db_v›w_node_šfo
, 
v›w_hªdË_p
);

242 if(
»t_v®ue
 =ğ
OF_FAILURE
)

244 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "failedo get view");

245 
¡©us
 = 
OF_FAILURE
;

250  
¡©us
;

251 
	}
}

	@crm_view_init.c

1 
	~"üm_sy¡em_d•’d’c›s.h
"

3 *
üm_v›w_node_mempoŞ_g
;

4 
üm_ä“_v›w_node_rcu
(
rcu_h—d
 *
v›w_node_p
);

7 
št32_t
 
	$üm_v›w_hash_bË_š™
(
mchash_bË
 **
v›w_node_bË
)

9 
št32_t
 
»t_v®ue
;

10 
ušt32_t
 
v›w_node_’Œ›s_max
,
v›w_node_¡©ic_’Œ›s
;

12 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_DEBUG
, "entered");

13 
	`üm_g‘_v›w_node_mempoŞ’Œ›s
(&
v›w_node_’Œ›s_max
,&
v›w_node_¡©ic_’Œ›s
);

14 
»t_v®ue
 = 
	`mchash_bË_ü—‹
(((
v›w_node_’Œ›s_max
 / 5 *
CRM_MAX_VIEW_DATABASE
)+1),

15 
v›w_node_’Œ›s_max
/
CRM_MAX_VIEW_DATABASE
,

16 
üm_ä“_v›w_node_rcu
,

17 
v›w_node_bË
);

18 if(
»t_v®ue
 !ğ
MCHASHTBL_SUCCESS
)

19  
CRM_FAILURE
;

21  
CRM_SUCCESS
;

23 
	}
}

25 
d©aba£_v›w_node
 *
	$üm_®loc_v›w_’Œy_ªd_£t_v®ues
(
ušt64_t
 
§ã»f
, *
node_Çme
, *
v›w_v®ue
)

28 
d©aba£_v›w_node
 *
v›w_node_’Œy_p
;

29 
št32_t
 
»t_v®ue
;

30 
ušt8_t
 
h—p_b
;

32 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_DEBUG
, "entered");

33 
»t_v®ue
 = 
	`mempoŞ_g‘_mem_block
(
üm_v›w_node_mempoŞ_g
,(
uch¬8_t
**)&
v›w_node_’Œy_p
,&
h—p_b
);

34 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

35  
NULL
;

37 
v›w_node_’Œy_p
->
node_Çme
=(*)
	`ÿÎoc
(1,128);

38 ià(
v›w_node_’Œy_p
->
node_Çme
 =ğ
NULL
)

40 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
,"memory‡llocation failed");

41 
	`mempoŞ_»Ëa£_mem_block
(
üm_v›w_node_mempoŞ_g
,(
uch¬8_t
*)
v›w_node_’Œy_p
,
FALSE
);

42  
NULL
;

45 
v›w_node_’Œy_p
->
v›w_v®ue
=(*)
	`ÿÎoc
(1,128);

46 ià(
v›w_node_’Œy_p
->
v›w_v®ue
 =ğ
NULL
)

48 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
,"memory‡llocation failed");

49 
	`ä“
(
v›w_node_’Œy_p
->
node_Çme
);

50 
	`mempoŞ_»Ëa£_mem_block
(
üm_v›w_node_mempoŞ_g
,(
uch¬8_t
*)
v›w_node_’Œy_p
,
FALSE
);

51  
NULL
;

54 
	`¡rıy
(
v›w_node_’Œy_p
->
v›w_v®ue
,view_value);

55 
	`¡rıy
(
v›w_node_’Œy_p
->
node_Çme
,node_name);

56 
v›w_node_’Œy_p
->
node_§ã»f
=
§ã»f
;

57  
v›w_node_’Œy_p
;

58 
	}
}

60 
št32_t
 
	$üm_v›w_hash_bË_deš™
(
mchash_bË
* 
v›w_node_bË
)

62 if(
v›w_node_bË
 =ğ
NULL
)

64 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
,"Table is NULL");

65  
CRM_FAILURE
;

67 
	`mchash_bË_d–‘e
(
v›w_node_bË
);

68  
CRM_SUCCESS
;

69 
	}
}

	@crm_view_test.c

	@crm_vm_api.c

28 
	~"üm_sy¡em_d•’d’c›s.h
"

29 
	~"üm_‹ÇÁ_­i.h
"

30 
	~"üm_vn_­i.h
"

31 
	~"üm_vm_­i.h
"

36 * 
üm_vm_mempoŞ_g
;

37 * 
üm_vm_pÜt_mempoŞ_g
;

38 * 
üm_nÙifiÿtiÚs_mempoŞ_g
;

39 
ušt32_t
 
üm_no_of_vm_buck‘s_g
;

40 
mchash_bË
* 
üm_vm_bË_g
;

42 
of_li¡_t
 
üm_vm_nÙifiÿtiÚs
[
CRM_VM_LAST_NOTIFICATION_TYPE
 + 1];

44 
d©aba£_v›w
 
	gvm_db_v›w
[
CRM_MAX_VIEW_DATABASE
];

48 
	$üm_vm_pÜt_ä“_’Œy_rcu
(
rcu_h—d
 *
üm_vm_pÜt_node_’Œy_p
)

50 
üm_vm_pÜt
 *
üm_vm_pÜt_node_šfo_p
=
NULL
;

51 
št32_t
 
»t_v®ue
;

53 if(
üm_vm_pÜt_node_’Œy_p
)

55 
üm_vm_pÜt_node_šfo_p
 = (
üm_vm_pÜt
 *)(((*)
üm_vm_pÜt_node_’Œy_p
è- (
of_li¡_node_t
));

56 
»t_v®ue
 = 
	`mempoŞ_»Ëa£_mem_block
(
üm_vm_pÜt_mempoŞ_g
,

57 (
uch¬8_t
*)
üm_vm_pÜt_node_šfo_p
,

58 
üm_vm_pÜt_node_šfo_p
->
h—p_b
);

59 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

61 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Failedo„elease crm vm…ort‚ode memory block");

65 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Deleted succesfully crm vm…ort‚ode fromhe database");

70 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "NULL…assed for deletion");

72 
	}
}

78 
št32_t
 
	$üm_g‘_vm_hªdË
(*
vm_Çme_p
, 
ušt64_t
 *
vm_hªdË_p
)

80 
ušt32_t
 
hashkey
;

81 
ušt32_t
 
off£t
;

83 
üm_vœtu®_machše
 *
üm_vm_šfo_p
=
NULL
;

85 if(
üm_vm_bË_g
 =ğ
NULL
)

86  
CRM_FAILURE
;

88 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
vm_Çme_p
,
üm_no_of_vm_buck‘s_g
);

89 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "hashkey:%d\r\n",
hashkey
);

90 
	`CNTLR_RCU_READ_LOCK_TAKE
();

91 
off£t
 = 
VMNODE_VMTBL_OFFSET
;

93 
	`MCHASH_BUCKET_SCAN
(
üm_vm_bË_g
, 
hashkey
, 
üm_vm_šfo_p
, 
üm_vœtu®_machše
 *,
off£t
)

95 if(
	`¡rcmp
(
üm_vm_šfo_p
->
vm_Çme
,
vm_Çme_p
))

97 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

99 *
vm_hªdË_p
 = 
üm_vm_šfo_p
->
magic
;

100 *
vm_hªdË_p
 = ((*vm_hªdË_°<<32è| (
üm_vm_šfo_p
->
šdex
));

102 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "vm_hªdË:%Îx\r\n",*
vm_hªdË_p
);

103  
CRM_SUCCESS
;

105 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

106  
CRM_ERROR_VM_NAME_INVALID
;

107 
	}
}

113 
št32_t
 
	$g‘_vm_byhªdË
(
ušt64_t
 
vm_hªdË
,
üm_vœtu®_machše
 **
üm_vm_šfo_p
)

116 
ušt32_t
 
šdex
,
magic
;

117 
ušt8_t
 
¡©us_b
;

119 
magic
 = (
ušt32_t
)(
vm_hªdË
 >>32);

120 
šdex
 = (
ušt32_t
)
vm_hªdË
;

122 
	`MCHASH_ACCESS_NODE
(
üm_vm_bË_g
,
šdex
,
magic
,*
üm_vm_šfo_p
,
¡©us_b
);

123 if(
TRUE
 =ğ
¡©us_b
)

124  
CRM_SUCCESS
;

125  
CRM_ERROR_INVALID_VM_HANDLE
;

126 
	}
}

130 
št32_t
 
	$üm_add_vœtu®_machše
 (
üm_vm_cÚfig_šfo
* 
cÚfig_šfo_p
,

131 
ušt64_t
* 
ouut_vm_hªdË_p
)

133 
št32_t
 
»t_v®ue
 = 
CRM_SUCCESS
;

134 
ušt32_t
 
hashkey
,
off£t
,
šdex
 = 0, 
magic
 = 0;

135 
ušt8_t
 
h—p_b
,
¡©us_b
 = 
FALSE
;

136 
uch¬8_t
* 
hashobj_p
 = 
NULL
;

137 
ušt32_t
 
­phookoff£t
;

138 
ušt64_t
 
sw™ch_hªdË
,
‹ÇÁ_hªdË
;

140 
üm_vœtu®_machše
* 
üm_vm_node_p
=
NULL
;

141 
üm_vœtu®_machše
* 
üm_vm_node_sÿn_p
=
NULL
;

142 
üm_vm_nÙifiÿtiÚ_d©a
 
nÙifiÿtiÚ_d©a
={};

144 
üm_nÙifiÿtiÚ_­p_hook_šfo
* 
­p_’Œy_p
;

146 if(
üm_vm_bË_g
 =ğ
NULL
)

148 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "VMable doesntƒxist");

149  
CRM_FAILURE
;

152 if((
cÚfig_šfo_p
->
vm_Çme
 =ğ
NULL
è|| (
	`¡¾’
(cÚfig_šfo_p->vm_Çme)>=
CRM_MAX_VM_NAME_LEN
))

154 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "virtual machine‚ame invalid");

155  
CRM_ERROR_VM_NAME_INVALID
;

158 if((
cÚfig_šfo_p
->
‹ÇÁ_Çme
 =ğ
NULL
è|| (cÚfig_šfo_p->
sw™ch_Çme
 == NULL))

160 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "name isƒmpty");

161  
CRM_FAILURE
;

164 
»t_v®ue
 = 
	`üm_g‘_‹ÇÁ_hªdË
(
cÚfig_šfo_p
->
‹ÇÁ_Çme
, &
‹ÇÁ_hªdË
);

165 if(
»t_v®ue
 !ğ
CRM_SUCCESS
)

167 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Invalidenant‚ame");

168  
CRM_ERROR_TENANT_NAME_INVALID
;

171 
»t_v®ue
 = 
	`d´m_g‘_sw™ch_hªdË
(
cÚfig_šfo_p
->
sw™ch_Çme
, &
sw™ch_hªdË
);

172 if(
»t_v®ue
 !ğ
CRM_SUCCESS
)

174 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Invalid switch‚ame");

175  
CRM_ERROR_INVALID_NAME
;

178 if(!((
cÚfig_šfo_p
->
vm_ty³
 =ğ
VM_TYPE_NORMAL_APPLICATION
è|| (cÚfig_šfo_p->vm_ty³ =ğ
VM_TYPE_NETWORK_SERVICE
)))

180 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
,"virtual machineype invalid");

181  
CRM_ERROR_INVALID_VM_TYPE
;

184 
	`CNTLR_RCU_READ_LOCK_TAKE
();

187 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
cÚfig_šfo_p
->
vm_Çme
, 
üm_no_of_vm_buck‘s_g
);

188 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "buck‘ = %d",
hashkey
);

190 
off£t
 = 
VMNODE_VMTBL_OFFSET
;

192 
	`MCHASH_BUCKET_SCAN
(
üm_vm_bË_g
, 
hashkey
, 
üm_vm_node_sÿn_p
, 
üm_vœtu®_machše
*, 
off£t
)

194 if(
	`¡rcmp
(
cÚfig_šfo_p
->
vm_Çme
, 
üm_vm_node_sÿn_p
->vm_name) != 0)

196 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Du¶iÿ‹ vœtu® machšÇm:%s", 
cÚfig_šfo_p
->
vm_Çme
);

197  
CRM_ERROR_DUPLICATE_VM_RESOURCE
;

201 
»t_v®ue
 = 
	`mempoŞ_g‘_mem_block
(
üm_vm_mempoŞ_g
, (
uch¬8_t
 **)&
üm_vm_node_p
, &
h—p_b
);

202 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

204 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
,"failedo get memory block");

205 
»t_v®ue
 = 
CRM_FAILURE
;

206 
CRM_ADD_VM_EXIT
;

208 
üm_vm_node_p
->
h—p_b
 = heap_b;

209 
	`¡ºıy
(
üm_vm_node_p
->
vm_Çme
, 
cÚfig_šfo_p
->vm_Çme, 
CRM_MAX_VM_NAME_LEN
);

210 
	`¡ºıy
(
üm_vm_node_p
->
‹ÇÁ_Çme
, 
cÚfig_šfo_p
->‹ÇÁ_Çme, 
CRM_MAX_TENANT_NAME_LEN
);

211 
üm_vm_node_p
->
sw™ch_hªdË
 = switch_handle;

212 
	`¡ºıy
(
üm_vm_node_p
->
sw™ch_Çme_d´m
, 
cÚfig_šfo_p
->
sw™ch_Çme
, 
DPRM_MAX_SWITCH_NAME_LEN
);

213 
	`¡ºıy
(
üm_vm_node_p
->
vm_desc
, 
cÚfig_šfo_p
->vm_desc, 
CRM_MAX_VM_DESC_LEN
);

214 
üm_vm_node_p
->
vm_ty³
 = 
cÚfig_šfo_p
->vm_type;

216 
hashobj_p
 = (
uch¬8_t
 *)
üm_vm_node_p
 + 
VMNODE_VMTBL_OFFSET
;

217 
	`MCHASH_APPEND_NODE
(
üm_vm_bË_g
, 
hashkey
, 
üm_vm_node_p
, 
šdex
, 
magic
, 
hashobj_p
, 
¡©us_b
);

218 if(
FALSE
 =ğ
¡©us_b
)

220 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "failedo‡dd vm‚ode");

221 
»t_v®ue
 = 
CRM_FAILURE
;

222 
CRM_ADD_VM_EXIT
;

225 *
ouut_vm_hªdË_p
 = 
magic
;

226 *
ouut_vm_hªdË_p
 = ((*ouut_vm_hªdË_°<<32è| (
šdex
));

228 
üm_vm_node_p
->
magic
 = magic;

229 
üm_vm_node_p
->
šdex
 = index;

231 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
vm_Çme
, 
üm_vm_node_p
->vm_name);

232 (
üm_vm_node_p
->
vm_hªdË
èğ*
ouut_vm_hªdË_p
;

234 
	`OF_LIST_INIT
(
üm_vm_node_p
->
li¡_of_logiÿl_sw™ch_side_pÜts_cÚÃùed
, 
üm_vm_pÜt_ä“_’Œy_rcu
);

235 
	`OF_LIST_INIT
(
üm_vm_node_p
->
©Œibu‹s
, 
üm_©Œibu‹s_ä“_©Œibu‹_’Œy_rcu
);

237 
­phookoff£t
 = 
CRM_NOTIFICATION_APP_HOOK_OFFSET
;

239 
	`OF_LIST_SCAN
(
üm_vm_nÙifiÿtiÚs
[
CRM_VM_ADDED
], 
­p_’Œy_p
, 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *, 
­phookoff£t
)

241 ((
üm_vm_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_VM_ADDED
,

242 *
ouut_vm_hªdË_p
,

243 
nÙifiÿtiÚ_d©a
,

244 
­p_’Œy_p
->
cbk_¬g1
,

245 
­p_’Œy_p
->
cbk_¬g2
);

248 
	`OF_LIST_SCAN
(
üm_vm_nÙifiÿtiÚs
[
CRM_VM_ALL_NOTIFICATIONS
], 
­p_’Œy_p
, 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *, 
­phookoff£t
 )

250 ((
üm_vm_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_VM_ADDED
,

251 *
ouut_vm_hªdË_p
,

252 
nÙifiÿtiÚ_d©a
,

253 
­p_’Œy_p
->
cbk_¬g1
,

254 
­p_’Œy_p
->
cbk_¬g2
);

256 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

257 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "VM Added successfully");

258  
CRM_SUCCESS
;

260 
CRM_ADD_VM_EXIT
:

261 if(
üm_vm_node_p
)

263 
	`mempoŞ_»Ëa£_mem_block
(
üm_vm_mempoŞ_g
, (
uch¬8_t
 *)
üm_vm_node_p
, crm_vm_node_p->
h—p_b
);

265 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

266 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "failedo‡dd VM");

267  
»t_v®ue
;

268 
	}
}

270 
št32_t
 
	$üm_modify_vœtu®_machše
 (
üm_vm_cÚfig_šfo
* 
cÚfig_šfo_p
,

271 
ušt64_t
* 
ouut_vm_hªdË_p
)

273 
št32_t
 
»t_v®ue
 =
CRM_SUCCESS
;

274 
ušt32_t
 
hashkey
, 
off£t
;

275 
ušt32_t
 
­phookoff£t
;

276 
ušt64_t
 
sw™ch_hªdË
,
‹ÇÁ_hªdË
;

277 
üm_vœtu®_machše
 *
üm_vm_node_sÿn_p
=
NULL
;

278 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *
­p_’Œy_p
=
NULL
;

279 
üm_vm_nÙifiÿtiÚ_d©a
 
nÙifiÿtiÚ_d©a
={};

280 
ušt32_t
 
vm_node_found
=0;

283 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Entered");

284 if(
üm_vm_bË_g
 =ğ
NULL
)

286 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "VMable‚ull");

287  
CRM_FAILURE
;

289 if((
cÚfig_šfo_p
->
vm_Çme
 =ğ
NULL
) ||

290 (
	`¡¾’
(
cÚfig_šfo_p
->
vm_Çme
)>=
CRM_MAX_VM_NAME_LEN
)

293 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "virtual machine‚ame invalid");

294  
CRM_ERROR_VM_NAME_INVALID
;

296 if((
cÚfig_šfo_p
->
‹ÇÁ_Çme
 =ğ
NULL
)||

297 (
cÚfig_šfo_p
->
sw™ch_Çme
 =ğ
NULL
)

300 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "name isƒmpty");

301  
CRM_FAILURE
;

304 
»t_v®ue
 = 
	`üm_g‘_‹ÇÁ_hªdË
(
cÚfig_šfo_p
->
‹ÇÁ_Çme
, &
‹ÇÁ_hªdË
);

305 if(
»t_v®ue
 !ğ
CRM_SUCCESS
)

307 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Invalidenant‚ame");

308  
CRM_ERROR_TENANT_NAME_INVALID
;

311 
»t_v®ue
 = 
	`d´m_g‘_sw™ch_hªdË
(
cÚfig_šfo_p
->
sw™ch_Çme
, &
sw™ch_hªdË
);

312 if(
»t_v®ue
 !ğ
CRM_SUCCESS
)

314 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Invalid switch‚ame");

315  
CRM_ERROR_INVALID_NAME
;

318 if(!((
cÚfig_šfo_p
->
vm_ty³
 =ğ
VM_TYPE_NORMAL_APPLICATION
)

319 || (
cÚfig_šfo_p
->
vm_ty³
 =ğ
VM_TYPE_NETWORK_SERVICE
)))

321 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
,"virtual machineype invalid");

322  
CRM_ERROR_INVALID_VM_TYPE
;

325 
	`CNTLR_RCU_READ_LOCK_TAKE
();

328 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
cÚfig_šfo_p
->
vm_Çme
, 
üm_no_of_vm_buck‘s_g
);

329 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "buck‘ = %d",
hashkey
);

331 
off£t
 = 
VMNODE_VMTBL_OFFSET
;

333 
	`MCHASH_BUCKET_SCAN
(
üm_vm_bË_g
, 
hashkey
, 
üm_vm_node_sÿn_p
, 
üm_vœtu®_machše
*, 
off£t
)

335 if(!
	`¡rcmp
(
cÚfig_šfo_p
->
vm_Çme
, 
üm_vm_node_sÿn_p
->vm_name))

337 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "vœtu® machšÇm:% foundØmodify", 
cÚfig_šfo_p
->
vm_Çme
);

338 
vm_node_found
 =1;

342 if(!
vm_node_found
)

344 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "vœtu® machšÇm:% nÙ foundØmodify", 
cÚfig_šfo_p
->
vm_Çme
);

345 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

346  
CRM_ERROR_DUPLICATE_VM_RESOURCE
;

348 
	`¡ºıy
(
üm_vm_node_sÿn_p
->
‹ÇÁ_Çme
, 
cÚfig_šfo_p
->‹ÇÁ_Çme, 
CRM_MAX_TENANT_NAME_LEN
);

349 
üm_vm_node_sÿn_p
->
sw™ch_hªdË
 = switch_handle;

350 
	`¡ºıy
(
üm_vm_node_sÿn_p
->
sw™ch_Çme_d´m
, 
cÚfig_šfo_p
->
sw™ch_Çme
, 
DPRM_MAX_SWITCH_NAME_LEN
);

351 
	`¡ºıy
(
üm_vm_node_sÿn_p
->
vm_desc
, 
cÚfig_šfo_p
->vm_desc, 
CRM_MAX_VM_DESC_LEN
);

352 
üm_vm_node_sÿn_p
->
vm_ty³
 = 
cÚfig_šfo_p
->vm_type;

354 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
vm_Çme
, 
üm_vm_node_sÿn_p
->vm_name);

355 
­phookoff£t
 = 
CRM_NOTIFICATION_APP_HOOK_OFFSET
;

357 
	`OF_LIST_SCAN
(
üm_vm_nÙifiÿtiÚs
[
CRM_VM_MODIFIED
], 
­p_’Œy_p
, 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *, 
­phookoff£t
)

359 ((
üm_vm_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_VM_MODIFIED
,

360 (
üm_vm_node_sÿn_p
->
vm_hªdË
),

361 
nÙifiÿtiÚ_d©a
,

362 
­p_’Œy_p
->
cbk_¬g1
,

363 
­p_’Œy_p
->
cbk_¬g2
);

366 
	`OF_LIST_SCAN
(
üm_vm_nÙifiÿtiÚs
[
CRM_VM_ALL_NOTIFICATIONS
], 
­p_’Œy_p
, 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *, 
­phookoff£t
 )

368 ((
üm_vm_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_VM_MODIFIED
,

369 (
üm_vm_node_sÿn_p
->
vm_hªdË
),

370 
nÙifiÿtiÚ_d©a
,

371 
­p_’Œy_p
->
cbk_¬g1
,

372 
­p_’Œy_p
->
cbk_¬g2
);

374 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

375 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "VM Modified successfully");

376  
CRM_SUCCESS
;

377 
	}
}

381 
št32_t
 
	$üm_d–_vœtu®_machše
 (* 
vm_Çme
)

383 
ušt32_t
 
hashkey
, 
off£t
;

384 
ušt8_t
 
¡©us_b
 = 
FALSE
;

385 
ušt8_t
 
vm_node_found
=0;

386 
št32_t
 
»t_v®
;

387 
ušt32_t
 
­phookoff£t
;

389 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *
­p_’Œy_p
;

390 
üm_vm_nÙifiÿtiÚ_d©a
 
nÙifiÿtiÚ_d©a
={};

391 
üm_vœtu®_machše
 *
üm_vm_node_sÿn_p
=
NULL
;

393 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Entered");

395 if(
üm_vm_bË_g
 =ğ
NULL
)

397 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "No vm db");

398  
CRM_FAILURE
;

401 if((
vm_Çme
 =ğ
NULL
))

403 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "vm‚ame‚ull");

404  
CRM_ERROR_VM_NAME_NULL
;

407 
	`CNTLR_RCU_READ_LOCK_TAKE
();

409 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
vm_Çme
, 
üm_no_of_vm_buck‘s_g
);

411 
off£t
 = 
VMNODE_VMTBL_OFFSET
;

414 
	`MCHASH_BUCKET_SCAN
(
üm_vm_bË_g
, 
hashkey
, 
üm_vm_node_sÿn_p
, 
üm_vœtu®_machše
*, 
off£t
)

416 if(!
	`¡rcmp
(
vm_Çme
, 
üm_vm_node_sÿn_p
->vm_name))

418 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "vm‚ame foundo delete");

419 
vm_node_found
 = 1;

424 if(
vm_node_found
==1)

426 if(
üm_vm_node_sÿn_p
->
no_of_pÜts
)

428 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Ports‡ttachedo vm‚ode");

429 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

430  
CRM_ERROR_RESOURCE_NOTEMPTY
;

432 
­phookoff£t
 = 
CRM_NOTIFICATION_APP_HOOK_OFFSET
;

433 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
vm_Çme
, vm_name);

434 
	`OF_LIST_SCAN
(
üm_vm_nÙifiÿtiÚs
[
CRM_VM_DELETE
], 
­p_’Œy_p
, 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *, 
­phookoff£t
 )

436 ((
üm_vm_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_VM_DELETE
,

437 
üm_vm_node_sÿn_p
->
vm_hªdË
,

438 
nÙifiÿtiÚ_d©a
,

439 
­p_’Œy_p
->
cbk_¬g1
,

440 
­p_’Œy_p
->
cbk_¬g2
);

443 
	`OF_LIST_SCAN
(
üm_vm_nÙifiÿtiÚs
[
CRM_VM_ALL_NOTIFICATIONS
], 
­p_’Œy_p
, 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *, 
­phookoff£t
 )

445 ((
üm_vm_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_VM_DELETE
,

446 
üm_vm_node_sÿn_p
->
vm_hªdË
,

447 
nÙifiÿtiÚ_d©a
,

448 
­p_’Œy_p
->
cbk_¬g1
,

449 
­p_’Œy_p
->
cbk_¬g2
);

452 
¡©us_b
 = 
FALSE
;

453 
off£t
 = 
VMNODE_VMTBL_OFFSET
;

454 
	`MCHASH_DELETE_NODE_BY_REF
(
üm_vm_bË_g
, 
üm_vm_node_sÿn_p
->
šdex
, crm_vm_node_sÿn_p->
magic
,
üm_vœtu®_machše
 *, 
off£t
, 
¡©us_b
);

455 if(
¡©us_b
 =ğ
TRUE
)

457 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
,"virtual machine‚ode deleted successfully");

458 
»t_v®
 = 
CRM_SUCCESS
;

462 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "failedo delete");

463 
»t_v®
ğ
CRM_FAILURE
;

468 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "vœtu® machšÇmnÙ foundØd–‘e", 
__FUNCTION__
, 
__LINE__
);

469 
»t_v®
=
CRM_ERROR_VM_NAME_INVALID
;

471 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

472  
»t_v®
;

473 
	}
}

475 
št32_t
 
	$üm_»gi¡”_vm_nÙifiÿtiÚs
 (
ušt32_t
 
nÙifiÿtiÚ_ty³
, 
üm_vm_nÙif›r_â
 
vm_nÙif›r_â
,

476 * 
ÿÎback_¬g1
,* 
ÿÎback_¬g2
)

478 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *
­p_’Œy_p
;

479 
ušt8_t
 
h—p_b
;

480 
št32_t
 
»tv®
 = 
CRM_SUCCESS
;

481 
ušt32_t
 
l¡off£t
;

483 
l¡off£t
 = 
CRM_NOTIFICATION_APP_HOOK_OFFSET
;

485 if((
nÙifiÿtiÚ_ty³
 < 
CRM_VM_FIRST_NOTIFICATION_TYPE
è|| (nÙifiÿtiÚ_ty³ > 
CRM_VM_LAST_NOTIFICATION_TYPE
))

487 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Inv®id NÙifiÿtiÚy³: %u", 
nÙifiÿtiÚ_ty³
);

488  
CRM_FAILURE
;

491 if(
vm_nÙif›r_â
 =ğ
NULL
)

493 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "callback function‚ull");

494  
CRM_FAILURE
;

497 
»tv®
 = 
	`mempoŞ_g‘_mem_block
(
üm_nÙifiÿtiÚs_mempoŞ_g
, (
uch¬8_t
**)&
­p_’Œy_p
, &
h—p_b
);

498 if(
»tv®
 !ğ
MEMPOOL_SUCCESS
)

500 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Failedo get memory block");

501  
CRM_FAILURE
;

504 
­p_’Œy_p
->
ÿÎ_back
 = (*)
vm_nÙif›r_â
;

505 
­p_’Œy_p
->
cbk_¬g1
 = 
ÿÎback_¬g1
;

506 
­p_’Œy_p
->
cbk_¬g2
 = 
ÿÎback_¬g2
;

507 
­p_’Œy_p
->
h—p_b
 = heap_b;

510 
	`OF_APPEND_NODE_TO_LIST
(
üm_vm_nÙifiÿtiÚs
[
nÙifiÿtiÚ_ty³
], 
­p_’Œy_p
, 
l¡off£t
);

512 if(
»tv®
 !ğ
CRM_SUCCESS
)

513 
	`mempoŞ_»Ëa£_mem_block
(
üm_nÙifiÿtiÚs_mempoŞ_g
, (
uch¬8_t
*)
­p_’Œy_p
,‡µ_’Œy_p->
h—p_b
);

515  
»tv®
;

516 
	}
}

518 
št32_t
 
	$üm_g‘_vm_by_Çme
(* 
vm_Çme
,
üm_vm_cÚfig_šfo
* 
cÚfig_šfo_p
,

519 
vm_ruÁime_šfo
* 
ruÁime_šfo
)

521 
št32_t
 
»t_v®
=
CRM_FAILURE
;

522 
ušt8_t
 
vm_node_found
=0;

523 
üm_vœtu®_machše
 *
üm_vm_node_sÿn_p
=
NULL
;

524 
ušt32_t
 
hashkey
,
off£t
;

526 if(
vm_Çme
 =ğ
NULL
)

527  
CRM_ERROR_VM_NAME_NULL
;

529 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "vm_Çm%s",
vm_Çme
);

531 
	`CNTLR_RCU_READ_LOCK_TAKE
();

534 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
vm_Çme
, 
üm_no_of_vm_buck‘s_g
);

536 
off£t
 = 
VMNODE_VMTBL_OFFSET
;

539 
	`MCHASH_BUCKET_SCAN
(
üm_vm_bË_g
, 
hashkey
, 
üm_vm_node_sÿn_p
, 
üm_vœtu®_machše
*, 
off£t
)

541 if(!
	`¡rcmp
(
vm_Çme
, 
üm_vm_node_sÿn_p
->vm_name))

543 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "virtual machine found");

544 
vm_node_found
 = 1;

548 if(
vm_node_found
 == 1)

550 
	`¡rıy
(
cÚfig_šfo_p
->
vm_Çme
, 
üm_vm_node_sÿn_p
->vm_name);

551 
cÚfig_šfo_p
->
vm_ty³
 = 
üm_vm_node_sÿn_p
->vm_type;

552 
	`¡rıy
(
cÚfig_šfo_p
->
sw™ch_Çme
, 
üm_vm_node_sÿn_p
->
sw™ch_Çme_d´m
);

553 
	`¡rıy
(
cÚfig_šfo_p
->
‹ÇÁ_Çme
, 
üm_vm_node_sÿn_p
->tenant_name);

554 
»t_v®
 = 
CRM_SUCCESS
;

558 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "virtual machine‚ot found");

559 
»t_v®
 = 
CRM_ERROR_VM_NAME_INVALID
;

561 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

562  
»t_v®
;

563 
	}
}

565 
št32_t
 
	$üm_g‘_fœ¡_vm
 (
üm_vm_cÚfig_šfo
* 
cÚfig_šfo_p
,

566 
vm_ruÁime_šfo
* 
ruÁime_šfo
,

567 
ušt64_t
* 
vm_hªdË_p
)

569 
üm_vœtu®_machše
* 
üm_vm_node_šfo_p
 = 
NULL
;

570 
ušt32_t
 
hashkey
;

571 
ušt32_t
 
off£t
;

573 
	`CNTLR_RCU_READ_LOCK_TAKE
();

575 
	`MCHASH_TABLE_SCAN
(
üm_vm_bË_g
, 
hashkey
)

577 
off£t
 = 
VMNODE_VMTBL_OFFSET
;

578 
	`MCHASH_BUCKET_SCAN
(
üm_vm_bË_g
,
hashkey
,
üm_vm_node_šfo_p
,
üm_vœtu®_machše
 *, 
off£t
)

580 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "copy info");

581 
	`¡rıy
(
cÚfig_šfo_p
->
vm_Çme
, 
üm_vm_node_šfo_p
->vm_name);

582 
cÚfig_šfo_p
->
vm_ty³
 = 
üm_vm_node_šfo_p
->vm_type;

583 
	`¡rıy
(
cÚfig_šfo_p
->
sw™ch_Çme
, 
üm_vm_node_šfo_p
->
sw™ch_Çme_d´m
);

584 
	`¡rıy
(
cÚfig_šfo_p
->
‹ÇÁ_Çme
, 
üm_vm_node_šfo_p
->tenant_name);

585 
	`¡rıy
(
cÚfig_šfo_p
->
vm_desc
,
üm_vm_node_šfo_p
->vm_desc);

589 *
vm_hªdË_p
 = 
üm_vm_node_šfo_p
->
magic
;

590 *
vm_hªdË_p
 = ((*vm_hªdË_°<<32è| (
üm_vm_node_šfo_p
->
šdex
));

592 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

593  
CRM_SUCCESS
;

596 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

597  
CRM_ERROR_NO_MORE_ENTRIES
;

598 
	}
}

600 
št32_t
 
	$üm_g‘_Ãxt_vm
 (
üm_vm_cÚfig_šfo
* 
cÚfig_šfo_p
,

601 
vm_ruÁime_šfo
* 
ruÁime_šfo
,

602 
ušt64_t
* 
vm_hªdË_p
)

604 
üm_vœtu®_machše
* 
üm_vm_node_šfo_p
 = 
NULL
;

605 
ušt32_t
 
hashkey
;

606 
ušt8_t
 
cu¼’t_’Œy_found_b
;

608 
ušt32_t
 
off£t
 = 
VMNODE_VMTBL_OFFSET
;

610 
	`CNTLR_RCU_READ_LOCK_TAKE
();

611 
cu¼’t_’Œy_found_b
 = 
FALSE
;

613 
	`MCHASH_TABLE_SCAN
(
üm_vm_bË_g
, 
hashkey
)

615 
off£t
 = 
VMNODE_VMTBL_OFFSET
;

616 
	`MCHASH_BUCKET_SCAN
(
üm_vm_bË_g
,
hashkey
,
üm_vm_node_šfo_p
,
üm_vœtu®_machše
 *,
off£t
)

618 if(
cu¼’t_’Œy_found_b
 =ğ
FALSE
)

620 if(*
vm_hªdË_p
 !ğ(
üm_vm_node_šfo_p
->
vm_hªdË
))

624 
cu¼’t_’Œy_found_b
 = 
TRUE
;

630 
	`¡rıy
(
cÚfig_šfo_p
->
vm_Çme
, 
üm_vm_node_šfo_p
->vm_name);

631 
cÚfig_šfo_p
->
vm_ty³
 = 
üm_vm_node_šfo_p
->vm_type;

632 
	`¡rıy
(
cÚfig_šfo_p
->
sw™ch_Çme
, 
üm_vm_node_šfo_p
->
sw™ch_Çme_d´m
);

633 
	`¡rıy
(
cÚfig_šfo_p
->
‹ÇÁ_Çme
, 
üm_vm_node_šfo_p
->tenant_name);

637 *
vm_hªdË_p
 = 
üm_vm_node_šfo_p
->
magic
;

638 *
vm_hªdË_p
 = ((*vm_hªdË_°<<32è| (
üm_vm_node_šfo_p
->
šdex
));

640 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

641  
CRM_SUCCESS
;

644 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

645 if(
cu¼’t_’Œy_found_b
 =ğ
TRUE
)

646  
CRM_ERROR_NO_MORE_ENTRIES
;

648  
CRM_ERROR_INVALID_VM_HANDLE
;

649 
	}
}

652 
št32_t
 
	$üm_©ch_logiÿl_sw™ch_side_pÜt_to_vm
 (* 
üm_pÜt_Çme
,

653 * 
vm_Çme
,

654 * 
vn_Çme
,

655 
ušt64_t
 
üm_pÜt_hªdË


658 
št32_t
 
»t_v®
 = 
CRM_SUCCESS
;

659 
ušt64_t
 
vm_hªdË
;

660 
ušt8_t
 
h—p_b
;

662 
üm_vm_pÜt
 *
üm_vm_pÜt_node_’Œy_p
 = 
NULL
;

663 
üm_vm_pÜt
 *
üm_vm_pÜt_node_sÿn_’Œy_p
 = 
NULL
;

664 
üm_vœtu®_machše
 *
üm_vm_node_p
 = 
NULL
;

666 
»t_v®
 = 
	`üm_g‘_vm_hªdË
(
vm_Çme
,&
vm_hªdË
);

667 if(
»t_v®
 !ğ
CRM_SUCCESS
)

669 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
,"Failedo get vm handle");

670  
CRM_FAILURE
;

673 
»t_v®
 = 
	`g‘_vm_byhªdË
(
vm_hªdË
,&
üm_vm_node_p
);

674 if(
»t_v®
 !ğ
CRM_SUCCESS
)

676 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
,"Failedo get vm‚ode\n");

677  
CRM_FAILURE
;

680 
	`CNTLR_RCU_READ_LOCK_TAKE
();

683 
	`OF_LIST_SCAN
((
üm_vm_node_p
->
li¡_of_logiÿl_sw™ch_side_pÜts_cÚÃùed
),

684 
üm_vm_pÜt_node_sÿn_’Œy_p
,

685 
üm_vm_pÜt
 *,

686 
CRM_VM_PORT_NODE_ENTRY_LISTNODE_OFFSET
)

688 if(!
	`¡rcmp
(
üm_vm_pÜt_node_sÿn_’Œy_p
->
pÜt_Çme
, 
üm_pÜt_Çme
))

690 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Duplicate crm vm…ort‚ode found.");

691 
»t_v®
 = 
CRM_FAILURE
;

696 
»t_v®
 = 
	`mempoŞ_g‘_mem_block
(
üm_vm_pÜt_mempoŞ_g
,(
uch¬8_t
**)&
üm_vm_pÜt_node_’Œy_p
,&
h—p_b
);

697 if(
»t_v®
 !ğ
MEMPOOL_SUCCESS
)

699 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "memory block‡llocation failed for crm vm…ort‚ode.");

700 
»t_v®
 = 
CRM_FAILURE
;

703 
üm_vm_pÜt_node_’Œy_p
->
h—p_b
 = heap_b;

704 
	`¡rıy
(
üm_vm_pÜt_node_’Œy_p
->
pÜt_Çme
,
üm_pÜt_Çme
);

705 
	`¡rıy
(
üm_vm_pÜt_node_’Œy_p
->
vn_Çme
,vn_name);

706 
üm_vm_pÜt_node_’Œy_p
->
pÜt_§ã»f
 = 
üm_pÜt_hªdË
;

708 
	`OF_APPEND_NODE_TO_LIST
((
üm_vm_node_p
->
li¡_of_logiÿl_sw™ch_side_pÜts_cÚÃùed
),

709 
üm_vm_pÜt_node_’Œy_p
,

710 
CRM_VM_PORT_NODE_ENTRY_LISTNODE_OFFSET
);

712 
üm_vm_node_p
->
no_of_pÜts
++;

716 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

717  
»t_v®
;

718 
	}
}

720 
št32_t
 
	$üm_d‘ach_logiÿl_sw™ch_side_pÜt_äom_vm
(*
pÜt_Çme
,*
vm_Çme
,*
vn_Çme
,
ušt8_t
* 
no_of_pÜts_p
)

722 
št32_t
 
»t_v®
 = 
CRM_SUCCESS
;

723 
ušt64_t
 
vm_hªdË
;

724 
ušt32_t
 
l¡off£t
;

726 
üm_vm_pÜt
 *
üm_vm_pÜt_node_p
=
NULL
;

727 
üm_vm_pÜt
 *
üm_vm_pÜt_´ev_node_p
=
NULL
;

729 
üm_vœtu®_machše
 *
üm_vm_node_p
=
NULL
;

731 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Entered");

732 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "pÜt_Çme:%s,vm_Çme:%s",
pÜt_Çme
,
vm_Çme
);

734 if((
pÜt_Çme
 =ğ
NULL
)|| (
vm_Çme
==NULL))

736 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Invalid…orts data suppliedo‡dd.\n");

737  
CRM_FAILURE
;

740 
»t_v®
 = 
	`üm_g‘_vm_hªdË
(
vm_Çme
 , &
vm_hªdË
);

741 if(
»t_v®
 !ğ
CRM_SUCCESS
)

743 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "failedo get vm handle\n");

744  
CRM_FAILURE
;

747 
»t_v®
 = 
	`g‘_vm_byhªdË
(
vm_hªdË
 , &
üm_vm_node_p
);

748 if(
»t_v®
 !ğ
CRM_SUCCESS
)

750 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "failedo get vm‚ode\n");

751  
CRM_FAILURE
;

754 
l¡off£t
 = 
CRM_VM_PORT_NODE_ENTRY_LISTNODE_OFFSET
;

755 
	`CNTLR_RCU_READ_LOCK_TAKE
();

757 
	`OF_LIST_SCAN
((
üm_vm_node_p
->
li¡_of_logiÿl_sw™ch_side_pÜts_cÚÃùed
),

758 
üm_vm_pÜt_node_p
,

759 
üm_vm_pÜt
 *,

760 
l¡off£t
)

762 if(!
	`¡rcmp
(
üm_vm_pÜt_node_p
->
pÜt_Çme
,…ort_name))

764 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "crm vm…ort‚ode foundo delete\n");

765 
	`OF_REMOVE_NODE_FROM_LIST
(
üm_vm_node_p
->
li¡_of_logiÿl_sw™ch_side_pÜts_cÚÃùed
,

766 
üm_vm_pÜt_node_p
,

767 
üm_vm_pÜt_´ev_node_p
,

768 
l¡off£t


771 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "nØoàpÜt : %d",
üm_vm_node_p
->
no_of_pÜts
);

772 
üm_vm_node_p
->
no_of_pÜts
--;

773 *
no_of_pÜts_p
 = 
üm_vm_node_p
->
no_of_pÜts
;

774 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "nØoàpÜt aá” deüem’ˆ: %d",*
no_of_pÜts_p
);

775 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

776  
CRM_SUCCESS
;

778 
üm_vm_pÜt_´ev_node_p
 = 
üm_vm_pÜt_node_p
;

780 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "crm vm…ort‚ode‚ot foundo delete\n");

781 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

782  
CRM_FAILURE
;

783 
	}
}

785 
št32_t
 
	$üm_add_©Œibu‹_to_vm
(
ušt64_t
 
vm_hªdË
, 
üm_©Œibu‹_Çme_v®ue_·œ
* 
©Œibu‹_šfo_p
)

787 
št32_t
 
»tv®
;

788 
üm_vœtu®_machše
* 
vm_’Œy_p
;

789 
üm_vm_nÙifiÿtiÚ_d©a
 
nÙifiÿtiÚ_d©a
={};

790 
üm_nÙifiÿtiÚ_­p_hook_šfo
* 
­p_’Œy_p
;

791 
uch¬8_t
 
l¡off£t
;

793 
l¡off£t
 = 
CRM_NOTIFICATION_APP_HOOK_OFFSET
;

795 
	`CNTLR_RCU_READ_LOCK_TAKE
();

797 
»tv®
 = 
	`g‘_vm_byhªdË
(
vm_hªdË
, &
vm_’Œy_p
);

798 if(
»tv®
 !ğ
CRM_SUCCESS
)

800 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

801  
»tv®
;

804 
»tv®
 = 
	`üm_add_©Œibu‹
(&(
vm_’Œy_p
->
©Œibu‹s
),
©Œibu‹_šfo_p
);

805 if(
»tv®
 !ğ
CRM_SUCCESS
)

807 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

808  
»tv®
;

811 
vm_’Œy_p
->
numb”_of_©Œibu‹s
++;

812 
	`üm_ü—‹_vm_v›w_’Œy
(
vm_hªdË
, 
©Œibu‹_šfo_p
->
Çme_¡ršg
,‡‰ribu‹_šfo_p->
v®ue_¡ršg
);

815 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
vm_Çme
, 
vm_’Œy_p
->vm_name);

816 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
©Œibu‹_Çme
,
©Œibu‹_šfo_p
->
Çme_¡ršg
);

817 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
©Œibu‹_v®ue
,
©Œibu‹_šfo_p
->
v®ue_¡ršg
);

818 
	`OF_LIST_SCAN
(
üm_vm_nÙifiÿtiÚs
[
CRM_VM_ATTRIBUTE_ADDED
],
­p_’Œy_p
,
üm_nÙifiÿtiÚ_­p_hook_šfo
*,
l¡off£t
 )

820 ((
üm_vm_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_VM_ATTRIBUTE_ADDED
,

821 
vm_hªdË
,

822 
nÙifiÿtiÚ_d©a
,

823 
­p_’Œy_p
->
cbk_¬g1
,

824 
­p_’Œy_p
->
cbk_¬g2
);

827 
	`OF_LIST_SCAN
(
üm_vm_nÙifiÿtiÚs
[
CRM_VM_ALL_NOTIFICATIONS
],
­p_’Œy_p
,
üm_nÙifiÿtiÚ_­p_hook_šfo
*,
l¡off£t
 )

829 ((
üm_vm_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_VM_ATTRIBUTE_ADDED
,

830 
vm_hªdË
,

831 
nÙifiÿtiÚ_d©a
,

832 
­p_’Œy_p
->
cbk_¬g1
,

833 
­p_’Œy_p
->
cbk_¬g2
);

835 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

836  
CRM_SUCCESS
;

837 
	}
}

839 
št32_t
 
	$üm_d–‘e_©Œibu‹_äom_vm
(
ušt64_t
 
vm_hªdË
, 
üm_©Œibu‹_Çme_v®ue_·œ
 *
©Œibu‹_šfo_p
)

841 
št32_t
 
»tv®
;

842 
üm_vœtu®_machše
* 
vm_’Œy_p
;

843 
üm_»sourû_©Œibu‹_’Œy
 *
©Œibu‹_’Œy_p
,*
´ev_­p_’Œy_p
 = 
NULL
;

845 
üm_vm_nÙifiÿtiÚ_d©a
 
nÙifiÿtiÚ_d©a
={};

846 
üm_nÙifiÿtiÚ_­p_hook_šfo
* 
­p_’Œy_p
;

848 
uch¬8_t
 
l¡©ŒÇmeoff£t
;

849 
l¡©ŒÇmeoff£t
 = 
CRM_RESOURCE_ATTRIBUTE_ENTRY_LISTNODE_OFFSET
;

851 
	`CNTLR_RCU_READ_LOCK_TAKE
();

853 
»tv®
 = 
	`g‘_vm_byhªdË
(
vm_hªdË
, &
vm_’Œy_p
);

854 if(
»tv®
 !ğ
CRM_SUCCESS
)

856 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

857  
»tv®
;

859 
	`OF_LIST_SCAN
(
vm_’Œy_p
->
©Œibu‹s
, 
©Œibu‹_’Œy_p
, 
üm_»sourû_©Œibu‹_’Œy
*,
l¡©ŒÇmeoff£t
)

861 if(!
	`¡rcmp
(
©Œibu‹_’Œy_p
->
Çme
, 
©Œibu‹_šfo_p
->
Çme_¡ršg
))

863 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
vm_Çme
, 
vm_’Œy_p
->vm_name);

864 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
©Œibu‹_Çme
,
©Œibu‹_’Œy_p
->
Çme
);

865 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
©Œibu‹_v®ue
,
©Œibu‹_’Œy_p
->
v®ue
);

867 
	`OF_LIST_SCAN
(
üm_vm_nÙifiÿtiÚs
[
CRM_VM_ATTRIBUTE_DELETE
],
­p_’Œy_p
,
üm_nÙifiÿtiÚ_­p_hook_šfo
*, 
l¡©ŒÇmeoff£t
 )

869 ((
üm_vm_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_VM_ATTRIBUTE_DELETE
,

870 
vm_hªdË
,

871 
nÙifiÿtiÚ_d©a
,

872 
­p_’Œy_p
->
cbk_¬g1
,

873 
­p_’Œy_p
->
cbk_¬g2
);

876 
	`OF_LIST_SCAN
(
üm_vm_nÙifiÿtiÚs
[
CRM_VM_ALL_NOTIFICATIONS
],
­p_’Œy_p
,
üm_nÙifiÿtiÚ_­p_hook_šfo
*,
l¡©ŒÇmeoff£t
)

878 ((
üm_vm_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_VM_ATTRIBUTE_DELETE
,

879 
vm_hªdË
,

880 
nÙifiÿtiÚ_d©a
,

881 
­p_’Œy_p
->
cbk_¬g1
,

882 
­p_’Œy_p
->
cbk_¬g2
);

884 
	`OF_REMOVE_NODE_FROM_LIST
(
vm_’Œy_p
->
©Œibu‹s
,
©Œibu‹_’Œy_p
,
´ev_­p_’Œy_p
, 
l¡©ŒÇmeoff£t
);

885 
vm_’Œy_p
->
numb”_of_©Œibu‹s
--;

886 
	`üm_»move_vm_v›w_’Œy
(
©Œibu‹_’Œy_p
->
Çme
,‡‰ribu‹_’Œy_p->
v®ue
);

887 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

888  
CRM_SUCCESS
;

890 
´ev_­p_’Œy_p
 = 
©Œibu‹_’Œy_p
;

893 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

894  
CRM_FAILURE
;

895 
	}
}

897 
št32_t
 
	$üm_g‘_vm_fœ¡_©Œibu‹
(
ušt64_t
 
vm_hªdË
,

898 
üm_©Œibu‹_Çme_v®ue_ouut_šfo
* 
©Œibu‹_ouut_p
)

900 
št32_t
 
»tv®
;

901 
üm_vœtu®_machše
 *
üm_vm_’Œy_p
=
NULL
;

902 if(
©Œibu‹_ouut_p
 =ğ
NULL
)

903  
CRM_FAILURE
;

905 
	`CNTLR_RCU_READ_LOCK_TAKE
();

908 
»tv®
 = 
	`g‘_vm_byhªdË
(
vm_hªdË
, &
üm_vm_’Œy_p
);

909 if(
»tv®
 !ğ
CRM_SUCCESS
)

911 
»tv®
 = 
CRM_ERROR_INVALID_VM_HANDLE
;

914 
»tv®
 = 
	`üm_g‘_fœ¡_©Œibu‹
(&(
üm_vm_’Œy_p
->
©Œibu‹s
), 
©Œibu‹_ouut_p
);

917 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

918  
»tv®
;

919 
	}
}

921 
št32_t
 
	$üm_g‘_vm_Ãxt_©Œibu‹
(
ušt64_t
 
vm_hªdË
,

922 * 
cu¼’t_©Œibu‹_Çme
,

923 
üm_©Œibu‹_Çme_v®ue_ouut_šfo
 *
©Œibu‹_ouut_p
)

925 
št32_t
 
»tv®
;

926 
üm_vœtu®_machše
* 
üm_vm_’Œy_p
=
NULL
;

928 if((
©Œibu‹_ouut_p
 =ğ
NULL
è|| (
cu¼’t_©Œibu‹_Çme
 == NULL))

929  
CRM_FAILURE
;

931 
	`CNTLR_RCU_READ_LOCK_TAKE
();

934 
»tv®
 = 
	`g‘_vm_byhªdË
(
vm_hªdË
,&
üm_vm_’Œy_p
);

935 if(
»tv®
 !ğ
CRM_SUCCESS
)

937 
»tv®
ğ
CRM_ERROR_INVALID_VM_HANDLE
;

940 
»tv®
 = 
	`üm_g‘_Ãxt_©Œibu‹
(&(
üm_vm_’Œy_p
->
©Œibu‹s
), 
cu¼’t_©Œibu‹_Çme
, 
©Œibu‹_ouut_p
);

942 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

943  
»tv®
;

944 
	}
}

946 
št32_t
 
	$üm_g‘_vm_exaù_©Œibu‹
(
ušt64_t
 
vm_hªdË
,

947 * 
©Œibu‹_Çme_¡ršg
,

948 
üm_©Œibu‹_Çme_v®ue_ouut_šfo
 *
©Œibu‹_ouut_p
)

950 
üm_vœtu®_machše
* 
üm_vm_’Œy_p
=
NULL
;

951 
št32_t
 
»tv®
;

953 if(
©Œibu‹_Çme_¡ršg
 =ğ
NULL
)

954  
CRM_ERROR_ATTRIBUTE_NAME_NULL
;

956 if(
	`¡¾’
(
©Œibu‹_Çme_¡ršg
è> 
CRM_MAX_ATTRIBUTE_NAME_LEN
)

957  
CRM_ERROR_INVALID_ATTRIBUTE_NAME_LEN
;

959 
	`CNTLR_RCU_READ_LOCK_TAKE
();

962 
»tv®
 = 
	`g‘_vm_byhªdË
(
vm_hªdË
, &
üm_vm_’Œy_p
);

963 if(
»tv®
 !ğ
CRM_SUCCESS
)

965 
»tv®
ğ
CRM_ERROR_INVALID_VM_HANDLE
;

968 
»tv®
 = 
	`üm_g‘_exaù_©Œibu‹
(&(
üm_vm_’Œy_p
->
©Œibu‹s
), 
©Œibu‹_Çme_¡ršg
,
©Œibu‹_ouut_p
);

971 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

972  
»tv®
;

973 
	}
}

976 
št32_t
 
	$üm_ü—‹_vm_v›w
(*
v›w_Çme
)

978 
št32_t
 
šdex
 = 0, 
ii
;

979 
ušt8_t
 
em±y_šdex_b
 = 0;

981 
ii
 = 0;ii<
CRM_MAX_VIEW_DATABASE
 ; ii++)

983 if(!
	`¡rcmp
(
vm_db_v›w
[
ii
].
v›w
 , 
v›w_Çme
))

985 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"View‡lready created");

986  
CRM_FAILURE
;

988 if((
em±y_šdex_b
 =ğ0è&& (!
	`¡rcmp
(
vm_db_v›w
[
ii
].
v›w
 ,"")))

990 
em±y_šdex_b
 = 1;

991 
šdex
 = 
ii
;

994 
	`¡rıy
(
vm_db_v›w
[
šdex
].
v›w
,
v›w_Çme
);

995 
	`üm_v›w_hash_bË_š™
(&
vm_db_v›w
[
šdex
].
db_v›wtbl_p
);

996 
vm_db_v›w
[
šdex
].
uniqu’ess_æag
 = 
FALSE
;

997 
vm_db_v›w
[
šdex
].
v®id_b
 = 
TRUE
;

999 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_DEBUG
, "View‚ode created succesfully");

1000  
CRM_SUCCESS
;

1001 
	}
}

1004 
št32_t
 
	$üm_ü—‹_vm_v›w_’Œy
(
ušt64_t
 
vm_hªdË
 , * 
v›w_Çme
 ,* 
v›w_v®ue
)

1006 
d©aba£_v›w_node
 *
v›w_node_’Œy_p
;

1007 
št32_t
 
v›w_šdex
;

1008 
ušt32_t
 
šdex
,
magic
;

1009 
št32_t
 
¡©us
 = 
CRM_SUCCESS
;

1010 
ušt32_t
 
hashkey
;

1011 
ušt8_t
 
¡©us_b
,
v›w_found_b
 = 0;

1015 
v›w_šdex
 = 0;v›w_šdex < 
CRM_MAX_VIEW_DATABASE
 ; view_index++)

1017 if(!
	`¡rcmp
(
vm_db_v›w
[
v›w_šdex
].
v›w
 ,
v›w_Çme
))

1019 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_DEBUG
, "Viewƒntry can be made.");

1020 
v›w_found_b
 = 1;

1024 if(
v›w_found_b
 == 0)

1026 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_ERROR
,"View hashable‚ot initialized");

1027 
¡©us
 = 
CRM_FAILURE
;

1030 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
v›w_v®ue
,
üm_no_of_vm_buck‘s_g
);

1031 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1032 
v›w_node_’Œy_p
 = 
	`üm_®loc_v›w_’Œy_ªd_£t_v®ues
(
vm_hªdË
, 
v›w_Çme
, 
v›w_v®ue
);

1033 ià(
v›w_node_’Œy_p
 =ğ
NULL
)

1035 
¡©us
 = 
CRM_FAILURE
;

1038 
	`MCHASH_APPEND_NODE
(
vm_db_v›w
[
v›w_šdex
].
db_v›wtbl_p
,
hashkey
,
v›w_node_’Œy_p
,
šdex
,
magic
,v›w_node_’Œy_p,
¡©us_b
);

1039 if(
FALSE
 =ğ
¡©us_b
)

1041 
¡©us
 = 
CRM_FAILURE
;

1042 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1045 
v›w_node_’Œy_p
->
magic
 = magic;

1046 
v›w_node_’Œy_p
->
šdex
 = index;

1047 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_DEBUG
,"Viewƒntry succesfuuly‡dded");

1048 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1051  
¡©us
;

1052 
	}
}

1055 
št32_t
 
	$üm_»move_vm_v›w_’Œy
(* 
v›w_Çme
,* 
v›w_v®ue
)

1057 
d©aba£_v›w_node
 *
v›w_node_’Œy_p
;

1058 
št32_t
 
šdex
 , 
off£t
 = 0;

1059 
št32_t
 
¡©us
 = 
CRM_SUCCESS
;

1060 
ušt32_t
 
hashkey
;

1061 
ušt8_t
 
¡©us_b
,
v›w_found_b
 = 0;

1065 
šdex
 = 0;šdex<
CRM_MAX_VIEW_DATABASE
;index++)

1067 if(!
	`¡rcmp
(
vm_db_v›w
[
šdex
].
v›w
,
v›w_Çme
))

1069 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_DEBUG
,"View found forhis view‚ame");

1070 
v›w_found_b
 = 1;

1074 if(
v›w_found_b
 == 0)

1076 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_ERROR
,"View‚ot initiliazed forhe view‚ame.So‚oƒntriesƒxist");

1077 
¡©us
 = 
CRM_FAILURE
;

1079 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
v›w_v®ue
,
üm_no_of_vm_buck‘s_g
);

1080 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1081 
	`MCHASH_BUCKET_SCAN
(
vm_db_v›w
[
šdex
].
db_v›wtbl_p
,
hashkey
, 
v›w_node_’Œy_p
,
d©aba£_v›w_node
 *,
off£t
)

1083 ià((!
	`¡rcmp
(
v›w_node_’Œy_p
->
v›w_v®ue
, view_value)) &&

1084 (!
	`¡rcmp
(
v›w_node_’Œy_p
->
node_Çme
, 
v›w_Çme
)))

1086 
¡©us_b
 = 
FALSE
;

1087 
off£t
 = 0;

1088 
	`MCHASH_DELETE_NODE_BY_REF
(
vm_db_v›w
[
šdex
].
db_v›wtbl_p
,
v›w_node_’Œy_p
->šdex,v›w_node_’Œy_p->
magic
,
d©aba£_v›w_node
 *,
off£t
,
¡©us_b
);

1089 ià(
¡©us_b
 =ğ
FALSE
)

1091 
¡©us
 = 
CRM_FAILURE
;

1094 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_DEBUG
,"Viewƒntry deleted successfully");

1095 
¡©us
 = 
CRM_SUCCESS
;

1101 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1102  
¡©us
;

1103 
	}
}

1105 
št32_t
 
	$üm_»move_vm_v›w
(*
v›w_Çme
)

1107 
d©aba£_v›w_node
 *
v›w_node_’Œy_p
;

1108 
št32_t
 
šdex
 , 
off£t
 ,
hashkey
 , 
»t_v®
;

1109 
ušt8_t
 
node_found_b
 = 0;

1111 
šdex
 = 0;šdex<
CRM_MAX_VIEW_DATABASE
 ; index++)

1113 if(!
	`¡rcmp
(
vm_db_v›w
[
šdex
].
v›w
 , 
v›w_Çme
))

1115 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"View foundo deleted");

1116 
node_found_b
 = 1;

1120 if(
node_found_b
 == 0)

1122 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Node‚ot found ");

1123  
CRM_FAILURE
;

1125 
node_found_b
 = 0;

1126 
off£t
 = 0;

1128 
	`MCHASH_TABLE_SCAN
(
vm_db_v›w
[
šdex
].
db_v›wtbl_p
,
hashkey
)

1130 
	`MCHASH_BUCKET_SCAN
(
vm_db_v›w
[
šdex
].
db_v›wtbl_p
,
hashkey
, 
v›w_node_’Œy_p
,
d©aba£_v›w_node
 *,
off£t
)

1132 if(
	`¡rcmp
(
v›w_node_’Œy_p
->
v›w_v®ue
 , ""))

1134 
node_found_b
 = 1;

1139 if(
node_found_b
 == 1)

1141 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Remove viewƒntireso„emoveheƒntire view");

1142  
CRM_FAILURE
;

1144 
»t_v®
 = 
	`üm_v›w_hash_bË_deš™
(
vm_db_v›w
[
šdex
].
db_v›wtbl_p
);

1145 if(
»t_v®
 !ğ
CRM_SUCCESS
)

1147 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Hash Table deinit failed");

1148  
CRM_FAILURE
;

1151 
	`¡rıy
(
vm_db_v›w
[
šdex
].
v›w
,"");

1152 
vm_db_v›w
[
šdex
].
uniqu’ess_æag
 = 
FALSE
;

1153 
vm_db_v›w
[
šdex
].
v®id_b
 = 
FALSE
;

1155 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_DEBUG
, "View‚ode deleted succesfully");

1156  
CRM_SUCCESS
;

1157 
	}
}

1159 
št32_t
 
	$üm_g‘_fœ¡_vm_v›w_’Œy
(*
v›w_Çme
 , 
d©aba£_v›w_node
 *
vm_v›w_node
)

1161 
št32_t
 
šdex
;

1162 
ušt8_t
 
node_found_b
 = 0 ;

1163 
št32_t
 
hashkey
 ,
off£t
 = 0;

1164 
d©aba£_v›w_node
 *
v›w_node_’Œy_p
;

1166 
šdex
 = 0;šdex<
CRM_MAX_VIEW_DATABASE
 ; index++)

1168 if(!
	`¡rcmp
(
vm_db_v›w
[
šdex
].
v›w
 , 
v›w_Çme
))

1170 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"View found ");

1171 
node_found_b
 = 1;

1175 if(
node_found_b
 == 0)

1177 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Node‚ot found ");

1178  
CRM_FAILURE
;

1180 
node_found_b
 = 0;

1181 
off£t
 = 0;

1182 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1183 
	`MCHASH_TABLE_SCAN
(
vm_db_v›w
[
šdex
].
db_v›wtbl_p
 ,
hashkey
)

1185 
	`MCHASH_BUCKET_SCAN
(
vm_db_v›w
[
šdex
].
db_v›wtbl_p
,
hashkey
, 
v›w_node_’Œy_p
,
d©aba£_v›w_node
 *,
off£t
)

1187 
	`¡rıy
(
vm_v›w_node
->
v›w_v®ue
 , 
v›w_node_’Œy_p
->view_value);

1188 
	`¡rıy
(
vm_v›w_node
->
node_Çme
 , 
v›w_node_’Œy_p
->node_name);

1189 
node_found_b
 = 1;

1192 if(
node_found_b
)

1195 if(
node_found_b
 == 0)

1197 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1198 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Nodeƒntry NOT found");

1199  
CRM_FAILURE
;

1201 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1202 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Nodeƒntry found");

1203  
CRM_SUCCESS
;

1205 
	}
}

1207 
št32_t
 
	$üm_g‘_Ãxt_vm_v›w_’Œy
(*
v›w_Çme
 , *
v›w_v®ue
 ,
d©aba£_v›w_node
 *
vm_v›w_node
)

1210 
št32_t
 
šdex
;

1211 
ušt8_t
 
node_found_b
 = 0 ;

1212 
št32_t
 
hashkey
 ,
off£t
 ;

1213 
d©aba£_v›w_node
 *
v›w_node_’Œy_p
;

1215 
šdex
 = 0;šdex<
CRM_MAX_VIEW_DATABASE
 ; index++)

1217 if(!
	`¡rcmp
(
vm_db_v›w
[
šdex
].
v›w
 , 
v›w_Çme
))

1219 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"View found ");

1220 
node_found_b
 = 1;

1224 if(
node_found_b
 == 0)

1226 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Node‚ot found ");

1227  
CRM_FAILURE
;

1229 
node_found_b
 =0;

1230 
off£t
 = 0;

1231 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1232 
	`MCHASH_TABLE_SCAN
(
vm_db_v›w
[
šdex
].
db_v›wtbl_p
 ,
hashkey
)

1234 
	`MCHASH_BUCKET_SCAN
(
vm_db_v›w
[
šdex
].
db_v›wtbl_p
,
hashkey
, 
v›w_node_’Œy_p
,
d©aba£_v›w_node
 *,
off£t
)

1236 if(
node_found_b
 == 0)

1238 if(!
	`¡rcmp
(
v›w_node_’Œy_p
->
node_Çme
 , 
v›w_Çme
) &&

1239 (!
	`¡rcmp
(
v›w_node_’Œy_p
->
v›w_v®ue
 , view_value)))

1241 
node_found_b
 = 1;

1249 
	`¡rıy
(
vm_v›w_node
->
v›w_v®ue
 , 
v›w_node_’Œy_p
->view_value);

1250 
	`¡rıy
(
vm_v›w_node
->
node_Çme
 , 
v›w_node_’Œy_p
->node_name);

1254 if(
node_found_b
 == 0)

1256 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1257 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Nodeƒntry NOT found");

1258  
CRM_FAILURE
;

1260 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1261 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Nodeƒntry found");

1262  
CRM_SUCCESS
;

1263 
	}
}

1266 
št32_t
 
	$üm_g‘_exaù_vm_v›w_’Œy
(*
v›w_Çme
 , *
v›w_v®ue
 ,
d©aba£_v›w_node
 *
vm_v›w_node
)

1269 
št32_t
 
šdex
;

1270 
ušt8_t
 
node_found_b
 = 0 ;

1271 
št32_t
 
hashkey
 ,
off£t
 ;

1272 
d©aba£_v›w_node
 *
v›w_node_’Œy_p
;

1274 
šdex
 = 0;šdex<
CRM_MAX_VIEW_DATABASE
 ; index++)

1276 if(!
	`¡rcmp
(
vm_db_v›w
[
šdex
].
v›w
 , 
v›w_Çme
))

1278 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"View found ");

1279 
node_found_b
 = 1;

1283 if(
node_found_b
 == 0)

1285 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Node‚ot found ");

1286  
CRM_FAILURE
;

1288 
node_found_b
 =0;

1289 
off£t
 = 0;

1290 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1291 
	`MCHASH_TABLE_SCAN
(
vm_db_v›w
[
šdex
].
db_v›wtbl_p
 ,
hashkey
)

1293 
	`MCHASH_BUCKET_SCAN
(
vm_db_v›w
[
šdex
].
db_v›wtbl_p
,
hashkey
, 
v›w_node_’Œy_p
,
d©aba£_v›w_node
 *,
off£t
)

1295 if(!
	`¡rcmp
(
v›w_node_’Œy_p
->
node_Çme
 , 
v›w_Çme
) &&

1296 (!
	`¡rcmp
(
v›w_node_’Œy_p
->
v›w_v®ue
 , view_value)))

1298 
node_found_b
 = 1;

1302 if(
node_found_b
)

1305 if(
node_found_b
 == 0)

1307 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1308 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Nodeƒntry NOT found");

1309  
CRM_FAILURE
;

1311 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1312 
	`¡rıy
(
vm_v›w_node
->
v›w_v®ue
 , 
v›w_node_’Œy_p
->view_value);

1313 
	`¡rıy
(
vm_v›w_node
->
node_Çme
 , 
v›w_node_’Œy_p
->node_name);

1314 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Nodeƒntry found");

1315  
CRM_SUCCESS
;

1316 
	}
}

1318 
št32_t
 
	$üm_g‘_vm_by_v›w
(*
v›w_Çme
 , *
v›w_v®ue
 ,
üm_vm_cÚfig_šfo
* 
cÚfig_šfo_p
)

1320 
št32_t
 
šdex
 ,
»t_v®
;

1321 
ušt8_t
 
node_found_b
 = 0 ;

1322 
št32_t
 
hashkey
 ,
off£t
 ;

1323 
d©aba£_v›w_node
 *
v›w_node_’Œy_p
 = 
NULL
;

1324 
üm_vœtu®_machše
 *
üm_vm_node_šfo_p
 = 
NULL
;

1326 
šdex
 = 0;šdex<
CRM_MAX_VIEW_DATABASE
 ; index++)

1328 if(!
	`¡rcmp
(
vm_db_v›w
[
šdex
].
v›w
 , 
v›w_Çme
))

1330 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"View found ");

1331 
node_found_b
 = 1;

1335 if(
node_found_b
 == 0)

1337 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Node‚ot found ");

1338  
CRM_FAILURE
;

1340 
node_found_b
 =0;

1341 
off£t
 = 0;

1342 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1343 
	`MCHASH_TABLE_SCAN
(
vm_db_v›w
[
šdex
].
db_v›wtbl_p
 ,
hashkey
)

1345 
	`MCHASH_BUCKET_SCAN
(
vm_db_v›w
[
šdex
].
db_v›wtbl_p
,
hashkey
, 
v›w_node_’Œy_p
,
d©aba£_v›w_node
 *,
off£t
)

1347 if(!
	`¡rcmp
(
v›w_node_’Œy_p
->
node_Çme
 , 
v›w_Çme
) &&

1348 (!
	`¡rcmp
(
v›w_node_’Œy_p
->
v›w_v®ue
 , view_value)))

1350 
node_found_b
 = 1;

1354 if(
node_found_b
)

1357 if(
node_found_b
 == 0)

1359 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1360 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Nodeƒntry NOT found");

1361  
CRM_FAILURE
;

1363 
»t_v®
 = 
	`g‘_vm_byhªdË
(
v›w_node_’Œy_p
->
node_§ã»f
 , &
üm_vm_node_šfo_p
);

1364 if(
»t_v®
 !ğ
CRM_SUCCESS
)

1366 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"No VMƒxists");

1367  
CRM_FAILURE
;

1369 
	`¡rıy
(
cÚfig_šfo_p
->
vm_Çme
, 
üm_vm_node_šfo_p
->vm_name);

1370 
	`¡rıy
(
cÚfig_šfo_p
->
sw™ch_Çme
, 
üm_vm_node_šfo_p
->
sw™ch_Çme_d´m
);

1371 
	`¡rıy
(
cÚfig_šfo_p
->
‹ÇÁ_Çme
, 
üm_vm_node_šfo_p
->tenant_name);

1372 
	`¡rıy
(
cÚfig_šfo_p
->
vm_desc
,
üm_vm_node_šfo_p
->vm_desc);

1373 
cÚfig_šfo_p
->
vm_ty³
 = 
üm_vm_node_šfo_p
->vm_type;

1375 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1376 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"VM found by view");

1377  
CRM_SUCCESS
;

1378 
	}
}

	@crm_vn_api.c

29 
	~"üm_sy¡em_d•’d’c›s.h
"

30 
	~"üm_‹ÇÁ_­i.h
"

31 
	~"üm_vn_­i.h
"

32 
	~"üm_vm_­i.h
"

33 
	~"pÜt_¡©us_mgr.h
"

34 
	~"¼m_üm_¹Ês_mgr.h
"

37 *
üm_vn_mempoŞ_g
;

38 *
üm_pÜt_»f_mempoŞ_g
;

39 *
üm_subÃt_hªdË_mempoŞ_g
;

40 *
üm_vm_hªdË_mempoŞ_g
;

41 *
üm_vn_compu‹_nodes_mempoŞ_g
;

42 *
üm_pÜt_mempoŞ_g
;

43 *
üm_nÙifiÿtiÚs_mempoŞ_g
;

45 
ušt32_t
 
üm_no_of_vn_buck‘s_g
;

46 
ušt32_t
 
üm_no_of_pÜt_buck‘s_g
;

47 
mchash_bË
* 
üm_vn_bË_g
;

48 
mchash_bË
* 
üm_vm_bË_g
;

49 
mchash_bË
* 
üm_pÜt_bË_g
;

51 
of_li¡_t
 
üm_vn_nÙifiÿtiÚs
[
CRM_VN_LAST_NOTIFICATION_TYPE
 + 1];

53 
št32_t
 
üm_d–_vn_äom_‹ÇÁ
(
ušt64_t
 
‹ÇÁ_hªdË
, *
vn_Çme_p
);

54 
d©aba£_v›w
 
	gvn_db_v›w
[
CRM_MAX_VIEW_DATABASE
];

56 
	güm_vn_­¶iÿtiÚ_Çmes
[
NO_OF_CRM_VN_APPLICATIONS
][
CRM_MAX_APPL_NAME_LEN
 + 1];

61 
	$üm_vm_hªdË_ä“_’Œy_rcu
(
rcu_h—d
 *
vm_hªdË_’Œy_p
)

63 
üm_vœtu®_machše_hªdË
* 
vm_hªdË_šfo_p
 = 
NULL
;

64 
št32_t
 
»t_v®ue
;

66 if(
vm_hªdË_’Œy_p
)

68 
vm_hªdË_šfo_p
 = (
üm_vœtu®_machše_hªdË
 *)(((*)
vm_hªdË_’Œy_p
è- (
of_li¡_node_t
));

69 
»t_v®ue
 = 
	`mempoŞ_»Ëa£_mem_block
(
üm_vm_hªdË_mempoŞ_g
,

70 (
uch¬8_t
*)
vm_hªdË_šfo_p
,

71 
vm_hªdË_šfo_p
->
h—p_b
);

72 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

74 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Failedo„elease vmname_reference memory block");

78 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Deleted succesfully vmname_reference‚ode fromhe database");

83 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "NULL…assed for deletion");

85 
	}
}

87 
	$üm_vn_logiÿl_sw™ch_pÜts_ä“_’Œy_rcu
(
rcu_h—d
 *
logiÿl_sw™ch_pÜts_’Œy_p
)

89 
üm_pÜt_»f
 *
logiÿl_sw™ch_pÜts_šfo_p
=
NULL
;

90 
št32_t
 
»t_v®ue
;

92 if(
logiÿl_sw™ch_pÜts_’Œy_p
)

94 
logiÿl_sw™ch_pÜts_šfo_p
 = (
üm_pÜt_»f
 *)(((*)
logiÿl_sw™ch_pÜts_’Œy_p
è- (
of_li¡_node_t
));

95 
»t_v®ue
 = 
	`mempoŞ_»Ëa£_mem_block
(
üm_pÜt_»f_mempoŞ_g
, (
uch¬8_t
*)
logiÿl_sw™ch_pÜts_šfo_p
,logiÿl_sw™ch_pÜts_šfo_p->
h—p_b
);

96 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

98 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Failedo„elease crm†ogical switch…orts memory block");

102 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
,"Released succesfully crm†ogical switch…orts memory block");

106 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
,"NULL…assed for deletion.");

107 
	}
}

109 
	$üm_compu‹_node_ä“_’Œy_rcu
(
rcu_h—d
 *
compu‹_nodes_’Œy_p
)

111 
üm_compu‹_node
 *
üm_compu‹_node_šfo_p
=
NULL
;

112 
št32_t
 
»t_v®ue
;

114 if(
compu‹_nodes_’Œy_p
)

116 
üm_compu‹_node_šfo_p
 = (
üm_compu‹_node
 *)(((*)
compu‹_nodes_’Œy_p
è- (
of_li¡_node_t
));

117 
»t_v®ue
 = 
	`mempoŞ_»Ëa£_mem_block
(
üm_vn_compu‹_nodes_mempoŞ_g
,

118 (
uch¬8_t
*)
üm_compu‹_node_šfo_p
,

119 
üm_compu‹_node_šfo_p
->
h—p_b
);

120 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

122 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Failedo„elease crm compute‚ode memory block");

126 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Deleted succesfully crm compute‚ode fromhe database");

131 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "NULL…assed for deletion");

133 
	}
}

135 
	$üm_subÃt_hªdË_node_ä“_’Œy_rcu
(
rcu_h—d
 *
subÃt_hªdË_’Œy_p
)

137 
üm_subÃt_hªdË
 *
subÃt_hªdË_šfo_p
=
NULL
;

138 
št32_t
 
»t_v®ue
;

140 if(
subÃt_hªdË_’Œy_p
)

142 
subÃt_hªdË_šfo_p
 = (
üm_subÃt_hªdË
 *)(((*)
subÃt_hªdË_’Œy_p
è- (
of_li¡_node_t
));

143 
»t_v®ue
 = 
	`mempoŞ_»Ëa£_mem_block
(
üm_subÃt_hªdË_mempoŞ_g
,

144 (
uch¬8_t
*)
subÃt_hªdË_šfo_p
,

145 
subÃt_hªdË_šfo_p
->
h—p_b
);

146 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

148 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Failedo„elease subnet handle memory block");

152 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Deleted succesfully subnet handle‚ode fromhe database");

157 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "NULL…assed for deletion");

159 
	}
}

161 
št32_t
 
	$üm_d‘ach_subÃt_hªdË_äom_vn
(*
subÃt_Çme_p
, *
vn_Çme_p
)

163 
ušt32_t
 
hashkey
,
vn_node_found
=0,
subÃt_hªdË_found
=0,
off£t
;

164 
ušt32_t
 
l¡off£t
;

166 
üm_subÃt_hªdË
 *
subÃt_hªdË_node_´ev_’Œy_p
=
NULL
;

167 
üm_subÃt_hªdË
 *
subÃt_hªdË_node_sÿn_’Œy_p
=
NULL
;

169 
üm_vœtu®_ÃtwÜk
 *
üm_vn_šfo_p
=
NULL
;

171 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Entered");

172 if(
vn_Çme_p
 =ğ
NULL
) 
CRM_FAILURE
;

173 if(
subÃt_Çme_p
 =ğ0) 
CRM_FAILURE
;

175 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
vn_Çme_p
, 
üm_no_of_vn_buck‘s_g
);

176 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "hashkey:%d\r\n",
hashkey
);

178 
	`CNTLR_RCU_READ_LOCK_TAKE
();

179 
off£t
 = 
VNNODE_VNTBL_OFFSET
;

180 
	`MCHASH_BUCKET_SCAN
(
üm_vn_bË_g
, 
hashkey
, 
üm_vn_šfo_p
, 
üm_vœtu®_ÃtwÜk
 *,
off£t
)

182 if(!
	`¡rcmp
(
üm_vn_šfo_p
->
nw_Çme
,
vn_Çme_p
))

184 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Virtual‚etwork found");

185 
vn_node_found
 = 1;

189 if(!
vn_node_found
)

191 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Virtual‚etwork‚ot found");

192 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

193  
CRM_FAILURE
;

196 
l¡off£t
 = 
CRM_SUBNET_HANDLE_LISTNODE_OFFSET
;

197 
	`OF_LIST_SCAN
((
üm_vn_šfo_p
->
üm_subÃt_hªdËs
),

198 
subÃt_hªdË_node_sÿn_’Œy_p
,

199 
üm_subÃt_hªdË
 *,

200 
l¡off£t
)

202 if(!
	`¡rcmp
(
subÃt_hªdË_node_sÿn_’Œy_p
->
subÃt_Çme
, 
subÃt_Çme_p
))

204 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "subnet handle found in VN‚odeo detach.");

205 
subÃt_hªdË_found
=1;

208 
subÃt_hªdË_node_´ev_’Œy_p
=
subÃt_hªdË_node_sÿn_’Œy_p
;

211 if(!
subÃt_hªdË_found
)

213 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "subnet handle‚ot found in VN‚odeo detach.");

214 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

215  
CRM_FAILURE
;

218 
	`OF_REMOVE_NODE_FROM_LIST
((
üm_vn_šfo_p
->
üm_subÃt_hªdËs
),

219 
subÃt_hªdË_node_sÿn_’Œy_p
,

220 
subÃt_hªdË_node_´ev_’Œy_p
,

221 
l¡off£t


223 
üm_vn_šfo_p
->
no_of_subÃts
--;

225 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Subnet handle deleted success fully fromhe Virtual Network");

226 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

227  
CRM_SUCCESS
;

228 
	}
}

235 
št32_t
 
	$üm_©ch_subÃt_hªdË_to_vn
(
ušt64_t
 
vn_hªdË
,

236 *
subÃt_Çme_p
,

237 
ušt64_t
 
subÃt_hªdË
)

239 
št32_t
 
»t_v®
;

240 
ušt8_t
 
h—p_b
;

241 
üm_subÃt_hªdË
* 
subÃt_hªdË_šfo_p
 = 
NULL
;

242 
üm_subÃt_hªdË
* 
subÃt_hªdË_node_sÿn_’Œy_p
 = 
NULL
;

243 
üm_vœtu®_ÃtwÜk
* 
üm_vn_šfo_p
 = 
NULL
;

245 
	`CNTLR_RCU_READ_LOCK_TAKE
();

246 
»t_v®
 = 
	`üm_g‘_vn_byhªdË
(
vn_hªdË
, &
üm_vn_šfo_p
);

247 if(
»t_v®
 !ğ
CRM_SUCCESS
)

249 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "crm_get_vn_byhandle failed!.");

250  
CRM_ERROR_INVALID_VN_HANDLE
;

252 
	`OF_LIST_SCAN
((
üm_vn_šfo_p
->
üm_subÃt_hªdËs
),

253 
subÃt_hªdË_node_sÿn_’Œy_p
,

254 
üm_subÃt_hªdË
 *,

255 
CRM_SUBNET_HANDLE_LISTNODE_OFFSET
)

257 if(!
	`¡rcmp
(
subÃt_hªdË_node_sÿn_’Œy_p
->
subÃt_Çme
, 
subÃt_Çme_p
))

259 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "subnet handle‡lready‡ttachedo VN.");

260 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

261  
CRM_FAILURE
;

265 
»t_v®
 = 
	`mempoŞ_g‘_mem_block
(
üm_subÃt_hªdË_mempoŞ_g
,

266 (
uch¬8_t
**)&
subÃt_hªdË_šfo_p
,

267 &
h—p_b
);

268 if(
»t_v®
 !ğ
MEMPOOL_SUCCESS
)

270 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "memory block‡llocation failed.");

271 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

272  
CRM_FAILURE
;

274 
subÃt_hªdË_šfo_p
->
h—p_b
 = heap_b;

275 
	`¡ºıy
(
subÃt_hªdË_šfo_p
->
subÃt_Çme
, 
subÃt_Çme_p
, 
CRM_MAX_SUBNET_NAME_LEN
);

276 
subÃt_hªdË_šfo_p
->
subÃt_hªdË
 = subnet_handle;

278 
	`OF_APPEND_NODE_TO_LIST
((
üm_vn_šfo_p
->
üm_subÃt_hªdËs
),

279 
subÃt_hªdË_šfo_p
,

280 
CRM_SUBNET_HANDLE_LISTNODE_OFFSET
);

282 
üm_vn_šfo_p
->
no_of_subÃts
++;

284 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

285  
CRM_SUCCESS
;

286 
	}
}

288 
št32_t
 
	$üm_d‘ch_vm_hªdË_äom_vn
(*
vm_Çme_p
, *
vn_Çme_p
)

290 
ušt32_t
 
hashkey
,
vn_node_found
=0,
vm_hªdË_found
=0,
off£t
,
l¡off£t
;

291 
üm_vœtu®_machše_hªdË
 *
vm_hªdË_node_´ev_’Œy_p
=
NULL
;

292 
üm_vœtu®_machše_hªdË
 *
vm_hªdË_node_sÿn_’Œy_p
=
NULL
;

293 
üm_vœtu®_ÃtwÜk
 *
üm_vn_šfo_p
=
NULL
;

295 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Entered");

296 if(
vn_Çme_p
 =ğ
NULL
) 
CRM_FAILURE
;

297 if(
vm_Çme_p
 =ğ0) 
CRM_FAILURE
;

299 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
vn_Çme_p
, 
üm_no_of_vn_buck‘s_g
);

300 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "hashkey:%d\r\n",
hashkey
);

302 
	`CNTLR_RCU_READ_LOCK_TAKE
();

303 
off£t
 = 
VNNODE_VNTBL_OFFSET
;

304 
	`MCHASH_BUCKET_SCAN
(
üm_vn_bË_g
, 
hashkey
, 
üm_vn_šfo_p
, 
üm_vœtu®_ÃtwÜk
 *,
off£t
)

306 if(!
	`¡rcmp
(
üm_vn_šfo_p
->
nw_Çme
,
vn_Çme_p
))

308 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Virtual‚etwork found");

309 
vn_node_found
 = 1;

313 if(!
vn_node_found
)

315 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Virtual‚etwork‚ot found");

316 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

317  
CRM_FAILURE
;

320 
l¡off£t
 = 
CRM_VM_HANDLE_LISTNODE_OFFSET
;

321 
	`OF_LIST_SCAN
((
üm_vn_šfo_p
->
üm_vm_hªdËs
),

322 
vm_hªdË_node_sÿn_’Œy_p
,

323 
üm_vœtu®_machše_hªdË
 *,

324 
l¡off£t
)

326 if(!
	`¡rcmp
(
vm_hªdË_node_sÿn_’Œy_p
->
vm_Çme
, 
vm_Çme_p
))

328 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "VM handle found in VN‚odeo detach.");

329 
vm_hªdË_found
=1;

332 
vm_hªdË_node_´ev_’Œy_p
=
vm_hªdË_node_sÿn_’Œy_p
;

335 if(!
vm_hªdË_found
)

337 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "VM handle‚ot found in VN‚odeo detach.");

338 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

339  
CRM_FAILURE
;

342 
	`OF_REMOVE_NODE_FROM_LIST
((
üm_vn_šfo_p
->
üm_vm_hªdËs
),

343 
vm_hªdË_node_sÿn_’Œy_p
,

344 
vm_hªdË_node_´ev_’Œy_p
,

345 
l¡off£t


347 
üm_vn_šfo_p
->
no_of_vms
--;

349 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Virtual Machine handle deleted success fully fromhe vn");

351 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

352  
CRM_SUCCESS
;

353 
	}
}

360 
št32_t
 
	$üm_©ch_vm_hªdË_to_vn
(*
vn_Çme_p
,*
vm_Çme_p
,
ušt64_t
 
vm_hªdË
)

362 
št32_t
 
»t_v®
;

363 
ušt32_t
 
hashkey
,
vn_node_found
=0,
off£t
;

364 
ušt8_t
 
h—p_b
;

366 
üm_vœtu®_machše_hªdË
 *
vm_hªdË_šfo_p
 = 
NULL
;

367 
üm_vœtu®_machše_hªdË
 *
vm_hªdË_node_sÿn_’Œy_p
 = 
NULL
;

368 
üm_vœtu®_ÃtwÜk
 *
üm_vn_šfo_p
 = 
NULL
;

370 if(
vn_Çme_p
 =ğ
NULL
)

371  
CRM_FAILURE
;

372 if(
vm_hªdË
 == 0)

373  
CRM_FAILURE
;

375 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
vn_Çme_p
,
üm_no_of_vn_buck‘s_g
);

376 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "hashkey:%d\r\n",
hashkey
);

377 
	`CNTLR_RCU_READ_LOCK_TAKE
();

378 
off£t
 = 
VNNODE_VNTBL_OFFSET
;

380 
	`MCHASH_BUCKET_SCAN
(
üm_vn_bË_g
, 
hashkey
, 
üm_vn_šfo_p
, 
üm_vœtu®_ÃtwÜk
 *,
off£t
)

382 if(!
	`¡rcmp
(
üm_vn_šfo_p
->
nw_Çme
,
vn_Çme_p
))

384 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Virtual‚etwork found");

385 
vn_node_found
 = 1;

389 if(!
vn_node_found
)

391 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Virtual‚etwork‚ot found");

392 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

393  
CRM_FAILURE
;

396 
	`OF_LIST_SCAN
((
üm_vn_šfo_p
->
üm_vm_hªdËs
),

397 
vm_hªdË_node_sÿn_’Œy_p
,

398 
üm_vœtu®_machše_hªdË
 *,

399 
CRM_VM_HANDLE_LISTNODE_OFFSET
)

401 if(!
	`¡rcmp
(
vm_hªdË_node_sÿn_’Œy_p
->
vm_Çme
, 
vm_Çme_p
))

403 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "VM handle‡lready‡ttachedo VN.");

404 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

405  
CRM_FAILURE
;

409 
»t_v®
 = 
	`mempoŞ_g‘_mem_block
(
üm_vm_hªdË_mempoŞ_g
,(
uch¬8_t
**)&
vm_hªdË_šfo_p
,&
h—p_b
);

410 if(
»t_v®
 !ğ
MEMPOOL_SUCCESS
)

412 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "memory block‡llocation failed.");

413 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

414  
CRM_FAILURE
;

417 
vm_hªdË_šfo_p
->
h—p_b
 = heap_b;

418 
	`¡ºıy
(
vm_hªdË_šfo_p
->
vm_Çme
, 
vm_Çme_p
, 
CRM_MAX_VM_NAME_LEN
);

419 
vm_hªdË_šfo_p
->
vm_hªdË
 = vm_handle;

421 
	`OF_APPEND_NODE_TO_LIST
((
üm_vn_šfo_p
->
üm_vm_hªdËs
),
vm_hªdË_šfo_p
,
CRM_VM_HANDLE_LISTNODE_OFFSET
);

423 
üm_vn_šfo_p
->
no_of_vms
++;

425 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

426  
CRM_SUCCESS
;

427 
	}
}

433 
št32_t
 
	$üm_g‘_vn_byhªdË
(
ušt64_t
 
vn_hªdË
,
üm_vœtu®_ÃtwÜk
 **
üm_vn_šfo_p
)

436 
ušt32_t
 
šdex
,
magic
;

437 
ušt8_t
 
¡©us_b
;

439 
	`CNTLR_RCU_READ_LOCK_TAKE
();

440 
magic
 = (
ušt32_t
)(
vn_hªdË
 >>32);

441 
šdex
 = (
ušt32_t
)
vn_hªdË
;

443 
	`MCHASH_ACCESS_NODE
(
üm_vn_bË_g
,
šdex
,
magic
,*
üm_vn_šfo_p
,
¡©us_b
);

444 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

445 if(
TRUE
 =ğ
¡©us_b
)

446  
CRM_SUCCESS
;

447  
CRM_ERROR_INVALID_VN_HANDLE
;

448 
	}
}

454 
št32_t
 
	$üm_g‘_vn_hªdË
(*
vn_Çme_p
, 
ušt64_t
 *
vn_hªdË_p
)

456 
ušt32_t
 
hashkey
;

457 
ušt32_t
 
off£t
;

459 
üm_vœtu®_ÃtwÜk
 *
üm_vn_šfo_p
=
NULL
;

461 if(
üm_vn_bË_g
 =ğ
NULL
)

462  
CRM_FAILURE
;

464 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
vn_Çme_p
,
üm_no_of_vn_buck‘s_g
);

465 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "hashkey:%d\r\n",
hashkey
);

466 
	`CNTLR_RCU_READ_LOCK_TAKE
();

467 
off£t
 = 
VNNODE_VNTBL_OFFSET
;

469 
	`MCHASH_BUCKET_SCAN
(
üm_vn_bË_g
, 
hashkey
, 
üm_vn_šfo_p
, 
üm_vœtu®_ÃtwÜk
 *,
off£t
)

471 if(
	`¡rcmp
(
üm_vn_šfo_p
->
nw_Çme
,
vn_Çme_p
))

473 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

475 *
vn_hªdË_p
 = 
üm_vn_šfo_p
->
magic
;

476 *
vn_hªdË_p
 = ((*vn_hªdË_°<<32è| (
üm_vn_šfo_p
->
šdex
));

478 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "*vn_hªdË_p:%x\r\n",*
vn_hªdË_p
);

479  
CRM_SUCCESS
;

481 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

482  
CRM_ERROR_VN_NAME_INVALID
;

483 
	}
}

489 
št32_t
 
	$üm_add_vœtu®_ÃtwÜk
 (
üm_vn_cÚfig_šfo
 *
cÚfig_šfo_p
,

490 
ušt64_t
 *
ouut_vn_hªdË_p
)

492 
št32_t
 
»t_v®ue
 = 
CRM_FAILURE
;

493 
üm_vœtu®_ÃtwÜk
 *
üm_vn_node_p
=
NULL
,*
üm_vn_node_sÿn_p
=NULL;

494 
ušt32_t
 
nid
 = 0,
hashkey
, 
vnoff£t
, 
šdex
, 
magic
,
­phookoff£t
;

495 
ušt8_t
 
h—p_b
, 
¡©us_b
 = 
FALSE
;

496 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *
­p_’Œy_p
=
NULL
;

497 
üm_vn_nÙifiÿtiÚ_d©a
 
nÙifiÿtiÚ_d©a
={};

498 
üm_‹ÇÁ_cÚfig_šfo
 crm_tenant_config_info={};

499 
ušt64_t
 
‹ÇÁ_hªdË
;

500 
uch¬8_t
* 
hashobj_p
 = 
NULL
;

502 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Entered");

504 if(
üm_vn_bË_g
 =ğ
NULL
)

506 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "No hashableo‡dd crm_vn„ecord\r\n");

507  
CRM_FAILURE
;

510 if((
cÚfig_šfo_p
->
nw_Çme
 =ğ
NULL
)||

511 (
	`¡¾’
(
cÚfig_šfo_p
->
nw_Çme
è>ğ
CRM_MAX_VN_NAME_LEN
))

513 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "network‚ame is invalid");

514  
CRM_ERROR_VN_NAME_INVALID
;

517 if((
cÚfig_šfo_p
->
‹ÇÁ_Çme
 =ğ
NULL
)||

518 (
	`¡¾’
(
cÚfig_šfo_p
->
‹ÇÁ_Çme
)>=
CRM_MAX_TENANT_NAME_LEN
))

520 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "tenant‚ame is invalid");

521  
CRM_ERROR_TENANT_NAME_INVALID
;

525 if((
cÚfig_šfo_p
->
subÃt_Çme
 =ğ
NULL
)||

526 (
	`¡¾’
(
cÚfig_šfo_p
->
subÃt_Çme
)>=
CRM_MAX_SUBNET_NAME_LEN
)

529 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "subnet‚ame is invalid");

530  
CRM_ERROR_SUBNET_NAME_INVALID
;

534 if(!((
cÚfig_šfo_p
->
nw_ty³
 =ğ
VLAN_TYPE
) ||

535 (
cÚfig_šfo_p
->
nw_ty³
 =ğ
VXLAN_TYPE
) ||

536 (
cÚfig_šfo_p
->
nw_ty³
 =ğ
NVGRE_TYPE
)))

538 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "ÃtwÜky³ inv®id\r\n", 
__FUNCTION__
, 
__LINE__
);

539  
CRM_ERROR_VN_NETWORK_TYPE_INVALID
;

543 
»t_v®ue
 = 
	`üm_g‘_‹ÇÁ_hªdË
(
cÚfig_šfo_p
->
‹ÇÁ_Çme
, &
‹ÇÁ_hªdË
);

544 if(
»t_v®ue
 !ğ
CRM_SUCCESS
)

546 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Tenant‚ot in db. createenant.");

547 
	`¡rıy
(
üm_‹ÇÁ_cÚfig_šfo
.
‹ÇÁ_Çme
, 
cÚfig_šfo_p
->tenant_name);

548 
»t_v®ue
 = 
	`üm_add_‹ÇÁ
(&
üm_‹ÇÁ_cÚfig_šfo
, &
‹ÇÁ_hªdË
);

549 if(
»t_v®ue
!=
CRM_SUCCESS
)

551 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Failedo‡ddenant");

552  
CRM_FAILURE
;

556 
	`CNTLR_RCU_READ_LOCK_TAKE
();

559 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
cÚfig_šfo_p
->
nw_Çme
, 
üm_no_of_vn_buck‘s_g
);

560 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "hashkey:%d",
hashkey
);

563 
vnoff£t
 = 
VNNODE_VNTBL_OFFSET
;

566 
	`MCHASH_BUCKET_SCAN
(
üm_vn_bË_g
, 
hashkey
, 
üm_vn_node_sÿn_p
, 
üm_vœtu®_ÃtwÜk
*, 
vnoff£t
)

568 if(
	`¡rcmp
(
cÚfig_šfo_p
->
nw_Çme
, 
üm_vn_node_sÿn_p
->nw_name) != 0)

570 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Du¶iÿ‹ vœtu®‚‘wÜk‚am%s",
cÚfig_šfo_p
->
nw_Çme
);

571 
»t_v®ue
 = 
CRM_ERROR_DUPLICATE_VN_RESOURCE
;

572 
CRM_ADD_VN_EXIT
;

576 
»t_v®ue
 = 
	`mempoŞ_g‘_mem_block
(
üm_vn_mempoŞ_g
, (
uch¬8_t
 **)&
üm_vn_node_p
, &
h—p_b
);

577 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

579 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "memory block‡llocation failed forhe virtual‚etwork‚ode.");

580 
»t_v®ue
 = 
CRM_FAILURE
;

581 
CRM_ADD_VN_EXIT
;

584 
	`mem£t
(
üm_vn_node_p
 , 0 , (üm_vn_node_pè+ (
NO_OF_CRM_VN_APPLICATIONS
 * (*)));

585 
üm_vn_node_p
->
h—p_b
 = heap_b;

588 
	`¡ºıy
(
üm_vn_node_p
->
nw_Çme
, 
cÚfig_šfo_p
->nw_Çme, 
CRM_MAX_VN_NAME_LEN
);

592 
	`¡ºıy
(
üm_vn_node_p
->
‹ÇÁ_Çme
, 
cÚfig_šfo_p
->‹ÇÁ_Çme, 
CRM_MAX_TENANT_NAME_LEN
);

593 
üm_vn_node_p
->
§ã»f_‹ÇÁ
 = 
‹ÇÁ_hªdË
;

596 
üm_vn_node_p
->
nw_ty³
 = 
cÚfig_šfo_p
->nw_type;

598 if(
cÚfig_šfo_p
->
nw_ty³
 =ğ
VXLAN_TYPE
)

600 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "vxlanype");

601 
üm_vn_node_p
->
nw_·¿ms
.
vxÏn_nw
.
nid
 = 
cÚfig_šfo_p
->nw_params.vxlan_nw.nid;

602 
nid
 = 
cÚfig_šfo_p
->
nw_·¿ms
.
vxÏn_nw
.nid;

603 
üm_vn_node_p
->
nw_·¿ms
.
vxÏn_nw
.
£rviû_pÜt
 = 
cÚfig_šfo_p
->nw_params.vxlan_nw.service_port;

604 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "%d:%d",
cÚfig_šfo_p
->
nw_·¿ms
.
vxÏn_nw
.
nid
,cÚfig_šfo_p->nw_·¿ms.vxÏn_nw.
£rviû_pÜt
);

606 if(
cÚfig_šfo_p
->
nw_ty³
 =ğ
NVGRE_TYPE
)

608 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "nvgreype");

609 
üm_vn_node_p
->
nw_·¿ms
.
nvg»_nw
.
nid
 = 
cÚfig_šfo_p
->nw_params.nvgre_nw.nid;

610 
nid
 = 
cÚfig_šfo_p
->
nw_·¿ms
.
nvg»_nw
.nid;

611 
üm_vn_node_p
->
nw_·¿ms
.
nvg»_nw
.
£rviû_pÜt
 = 
cÚfig_šfo_p
->nw_params.nvgre_nw.service_port;

612 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "%d:%d",
cÚfig_šfo_p
->
nw_·¿ms
.
nvg»_nw
.
nid
,cÚfig_šfo_p->nw_·¿ms.nvg»_nw.
£rviû_pÜt
);

614 if(
cÚfig_šfo_p
->
nw_ty³
 =ğ
VLAN_TYPE
)

616 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "vlanype");

617 
üm_vn_node_p
->
nw_·¿ms
.
vÏn_nw
.
vÏn_id
 = 
cÚfig_šfo_p
->nw_params.vlan_nw.vlan_id;

618 
nid
 = 
cÚfig_šfo_p
->
nw_·¿ms
.
vÏn_nw
.
vÏn_id
;

619 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "%d",
cÚfig_šfo_p
->
nw_·¿ms
.
vÏn_nw
.
vÏn_id
);

624 
	`OF_LIST_INIT
(
üm_vn_node_p
->
üm_compu‹_nodes
, 
üm_compu‹_node_ä“_’Œy_rcu
);

625 
	`OF_LIST_INIT
(
üm_vn_node_p
->
üm_subÃt_hªdËs
, 
üm_subÃt_hªdË_node_ä“_’Œy_rcu
);

626 
	`OF_LIST_INIT
(
üm_vn_node_p
->
©Œibu‹s
, 
üm_©Œibu‹s_ä“_©Œibu‹_’Œy_rcu
);

627 
	`OF_LIST_INIT
(
üm_vn_node_p
->
üm_vm_hªdËs
, 
üm_vm_hªdË_ä“_’Œy_rcu
);

629 
	`¡ºıy
(
üm_vn_node_p
->
nw_desc
, 
cÚfig_šfo_p
->nw_desc, 
CRM_MAX_VN_DESC_LEN
);

630 
üm_vn_node_p
->
vn_İ”©iÚ®_¡©us_b
 = 
cÚfig_šfo_p
->vn_operational_status_b;

631 
	`¡ºıy
(
üm_vn_node_p
->
´ovid”_physiÿl_ÃtwÜk
, 
cÚfig_šfo_p
->´ovid”_physiÿl_ÃtwÜk,
CRM_MAX_VN_PROVIDER_PHY_NW
);

632 
üm_vn_node_p
->
vn_admš_¡©e_up_b
 = 
cÚfig_šfo_p
->vn_admin_state_up_b;

633 
üm_vn_node_p
->
rou‹r_ex‹º®_b
 = 
cÚfig_šfo_p
->router_external_b;

635 
hashobj_p
 = (
uch¬8_t
 *)
üm_vn_node_p
 + 
VNNODE_VNTBL_OFFSET
;

637 
	`MCHASH_APPEND_NODE
(
üm_vn_bË_g
, 
hashkey
, 
üm_vn_node_p
, 
šdex
, 
magic
, 
hashobj_p
, 
¡©us_b
);

638 if(
FALSE
 =ğ
¡©us_b
)

640 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, " failedo‡ppend virtual‚etwork‚odeo hashable");

641 
»t_v®ue
 = 
CRM_ERROR_VN_ADD_FAIL
;

642 
CRM_ADD_VN_EXIT
;

645 *
ouut_vn_hªdË_p
 = 
magic
;

646 *
ouut_vn_hªdË_p
 = ((*ouut_vn_hªdË_°<<32è| (
šdex
));

648 
üm_vn_node_p
->
magic
 = magic;

649 
üm_vn_node_p
->
šdex
 = index;

650 (
üm_vn_node_p
->
vn_hªdË
èğ*
ouut_vn_hªdË_p
;

652 if(
	`üm_add_vn_to_‹ÇÁ
(
‹ÇÁ_hªdË
, 
üm_vn_node_p
->
nw_Çme
è!ğ
CRM_SUCCESS
)

654 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "add vnoenant failed!.");

656 
­phookoff£t
 = 
CRM_NOTIFICATION_APP_HOOK_OFFSET
;

657 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
vn_Çme
, 
üm_vn_node_p
->
nw_Çme
);

658 
nÙifiÿtiÚ_d©a
.
nw_ty³
 = 
üm_vn_node_p
->nw_type;

659 
nÙifiÿtiÚ_d©a
.
tun_id
 = 
nid
;

661 
	`OF_LIST_SCAN
(
üm_vn_nÙifiÿtiÚs
[
CRM_VN_ADDED
], 
­p_’Œy_p
, 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *, 
­phookoff£t
 )

663 ((
üm_vn_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_VN_ADDED
,

664 *
ouut_vn_hªdË_p
,

665 
nÙifiÿtiÚ_d©a
,

666 
­p_’Œy_p
->
cbk_¬g1
,

667 
­p_’Œy_p
->
cbk_¬g2
);

670 
	`OF_LIST_SCAN
(
üm_vn_nÙifiÿtiÚs
[
CRM_VN_ALL_NOTIFICATIONS
], 
­p_’Œy_p
, 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *, 
­phookoff£t
 )

672 ((
üm_vn_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_VN_ADDED
,

673 *
ouut_vn_hªdË_p
,

674 
nÙifiÿtiÚ_d©a
,

675 
­p_’Œy_p
->
cbk_¬g1
,

676 
­p_’Œy_p
->
cbk_¬g2
);

678 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

679 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "virtual‚etwork‡dded successfullyohe vn-db");

680  
CRM_SUCCESS
;

682 
CRM_ADD_VN_EXIT
:

683 if(
üm_vn_node_p
)

685 
	`mempoŞ_»Ëa£_mem_block
(
üm_vn_mempoŞ_g
, (
uch¬8_t
 *)
üm_vn_node_p
, crm_vn_node_p->
h—p_b
);

687 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

688 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "virtual‚etwork failedo‡dd vn-db");

689  
»t_v®ue
;

690 
	}
}

696 
št32_t
 
	$üm_modify_vœtu®_ÃtwÜk
 (
üm_vn_cÚfig_šfo
 *
cÚfig_šfo_p
,

697 
ušt32_t
 
f›ld_æags
)

699 
št32_t
 
»t_v®ue
=
CRM_FAILURE
;

700 
üm_vœtu®_ÃtwÜk
 *
üm_vn_node_sÿn_p
=
NULL
;

701 
ušt32_t
 
hashkey
, 
vnoff£t
,
­phookoff£t
;

702 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *
­p_’Œy_p
=
NULL
;

703 
üm_vn_nÙifiÿtiÚ_d©a
 
nÙifiÿtiÚ_d©a
={};

704 
ušt64_t
 
‹ÇÁ_hªdË
;

706 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "entered");

708 if(
üm_vn_bË_g
 =ğ
NULL
)

710 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "no hashableo‡dd crm_vn„ecord\r\n");

711  
CRM_FAILURE
;

714 if((
cÚfig_šfo_p
->
nw_Çme
 =ğ
NULL
)||

715 (
	`¡¾’
(
cÚfig_šfo_p
->
nw_Çme
)>=
CRM_MAX_VN_NAME_LEN
))

717 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "network‚ame is invalid");

718  
CRM_ERROR_VN_NAME_INVALID
;

721 if((
cÚfig_šfo_p
->
‹ÇÁ_Çme
 =ğ
NULL
)||

722 (
	`¡¾’
(
cÚfig_šfo_p
->
‹ÇÁ_Çme
)>=
CRM_MAX_TENANT_NAME_LEN
))

724 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "tenant‚ame is invalid");

725  
CRM_ERROR_TENANT_NAME_INVALID
;

728 if(!((
cÚfig_šfo_p
->
nw_ty³
 =ğ
VLAN_TYPE
)||

729 (
cÚfig_šfo_p
->
nw_ty³
 ==
VXLAN_TYPE
)))

731 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "ÃtwÜky³ inv®id\r\n", 
__FUNCTION__
, 
__LINE__
);

732  
CRM_ERROR_VN_NETWORK_TYPE_INVALID
;

736 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
cÚfig_šfo_p
->
nw_Çme
, 
üm_no_of_vn_buck‘s_g
);

737 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "hashkey:%d",
hashkey
);

739 
vnoff£t
 = 
VNNODE_VNTBL_OFFSET
;

741 
	`CNTLR_RCU_READ_LOCK_TAKE
();

745 
	`MCHASH_BUCKET_SCAN
(
üm_vn_bË_g
, 
hashkey
, 
üm_vn_node_sÿn_p
, 
üm_vœtu®_ÃtwÜk
*, 
vnoff£t
)

747 if(
	`¡rcmp
(
cÚfig_šfo_p
->
nw_Çme
, 
üm_vn_node_sÿn_p
->nw_name) != 0)

749 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "vœtu®‚‘wÜk‚am% found",
cÚfig_šfo_p
->
nw_Çme
);

754 if(
	`¡rcmp
(
üm_vn_node_sÿn_p
->
‹ÇÁ_Çme
,
cÚfig_šfo_p
->tenant_name)!=0)

756 if(
	`üm_d–_vn_äom_‹ÇÁ
(
üm_vn_node_sÿn_p
->
§ã»f_‹ÇÁ
, crm_vn_node_sÿn_p->
nw_Çme
è!ğ
CRM_SUCCESS
)

758 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "del vn fromenant failed!.");

759 
»t_v®ue
 = 
CRM_FAILURE
;

762 
»t_v®ue
 = 
	`üm_g‘_‹ÇÁ_hªdË
(
cÚfig_šfo_p
->
‹ÇÁ_Çme
, &
‹ÇÁ_hªdË
);

763 if(
»t_v®ue
 !ğ
CRM_SUCCESS
)

765 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "tenant‚ame invalid");

766 
»t_v®ue
 = 
CRM_ERROR_TENANT_NAME_INVALID
;

769 
	`¡ºıy
(
üm_vn_node_sÿn_p
->
‹ÇÁ_Çme
, 
cÚfig_šfo_p
->‹ÇÁ_Çme, 
CRM_MAX_TENANT_NAME_LEN
);

770 
üm_vn_node_sÿn_p
->
§ã»f_‹ÇÁ
 = 
‹ÇÁ_hªdË
;

771 if(
	`üm_add_vn_to_‹ÇÁ
(
‹ÇÁ_hªdË
, 
üm_vn_node_sÿn_p
->
nw_Çme
è!ğ
CRM_SUCCESS
)

773 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "add vnoenant failed!.");

779 
üm_vn_node_sÿn_p
->
nw_ty³
 = 
cÚfig_šfo_p
->nw_type;

780 if(
cÚfig_šfo_p
->
nw_ty³
 =ğ
VLAN_TYPE
)

782 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "vlanype");

783 
üm_vn_node_sÿn_p
->
nw_·¿ms
.
vÏn_nw
.
vÏn_id
 = 
cÚfig_šfo_p
->nw_params.vlan_nw.vlan_id;

784 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "%d",
cÚfig_šfo_p
->
nw_·¿ms
.
vÏn_nw
.
vÏn_id
);

786 if(
cÚfig_šfo_p
->
nw_ty³
 =ğ
VXLAN_TYPE
)

788 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "vxlanype");

789 
üm_vn_node_sÿn_p
->
nw_·¿ms
.
vxÏn_nw
.
nid
 = 
cÚfig_šfo_p
->nw_params.vxlan_nw.nid;

790 
üm_vn_node_sÿn_p
->
nw_·¿ms
.
vxÏn_nw
.
£rviû_pÜt
 = 
cÚfig_šfo_p
->nw_params.vxlan_nw.service_port;

791 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "%d:%d",
cÚfig_šfo_p
->
nw_·¿ms
.
vxÏn_nw
.
nid
,cÚfig_šfo_p->nw_·¿ms.vxÏn_nw.
£rviû_pÜt
);

793 
	`¡ºıy
(
üm_vn_node_sÿn_p
->
nw_desc
, 
cÚfig_šfo_p
->nw_desc, 
CRM_MAX_VN_DESC_LEN
);

794 
üm_vn_node_sÿn_p
->
vn_İ”©iÚ®_¡©us_b
 = 
cÚfig_šfo_p
->vn_operational_status_b;

795 
	`¡ºıy
(
üm_vn_node_sÿn_p
->
´ovid”_physiÿl_ÃtwÜk
, 
cÚfig_šfo_p
->´ovid”_physiÿl_ÃtwÜk,
CRM_MAX_VN_PROVIDER_PHY_NW
);

796 
üm_vn_node_sÿn_p
->
vn_admš_¡©e_up_b
 = 
cÚfig_šfo_p
->vn_admin_state_up_b;

797 
üm_vn_node_sÿn_p
->
rou‹r_ex‹º®_b
 = 
cÚfig_šfo_p
->router_external_b;

800 
­phookoff£t
 = 
CRM_NOTIFICATION_APP_HOOK_OFFSET
;

801 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
vn_Çme
, 
üm_vn_node_sÿn_p
->
nw_Çme
);

802 
	`OF_LIST_SCAN
(
üm_vn_nÙifiÿtiÚs
[
CRM_VN_MODIFIED
], 
­p_’Œy_p
, 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *, 
­phookoff£t
 )

804 ((
üm_vn_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_VN_MODIFIED
,

805 
üm_vn_node_sÿn_p
->
vn_hªdË
,

806 
nÙifiÿtiÚ_d©a
,

807 
­p_’Œy_p
->
cbk_¬g1
,

808 
­p_’Œy_p
->
cbk_¬g2
);

811 
	`OF_LIST_SCAN
(
üm_vn_nÙifiÿtiÚs
[
CRM_VN_ALL_NOTIFICATIONS
], 
­p_’Œy_p
, 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *, 
­phookoff£t
 )

813 ((
üm_vn_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_VN_MODIFIED
,

814 
üm_vn_node_sÿn_p
->
vn_hªdË
,

815 
nÙifiÿtiÚ_d©a
,

816 
­p_’Œy_p
->
cbk_¬g1
,

817 
­p_’Œy_p
->
cbk_¬g2
);

819 
»t_v®ue
=
CRM_SUCCESS
;

823 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

824 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "virtual‚etwork modified successfully inhe vn-db");

826  
»t_v®ue
;

827 
	}
}

834 
št32_t
 
	$üm_»gi¡”_vn_nÙifiÿtiÚs
 (
ušt32_t
 
nÙifiÿtiÚ_ty³
, 
üm_vn_nÙif›r_â
 
vn_nÙif›r_â
,

835 * 
ÿÎback_¬g1
, * 
ÿÎback_¬g2
)

837 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *
­p_’Œy_p
;

838 
ušt8_t
 
h—p_b
;

839 
št32_t
 
»tv®
 = 
CRM_SUCCESS
;

840 
uch¬8_t
 
l¡off£t
;

841 
l¡off£t
 = 
CRM_NOTIFICATION_APP_HOOK_OFFSET
;

843 if((
nÙifiÿtiÚ_ty³
 < 
CRM_VN_FIRST_NOTIFICATION_TYPE
) ||

844 (
nÙifiÿtiÚ_ty³
 > 
CRM_VN_LAST_NOTIFICATION_TYPE
)

847 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "šv®id‚ÙifiÿtiÚy³:%d", 
nÙifiÿtiÚ_ty³
);

848  
CRM_FAILURE
;

851 if(
vn_nÙif›r_â
 =ğ
NULL
)

853 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "callback function is NULL");

854  
CRM_FAILURE
;

857 
»tv®
 = 
	`mempoŞ_g‘_mem_block
(
üm_nÙifiÿtiÚs_mempoŞ_g
, (
uch¬8_t
**)&
­p_’Œy_p
, &
h—p_b
);

858 if(
»tv®
 !ğ
MEMPOOL_SUCCESS
)

860 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "failedo get mempool");

861  
CRM_FAILURE
;

864 
­p_’Œy_p
->
ÿÎ_back
 = (*)
vn_nÙif›r_â
;

865 
­p_’Œy_p
->
cbk_¬g1
 = 
ÿÎback_¬g1
;

866 
­p_’Œy_p
->
cbk_¬g2
 = 
ÿÎback_¬g2
;

867 
­p_’Œy_p
->
h—p_b
 = heap_b;

870 
	`OF_APPEND_NODE_TO_LIST
(
üm_vn_nÙifiÿtiÚs
[
nÙifiÿtiÚ_ty³
], 
­p_’Œy_p
, 
l¡off£t
);

872 if(
»tv®
 !ğ
CRM_SUCCESS
)

873 
	`mempoŞ_»Ëa£_mem_block
(
üm_nÙifiÿtiÚs_mempoŞ_g
, (
uch¬8_t
*)
­p_’Œy_p
,‡µ_’Œy_p->
h—p_b
);

874  
»tv®
;

875 
	}
}

877 
št32_t
 
	$üm_d”egi¡”_vn_nÙifiÿtiÚs
(
ušt32_t
 
nÙifiÿtiÚ_ty³
,

878 
üm_vn_nÙif›r_â
 
vn_nÙif›r_â
)

880 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *
­p_’Œy_p
,*
´ev_­p_’Œy_p
 = 
NULL
;

881 
uch¬8_t
 
l¡off£t
;

882 
l¡off£t
 = 
CRM_NOTIFICATION_APP_HOOK_OFFSET
;

884 if((
nÙifiÿtiÚ_ty³
 < 
CRM_VN_FIRST_NOTIFICATION_TYPE
) ||

885 (
nÙifiÿtiÚ_ty³
 > 
CRM_VN_LAST_NOTIFICATION_TYPE
))

887 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "šv®id vÀnÙifiÿtiÚy³:%d", 
nÙifiÿtiÚ_ty³
);

888  
CRM_FAILURE
;

891 if(
vn_nÙif›r_â
 =ğ
NULL
)

893 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "callback function is NULL");

894  
CRM_FAILURE
;

897 
	`CNTLR_RCU_READ_LOCK_TAKE
();

898 
	`OF_LIST_SCAN
(
üm_vn_nÙifiÿtiÚs
[
nÙifiÿtiÚ_ty³
],
­p_’Œy_p
,
üm_nÙifiÿtiÚ_­p_hook_šfo
 *,
l¡off£t
 )

900 if(
­p_’Œy_p
->
ÿÎ_back
 !ğ
vn_nÙif›r_â
)

902 
´ev_­p_’Œy_p
 = 
­p_’Œy_p
;

905 
	`OF_REMOVE_NODE_FROM_LIST
(
üm_vn_nÙifiÿtiÚs
[
nÙifiÿtiÚ_ty³
],
­p_’Œy_p
,
´ev_­p_’Œy_p
,
l¡off£t
 );

906 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

907  
CRM_SUCCESS
;

909 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

910  
CRM_FAILURE
;

911 
	}
}

913 
št32_t
 
	$üm_d–_vœtu®_ÃtwÜk
 (* 
nw_Çme_p
)

915 
št32_t
 
»t_v®
;

916 
št32_t
 
vn_node_found
=0;

917 
ušt32_t
 
off£t
, 
hashkey
,
magic
,
šdex
;

918 
ušt8_t
 
¡©us_b
;

920 
üm_vœtu®_ÃtwÜk
 *
üm_vn_node_sÿn_p
=
NULL
;

922 if(
nw_Çme_p
 =ğ
NULL
)

923  
CRM_ERROR_VM_NAME_NULL
;

925 if(
üm_vn_bË_g
 =ğ
NULL
)

926  
CRM_FAILURE
;

928 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "nw_Çm%s",
nw_Çme_p
);

930 
	`CNTLR_RCU_READ_LOCK_TAKE
();

935 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
nw_Çme_p
, 
üm_no_of_vn_buck‘s_g
);

936 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "hashkey:%d\r\n",
hashkey
);

938 
off£t
 = 
VNNODE_VNTBL_OFFSET
;

941 
	`MCHASH_BUCKET_SCAN
(
üm_vn_bË_g
, 
hashkey
, 
üm_vn_node_sÿn_p
, 
üm_vœtu®_ÃtwÜk
*, 
off£t
)

943 if(!
	`¡rcmp
(
nw_Çme_p
, 
üm_vn_node_sÿn_p
->
nw_Çme
))

945 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "virtual‚etwork foundo delete");

946 
vn_node_found
 = 1;

951 if(
vn_node_found
 == 0)

953 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "virtual‚etwork‚ot foundo delete");

954 
»t_v®
ğ
CRM_ERROR_VN_NAME_INVALID
;

958 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "nØoàcompu‹_nodes:%d ,‚Øoà©Œibu‹s:%d,nØoàvms:%d,nØoàsubÃts:%d",
üm_vn_node_sÿn_p
->
no_of_compu‹_nodes
,üm_vn_node_sÿn_p->
numb”_of_©Œibu‹s
,üm_vn_node_sÿn_p->
no_of_vms
,üm_vn_node_sÿn_p->
no_of_subÃts
);

960 if((
üm_vn_node_sÿn_p
->
no_of_compu‹_nodes
)||

961 (
üm_vn_node_sÿn_p
->
numb”_of_©Œibu‹s
)||

962 (
üm_vn_node_sÿn_p
->
no_of_subÃts
)||

963 (
üm_vn_node_sÿn_p
->
no_of_vms
)

966 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, " virtual‚etwork has‡ttached . first delete it.");

967 
»t_v®
ğ
CRM_ERROR_RESOURCE_NOTEMPTY
;

971 if(
	`üm_d–_vn_äom_‹ÇÁ
(
üm_vn_node_sÿn_p
->
§ã»f_‹ÇÁ
, crm_vn_node_sÿn_p->
nw_Çme
è!ğ
CRM_SUCCESS
)

973 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "del vn fromenant failed!.");

974 
»t_v®
 = 
CRM_FAILURE
;

978 
¡©us_b
 = 
FALSE
;

979 
off£t
 = 
VNNODE_VNTBL_OFFSET
;

980 
magic
 = (
üm_vn_node_sÿn_p
->magic);

981 
šdex
 = (
üm_vn_node_sÿn_p
->index);

982 
	`MCHASH_DELETE_NODE_BY_REF
(
üm_vn_bË_g
,
šdex
,
magic
,
üm_vœtu®_ÃtwÜk
*, 
off£t
, 
¡©us_b
);

983 if(
¡©us_b
 =ğ
TRUE
)

984 
»t_v®
 = 
CRM_SUCCESS
;

986 
»t_v®
 = 
CRM_FAILURE
;

988 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

989  
»t_v®
;

990 
	}
}

992 
št32_t
 
	$üm_g‘_vn_by_Çme
(* 
nw_Çme
,

993 
üm_vn_cÚfig_šfo
* 
cÚfig_šfo_p
,

994 
vn_ruÁime_šfo
* 
ruÁime_šfo
)

996 
št32_t
 
»t_v®
=
CRM_FAILURE
;

997 
ušt8_t
 
vn_node_found
=0;

998 
ušt32_t
 
hashkey
, 
off£t
;

999 
üm_vœtu®_ÃtwÜk
 *
üm_vn_node_sÿn_p
=
NULL
;

1001 if(
üm_vn_bË_g
 =ğ
NULL
)

1002  
CRM_FAILURE
;

1004 if(
nw_Çme
 =ğ
NULL
)

1005  
CRM_ERROR_VM_NAME_NULL
;

1007 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "%s:%d‚w_Çm%s\r\n",
__FUNCTION__
, 
__LINE__
,
nw_Çme
);

1008 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1011 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
nw_Çme
, 
üm_no_of_vn_buck‘s_g
);

1012 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "hashkey:%d\r\n",
hashkey
);

1014 
off£t
 = 
VNNODE_VNTBL_OFFSET
;

1017 
	`MCHASH_BUCKET_SCAN
(
üm_vn_bË_g
, 
hashkey
, 
üm_vn_node_sÿn_p
, 
üm_vœtu®_ÃtwÜk
*, 
off£t
)

1019 if(!
	`¡rcmp
(
nw_Çme
, 
üm_vn_node_sÿn_p
->nw_name))

1021 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "%s:%d vœtu®‚‘wÜk found\r\n",
__FUNCTION__
, 
__LINE__
);

1022 
vn_node_found
 = 1;

1027 if(
vn_node_found
 == 1)

1029 
	`¡rıy
(
cÚfig_šfo_p
->
nw_Çme
, 
üm_vn_node_sÿn_p
->nw_name);

1030 
	`¡rıy
(
cÚfig_šfo_p
->
‹ÇÁ_Çme
, 
üm_vn_node_sÿn_p
->tenant_name);

1031 
cÚfig_šfo_p
->
nw_ty³
 = 
üm_vn_node_sÿn_p
->nw_type;

1033 if(
üm_vn_node_sÿn_p
->
nw_ty³
 =ğ
VLAN_TYPE
)

1035 
cÚfig_šfo_p
->
nw_·¿ms
.
vÏn_nw
.
vÏn_id
 = 
üm_vn_node_sÿn_p
->nw_params.vlan_nw.vlan_id;

1037 if(
üm_vn_node_sÿn_p
->
nw_ty³
 =ğ
VXLAN_TYPE
)

1039 
cÚfig_šfo_p
->
nw_·¿ms
.
vxÏn_nw
.
nid
 = 
üm_vn_node_sÿn_p
->nw_params.vxlan_nw.nid;

1040 
cÚfig_šfo_p
->
nw_·¿ms
.
vxÏn_nw
.
£rviû_pÜt
 = 
üm_vn_node_sÿn_p
->nw_params.vxlan_nw.service_port;

1042 
	`¡ºıy
(
cÚfig_šfo_p
->
nw_desc
, 
üm_vn_node_sÿn_p
->nw_desc, 
CRM_MAX_VN_DESC_LEN
);

1045 
cÚfig_šfo_p
->
vn_İ”©iÚ®_¡©us_b
 = 
üm_vn_node_sÿn_p
->vn_operational_status_b;

1046 
	`¡ºıy
(
cÚfig_šfo_p
->
´ovid”_physiÿl_ÃtwÜk
, 
üm_vn_node_sÿn_p
->´ovid”_physiÿl_ÃtwÜk,
CRM_MAX_VN_PROVIDER_PHY_NW
);

1047 
cÚfig_šfo_p
->
vn_admš_¡©e_up_b
 = 
üm_vn_node_sÿn_p
->vn_admin_state_up_b;

1048 
cÚfig_šfo_p
->
rou‹r_ex‹º®_b
 = 
üm_vn_node_sÿn_p
->router_external_b;

1049 
»t_v®
 = 
CRM_SUCCESS
;

1053 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "%s:%d vœtu®‚‘wÜk‚Ù found\r\n",
__FUNCTION__
, 
__LINE__
);

1054 
»t_v®
 = 
CRM_ERROR_VN_NAME_INVALID
;

1056 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1057  
»t_v®
;

1058 
	}
}

1060 
št32_t
 
	$üm_g‘_fœ¡_vœtu®_ÃtwÜk
 (
üm_vn_cÚfig_šfo
* 
cÚfig_šfo_p
,

1061 
vn_ruÁime_šfo
* vn_runtime_info,

1062 
ušt64_t
* 
vn_hªdË_p
)

1064 
üm_vœtu®_ÃtwÜk
 *
üm_vn_node_sÿn_p
=
NULL
;

1065 
ušt32_t
 
hashkey
;

1067 
ušt32_t
 
off£t
;

1068 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "%s:%d \r\n",
__FUNCTION__
, 
__LINE__
);

1070 if(
üm_vn_bË_g
 =ğ
NULL
)

1071  
CRM_FAILURE
;

1073 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1075 
	`MCHASH_TABLE_SCAN
(
üm_vn_bË_g
, 
hashkey
)

1077 
off£t
 = 
VNNODE_VNTBL_OFFSET
;

1078 
	`MCHASH_BUCKET_SCAN
(
üm_vn_bË_g
, 
hashkey
, 
üm_vn_node_sÿn_p
, 
üm_vœtu®_ÃtwÜk
 *, 
off£t
)

1080 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "copying vn config\r\n");

1081 
	`¡ºıy
(
cÚfig_šfo_p
->
nw_Çme
, 
üm_vn_node_sÿn_p
->nw_Çme,
CRM_MAX_VN_NAME_LEN
);

1082 
	`¡ºıy
(
cÚfig_šfo_p
->
‹ÇÁ_Çme
, 
üm_vn_node_sÿn_p
->‹ÇÁ_Çme,
CRM_MAX_TENANT_NAME_LEN
);

1084 
cÚfig_šfo_p
->
nw_ty³
 = 
üm_vn_node_sÿn_p
->nw_type;

1086 if(
üm_vn_node_sÿn_p
->
nw_ty³
 =ğ
VLAN_TYPE
)

1088 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "vlanype\r\n");

1089 
cÚfig_šfo_p
->
nw_·¿ms
.
vÏn_nw
.
vÏn_id
 = 
üm_vn_node_sÿn_p
->nw_params.vlan_nw.vlan_id;

1091 if(
üm_vn_node_sÿn_p
->
nw_ty³
 =ğ
VXLAN_TYPE
)

1093 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "vxlanype\r\n");

1094 
cÚfig_šfo_p
->
nw_·¿ms
.
vxÏn_nw
.
nid
 = 
üm_vn_node_sÿn_p
->nw_params.vxlan_nw.nid;

1095 
cÚfig_šfo_p
->
nw_·¿ms
.
vxÏn_nw
.
£rviû_pÜt
 = 
üm_vn_node_sÿn_p
->nw_params.vxlan_nw.service_port;

1097 
	`¡ºıy
(
cÚfig_šfo_p
->
nw_desc
, 
üm_vn_node_sÿn_p
->nw_desc, 
CRM_MAX_VN_DESC_LEN
);

1098 
cÚfig_šfo_p
->
vn_İ”©iÚ®_¡©us_b
 = 
üm_vn_node_sÿn_p
->vn_operational_status_b;

1099 
	`¡ºıy
(
cÚfig_šfo_p
->
´ovid”_physiÿl_ÃtwÜk
, 
üm_vn_node_sÿn_p
->provider_physical_network,

1100 
CRM_MAX_VN_PROVIDER_PHY_NW
);

1101 
cÚfig_šfo_p
->
vn_admš_¡©e_up_b
 = 
üm_vn_node_sÿn_p
->vn_admin_state_up_b;

1102 
cÚfig_šfo_p
->
rou‹r_ex‹º®_b
 = 
üm_vn_node_sÿn_p
->router_external_b;

1106 *
vn_hªdË_p
 = 
üm_vn_node_sÿn_p
->
magic
;

1107 *
vn_hªdË_p
 = ((*vn_hªdË_°<<32è| (
üm_vn_node_sÿn_p
->
šdex
));

1109 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1110  
CRM_SUCCESS
;

1113 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1114  
CRM_ERROR_NO_MORE_ENTRIES
;

1115 
	}
}

1117 
št32_t
 
	$üm_g‘_Ãxt_vœtu®_ÃtwÜk
(
üm_vn_cÚfig_šfo
* 
cÚfig_šfo_p
,

1118 
vn_ruÁime_šfo
* vn_runtime_info,

1119 
ušt64_t
* 
vn_hªdË_p
)

1121 
üm_vœtu®_ÃtwÜk
 *
üm_vn_node_sÿn_p
=
NULL
;

1122 
ušt32_t
 
hashkey
;

1123 
ušt8_t
 
cu¼’t_’Œy_found_b
;

1124 
ušt32_t
 
off£t
 = 
VNNODE_VNTBL_OFFSET
;

1126 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "%s(%d)\r\n",
__FUNCTION__
,
__LINE__
);

1128 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1129 
cu¼’t_’Œy_found_b
 = 
FALSE
;

1131 
	`MCHASH_TABLE_SCAN
(
üm_vn_bË_g
, 
hashkey
)

1133 
off£t
 = 
VNNODE_VNTBL_OFFSET
;

1134 
	`MCHASH_BUCKET_SCAN
(
üm_vn_bË_g
, 
hashkey
, 
üm_vn_node_sÿn_p
, 
üm_vœtu®_ÃtwÜk
 *,
off£t
)

1136 if(
cu¼’t_’Œy_found_b
 =ğ
FALSE
)

1138 if(*
vn_hªdË_p
 !ğ(
üm_vn_node_sÿn_p
->
vn_hªdË
))

1142 
cu¼’t_’Œy_found_b
 = 
TRUE
;

1146 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "%s:%d cİyšg vÀcÚfig\r\n",
__FUNCTION__
, 
__LINE__
);

1147 
	`¡ºıy
(
cÚfig_šfo_p
->
nw_Çme
, 
üm_vn_node_sÿn_p
->nw_Çme,
CRM_MAX_VN_NAME_LEN
);

1148 
	`¡ºıy
(
cÚfig_šfo_p
->
‹ÇÁ_Çme
, 
üm_vn_node_sÿn_p
->‹ÇÁ_Çme,
CRM_MAX_TENANT_NAME_LEN
);

1150 
cÚfig_šfo_p
->
nw_ty³
 = 
üm_vn_node_sÿn_p
->nw_type;

1152 if(
üm_vn_node_sÿn_p
->
nw_ty³
 =ğ
VLAN_TYPE
)

1154 
cÚfig_šfo_p
->
nw_·¿ms
.
vÏn_nw
.
vÏn_id
 = 
üm_vn_node_sÿn_p
->nw_params.vlan_nw.vlan_id;

1156 if(
üm_vn_node_sÿn_p
->
nw_ty³
 =ğ
VXLAN_TYPE
)

1158 
cÚfig_šfo_p
->
nw_·¿ms
.
vxÏn_nw
.
nid
 = 
üm_vn_node_sÿn_p
->nw_params.vxlan_nw.nid;

1159 
cÚfig_šfo_p
->
nw_·¿ms
.
vxÏn_nw
.
£rviû_pÜt
 = 
üm_vn_node_sÿn_p
->nw_params.vxlan_nw.service_port;

1161 
	`¡ºıy
(
cÚfig_šfo_p
->
nw_desc
, 
üm_vn_node_sÿn_p
->nw_desc, 
CRM_MAX_VN_DESC_LEN
);

1162 
cÚfig_šfo_p
->
vn_İ”©iÚ®_¡©us_b
 = 
üm_vn_node_sÿn_p
->vn_operational_status_b;

1163 
	`¡ºıy
(
cÚfig_šfo_p
->
´ovid”_physiÿl_ÃtwÜk
, 
üm_vn_node_sÿn_p
->provider_physical_network,

1164 
CRM_MAX_VN_PROVIDER_PHY_NW
);

1165 
cÚfig_šfo_p
->
vn_admš_¡©e_up_b
 = 
üm_vn_node_sÿn_p
->vn_admin_state_up_b;

1166 
cÚfig_šfo_p
->
rou‹r_ex‹º®_b
 = 
üm_vn_node_sÿn_p
->router_external_b;

1170 *
vn_hªdË_p
 = 
üm_vn_node_sÿn_p
->
magic
;

1171 *
vn_hªdË_p
 = ((*vn_hªdË_°<<32è| (
üm_vn_node_sÿn_p
->
šdex
));

1172 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1173  
CRM_SUCCESS
;

1176 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1177 if(
cu¼’t_’Œy_found_b
 =ğ
TRUE
)

1178  
CRM_ERROR_NO_MORE_ENTRIES
;

1180  
CRM_ERROR_INVALID_VM_HANDLE
;

1181 
	}
}

1189 
št32_t
 
	$üm_add_üm_compu‹_node_to_vn
(*
vn_Çme_p
,

1190 *
sw™ch_Çme_p
,

1191 *
bridge_Çme_p
)

1193 
št32_t
 
»t_v®
=
CRM_SUCCESS
,
šdex
,
üm_compu‹_node_found
=0;

1194 
ušt64_t
 
vn_hªdË
, 
sw™ch_hªdË
,
logiÿl_sw™ch_hªdË
;

1195 
ušt8_t
 
h—p_b
;

1196 
üm_vœtu®_ÃtwÜk
 *
üm_vn_šfo_p
=
NULL
;

1197 
üm_compu‹_node
 *
üm_compu‹_node_’Œy_p
 = 
NULL
;

1198 
ušt32_t
 
š£¹_šdex
=0;

1200 if(
üm_vn_bË_g
 =ğ
NULL
)

1202 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "no hashableo‡dd„ecords\r\n");

1203  
CRM_FAILURE
;

1207 if((
vn_Çme_p
 =ğ
NULL
è|| (
	`¡¾’
(vn_Çme_p)>=
CRM_MAX_VN_NAME_LEN
))

1209 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "virtual‚etwork‚ame is invalid");

1210  
CRM_ERROR_VN_NAME_INVALID
;

1214 
»t_v®
 = 
	`üm_g‘_vn_hªdË
(
vn_Çme_p
, &
vn_hªdË
);

1215 if(
»t_v®
 !ğ
CRM_SUCCESS
)

1217 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm_get_vn_handle failed!.");

1218  
CRM_ERROR_VN_NAME_INVALID
;

1221 
»t_v®
 = 
	`üm_g‘_vn_byhªdË
(
vn_hªdË
, &
üm_vn_šfo_p
);

1222 if(
»t_v®
 !ğ
CRM_SUCCESS
)

1224 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm_get_vn_byhandle failed!.");

1225  
CRM_ERROR_INVALID_VN_HANDLE
;

1229 if((
sw™ch_Çme_p
 =ğ
NULL
)||

1230 (
	`¡¾’
(
sw™ch_Çme_p
)>ğ
DPRM_MAX_SWITCH_NAME_LEN
)

1233 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "switch‚ame is invalid");

1234  
CRM_ERROR_INVALID_NAME
;

1238 
»t_v®
 = 
	`d´m_g‘_sw™ch_hªdË
(
sw™ch_Çme_p
, &
sw™ch_hªdË
);

1239 if(
»t_v®
 !ğ
CRM_SUCCESS
)

1241 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "switch‚ame is invalid");

1242  
CRM_ERROR_INVALID_NAME
;

1246 if((
bridge_Çme_p
 =ğ
NULL
)||

1247 (
	`¡¾’
(
bridge_Çme_p
)>ğ
CRM_LOGICAL_SWITCH_NAME_LEN
))

1249 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "birdige‚ame‡re invalid");

1250  
CRM_FAILURE
;

1252 
»t_v®
 = 
	`d´m_g‘_logiÿl_sw™ch_hªdË
(
sw™ch_hªdË
,
bridge_Çme_p
,&
logiÿl_sw™ch_hªdË
);

1253 if(
»t_v®
!=
CRM_SUCCESS
)

1255 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "g‘†ogiÿÈsw™ch hªdË faed fÜ†ogiÿÈsw™ch‚ame:%s!",
bridge_Çme_p
);

1256  
CRM_FAILURE
;

1259 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1262 
	`OF_LIST_SCAN
((
üm_vn_šfo_p
->
üm_compu‹_nodes
),

1263 
üm_compu‹_node_’Œy_p
,

1264 
üm_compu‹_node
 *,

1265 
CRM_VN_COMPUTE_NODE_ENTRY_LISTNODE_OFFSET
)

1268 if(!
	`¡rcmp
(
üm_compu‹_node_’Œy_p
->
sw™ch_Çme
, 
sw™ch_Çme_p
))

1270 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "compu‹‚odfound .‚Øoàbridges:%d",
üm_compu‹_node_’Œy_p
->
no_of_bridges
);

1271 
üm_compu‹_node_found
 = 1;

1273 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "1");

1274 if((
üm_compu‹_node_’Œy_p
->
no_of_bridges
è=ğ
CRM_MAX_DPS_IN_A_COMPUTE_NODE
)

1276 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "max‚o of bridges…er computenode„eached.");

1277 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1278  
CRM_FAILURE
;

1280 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "2");

1282 
šdex
=0; index<(
üm_compu‹_node_’Œy_p
->
no_of_bridges
); index++)

1285 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "logiÿl_sw™ch_Çme:%s",(
üm_compu‹_node_’Œy_p
->
dp_»ã»nûs
[
šdex
]).
logiÿl_sw™ch_Çme
);

1286 if(!
	`¡rcmp
((
üm_compu‹_node_’Œy_p
->
dp_»ã»nûs
[
šdex
]).
logiÿl_sw™ch_Çme
, 
bridge_Çme_p
))

1288 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "du¶iÿ‹ bridg% found.",
bridge_Çme_p
);

1289 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1290  
CRM_SUCCESS
;

1294 
š£¹_šdex
 = 
üm_compu‹_node_’Œy_p
->
no_of_bridges
;

1298 if(!
üm_compu‹_node_found
)

1300 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "creating‚ew crm computenode");

1302 
»t_v®
 = 
	`mempoŞ_g‘_mem_block
(
üm_vn_compu‹_nodes_mempoŞ_g
,

1303 (
uch¬8_t
**)&
üm_compu‹_node_’Œy_p
,

1304 &
h—p_b
);

1305 if(
»t_v®
 !ğ
MEMPOOL_SUCCESS
)

1307 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "memory block‡llocation failed for crm compute‚ode.");

1308 
»t_v®
 = 
CRM_FAILURE
;

1311 
üm_compu‹_node_’Œy_p
->
h—p_b
 = heap_b;

1314 
	`¡rıy
(
üm_compu‹_node_’Œy_p
->
vn_Çme
, 
vn_Çme_p
);

1315 
üm_compu‹_node_’Œy_p
->
§ã»f_vn
 = 
vn_hªdË
;

1318 
	`¡rıy
(
üm_compu‹_node_’Œy_p
->
sw™ch_Çme
, 
sw™ch_Çme_p
);

1319 
üm_compu‹_node_’Œy_p
->
§ã»f_sw™ch
 = 
sw™ch_hªdË
;

1322 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "š£¹_šdex:%d",
š£¹_šdex
);

1323 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "bridge_Çme_p:%s",
bridge_Çme_p
);

1324 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "vn_Çme_p:%s",
vn_Çme_p
);

1325 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "sw™ch_Çme_p:%s",
sw™ch_Çme_p
);

1327 
	`¡rıy
(((
üm_compu‹_node_’Œy_p
->
dp_»ã»nûs
[
š£¹_šdex
]).
logiÿl_sw™ch_Çme
),
bridge_Çme_p
);

1329 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "üm_compu‹_node_’Œy_p->dp_»ã»nûs[š£¹_šdex]).logiÿl_sw™ch_Çme:%s",(
üm_compu‹_node_’Œy_p
->
dp_»ã»nûs
[
š£¹_šdex
]).
logiÿl_sw™ch_Çme
);

1330 (
üm_compu‹_node_’Œy_p
->
dp_»ã»nûs
[
š£¹_šdex
]).
§ã»f_logiÿl_sw™ch
 = 
logiÿl_sw™ch_hªdË
;

1332 
	`OF_LIST_INIT
((
üm_compu‹_node_’Œy_p
->
dp_»ã»nûs
[
š£¹_šdex
]).
vmside_pÜts
, 
üm_vn_logiÿl_sw™ch_pÜts_ä“_’Œy_rcu
);

1334 
	`OF_LIST_INIT
((
üm_compu‹_node_’Œy_p
->
dp_»ã»nûs
[
š£¹_šdex
]).
nwside_uniÿ¡_pÜts
, 
üm_vn_logiÿl_sw™ch_pÜts_ä“_’Œy_rcu
);

1336 
	`OF_LIST_INIT
((
üm_compu‹_node_’Œy_p
->
dp_»ã»nûs
[
š£¹_šdex
]).
nwside_brßdÿ¡_pÜts
, 
üm_vn_logiÿl_sw™ch_pÜts_ä“_’Œy_rcu
);

1338 
	`OF_LIST_INIT
((
üm_compu‹_node_’Œy_p
->
dp_»ã»nûs
[
š£¹_šdex
]).
vmns_pÜts
, 
üm_vn_logiÿl_sw™ch_pÜts_ä“_’Œy_rcu
);

1340 
üm_compu‹_node_’Œy_p
->
no_of_bridges
++;

1342 if(!
üm_compu‹_node_found
)

1344 
	`OF_APPEND_NODE_TO_LIST
((
üm_vn_šfo_p
->
üm_compu‹_nodes
),

1345 
üm_compu‹_node_’Œy_p
,

1346 
CRM_VN_COMPUTE_NODE_ENTRY_LISTNODE_OFFSET
);

1347 
üm_vn_šfo_p
->
no_of_compu‹_nodes
++;

1350 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1351  
»t_v®
;

1352 
	}
}

1354 
št32_t
 
	$üm_d–_üm_compu‹_node_äom_vn
(* 
vn_Çme_p
, * 
sw_Çme_p
)

1356 
št32_t
 
»t_v®
=
CRM_SUCCESS
,
l¡off£t
;

1357 
ušt64_t
 
vn_hªdË
;

1358 
üm_vœtu®_ÃtwÜk
 *
üm_vn_šfo_p
=
NULL
;

1359 
üm_compu‹_node
 *
üm_compu‹_node_sÿn_’Œy_p
 = 
NULL
;

1360 
üm_compu‹_node
 *
üm_compu‹_node_´ev_node_p
 = 
NULL
;

1361 
ušt32_t
 
compu‹_node_found
 =0,
ii
;

1363 if((
vn_Çme_p
 =ğ
NULL
)||

1364 (
sw_Çme_p
 =ğ
NULL
)

1367 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "vn or switch‚ame invalid ");

1368  
CRM_FAILURE
;

1371 if(
üm_vn_bË_g
 =ğ
NULL
)

1373 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "no hashableo‡dd„ecords\r\n");

1374  
CRM_FAILURE
;

1378 
»t_v®
 = 
	`üm_g‘_vn_hªdË
(
vn_Çme_p
, &
vn_hªdË
);

1379 if(
»t_v®
 !ğ
CRM_SUCCESS
)

1381 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm_get_vn_handle failed!.");

1382  
CRM_ERROR_VN_NAME_INVALID
;

1385 
»t_v®
 = 
	`üm_g‘_vn_byhªdË
(
vn_hªdË
, &
üm_vn_šfo_p
);

1386 if(
»t_v®
 !ğ
CRM_SUCCESS
)

1388 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm_get_vn_byhandle failed!.");

1389  
CRM_ERROR_INVALID_VN_HANDLE
;

1392 
l¡off£t
 = 
CRM_VN_COMPUTE_NODE_ENTRY_LISTNODE_OFFSET
;

1393 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1397 
	`OF_LIST_SCAN
((
üm_vn_šfo_p
->
üm_compu‹_nodes
),

1398 
üm_compu‹_node_sÿn_’Œy_p
,

1399 
üm_compu‹_node
 *,

1400 
l¡off£t
)

1402 if(!
	`¡rcmp
(
üm_compu‹_node_sÿn_’Œy_p
->
sw™ch_Çme
, 
sw_Çme_p
))

1404 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "compute‚ode foundo delete");

1405 
compu‹_node_found
=1;

1408 
üm_compu‹_node_´ev_node_p
 = 
üm_compu‹_node_sÿn_’Œy_p
;

1410 if(
compu‹_node_found
 == 0)

1412 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "compute‚ode‚ot foundo delete");

1413 
»t_v®
=
CRM_FAILURE
;

1417 
ii
=0;ii<(
üm_compu‹_node_sÿn_’Œy_p
->
no_of_bridges
);ii++)

1419 if((
üm_compu‹_node_sÿn_’Œy_p
->
dp_»ã»nûs
[
ii
].
no_of_pÜts
) >0)

1421 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "ports‡ttachedo bridge. we cannot delete compute‚ode. detach…orts from brdige first");

1423 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1424  
CRM_ERROR_RESOURCE_NOTEMPTY
;

1428 
	`OF_REMOVE_NODE_FROM_LIST
((
üm_vn_šfo_p
->
üm_compu‹_nodes
),

1429 
üm_compu‹_node_sÿn_’Œy_p
,

1430 
üm_compu‹_node_´ev_node_p
,

1431 
l¡off£t


1433 
üm_vn_šfo_p
->
no_of_compu‹_nodes
--;

1434 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "compute‚ode deleted success fully fromhe vn");

1437 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1438  
»t_v®
;

1439 
	}
}

1441 
št32_t
 
	$üm_g‘_fœ¡_üm_compu‹_node
(*
vn_Çme_p
, * 
sw™ch_Çme_p
)

1443 
št32_t
 
»t_v®
,
l¡off£t
;

1444 
ušt64_t
 
vn_hªdË
;

1445 
üm_vœtu®_ÃtwÜk
 *
üm_vn_šfo_p
=
NULL
;

1446 
üm_compu‹_node
 *
üm_compu‹_node_sÿn_’Œy_p
 = 
NULL
;

1448 if((
vn_Çme_p
 =ğ
NULL
)||

1449 (
sw™ch_Çme_p
 =ğ
NULL
)

1452 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "vn or switch‚ame invalid ");

1453  
CRM_FAILURE
;

1456 if(
üm_vn_bË_g
 =ğ
NULL
)

1458 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "no hashableo‡dd„ecords\r\n");

1459  
CRM_FAILURE
;

1463 
»t_v®
 = 
	`üm_g‘_vn_hªdË
(
vn_Çme_p
, &
vn_hªdË
);

1464 if(
»t_v®
 !ğ
CRM_SUCCESS
)

1466 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm_get_vn_handle failed!.");

1467  
CRM_ERROR_VN_NAME_INVALID
;

1470 
»t_v®
 = 
	`üm_g‘_vn_byhªdË
(
vn_hªdË
, &
üm_vn_šfo_p
);

1471 if(
»t_v®
 !ğ
CRM_SUCCESS
)

1473 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm_get_vn_byhandle failed!.");

1474  
CRM_ERROR_INVALID_VN_HANDLE
;

1477 if(
üm_vn_šfo_p
->
no_of_compu‹_nodes
 == 0)

1479  
CRM_ERROR_NO_MORE_ENTRIES
;

1482 
»t_v®
 = 
CRM_ERROR_NO_MORE_ENTRIES
;

1483 
l¡off£t
 = 
CRM_VN_COMPUTE_NODE_ENTRY_LISTNODE_OFFSET
;

1484 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1487 
	`OF_LIST_SCAN
((
üm_vn_šfo_p
->
üm_compu‹_nodes
),

1488 
üm_compu‹_node_sÿn_’Œy_p
,

1489 
üm_compu‹_node
 *,

1490 
l¡off£t
)

1494 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "sw™ch_Çme:%s",
üm_compu‹_node_sÿn_’Œy_p
->
sw™ch_Çme
);

1495 
	`¡rıy
(
sw™ch_Çme_p
, 
üm_compu‹_node_sÿn_’Œy_p
->
sw™ch_Çme
);

1496 
»t_v®
=
CRM_SUCCESS
;

1498 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1499  
»t_v®
;

1500 
	}
}

1502 
št32_t
 
	$üm_g‘_Ãxt_üm_compu‹_node
 (*
vn_Çme_p
, * 
sw™ch_Çme_p
)

1504 
št32_t
 
»t_v®
,
l¡off£t
;

1505 
ušt64_t
 
vn_hªdË
;

1506 
üm_vœtu®_ÃtwÜk
 *
üm_vn_šfo_p
=
NULL
;

1507 
üm_compu‹_node
 *
üm_compu‹_node_sÿn_’Œy_p
 = 
NULL
;

1508 
ušt32_t
 
cu¼’t_’Œy_found_b
=0;

1510 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "sw™ch_Çme:%s",
sw™ch_Çme_p
);

1511 if((
vn_Çme_p
 =ğ
NULL
)||

1512 (
sw™ch_Çme_p
 =ğ
NULL
)

1515 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "vn or switch‚ame invalid ");

1516  
CRM_FAILURE
;

1519 if(
üm_vn_bË_g
 =ğ
NULL
)

1521 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "no hashableo‡dd„ecords\r\n");

1522  
CRM_FAILURE
;

1526 
»t_v®
 = 
	`üm_g‘_vn_hªdË
(
vn_Çme_p
, &
vn_hªdË
);

1527 if(
»t_v®
 !ğ
CRM_SUCCESS
)

1529 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm_get_vn_handle failed!.");

1530  
CRM_ERROR_VN_NAME_INVALID
;

1533 
»t_v®
 = 
	`üm_g‘_vn_byhªdË
(
vn_hªdË
, &
üm_vn_šfo_p
);

1534 if(
»t_v®
 !ğ
CRM_SUCCESS
)

1536 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm_get_vn_byhandle failed!.");

1537  
CRM_ERROR_INVALID_VN_HANDLE
;

1539 if(
üm_vn_šfo_p
->
no_of_compu‹_nodes
 == 0)

1541  
CRM_FAILURE
;

1544 
l¡off£t
 = 
CRM_VN_COMPUTE_NODE_ENTRY_LISTNODE_OFFSET
;

1545 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1548 
»t_v®
 = 
CRM_ERROR_NO_MORE_ENTRIES
;

1550 
	`OF_LIST_SCAN
((
üm_vn_šfo_p
->
üm_compu‹_nodes
),

1551 
üm_compu‹_node_sÿn_’Œy_p
,

1552 
üm_compu‹_node
 *,

1553 
l¡off£t
)

1555 if(
cu¼’t_’Œy_found_b
 == 0)

1557 if(!
	`¡rcmp
(
üm_compu‹_node_sÿn_’Œy_p
->
sw™ch_Çme
, 
sw™ch_Çme_p
))

1559 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "switchƒntry found");

1560 
cu¼’t_’Œy_found_b
 = 1;

1568 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "Ãxˆsw™ch_Çme:%s",
üm_compu‹_node_sÿn_’Œy_p
->
sw™ch_Çme
);

1569 
	`¡rıy
(
sw™ch_Çme_p
, 
üm_compu‹_node_sÿn_’Œy_p
->
sw™ch_Çme
);

1570 
»t_v®
=
CRM_SUCCESS
;

1574 if(
cu¼’t_’Œy_found_b
 == 0)

1576 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "switchƒntry‚ot found");

1577 
»t_v®
 = 
CRM_ERROR_INVALID_NAME
;

1580 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1581  
»t_v®
;

1582 
	}
}

1584 
št32_t
 
	$üm_g‘_exaù_üm_compu‹_node_by_Çme
(*
vn_Çme_p
, *
sw™ch_Çme_p
)

1586 
št32_t
 
»t_v®
=
CRM_FAILURE
,
l¡off£t
;

1587 
ušt64_t
 
vn_hªdË
;

1588 
üm_vœtu®_ÃtwÜk
 *
üm_vn_šfo_p
=
NULL
;

1589 
üm_compu‹_node
 *
üm_compu‹_node_sÿn_’Œy_p
 = 
NULL
;

1591 if((
vn_Çme_p
 =ğ
NULL
)|| (
sw™ch_Çme_p
 == NULL)

1594 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "vn or switch‚ame invalid ");

1595  
CRM_FAILURE
;

1599 
»t_v®
 = 
	`üm_g‘_vn_hªdË
(
vn_Çme_p
, &
vn_hªdË
);

1600 if(
»t_v®
 !ğ
CRM_SUCCESS
)

1602 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm_get_vn_handle failed!.");

1603  
CRM_ERROR_VN_NAME_INVALID
;

1606 
»t_v®
 = 
	`üm_g‘_vn_byhªdË
(
vn_hªdË
, &
üm_vn_šfo_p
);

1607 if(
»t_v®
 !ğ
CRM_SUCCESS
)

1609 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm_get_vn_byhandle failed!.");

1610  
CRM_ERROR_INVALID_VN_HANDLE
;

1612 if(
üm_vn_šfo_p
->
no_of_compu‹_nodes
 == 0)

1614  
CRM_FAILURE
;

1617 
l¡off£t
 = 
CRM_VN_COMPUTE_NODE_ENTRY_LISTNODE_OFFSET
;

1618 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1621 
	`OF_LIST_SCAN
((
üm_vn_šfo_p
->
üm_compu‹_nodes
),

1622 
üm_compu‹_node_sÿn_’Œy_p
,

1623 
üm_compu‹_node
 *,

1624 
l¡off£t
)

1626 if(!
	`¡rcmp
(
üm_compu‹_node_sÿn_’Œy_p
->
sw™ch_Çme
, 
sw™ch_Çme_p
))

1628 
»t_v®
=
CRM_SUCCESS
;

1634 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1635  
»t_v®
;

1636 
	}
}

1638 
št32_t
 
	$üm_g‘_fœ¡_üm_logiÿl_sw™ch
(* 
vn_Çme_p
,

1639 * 
sw™ch_Çme_p
,

1640 * 
logiÿl_sw™ch_Çme_p
)

1642 
št32_t
 
»t_v®
=
CRM_SUCCESS
,
l¡off£t
;

1643 
ušt64_t
 
vn_hªdË
;

1644 
üm_vœtu®_ÃtwÜk
 *
üm_vn_šfo_p
=
NULL
;

1645 
üm_compu‹_node
 *
üm_compu‹_node_sÿn_’Œy_p
 = 
NULL
;

1646 
ušt32_t
 
compu‹_node_’Œy_found_b
=
FALSE
;

1648 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "’‹»d(vn_Çme:%s,sw™ch_Çme:%s,logiÿl_sw™ch_Çme:%s)",
vn_Çme_p
,
sw™ch_Çme_p
,
logiÿl_sw™ch_Çme_p
);

1649 if((
vn_Çme_p
 =ğ
NULL
)||

1650 (
sw™ch_Çme_p
 =ğ
NULL
)

1653 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "vn or switch‚ame invalid ");

1654  
CRM_FAILURE
;

1657 if(
üm_vn_bË_g
 =ğ
NULL
)

1659 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "no hashableo‡dd„ecords\r\n");

1660  
CRM_FAILURE
;

1664 
»t_v®
 = 
	`üm_g‘_vn_hªdË
(
vn_Çme_p
, &
vn_hªdË
);

1665 if(
»t_v®
 !ğ
CRM_SUCCESS
)

1667 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm_get_vn_handle failed!.");

1668  
CRM_ERROR_VN_NAME_INVALID
;

1671 
»t_v®
 = 
	`üm_g‘_vn_byhªdË
(
vn_hªdË
, &
üm_vn_šfo_p
);

1672 if(
»t_v®
 !ğ
CRM_SUCCESS
)

1674 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm_get_vn_byhandle failed!.");

1675  
CRM_ERROR_INVALID_VN_HANDLE
;

1677 if(
üm_vn_šfo_p
->
no_of_compu‹_nodes
 == 0)

1679  
CRM_FAILURE
;

1682 
l¡off£t
 = 
CRM_VN_COMPUTE_NODE_ENTRY_LISTNODE_OFFSET
;

1683 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1687 
	`OF_LIST_SCAN
((
üm_vn_šfo_p
->
üm_compu‹_nodes
),

1688 
üm_compu‹_node_sÿn_’Œy_p
,

1689 
üm_compu‹_node
 *,

1690 
l¡off£t
)

1692 if(!
	`¡rcmp
(
üm_compu‹_node_sÿn_’Œy_p
->
sw™ch_Çme
, 
sw™ch_Çme_p
))

1694 
compu‹_node_’Œy_found_b
 = 
TRUE
;

1698 if(
compu‹_node_’Œy_found_b
 =ğ
FALSE
)

1700 
»t_v®
 = 
CRM_ERROR_DUPLICATE_COMPUTE_NODE
;

1705 
	`¡rıy
(
logiÿl_sw™ch_Çme_p
,(
üm_compu‹_node_sÿn_’Œy_p
->
dp_»ã»nûs
[0]).
logiÿl_sw™ch_Çme
);

1706 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "logiÿl_sw™ch_Çme:%s",
logiÿl_sw™ch_Çme_p
);

1707 
»t_v®
=
CRM_SUCCESS
;

1711 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1712  
»t_v®
;

1713 
	}
}

1715 
št32_t
 
	$üm_g‘_Ãxt_üm_logiÿl_sw™ch
(* 
vn_Çme_p
,

1716 * 
sw™ch_Çme_p
,

1717 * 
logiÿl_sw™ch_Çme_p
)

1719 
št32_t
 
»t_v®
=
CRM_SUCCESS
,
l¡off£t
;

1720 
ušt64_t
 
vn_hªdË
;

1721 
üm_vœtu®_ÃtwÜk
 *
üm_vn_šfo_p
=
NULL
;

1722 
üm_compu‹_node
 *
üm_compu‹_node_sÿn_’Œy_p
 = 
NULL
;

1723 
ušt32_t
 
compu‹_node_’Œy_found_b
=
FALSE
,
šdex
;

1724 
ušt32_t
 
bridge_’Œy_found
=
FALSE
;

1726 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "’‹»d(vn_Çme:%s,sw™ch_Çme:%s,logiÿl_sw™ch_Çme:%s)",
vn_Çme_p
,
sw™ch_Çme_p
,
logiÿl_sw™ch_Çme_p
);

1727 if((
vn_Çme_p
 =ğ
NULL
)||(
sw™ch_Çme_p
 == NULL))

1729 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "vn or switch‚ame invalid ");

1730  
CRM_FAILURE
;

1734 
»t_v®
 = 
	`üm_g‘_vn_hªdË
(
vn_Çme_p
, &
vn_hªdË
);

1735 if(
»t_v®
 !ğ
CRM_SUCCESS
)

1737 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm_get_vn_handle failed!.");

1738  
CRM_ERROR_VN_NAME_INVALID
;

1741 
»t_v®
 = 
	`üm_g‘_vn_byhªdË
(
vn_hªdË
, &
üm_vn_šfo_p
);

1742 if(
»t_v®
 !ğ
CRM_SUCCESS
)

1744 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "crm_get_vn_byhandle failed!.");

1745  
CRM_ERROR_INVALID_VN_HANDLE
;

1747 if(
üm_vn_šfo_p
->
no_of_compu‹_nodes
 == 0)

1749  
CRM_FAILURE
;

1752 
l¡off£t
 = 
CRM_VN_COMPUTE_NODE_ENTRY_LISTNODE_OFFSET
;

1753 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1757 
	`OF_LIST_SCAN
((
üm_vn_šfo_p
->
üm_compu‹_nodes
),

1758 
üm_compu‹_node_sÿn_’Œy_p
,

1759 
üm_compu‹_node
 *,

1760 
l¡off£t
)

1762 if(!
	`¡rcmp
(
üm_compu‹_node_sÿn_’Œy_p
->
sw™ch_Çme
, 
sw™ch_Çme_p
))

1764 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "compute‚ode found!");

1765 
compu‹_node_’Œy_found_b
 = 1;

1769 if(
compu‹_node_’Œy_found_b
 == 0)

1771 
»t_v®
 = 
CRM_ERROR_DUPLICATE_COMPUTE_NODE
;

1776 
šdex
=0; index<(
üm_compu‹_node_sÿn_’Œy_p
->
no_of_bridges
); index++)

1778 if(!
	`¡rcmp
(
logiÿl_sw™ch_Çme_p
,(
üm_compu‹_node_sÿn_’Œy_p
->
dp_»ã»nûs
[
šdex
]).
logiÿl_sw™ch_Çme
))

1780 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "brdige found!");

1781 
bridge_’Œy_found
 =
TRUE
;

1785 if((
bridge_’Œy_found
==
TRUE
)&&(
	`¡¾’
((
üm_compu‹_node_sÿn_’Œy_p
->
dp_»ã»nûs
[
šdex
+1]).
logiÿl_sw™ch_Çme
)))

1787 
	`¡rıy
(
logiÿl_sw™ch_Çme_p
, (
üm_compu‹_node_sÿn_’Œy_p
->
dp_»ã»nûs
[
šdex
+1]).
logiÿl_sw™ch_Çme
);

1788 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "Ãxˆlogiÿl_sw™ch_Çme:%s",
logiÿl_sw™ch_Çme_p
);

1789 
»t_v®
=
CRM_SUCCESS
;

1794 
»t_v®
=
CRM_ERROR_NO_MORE_ENTRIES
;

1799 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1800  
»t_v®
;

1801 
	}
}

1805 
št32_t
 
	$üm_add_©Œibu‹_to_vn
(
ušt64_t
 
vn_hªdË
, 
üm_©Œibu‹_Çme_v®ue_·œ
* 
©Œibu‹_šfo_p
)

1807 
št32_t
 
»tv®
;

1808 
üm_vœtu®_ÃtwÜk
 *
vn_’Œy_p
;

1809 
üm_vn_nÙifiÿtiÚ_d©a
 
nÙifiÿtiÚ_d©a
;

1810 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *
­p_’Œy_p
;

1811 
uch¬8_t
 
l¡off£t
;

1812 
l¡off£t
 = 
CRM_NOTIFICATION_APP_HOOK_OFFSET
;

1814 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "entered");

1816 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1818 
»tv®
 = 
	`üm_g‘_vn_byhªdË
(
vn_hªdË
, &
vn_’Œy_p
);

1819 if(
»tv®
 !ğ
CRM_SUCCESS
)

1821 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1822  
»tv®
;

1825 
»tv®
 = 
	`üm_add_©Œibu‹
(&(
vn_’Œy_p
->
©Œibu‹s
),
©Œibu‹_šfo_p
);

1826 if(
»tv®
 !ğ
CRM_SUCCESS
)

1828 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1829  
»tv®
;

1832 
vn_’Œy_p
->
numb”_of_©Œibu‹s
++;

1833 
	`üm_ü—‹_vn_v›w_’Œy
(
vn_hªdË
, 
©Œibu‹_šfo_p
->
Çme_¡ršg
,‡‰ribu‹_šfo_p->
v®ue_¡ršg
);

1836 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
vn_Çme
, 
vn_’Œy_p
->
nw_Çme
);

1837 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
©Œibu‹_Çme
,
©Œibu‹_šfo_p
->
Çme_¡ršg
);

1838 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
©Œibu‹_v®ue
,
©Œibu‹_šfo_p
->
v®ue_¡ršg
);

1839 
	`OF_LIST_SCAN
(
üm_vn_nÙifiÿtiÚs
[
CRM_VN_ATTRIBUTE_ADDED
],
­p_’Œy_p
,
üm_nÙifiÿtiÚ_­p_hook_šfo
*,
l¡off£t
 )

1841 ((
üm_vn_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_VN_ATTRIBUTE_ADDED
,

1842 
vn_hªdË
,

1843 
nÙifiÿtiÚ_d©a
,

1844 
­p_’Œy_p
->
cbk_¬g1
,

1845 
­p_’Œy_p
->
cbk_¬g2
);

1848 
	`OF_LIST_SCAN
(
üm_vn_nÙifiÿtiÚs
[
CRM_VN_ALL_NOTIFICATIONS
],
­p_’Œy_p
,
üm_nÙifiÿtiÚ_­p_hook_šfo
*,
l¡off£t
 )

1850 ((
üm_vn_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_VN_ATTRIBUTE_ADDED
,

1851 
vn_hªdË
,

1852 
nÙifiÿtiÚ_d©a
,

1853 
­p_’Œy_p
->
cbk_¬g1
,

1854 
­p_’Œy_p
->
cbk_¬g2
);

1856 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1857  
CRM_SUCCESS
;

1858 
	}
}

1860 
št32_t
 
	$üm_d–‘e_©Œibu‹_äom_vn
(
ušt64_t
 
vn_hªdË
, 
üm_©Œibu‹_Çme_v®ue_·œ
 *
©Œibu‹_šfo_p
)

1862 
št32_t
 
»tv®
;

1863 
üm_vœtu®_ÃtwÜk
 *
vn_’Œy_p
;

1864 
üm_»sourû_©Œibu‹_’Œy
 *
©Œibu‹_’Œy_p
,*
´ev_­p_’Œy_p
 = 
NULL
;

1866 
üm_vn_nÙifiÿtiÚ_d©a
 
nÙifiÿtiÚ_d©a
;

1867 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *
­p_’Œy_p
;

1868 
uch¬8_t
 
l¡©ŒÇmeoff£t
;

1869 
l¡©ŒÇmeoff£t
 = 
CRM_RESOURCE_ATTRIBUTE_ENTRY_LISTNODE_OFFSET
;

1871 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
, "entered");

1873 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1875 
»tv®
 = 
	`üm_g‘_vn_byhªdË
(
vn_hªdË
, &
vn_’Œy_p
);

1876 if(
»tv®
 !ğ
CRM_SUCCESS
)

1878 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1879  
»tv®
;

1881 
	`OF_LIST_SCAN
(
vn_’Œy_p
->
©Œibu‹s
, 
©Œibu‹_’Œy_p
, 
üm_»sourû_©Œibu‹_’Œy
*,
l¡©ŒÇmeoff£t
)

1883 if(!
	`¡rcmp
(
©Œibu‹_’Œy_p
->
Çme
, 
©Œibu‹_šfo_p
->
Çme_¡ršg
))

1885 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
vn_Çme
, 
vn_’Œy_p
->
nw_Çme
);

1886 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
©Œibu‹_Çme
,
©Œibu‹_’Œy_p
->
Çme
);

1888 
	`¡rıy
(
nÙifiÿtiÚ_d©a
.
©Œibu‹_v®ue
,
©Œibu‹_’Œy_p
->
v®ue
);

1889 
	`OF_LIST_SCAN
(
üm_vn_nÙifiÿtiÚs
[
CRM_VN_ATTRIBUTE_DELETE
], 
­p_’Œy_p
, 
üm_nÙifiÿtiÚ_­p_hook_šfo
*,

1890 
l¡©ŒÇmeoff£t
 )

1892 ((
üm_vn_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_VN_ATTRIBUTE_DELETE
,

1893 
vn_hªdË
,

1894 
nÙifiÿtiÚ_d©a
,

1895 
­p_’Œy_p
->
cbk_¬g1
,

1896 
­p_’Œy_p
->
cbk_¬g2
);

1899 
	`OF_LIST_SCAN
(
üm_vn_nÙifiÿtiÚs
[
CRM_VN_ALL_NOTIFICATIONS
],
­p_’Œy_p
,
üm_nÙifiÿtiÚ_­p_hook_šfo
*,
l¡©ŒÇmeoff£t
)

1901 ((
üm_vn_nÙif›r_â
)(
­p_’Œy_p
->
ÿÎ_back
))(
CRM_VN_ATTRIBUTE_DELETE
,

1902 
vn_hªdË
,

1903 
nÙifiÿtiÚ_d©a
,

1904 
­p_’Œy_p
->
cbk_¬g1
,

1905 
­p_’Œy_p
->
cbk_¬g2
);

1907 
	`OF_REMOVE_NODE_FROM_LIST
(
vn_’Œy_p
->
©Œibu‹s
,
©Œibu‹_’Œy_p
,
´ev_­p_’Œy_p
, 
l¡©ŒÇmeoff£t
);

1908 
vn_’Œy_p
->
numb”_of_©Œibu‹s
--;

1910 
	`üm_»move_vn_v›w_’Œy
(
©Œibu‹_’Œy_p
->
Çme
,‡‰ribu‹_’Œy_p->
v®ue
);

1911 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1912  
CRM_SUCCESS
;

1914 
´ev_­p_’Œy_p
 = 
©Œibu‹_’Œy_p
;

1917 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1918  
CRM_FAILURE
;

1919 
	}
}

1921 
št32_t
 
	$üm_g‘_vn_fœ¡_©Œibu‹
(
ušt64_t
 
vn_hªdË
,

1922 
üm_©Œibu‹_Çme_v®ue_ouut_šfo
 *
©Œibu‹_ouut_p
)

1924 
št32_t
 
»tv®
;

1925 
üm_vœtu®_ÃtwÜk
 *
üm_vn_’Œy_p
=
NULL
;

1927 if(
©Œibu‹_ouut_p
 =ğ
NULL
)

1928  
CRM_FAILURE
;

1930 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1933 
»tv®
 = 
	`üm_g‘_vn_byhªdË
(
vn_hªdË
, &
üm_vn_’Œy_p
);

1934 if(
»tv®
 !ğ
CRM_SUCCESS
)

1936 
»tv®
 = 
CRM_ERROR_INVALID_VN_HANDLE
;

1939 
»tv®
 = 
	`üm_g‘_fœ¡_©Œibu‹
(&(
üm_vn_’Œy_p
->
©Œibu‹s
), 
©Œibu‹_ouut_p
);

1943 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1944  
»tv®
;

1945 
	}
}

1947 
št32_t
 
	$üm_g‘_vn_Ãxt_©Œibu‹
(
ušt64_t
 
vn_hªdË
,

1948 * 
cu¼’t_©Œibu‹_Çme
,

1949 
üm_©Œibu‹_Çme_v®ue_ouut_šfo
 *
©Œibu‹_ouut_p
)

1951 
št32_t
 
»tv®
;

1952 
üm_vœtu®_ÃtwÜk
 *
üm_vn_’Œy_p
=
NULL
;

1954 if((
©Œibu‹_ouut_p
 =ğ
NULL
è|| (
cu¼’t_©Œibu‹_Çme
 == NULL))

1955  
CRM_FAILURE
;

1957 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1960 
»tv®
 = 
	`üm_g‘_vn_byhªdË
(
vn_hªdË
,&
üm_vn_’Œy_p
);

1961 if(
»tv®
 !ğ
CRM_SUCCESS
)

1963 
»tv®
ğ
CRM_ERROR_INVALID_VN_HANDLE
;

1966 
»tv®
 = 
	`üm_g‘_Ãxt_©Œibu‹
(&(
üm_vn_’Œy_p
->
©Œibu‹s
), 
cu¼’t_©Œibu‹_Çme
, 
©Œibu‹_ouut_p
);

1968 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1969  
»tv®
;

1970 
	}
}

1972 
št32_t
 
	$üm_g‘_vn_exaù_©Œibu‹
(
ušt64_t
 
vn_hªdË
,*
©Œibu‹_Çme_¡ršg
, 
üm_©Œibu‹_Çme_v®ue_ouut_šfo
 *
©Œibu‹_ouut_p
)

1974 
üm_vœtu®_ÃtwÜk
 *
üm_vn_’Œy_p
=
NULL
;

1975 
št32_t
 
»tv®
;

1977 if(
©Œibu‹_Çme_¡ršg
 =ğ
NULL
)

1978  
CRM_ERROR_ATTRIBUTE_NAME_NULL
;

1980 if(
	`¡¾’
(
©Œibu‹_Çme_¡ršg
è> 
CRM_MAX_ATTRIBUTE_NAME_LEN
)

1981  
CRM_ERROR_INVALID_ATTRIBUTE_NAME_LEN
;

1983 
	`CNTLR_RCU_READ_LOCK_TAKE
();

1986 
»tv®
 = 
	`üm_g‘_vn_byhªdË
(
vn_hªdË
,&
üm_vn_’Œy_p
);

1987 if(
»tv®
 !ğ
CRM_SUCCESS
)

1989 
»tv®
ğ
CRM_ERROR_INVALID_VN_HANDLE
;

1992 
»tv®
 = 
	`üm_g‘_exaù_©Œibu‹
(&(
üm_vn_’Œy_p
->
©Œibu‹s
), 
©Œibu‹_Çme_¡ršg
,
©Œibu‹_ouut_p
);

1994 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

1995  
»tv®
;

1996 
	}
}

1998 
št32_t
 
	$üm_vn_»gi¡”_­¶iÿtiÚ
(* 
­¶n_Çme_p
 , 
ušt32_t
* 
off£t_p
)

2000 
št8_t
 
ii
 =0 , 
found_b
 = 
FALSE
;

2002 if(
­¶n_Çme_p
 =ğ
NULL
)

2004 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Application‚ame is NULL");

2005  
CRM_FAILURE
;

2007 if(
	`¡¾’
(
­¶n_Çme_p
è> 
CRM_MAX_APPL_NAME_LEN
 )

2009 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Application‚ame†ength max†imitƒxceeds");

2010  
CRM_FAILURE
;

2013  
ii
 = 0 ; i˜< 
NO_OF_CRM_VN_APPLICATIONS
 ; ii++)

2015 if(
	`¡rcmp
(
üm_vn_­¶iÿtiÚ_Çmes
[
ii
] , 
­¶n_Çme_p
) == 0)

2017 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Application‡lready„egistered");

2018  
CRM_FAILURE
;

2022  
ii
 = 0 ; i˜< 
NO_OF_CRM_VN_APPLICATIONS
 ; ii++)

2024 if(
	`¡rcmp
(
üm_vn_­¶iÿtiÚ_Çmes
[
ii
] , "") == 0)

2026 
	`¡ºıy
(
üm_vn_­¶iÿtiÚ_Çmes
[
ii
] , 
­¶n_Çme_p
 , 
CRM_MAX_APPL_NAME_LEN
);

2027 
found_b
 = 
TRUE
;

2031 if(
found_b
 =ğ
FALSE
)

2033 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
, "Application„egistration failure");

2034  
CRM_FAILURE
;

2037 *
off£t_p
 = (
üm_vœtu®_ÃtwÜk
è+ (
ii
 * (*));

2039 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"­¶iÿtiÚ % »gi¡”ed sucûsfuÎy",
üm_vn_­¶iÿtiÚ_Çmes
[
ii
]);

2040  
CRM_SUCCESS
;

2041 
	}
}

2043 
št32_t
 
	$üm_vn_uÄegi¡”_­¶iÿtiÚ
(* 
­²ame_p
)

2045 
ušt8_t
 
ii
 = 0 , 
found_b
 = 
FALSE
;

2047 if(
­²ame_p
 =ğ
NULL
)

2049 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Application‚ame is NULL");

2050  
CRM_FAILURE
;

2052  
ii
 = 0 ; i˜< 
NO_OF_CRM_VN_APPLICATIONS
 ; ii++)

2054 if(
	`¡rcmp
(
üm_vn_­¶iÿtiÚ_Çmes
[
ii
] ,
­²ame_p
) == 0)

2056 
found_b
 = 
TRUE
;

2060 if(
found_b
 =ğ
TRUE
)

2062 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Application Nodeo be deleted is found");

2063 
	`¡rıy
(
üm_vn_­¶iÿtiÚ_Çmes
[
ii
], "");

2064  
CRM_SUCCESS
;

2068 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Application Nodeo be deleted is NOT found");

2069  
CRM_FAILURE
;

2071 
	}
}

2073 
št32_t
 
	$üm_ü—‹_vn_v›w
(*
v›w_Çme
)

2075 
št32_t
 
šdex
 , 
ii
;

2076 
ušt8_t
 
em±y_šdex_b
 = 0;

2078 
ii
 = 0;ii<
CRM_MAX_VIEW_DATABASE
 ; ii++)

2080 if(!
	`¡rcmp
(
vn_db_v›w
[
ii
].
v›w
 , 
v›w_Çme
))

2082 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"View‡lready created");

2083  
CRM_FAILURE
;

2085 if((
em±y_šdex_b
 =ğ0è&& (!
	`¡rcmp
(
vn_db_v›w
[
ii
].
v›w
 ,"")))

2087 
em±y_šdex_b
 = 1;

2088 
šdex
 = 
ii
;

2091 if(
em±y_šdex_b
 == 0)

2093 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"View‡rray full . Cannot create‚ew view");

2094  
CRM_FAILURE
;

2096 
	`¡rıy
(
vn_db_v›w
[
šdex
].
v›w
,
v›w_Çme
);

2097 
	`üm_v›w_hash_bË_š™
(&
vn_db_v›w
[
šdex
].
db_v›wtbl_p
);

2098 
vn_db_v›w
[
šdex
].
uniqu’ess_æag
 = 
FALSE
;

2099 
vn_db_v›w
[
šdex
].
v®id_b
 = 
TRUE
;

2101 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_DEBUG
, "View‚ode created succesfully");

2102  
CRM_SUCCESS
;

2103 
	}
}

2106 
št32_t
 
	$üm_ü—‹_vn_v›w_’Œy
(
ušt64_t
 
vn_hªdË
 , * 
v›w_Çme
 ,* 
v›w_v®ue
)

2108 
d©aba£_v›w_node
 *
v›w_node_’Œy_p
;

2109 
št32_t
 
v›w_šdex
;

2110 
ušt32_t
 
šdex
,
magic
;

2111 
št32_t
 
¡©us
 = 
CRM_SUCCESS
;

2112 
ušt32_t
 
hashkey
;

2113 
ušt8_t
 
¡©us_b
,
v›w_found_b
 = 0;

2117 
v›w_šdex
 = 0;v›w_šdex < 
CRM_MAX_VIEW_DATABASE
 ; view_index++)

2119 if(!
	`¡rcmp
(
vn_db_v›w
[
v›w_šdex
].
v›w
 ,
v›w_Çme
))

2121 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_DEBUG
, "Viewƒntry can be made.");

2122 
v›w_found_b
 = 1;

2126 if(
v›w_found_b
 == 0)

2128 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_ERROR
,"View hashable‚ot initialized");

2129 
¡©us
 = 
CRM_FAILURE
;

2132 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
v›w_v®ue
,
üm_no_of_vn_buck‘s_g
);

2133 
	`CNTLR_RCU_READ_LOCK_TAKE
();

2134 
v›w_node_’Œy_p
 = 
	`üm_®loc_v›w_’Œy_ªd_£t_v®ues
(
vn_hªdË
, 
v›w_Çme
, 
v›w_v®ue
);

2135 ià(
v›w_node_’Œy_p
 =ğ
NULL
)

2137 
¡©us
 = 
CRM_FAILURE
;

2140 
	`MCHASH_APPEND_NODE
(
vn_db_v›w
[
v›w_šdex
].
db_v›wtbl_p
,
hashkey
,
v›w_node_’Œy_p
,
šdex
,
magic
,v›w_node_’Œy_p,
¡©us_b
);

2141 if(
FALSE
 =ğ
¡©us_b
)

2143 
¡©us
 = 
CRM_FAILURE
;

2144 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2147 
v›w_node_’Œy_p
->
magic
 = magic;

2148 
v›w_node_’Œy_p
->
šdex
 = index;

2149 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_DEBUG
,"Viewƒntry succesfuuly‡dded");

2150 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2153  
¡©us
;

2154 
	}
}

2157 
št32_t
 
	$üm_»move_vn_v›w_’Œy
(* 
v›w_Çme
,* 
v›w_v®ue
)

2159 
d©aba£_v›w_node
 *
v›w_node_’Œy_p
;

2160 
št32_t
 
šdex
 , 
off£t
 = 0;

2161 
št32_t
 
¡©us
 = 
CRM_SUCCESS
;

2162 
ušt32_t
 
hashkey
;

2163 
ušt8_t
 
¡©us_b
,
v›w_found_b
 = 0;

2167 
šdex
 = 0;šdex<
CRM_MAX_VIEW_DATABASE
;index++)

2169 if(!
	`¡rcmp
(
vn_db_v›w
[
šdex
].
v›w
,
v›w_Çme
))

2171 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_DEBUG
,"View found forhis view‚ame");

2172 
v›w_found_b
 = 1;

2176 if(
v›w_found_b
 == 0)

2178 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_ERROR
,"View‚ot initiliazed forhe view‚ame.So‚oƒntriesƒxist");

2179 
¡©us
 = 
CRM_FAILURE
;

2181 
hashkey
 = 
	`üm_g‘_hashv®_byÇme
(
v›w_v®ue
,
üm_no_of_vn_buck‘s_g
);

2182 
	`CNTLR_RCU_READ_LOCK_TAKE
();

2183 
	`MCHASH_BUCKET_SCAN
(
vn_db_v›w
[
šdex
].
db_v›wtbl_p
,
hashkey
, 
v›w_node_’Œy_p
,
d©aba£_v›w_node
 *,
off£t
)

2185 ià((!
	`¡rcmp
(
v›w_node_’Œy_p
->
v›w_v®ue
, view_value)) &&

2186 (!
	`¡rcmp
(
v›w_node_’Œy_p
->
node_Çme
, 
v›w_Çme
)))

2188 
¡©us_b
 = 
FALSE
;

2189 
off£t
 = 0;

2190 
	`MCHASH_DELETE_NODE_BY_REF
(
vn_db_v›w
[
šdex
].
db_v›wtbl_p
,
v›w_node_’Œy_p
->šdex,v›w_node_’Œy_p->
magic
,
d©aba£_v›w_node
 *,
off£t
,
¡©us_b
);

2191 ià(
¡©us_b
 =ğ
FALSE
)

2193 
¡©us
 = 
CRM_FAILURE
;

2196 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_DEBUG
,"Viewƒntry deleted successfully");

2197 
¡©us
 = 
CRM_SUCCESS
;

2203 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2204  
¡©us
;

2205 
	}
}

2207 
št32_t
 
	$üm_»move_vn_v›w
(*
v›w_Çme
)

2209 
št32_t
 
šdex
 , 
»t_v®
;

2210 
ušt8_t
 
node_found_b
 = 0 ;

2211 
ušt64_t
 
hashkey
 ,
off£t
 ;

2212 
d©aba£_v›w_node
 *
v›w_node_’Œy_p
;

2214 
šdex
 = 0;šdex<
CRM_MAX_VIEW_DATABASE
 ; index++)

2216 if(!
	`¡rcmp
(
vn_db_v›w
[
šdex
].
v›w
 , 
v›w_Çme
))

2218 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"View foundo deleted");

2219 
node_found_b
 = 1;

2223 if(
node_found_b
 == 0)

2225 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Node‚ot found ");

2226  
CRM_FAILURE
;

2229 
node_found_b
 = 0;

2230 
off£t
 = 0;

2232 
	`MCHASH_TABLE_SCAN
(
vn_db_v›w
[
šdex
].
db_v›wtbl_p
,
hashkey
)

2234 
	`MCHASH_BUCKET_SCAN
(
vn_db_v›w
[
šdex
].
db_v›wtbl_p
,
hashkey
, 
v›w_node_’Œy_p
,
d©aba£_v›w_node
 *,
off£t
)

2236 if(
	`¡rcmp
(
v›w_node_’Œy_p
->
v›w_v®ue
 , ""))

2238 
node_found_b
 = 1;

2243 if(
node_found_b
 == 1)

2245 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Remove viewƒntireso„emoveheƒntire view");

2246  
CRM_FAILURE
;

2248 
»t_v®
 = 
	`üm_v›w_hash_bË_deš™
(
vn_db_v›w
[
šdex
].
db_v›wtbl_p
);

2249 if(
»t_v®
 !ğ
CRM_SUCCESS
)

2251 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Hash Table deinit failed");

2252  
CRM_FAILURE
;

2254 
	`¡rıy
(
vn_db_v›w
[
šdex
].
v›w
,"");

2255 
vn_db_v›w
[
šdex
].
uniqu’ess_æag
 = 
FALSE
;

2256 
vn_db_v›w
[
šdex
].
v®id_b
 = 
FALSE
;

2258 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_DEBUG
, "View‚ode deleted succesfully");

2259  
CRM_SUCCESS
;

2260 
	}
}

2263 
št32_t
 
	$üm_g‘_fœ¡_vn_v›w_’Œy
(*
v›w_Çme
 , 
d©aba£_v›w_node
 *
vn_v›w_node
)

2265 
št32_t
 
šdex
;

2266 
ušt8_t
 
node_found_b
 = 0 ;

2267 
št32_t
 
hashkey
 ,
off£t
 ;

2268 
d©aba£_v›w_node
 *
v›w_node_’Œy_p
;

2270 
šdex
 = 0;šdex<
CRM_MAX_VIEW_DATABASE
 ; index++)

2272 if(!
	`¡rcmp
(
vn_db_v›w
[
šdex
].
v›w
 , 
v›w_Çme
))

2274 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"View found ");

2275 
node_found_b
 = 1;

2279 if(
node_found_b
 == 0)

2281 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Node‚ot found ");

2282  
CRM_FAILURE
;

2284 
node_found_b
 = 0;

2285 
off£t
 = 0;

2286 
	`CNTLR_RCU_READ_LOCK_TAKE
();

2287 
	`MCHASH_TABLE_SCAN
(
vn_db_v›w
[
šdex
].
db_v›wtbl_p
 ,
hashkey
)

2289 
	`MCHASH_BUCKET_SCAN
(
vn_db_v›w
[
šdex
].
db_v›wtbl_p
,
hashkey
, 
v›w_node_’Œy_p
,
d©aba£_v›w_node
 *,
off£t
)

2291 
	`¡rıy
(
vn_v›w_node
->
v›w_v®ue
 , 
v›w_node_’Œy_p
->view_value);

2292 
	`¡rıy
(
vn_v›w_node
->
node_Çme
 , 
v›w_node_’Œy_p
->node_name);

2293 
node_found_b
 = 1;

2296 if(
node_found_b
)

2299 if(
node_found_b
 == 0)

2301 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2302 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Nodeƒntry NOT found");

2303  
CRM_FAILURE
;

2306 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2307 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Nodeƒntry found");

2308  
CRM_SUCCESS
;

2309 
	}
}

2311 
št32_t
 
	$üm_g‘_Ãxt_vn_v›w_’Œy
(*
v›w_Çme
 , *
v›w_v®ue
 ,
d©aba£_v›w_node
 *
vn_v›w_node
)

2314 
št32_t
 
šdex
;

2315 
ušt8_t
 
node_found_b
 = 0 ;

2316 
št32_t
 
hashkey
 ,
off£t
 ;

2317 
d©aba£_v›w_node
 *
v›w_node_’Œy_p
;

2319 
šdex
 = 0;šdex<
CRM_MAX_VIEW_DATABASE
 ; index++)

2321 if(!
	`¡rcmp
(
vn_db_v›w
[
šdex
].
v›w
 , 
v›w_Çme
))

2323 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"View found ");

2324 
node_found_b
 = 1;

2328 if(
node_found_b
 == 0)

2330 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Node‚ot found ");

2331  
CRM_FAILURE
;

2333 
node_found_b
 = 0;

2334 
off£t
 = 0;

2335 
	`CNTLR_RCU_READ_LOCK_TAKE
();

2336 
	`MCHASH_TABLE_SCAN
(
vn_db_v›w
[
šdex
].
db_v›wtbl_p
 , 
hashkey
)

2338 
	`MCHASH_BUCKET_SCAN
(
vn_db_v›w
[
šdex
].
db_v›wtbl_p
,
hashkey
, 
v›w_node_’Œy_p
,
d©aba£_v›w_node
 *,
off£t
)

2340 if(
node_found_b
 == 0)

2342 if(!
	`¡rcmp
(
v›w_node_’Œy_p
->
node_Çme
 , 
v›w_Çme
) &&

2343 (!
	`¡rcmp
(
v›w_node_’Œy_p
->
v›w_v®ue
 , view_value)))

2345 
node_found_b
 = 1;

2353 
	`¡rıy
(
vn_v›w_node
->
v›w_v®ue
 , 
v›w_node_’Œy_p
->view_value);

2354 
	`¡rıy
(
vn_v›w_node
->
node_Çme
 , 
v›w_node_’Œy_p
->node_name);

2358 if(
node_found_b
 == 0)

2360 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2361 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Nodeƒntry NOT found");

2362  
CRM_FAILURE
;

2364 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2365 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Nodeƒntry found");

2366  
CRM_SUCCESS
;

2367 
	}
}

2369 
št32_t
 
	$üm_g‘_exaù_vn_v›w_’Œy
(*
v›w_Çme
 , *
v›w_v®ue
 ,
d©aba£_v›w_node
 *
vn_v›w_node
)

2372 
št32_t
 
šdex
;

2373 
ušt8_t
 
node_found_b
 = 0 ;

2374 
št32_t
 
hashkey
 ,
off£t
 ;

2375 
d©aba£_v›w_node
 *
v›w_node_’Œy_p
;

2377 
šdex
 = 0;šdex<
CRM_MAX_VIEW_DATABASE
 ; index++)

2379 if(!
	`¡rcmp
(
vn_db_v›w
[
šdex
].
v›w
 , 
v›w_Çme
))

2381 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"View found ");

2382 
node_found_b
 = 1;

2386 if(
node_found_b
 == 0)

2388 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Node‚ot found ");

2389  
CRM_FAILURE
;

2391 
node_found_b
 =0;

2392 
off£t
 = 0;

2393 
	`CNTLR_RCU_READ_LOCK_TAKE
();

2394 
	`MCHASH_TABLE_SCAN
(
vn_db_v›w
[
šdex
].
db_v›wtbl_p
 ,
hashkey
)

2396 
	`MCHASH_BUCKET_SCAN
(
vn_db_v›w
[
šdex
].
db_v›wtbl_p
,
hashkey
, 
v›w_node_’Œy_p
,
d©aba£_v›w_node
 *,
off£t
)

2398 if(!
	`¡rcmp
(
v›w_node_’Œy_p
->
node_Çme
 , 
v›w_Çme
) &&

2399 (!
	`¡rcmp
(
v›w_node_’Œy_p
->
v›w_v®ue
 , view_value)))

2401 
node_found_b
 = 1;

2405 if(
node_found_b
)

2408 if(
node_found_b
 == 0)

2410 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2411 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Nodeƒntry NOT found");

2412  
CRM_FAILURE
;

2414 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2415 
	`¡rıy
(
vn_v›w_node
->
v›w_v®ue
 , 
v›w_node_’Œy_p
->view_value);

2416 
	`¡rıy
(
vn_v›w_node
->
node_Çme
 , 
v›w_node_’Œy_p
->node_name);

2417 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Nodeƒntry found");

2418  
CRM_SUCCESS
;

2419 
	}
}

2421 
št32_t
 
	$üm_g‘_vn_by_v›w
(*
v›w_Çme
,*
v›w_v®ue
 ,
üm_vn_cÚfig_šfo
 *
cÚfig_šfo_p
)

2423 
üm_vœtu®_ÃtwÜk
 *
vn_šfo_p
 = 
NULL
;

2424 
d©aba£_v›w_node
 *
v›w_node_’Œy_p
 = 
NULL
;

2425 
št32_t
 
šdex
 ,
»t_v®
 , 
hashkey
,
off£t
;

2426 
ušt8_t
 
node_found_b
 = 0;

2428 
šdex
 = 0;šdex<
CRM_MAX_VIEW_DATABASE
 ; index++)

2430 if(!
	`¡rcmp
(
vn_db_v›w
[
šdex
].
v›w
 , 
v›w_Çme
))

2432 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"View found ");

2433 
node_found_b
 = 1;

2437 if(
node_found_b
 == 0)

2439 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"Node‚ot found ");

2440  
CRM_FAILURE
;

2443 
node_found_b
 =0;

2444 
off£t
 = 0;

2445 
	`CNTLR_RCU_READ_LOCK_TAKE
();

2446 
	`MCHASH_TABLE_SCAN
(
vn_db_v›w
[
šdex
].
db_v›wtbl_p
 ,
hashkey
)

2448 
	`MCHASH_BUCKET_SCAN
(
vn_db_v›w
[
šdex
].
db_v›wtbl_p
,
hashkey
, 
v›w_node_’Œy_p
,
d©aba£_v›w_node
 *,
off£t
)

2450 if(!
	`¡rcmp
(
v›w_node_’Œy_p
->
node_Çme
 , 
v›w_Çme
) &&

2451 (!
	`¡rcmp
(
v›w_node_’Œy_p
->
v›w_v®ue
 , view_value)))

2453 
node_found_b
 = 1;

2457 if(
node_found_b
)

2460 if(
node_found_b
 == 0)

2462 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2463 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"Nodeƒntry NOT found");

2464  
CRM_FAILURE
;

2466 
»t_v®
 = 
	`üm_g‘_vn_byhªdË
(
v›w_node_’Œy_p
->
node_§ã»f
 , &
vn_šfo_p
);

2467 if(
»t_v®
 !ğ
CRM_SUCCESS
)

2469 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_ERROR
,"No VN found forhe given handle");

2470  
CRM_FAILURE
;

2472 
	`¡ºıy
(
cÚfig_šfo_p
->
nw_Çme
, 
vn_šfo_p
->nw_Çme,
CRM_MAX_VN_NAME_LEN
);

2473 
	`¡ºıy
(
cÚfig_šfo_p
->
‹ÇÁ_Çme
, 
vn_šfo_p
->‹ÇÁ_Çme,
CRM_MAX_TENANT_NAME_LEN
);

2474 
cÚfig_šfo_p
->
nw_ty³
 = 
vn_šfo_p
->nw_type;

2476 if(
vn_šfo_p
->
nw_ty³
 =ğ
VLAN_TYPE
)

2478 
cÚfig_šfo_p
->
nw_·¿ms
.
vÏn_nw
.
vÏn_id
 = 
vn_šfo_p
->nw_params.vlan_nw.vlan_id;

2480 if(
vn_šfo_p
->
nw_ty³
 =ğ
VXLAN_TYPE
)

2482 
cÚfig_šfo_p
->
nw_·¿ms
.
vxÏn_nw
.
nid
 = 
vn_šfo_p
->nw_params.vxlan_nw.nid;

2483 
cÚfig_šfo_p
->
nw_·¿ms
.
vxÏn_nw
.
£rviû_pÜt
 = 
vn_šfo_p
->nw_params.vxlan_nw.service_port;

2485 
	`¡ºıy
(
cÚfig_šfo_p
->
nw_desc
, 
vn_šfo_p
->nw_desc, 
CRM_MAX_VN_DESC_LEN
);

2486 
	`¡ºıy
(
cÚfig_šfo_p
->
´ovid”_physiÿl_ÃtwÜk
, 
vn_šfo_p
->provider_physical_network,

2487 
CRM_MAX_VN_PROVIDER_PHY_NW
);

2488 
cÚfig_šfo_p
->
vn_admš_¡©e_up_b
 = 
vn_šfo_p
->vn_admin_state_up_b;

2489 
cÚfig_šfo_p
->
vn_İ”©iÚ®_¡©us_b
 = 
vn_šfo_p
->vn_operational_status_b;

2490 
cÚfig_šfo_p
->
rou‹r_ex‹º®_b
 = 
vn_šfo_p
->router_external_b;

2492 
	`CNTLR_RCU_READ_LOCK_RELEASE
();

2493 
	`OF_LOG_MSG
(
OF_LOG_CRM
,
OF_LOG_DEBUG
,"VN found forhe given view");

2494  
CRM_SUCCESS
;

2495 
	}
}

	@crmapi.c

31 
	~"üm_sy¡em_d•’d’c›s.h
"

32 
	~"üm_vn_­i.h
"

33 
	~"üm_pÜt_­i.h
"

34 
	~"üm_subÃt_­i.h
"

35 
	~"üm_vm_­i.h
"

36 
	~"üm_‹ÇÁ_­i.h
"

38 
	#RCUNODE_OFFSET_IN_MCHASH_TBLLNK
 
	`off£tof
(
mchash_bË_lšk
, 
rcu_h—d
)

	)

49 * 
	güm_vm_mempoŞ_g
 = 
NULL
;

50 
ušt32_t
 
	güm_no_of_vm_buck‘s_g
;

51 
mchash_bË
* 
	güm_vm_bË_g
 = 
NULL
;

54 * 
	güm_pÜt_mempoŞ_g
 = 
NULL
;

55 
ušt32_t
 
	güm_no_of_pÜt_buck‘s_g
;

56 
mchash_bË
* 
	güm_pÜt_bË_g
 = 
NULL
;

59 * 
	güm_vn_mempoŞ_g
 = 
NULL
;

60 
ušt32_t
 
	güm_no_of_vn_buck‘s_g
;

61 
mchash_bË
* 
	güm_vn_bË_g
 = 
NULL
;

64 * 
	güm_subÃt_mempoŞ_g
 = 
NULL
;

65 
ušt32_t
 
	güm_no_of_subÃt_buck‘s_g
;

66 
mchash_bË
* 
	güm_subÃt_bË_g
 = 
NULL
;

69 * 
	güm_‹ÇÁ_mempoŞ_g
 = 
NULL
;

70 
ušt32_t
 
	güm_no_of_‹ÇÁ_buck‘s_g
;

71 
mchash_bË
* 
	güm_‹ÇÁ_bË_g
 = 
NULL
;

75 * 
	güm_©Œibu‹s_mempoŞ_g
;

77 *
	güm_v›w_node_mempoŞ_g
 = 
NULL
;

80 * 
	güm_nÙifiÿtiÚs_mempoŞ_g
;

82 * 
	güm_vm_hªdË_mempoŞ_g
 = 
NULL
;

83 * 
	güm_‹ÇÁ_vÂames_mempoŞ_g
 = 
NULL
;

84 * 
	güm_vn_compu‹_nodes_mempoŞ_g
 = 
NULL
;

85 * 
	güm_pÜt_»f_mempoŞ_g
 = 
NULL
;

86 * 
	güm_subÃt_hªdË_mempoŞ_g
 = 
NULL
;

87 * 
	güm_vm_pÜt_mempoŞ_g
 = 
NULL
;

89 
of_li¡_t
 
	güm_vn_nÙifiÿtiÚs
[
CRM_VN_LAST_NOTIFICATION_TYPE
 + 1];

90 
of_li¡_t
 
	güm_pÜt_nÙifiÿtiÚs
[
CRM_PORT_LAST_NOTIFICATION_TYPE
 + 1];

91 
of_li¡_t
 
	güm_vm_nÙifiÿtiÚs
[
CRM_VM_LAST_NOTIFICATION_TYPE
 + 1];

92 
of_li¡_t
 
	güm_‹ÇÁ_nÙifiÿtiÚs
[
CRM_TENANT_LAST_NOTIFICATION_TYPE
 + 1];

93 
of_li¡_t
 
	güm_subÃt_nÙifiÿtiÚs
[
CRM_SUBNET_LAST_NOTIFICATION_TYPE
 + 1];

98 
	$üm_g‘_vn_mempoŞ’Œ›s
(
ušt32_t
* 
vn_’Œ›s_max
,

99 
ušt32_t
* 
vn_¡©ic_’Œ›s
)

101 *
vn_’Œ›s_max
 = 
CRM_MAX_VN_ENTRIES
;

102 *
vn_¡©ic_’Œ›s
 = 
CRM_MAX_VN_STATIC_ENTRIES
;

103 
	}
}

105 
	$üm_g‘_subÃt_mempoŞ’Œ›s
(
ušt32_t
* 
subÃt_’Œ›s_max
,

106 
ušt32_t
* 
subÃt_¡©ic_’Œ›s
)

108 *
subÃt_’Œ›s_max
 = 
CRM_MAX_SUBNET_ENTRIES
;

109 *
subÃt_¡©ic_’Œ›s
 = 
CRM_MAX_SUBNET_STATIC_ENTRIES
;

110 
	}
}

112 
	$üm_g‘_vm_mempoŞ’Œ›s
(
ušt32_t
* 
vm_’Œ›s_max
,

113 
ušt32_t
* 
vm_¡©ic_’Œ›s
)

115 *
vm_’Œ›s_max
 = 
CRM_MAX_VM_ENTRIES
;

116 *
vm_¡©ic_’Œ›s
 = 
CRM_MAX_VM_STATIC_ENTRIES
;

117 
	}
}

119 
	$üm_g‘_‹ÇÁ_mempoŞ’Œ›s
(
ušt32_t
* 
‹ÇÁ_’Œ›s_max
,

120 
ušt32_t
* 
‹ÇÁ_¡©ic_’Œ›s
)

122 *
‹ÇÁ_’Œ›s_max
 = 
CRM_MAX_TENANT_ENTRIES
;

123 *
‹ÇÁ_¡©ic_’Œ›s
 = 
CRM_MAX_TENANT_STATIC_ENTRIES
;

124 
	}
}

126 
	$üm_g‘_nÙifiÿtiÚ_mempoŞ’Œ›s
(
ušt32_t
* 
nÙifiÿtiÚ_’Œ›s_max
,

127 
ušt32_t
* 
nÙifiÿtiÚ_¡©ic_’Œ›s
)

129 *
nÙifiÿtiÚ_’Œ›s_max
 = 
CRM_MAX_NOTIFICATION_ENTRIES
;

130 *
nÙifiÿtiÚ_¡©ic_’Œ›s
 = 
CRM_MAX_NOTIFICATION_STATIC_ENTRIES
;

131 
	}
}

133 
	$üm_g‘_vn_compu‹_node_mempoŞ’Œ›s
(
ušt32_t
 *
vn_compu‹_nodes_max_’Œ›s
,

134 
ušt32_t
 *
vn_compu‹_nodes_¡©ic_’Œ›s
)

136 *
vn_compu‹_nodes_max_’Œ›s
 = 
CRM_MAX_COMPUTE_NODES_ENTRIES
;

137 *
vn_compu‹_nodes_¡©ic_’Œ›s
 = 
CRM_MAX_COMPUTE_NODES_STATIC_ENTRIES
;

138 
	}
}

140 
	$üm_g‘_vn_pÜt_mempoŞ’Œ›s
(
ušt32_t
 *
vn_pÜt_max_’Œ›s
,

141 
ušt32_t
 *
vn_pÜt_¡©ic_’Œ›s
)

143 *
vn_pÜt_max_’Œ›s
 = 
CRM_MAX_VN_PORT_ENTRIES
;

144 *
vn_pÜt_¡©ic_’Œ›s
 = 
CRM_MAX_VN_PORT_STATIC_ENTRIES
;

145 
	}
}

147 
	$üm_g‘_vm_pÜt_mempoŞ’Œ›s
(
ušt32_t
 *
vm_pÜt_max_’Œ›s
,

148 
ušt32_t
 *
vm_pÜt_¡©ic_’Œ›s
)

150 *
vm_pÜt_max_’Œ›s
 = 
CRM_MAX_VM_PORT_ENTRIES
;

151 *
vm_pÜt_¡©ic_’Œ›s
 = 
CRM_MAX_VM_STATIC_ENTRIES
;

152 
	}
}

154 
	$üm_g‘_pÜt_mempoŞ’Œ›s
(
ušt32_t
 *
üm_pÜt_max_’Œ›s
,

155 
ušt32_t
 *
üm_pÜt_¡©ic_’Œ›s
)

157 *
üm_pÜt_max_’Œ›s
 = 
CRM_MAX_PORT_NODES_ENTRIES
;

158 *
üm_pÜt_¡©ic_’Œ›s
 = 
CRM_MAX_PORT_NODES_STATIC_ENTRIES
;

159 
	}
}

161 
	$üm_g‘_©Œibu‹_mempoŞ’Œ›s
(
ušt32_t
 *
©Œibu‹_’Œ›s_max
,

162 
ušt32_t
 *
©Œibu‹_¡©ic_’Œ›s
)

164 *
©Œibu‹_’Œ›s_max
 = 
CRM_MAX_ATTRIBUTE_ENTRIES
;

165 *
©Œibu‹_¡©ic_’Œ›s
 = 
CRM_MAX_ATTRIBUTE_STATIC_ENTRIES
;

166 
	}
}

168 
	$üm_g‘_v›w_node_mempoŞ’Œ›s
(
ušt32_t
* 
v›w_node_’Œ›s_max
,ušt32_t* 
v›w_node_¡©ic_’Œ›s
)

170 *
v›w_node_’Œ›s_max
 = 
CRM_MAX_VIEW_NODE_ENTRIES
;

171 *
v›w_node_¡©ic_’Œ›s
 = 
CRM_MAX_VIEW_STATIC_NODE_ENTRIES
;

172 
	}
}

175 
	$üm_©Œibu‹s_ä“_©Œibu‹_’Œy_rcu
(
rcu_h—d
 *
©Œibu‹_’Œy_p
)

177 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Entered");

178 
üm_»sourû_©Œibu‹_’Œy
 *
©Œibu‹_šfo_p
;

179 
št32_t
 
»t_v®
;

180 if(
©Œibu‹_’Œy_p
)

182 
©Œibu‹_šfo_p
 = (
üm_»sourû_©Œibu‹_’Œy
 *)(((*)
©Œibu‹_’Œy_p
è- (
of_li¡_node_t
));

183 
»t_v®
 = 
	`mempoŞ_»Ëa£_mem_block
(
üm_©Œibu‹s_mempoŞ_g
,(
uch¬8_t
*)
©Œibu‹_šfo_p
,©Œibu‹_šfo_p->
h—p_b
);

184 if(
»t_v®
 !ğ
MEMPOOL_SUCCESS
)

186 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Failedo„elease‡ttr memory block.");

190 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Released‡ttr memory block fromhe memory…ool.");

194 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "passed for deletion.");

195 
	}
}

197 
	$üm_ä“_vÃÁry_rcu
(
rcu_h—d
 *
vn_’Œy_p
)

199 
üm_vœtu®_ÃtwÜk
 *
vn_šfo_p
=
NULL
;

200 
ušt32_t
 
off£t
;

201 
št32_t
 
»t_v®
;

203 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Entered");

204 if(
vn_’Œy_p
)

206 
off£t
 = 
VNNODE_VNTBL_OFFSET
;

207 
vn_šfo_p
 = (
üm_vœtu®_ÃtwÜk
 *)(((*)
vn_’Œy_p
 - 
RCUNODE_OFFSET_IN_MCHASH_TBLLNK
è- 
off£t
);

208 
»t_v®
 = 
	`mempoŞ_»Ëa£_mem_block
(
üm_vn_mempoŞ_g
,(
uch¬8_t
*)
vn_šfo_p
,vn_šfo_p->
h—p_b
);

210 if(
»t_v®
 !ğ
MEMPOOL_SUCCESS
)

212 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Failedo„elease virtual‚etwork memory block.");

216 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Released virtual‚etwork memory block fromhe memory…ool.");

221 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "NuÎƒÁryØ»Ëa£",
__FUNCTION__
,
__LINE__
);

223 
	}
}

225 
	$üm_ä“_pÜt_’Œy_rcu
(
rcu_h—d
 *
üm_pÜt_’Œy_p
)

227 
üm_pÜt
 *
pÜt_šfo_p
=
NULL
;

228 
ušt32_t
 
off£t
;

229 
št32_t
 
»t_v®ue
;

230 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Entered");

232 if(
üm_pÜt_’Œy_p
)

234 
off£t
 = 
CRM_PORT_NODE_PORT_TBL_OFFSET
;

235 
pÜt_šfo_p
 = (
üm_pÜt
 *)(((*)
üm_pÜt_’Œy_p
 - 
RCUNODE_OFFSET_IN_MCHASH_TBLLNK
è- 
off£t
);

236 
»t_v®ue
 = 
	`mempoŞ_»Ëa£_mem_block
(
üm_pÜt_mempoŞ_g
,(
uch¬8_t
*)
pÜt_šfo_p
,pÜt_šfo_p->
h—p_b
);

238 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

240 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Failedo„elease crm…ort memory block.");

244 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Released crm…ort memory block fromhe memory…ool.");

249 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Nullƒntryo„elease");

251 
	}
}

253 
	$üm_ä“_subÃ‹Áry_rcu
(
rcu_h—d
 *
subÃt_’Œy_p
)

255 
üm_subÃt
 *
subÃt_šfo_p
=
NULL
;

256 
ušt32_t
 
off£t
;

257 
št32_t
 
»t_v®ue
;

258 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Entered");

260 if(
subÃt_’Œy_p
)

262 
off£t
 = 
SUBNETNODE_SUBNETTBL_OFFSET
;

263 
subÃt_šfo_p
 = (
üm_subÃt
 *)(((*)
subÃt_’Œy_p
 - 
RCUNODE_OFFSET_IN_MCHASH_TBLLNK
è- 
off£t
);

264 
»t_v®ue
 = 
	`mempoŞ_»Ëa£_mem_block
(
üm_subÃt_mempoŞ_g
,(
uch¬8_t
*)
subÃt_šfo_p
,subÃt_šfo_p->
h—p_b
);

266 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

268 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Failedo„elease subnet memory block.");

272 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Released subnet memory block fromhe memory…ool.");

277 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Nullƒntryo„elease");

279 
	}
}

281 
	$üm_ä“_vm’Œy_rcu
(
rcu_h—d
 *
vm_’Œy_p
)

283 
üm_vœtu®_machše
 *
vm_šfo_p
;

284 
ušt32_t
 
off£t
;

285 
št32_t
 
»t_v®ue
;

286 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Entered");

287 if(
vm_’Œy_p
)

289 
off£t
 = 
VMNODE_VMTBL_OFFSET
;

290 
vm_šfo_p
 = (
üm_vœtu®_machše
*)(((*)
vm_’Œy_p
 - 
RCUNODE_OFFSET_IN_MCHASH_TBLLNK
è- 
off£t
);

291 
»t_v®ue
 = 
	`mempoŞ_»Ëa£_mem_block
(
üm_vm_mempoŞ_g
,(
uch¬8_t
*)
vm_šfo_p
,vm_šfo_p->
h—p_b
);

293 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

295 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Failedo„elease virtual machine memory block.");

299 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Released virtual machine memory block fromhe memory…ool.");

304 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "NULL…assed for deletion.");

306 
	}
}

308 
	$üm_ä“_‹ÇÁ’Œy_rcu
(
rcu_h—d
 *
‹ÇÁ_’Œy_p
)

310 
üm_‹ÇÁ
 *
‹ÇÁ_šfo_p
;

311 
uch¬8_t
 
off£t
=
TENANT_NODE_TENANT_TBL_OFFSET
;

312 
št32_t
 
»t_v®ue
;

313 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Entered");

315 if(
‹ÇÁ_’Œy_p
)

317 
‹ÇÁ_šfo_p
 = (
üm_‹ÇÁ
*è(((*)
‹ÇÁ_’Œy_p
 - 
RCUNODE_OFFSET_IN_MCHASH_TBLLNK
è- 
off£t
);

318 
»t_v®ue
 = 
	`mempoŞ_»Ëa£_mem_block
(
üm_‹ÇÁ_mempoŞ_g
,(
uch¬8_t
*)
‹ÇÁ_šfo_p
,’ªt_šfo_p->
h—p_b
);

319 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

321 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Failedo„eleaseenant memory block.");

325 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Releasedenant memory block fromhe memory…ool.");

330 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "NULL…assed for deletion.");

332 
	}
}

334 
	$üm_nÙifiÿtiÚs_ä“_­p_’Œy_rcu
(
rcu_h—d
 *
­p_’Œy_p
)

336 
üm_nÙifiÿtiÚ_­p_hook_šfo
 *
­p_šfo_p
;

337 
št32_t
 
»t_v®ue
;

338 if(
­p_’Œy_p
)

340 
­p_šfo_p
 = (
üm_nÙifiÿtiÚ_­p_hook_šfo
 *)((*)
­p_’Œy_p
 - (
of_li¡_node_t
));

341 
»t_v®ue
 = 
	`mempoŞ_»Ëa£_mem_block
(
üm_nÙifiÿtiÚs_mempoŞ_g
, (
uch¬8_t
*)
­p_šfo_p
,‡µ_šfo_p->
h—p_b
);

342 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

344 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Failedo„elease‚otification memory block.");

348 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "Released‚otification memory block fromhe memory…ool.");

353 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_DEBUG
, "NULL…assed for deletion.");

355 
	}
}

357 
	$üm_ä“_v›w_node_rcu
(
rcu_h—d
 *
v›w_node_p
)

359 
d©aba£_v›w_node
 *
d©aba£_v›w_node_p
=(d©aba£_v›w_nod*)
v›w_node_p
;

360 if(
d©aba£_v›w_node_p
)

362 
	`mempoŞ_»Ëa£_mem_block
(
üm_v›w_node_mempoŞ_g
,(
uch¬8_t
*)
d©aba£_v›w_node_p
,
FALSE
);

363 ifĞ
d©aba£_v›w_node_p
->
node_Çme
)

365 
	`ä“
(
d©aba£_v›w_node_p
->
node_Çme
);

367 ifĞ
d©aba£_v›w_node_p
->
v›w_v®ue
)

369 
	`ä“
(
d©aba£_v›w_node_p
->
v›w_v®ue
);

374 
	`OF_LOG_MSG
(
OF_LOG_MOD
, 
OF_LOG_ERROR
," NULL…assed for deletion.");

376 
	}
}

380 
ušt32_t
 
	$üm_g‘_hashv®_byÇme
(* 
Çme_p
,
ušt32_t
 
no_of_buck‘s
)

382 
ušt32_t
 
hashkey
,
·¿m1
,
·¿m2
,
·¿m3
,
·¿m4
;

383 
Çme_hash
[16];

384 
	`mem£t
(
Çme_hash
,0,16);

385 
	`¡ºıy
(
Çme_hash
,
Çme_p
,16);

386 
·¿m1
 = *(
ušt32_t
 *)(
Çme_hash
 +0);

387 
·¿m2
 = *(
ušt32_t
 *)(
Çme_hash
 +4);

388 
·¿m3
 = *(
ušt32_t
 *)(
Çme_hash
 +8);

389 
·¿m4
 = *(
ušt32_t
 *)(
Çme_hash
 +12);

390 
	`CRM_COMPUTE_HASH
(
·¿m1
,
·¿m2
,
·¿m3
,
·¿m4
,
no_of_buck‘s
,
hashkey
);

391  
hashkey
;

392 
	}
}

394 
ušt32_t
 
	$üm_g‘_hashv®_byÇmes
(* 
Çme1_p
,*
Çme2_p
,
ušt32_t
 
no_of_buck‘s
)

396 
ušt32_t
 
hashkey
,
·¿m1
,
·¿m2
,
·¿m3
,
·¿m4
;

397 
Çme1_hash
[8];

398 
Çme2_hash
[8];

399 
	`mem£t
(
Çme1_hash
,0,8);

400 
	`mem£t
(
Çme2_hash
,0,8);

401 
	`¡ºıy
(
Çme1_hash
,
Çme2_p
,8);

402 
	`¡ºıy
(
Çme2_hash
,
Çme2_p
,8);

403 
·¿m1
 = *(
ušt32_t
 *)(
Çme1_hash
 +0);

404 
·¿m2
 = *(
ušt32_t
 *)(
Çme1_hash
 +4);

405 
·¿m3
 = *(
ušt32_t
 *)(
Çme2_hash
 +0);

406 
·¿m4
 = *(
ušt32_t
 *)(
Çme2_hash
 +4);

407 
	`CRM_COMPUTE_HASH
(
·¿m1
,
·¿m2
,
·¿m3
,
·¿m4
,
no_of_buck‘s
,
hashkey
);

408  
hashkey
;

409 
	}
}

411 
št32_t
 
	$üm_š™
()

413 
št32_t
 
ii
, 
»t_v®ue
;

414 
ušt32_t
 
vn_’Œ›s_max
, 
vn_¡©ic_’Œ›s
;

415 
ušt32_t
 
vn_compu‹_nodes_’Œ›s_max
, 
vn_compu‹_nodes_¡©ic_’Œ›s
;

416 
ušt32_t
 
pÜt_’Œ›s_max
, 
pÜt_¡©ic_’Œ›s
;

417 
ušt32_t
 
vm_pÜt_’Œ›s_max
, 
vm_pÜt_¡©ic_’Œ›s
;

418 
ušt32_t
 
vm_’Œ›s_max
, 
vm_¡©ic_’Œ›s
;

419 
ušt32_t
 
subÃt_’Œ›s_max
, 
subÃt_¡©ic_’Œ›s
;

420 
ušt32_t
 
‹ÇÁ_’Œ›s_max
, 
‹ÇÁ_¡©ic_’Œ›s
;

421 
ušt32_t
 
nÙifiÿtiÚ_’Œ›s_max
, 
nÙifiÿtiÚ_¡©ic_’Œ›s
;

422 
ušt32_t
 
©Œibu‹_’Œ›s_max
, 
©Œibu‹_¡©ic_’Œ›s
;

423 
ušt32_t
 
v›w_node_’Œ›s_max
,
v›w_node_¡©ic_’Œ›s
;

424 
mempoŞ_·¿ms
 
mempoŞ_šfo
={};

427 
	`üm_g‘_vn_mempoŞ’Œ›s
(&
vn_’Œ›s_max
,&
vn_¡©ic_’Œ›s
);

429 
mempoŞ_šfo
.
mempoŞ_ty³
 = 
MEMPOOL_TYPE_HEAP
;

430 
mempoŞ_šfo
.
block_size
 = (
üm_vœtu®_ÃtwÜk
è+ (
NO_OF_CRM_VN_APPLICATIONS
 * (*));

431 
mempoŞ_šfo
.
max_blocks
 = 
vn_’Œ›s_max
;

432 
mempoŞ_šfo
.
¡©ic_blocks
 = 
vn_¡©ic_’Œ›s
;

433 
mempoŞ_šfo
.
th»shŞd_mš
 = 
vn_¡©ic_’Œ›s
/10;

434 
mempoŞ_šfo
.
th»shŞd_max
 = 
vn_¡©ic_’Œ›s
/3;

435 
mempoŞ_šfo
.
»¶’ish_couÁ
 = 
vn_¡©ic_’Œ›s
/10;

436 
mempoŞ_šfo
.
b_mem£t_nÙ_»quœed
 = 
FALSE
;

437 
mempoŞ_šfo
.
b_li¡_³r_th»ad_»quœed
 = 
FALSE
;

438 
mempoŞ_šfo
.
noof_blocks_to_move_to_th»ad_li¡
 = 0;

440 
»t_v®ue
 = 
	`mempoŞ_ü—‹_poŞ
("üm_vœtu®_ÃtwÜk_poŞ", &
mempoŞ_šfo
,

441 &
üm_vn_mempoŞ_g


443 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

445 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Memory Pool Creation failed for virtual‚etworks!.");

446 
CRMINIT_EXIT
;

448 
»t_v®ue
 = 
	`mchash_bË_ü—‹
(((
vn_’Œ›s_max
 / 5)+1),

449 
vn_’Œ›s_max
,

450 
üm_ä“_vÃÁry_rcu
,

451 &
üm_vn_bË_g
);

452 if(
»t_v®ue
 !ğ
MCHASHTBL_SUCCESS
)

454 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Hashable Creation failed for virtual‚etworks!.");

455 
CRMINIT_EXIT
;

457 
üm_no_of_vn_buck‘s_g
 = (
vn_’Œ›s_max
 / 5) + 1;

463 
	`üm_g‘_vn_compu‹_node_mempoŞ’Œ›s
(&
vn_compu‹_nodes_’Œ›s_max
,

464 &
vn_compu‹_nodes_¡©ic_’Œ›s
);

466 
mempoŞ_šfo
.
mempoŞ_ty³
 = 
MEMPOOL_TYPE_HEAP
;

467 
mempoŞ_šfo
.
block_size
 = (
üm_compu‹_node
);

468 
mempoŞ_šfo
.
max_blocks
 = 
vn_compu‹_nodes_’Œ›s_max
;

469 
mempoŞ_šfo
.
¡©ic_blocks
 = 
vn_compu‹_nodes_¡©ic_’Œ›s
;

470 
mempoŞ_šfo
.
th»shŞd_mš
 = 
vn_compu‹_nodes_¡©ic_’Œ›s
/10;

471 
mempoŞ_šfo
.
th»shŞd_max
 = 
vn_compu‹_nodes_¡©ic_’Œ›s
/3;

472 
mempoŞ_šfo
.
»¶’ish_couÁ
 = 
vn_compu‹_nodes_¡©ic_’Œ›s
/10;

473 
mempoŞ_šfo
.
b_mem£t_nÙ_»quœed
 = 
FALSE
;

474 
mempoŞ_šfo
.
b_li¡_³r_th»ad_»quœed
 = 
FALSE
;

475 
mempoŞ_šfo
.
noof_blocks_to_move_to_th»ad_li¡
 = 0;

477 
»t_v®ue
 = 
	`mempoŞ_ü—‹_poŞ
("üm_compu‹_nodes_poŞ", &
mempoŞ_šfo
,

478 &
üm_vn_compu‹_nodes_mempoŞ_g


480 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

482 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Memory Pool Creation failed for virtual‚etwork compute‚odes!.");

483 
CRMINIT_EXIT
;

488 
	`üm_g‘_vn_pÜt_mempoŞ’Œ›s
(&
pÜt_’Œ›s_max
, &
pÜt_¡©ic_’Œ›s
);

490 
mempoŞ_šfo
.
mempoŞ_ty³
 = 
MEMPOOL_TYPE_HEAP
;

491 
mempoŞ_šfo
.
block_size
 = (
üm_pÜt_»f
);

492 
mempoŞ_šfo
.
max_blocks
 = 
pÜt_’Œ›s_max
;

493 
mempoŞ_šfo
.
¡©ic_blocks
 = 
pÜt_¡©ic_’Œ›s
;

494 
mempoŞ_šfo
.
th»shŞd_mš
 = 
pÜt_¡©ic_’Œ›s
/10;

495 
mempoŞ_šfo
.
th»shŞd_max
 = 
pÜt_¡©ic_’Œ›s
/3;

496 
mempoŞ_šfo
.
»¶’ish_couÁ
 = 
pÜt_¡©ic_’Œ›s
/10;

497 
mempoŞ_šfo
.
b_mem£t_nÙ_»quœed
 = 
FALSE
;

498 
mempoŞ_šfo
.
b_li¡_³r_th»ad_»quœed
 = 
FALSE
;

499 
mempoŞ_šfo
.
noof_blocks_to_move_to_th»ad_li¡
 = 0;

501 
»t_v®ue
 = 
	`mempoŞ_ü—‹_poŞ
("üm_pÜt_hªdË_poŞ", &
mempoŞ_šfo
,

502 &
üm_pÜt_»f_mempoŞ_g


504 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

506 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Memory Pool Creation failed for crm_port handles!.");

507 
CRMINIT_EXIT
;

511 
	`üm_g‘_subÃt_mempoŞ’Œ›s
(&
subÃt_’Œ›s_max
, &
subÃt_¡©ic_’Œ›s
);

513 
mempoŞ_šfo
.
mempoŞ_ty³
 = 
MEMPOOL_TYPE_HEAP
;

514 
mempoŞ_šfo
.
block_size
 = (
üm_subÃt_hªdË
);

515 
mempoŞ_šfo
.
max_blocks
 = 
subÃt_’Œ›s_max
;

516 
mempoŞ_šfo
.
¡©ic_blocks
 = 
subÃt_¡©ic_’Œ›s
;

517 
mempoŞ_šfo
.
th»shŞd_mš
 = 
subÃt_¡©ic_’Œ›s
/10;

518 
mempoŞ_šfo
.
th»shŞd_max
 = 
subÃt_¡©ic_’Œ›s
/3;

519 
mempoŞ_šfo
.
»¶’ish_couÁ
 = 
subÃt_¡©ic_’Œ›s
/10;

520 
mempoŞ_šfo
.
b_mem£t_nÙ_»quœed
 = 
FALSE
;

521 
mempoŞ_šfo
.
b_li¡_³r_th»ad_»quœed
 = 
FALSE
;

522 
mempoŞ_šfo
.
noof_blocks_to_move_to_th»ad_li¡
 = 0;

524 
»t_v®ue
 = 
	`mempoŞ_ü—‹_poŞ
("üm_subÃt_hªdË_poŞ", &
mempoŞ_šfo
,

525 &
üm_subÃt_hªdË_mempoŞ_g


527 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

529 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Memory Pool Creation failed for crm subnet handles!.");

530 
CRMINIT_EXIT
;

534 
	`üm_g‘_vm_mempoŞ’Œ›s
(&
vm_’Œ›s_max
, &
vm_¡©ic_’Œ›s
);

536 
mempoŞ_šfo
.
mempoŞ_ty³
 = 
MEMPOOL_TYPE_HEAP
;

537 
mempoŞ_šfo
.
block_size
 = (
üm_vœtu®_machše_hªdË
);

538 
mempoŞ_šfo
.
max_blocks
 = 
vm_’Œ›s_max
;

539 
mempoŞ_šfo
.
¡©ic_blocks
 = 
vm_¡©ic_’Œ›s
;

540 
mempoŞ_šfo
.
th»shŞd_mš
 = 
vm_¡©ic_’Œ›s
/10;

541 
mempoŞ_šfo
.
th»shŞd_max
 = 
vm_¡©ic_’Œ›s
/3;

542 
mempoŞ_šfo
.
»¶’ish_couÁ
 = 
vm_¡©ic_’Œ›s
/10;

543 
mempoŞ_šfo
.
b_mem£t_nÙ_»quœed
 = 
FALSE
;

544 
mempoŞ_šfo
.
b_li¡_³r_th»ad_»quœed
 = 
FALSE
;

545 
mempoŞ_šfo
.
noof_blocks_to_move_to_th»ad_li¡
 = 0;

547 
»t_v®ue
 = 
	`mempoŞ_ü—‹_poŞ
("üm_vœtu®_machše_hªdË_poŞ", &
mempoŞ_šfo
,

548 &
üm_vm_hªdË_mempoŞ_g


550 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

552 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Memory Pool Creation failed for crm vm handles!.");

553 
CRMINIT_EXIT
;

559 
	`üm_g‘_subÃt_mempoŞ’Œ›s
(&
subÃt_’Œ›s_max
,&
subÃt_¡©ic_’Œ›s
);

561 
mempoŞ_šfo
.
mempoŞ_ty³
 = 
MEMPOOL_TYPE_HEAP
;

562 
mempoŞ_šfo
.
block_size
 = (
üm_subÃt
);

563 
mempoŞ_šfo
.
max_blocks
 = 
subÃt_’Œ›s_max
;

564 
mempoŞ_šfo
.
¡©ic_blocks
 = 
subÃt_¡©ic_’Œ›s
;

565 
mempoŞ_šfo
.
th»shŞd_mš
 = 
subÃt_¡©ic_’Œ›s
/10;

566 
mempoŞ_šfo
.
th»shŞd_max
 = 
subÃt_¡©ic_’Œ›s
/3;

567 
mempoŞ_šfo
.
»¶’ish_couÁ
 = 
subÃt_¡©ic_’Œ›s
/10;

568 
mempoŞ_šfo
.
b_mem£t_nÙ_»quœed
 = 
FALSE
;

569 
mempoŞ_šfo
.
b_li¡_³r_th»ad_»quœed
 = 
FALSE
;

570 
mempoŞ_šfo
.
noof_blocks_to_move_to_th»ad_li¡
 = 0;

572 
»t_v®ue
 = 
	`mempoŞ_ü—‹_poŞ
("üm_subÃt_poŞ", &
mempoŞ_šfo
,

573 &
üm_subÃt_mempoŞ_g


576 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

577 
CRMINIT_EXIT
;

578 
»t_v®ue
 = 
	`mchash_bË_ü—‹
(((
subÃt_’Œ›s_max
 / 5)+1),

579 
subÃt_’Œ›s_max
,

580 
üm_ä“_subÃ‹Áry_rcu
,

581 &
üm_subÃt_bË_g
);

582 if(
»t_v®ue
 !ğ
MCHASHTBL_SUCCESS
)

583 
CRMINIT_EXIT
;

584 
üm_no_of_subÃt_buck‘s_g
 = (
subÃt_’Œ›s_max
 / 5) + 1;

588 
	`üm_g‘_pÜt_mempoŞ’Œ›s
(&
pÜt_’Œ›s_max
,&
pÜt_¡©ic_’Œ›s
);

590 
mempoŞ_šfo
.
mempoŞ_ty³
 = 
MEMPOOL_TYPE_HEAP
;

591 
mempoŞ_šfo
.
block_size
 = (
üm_pÜt
);

592 
mempoŞ_šfo
.
max_blocks
 = 
pÜt_’Œ›s_max
;

593 
mempoŞ_šfo
.
¡©ic_blocks
 = 
pÜt_¡©ic_’Œ›s
;

594 
mempoŞ_šfo
.
th»shŞd_mš
 = 
pÜt_¡©ic_’Œ›s
/10;

595 
mempoŞ_šfo
.
th»shŞd_max
 = 
pÜt_¡©ic_’Œ›s
/3;

596 
mempoŞ_šfo
.
»¶’ish_couÁ
 = 
pÜt_¡©ic_’Œ›s
/10;

597 
mempoŞ_šfo
.
b_mem£t_nÙ_»quœed
 = 
FALSE
;

598 
mempoŞ_šfo
.
b_li¡_³r_th»ad_»quœed
 = 
FALSE
;

599 
mempoŞ_šfo
.
noof_blocks_to_move_to_th»ad_li¡
 = 0;

601 
»t_v®ue
 = 
	`mempoŞ_ü—‹_poŞ
("üm_pÜt_poŞ", &
mempoŞ_šfo
,

602 &
üm_pÜt_mempoŞ_g


604 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

605 
CRMINIT_EXIT
;

606 
»t_v®ue
 = 
	`mchash_bË_ü—‹
(((
pÜt_’Œ›s_max
 / 5)+1),

607 
pÜt_’Œ›s_max
,

608 
üm_ä“_pÜt_’Œy_rcu
,

609 &
üm_pÜt_bË_g
);

610 if(
»t_v®ue
 !ğ
MCHASHTBL_SUCCESS
)

611 
CRMINIT_EXIT
;

612 
üm_no_of_pÜt_buck‘s_g
 = (
pÜt_’Œ›s_max
 / 5) + 1;

616 
	`üm_g‘_vm_mempoŞ’Œ›s
(&
vm_’Œ›s_max
,&
vm_¡©ic_’Œ›s
);

618 
mempoŞ_šfo
.
mempoŞ_ty³
 = 
MEMPOOL_TYPE_HEAP
;

619 
mempoŞ_šfo
.
block_size
 = (
üm_vœtu®_machše
);

620 
mempoŞ_šfo
.
max_blocks
 = 
vm_’Œ›s_max
;

621 
mempoŞ_šfo
.
¡©ic_blocks
 = 
vm_¡©ic_’Œ›s
;

622 
mempoŞ_šfo
.
th»shŞd_mš
 = 
vm_¡©ic_’Œ›s
/10;

623 
mempoŞ_šfo
.
th»shŞd_max
 = 
vm_¡©ic_’Œ›s
/3;

624 
mempoŞ_šfo
.
»¶’ish_couÁ
 = 
vm_¡©ic_’Œ›s
/10;

625 
mempoŞ_šfo
.
b_mem£t_nÙ_»quœed
 = 
FALSE
;

626 
mempoŞ_šfo
.
b_li¡_³r_th»ad_»quœed
 = 
FALSE
;

627 
mempoŞ_šfo
.
noof_blocks_to_move_to_th»ad_li¡
 = 0;

629 
»t_v®ue
 = 
	`mempoŞ_ü—‹_poŞ
("üm_vm_poŞ", &
mempoŞ_šfo
,

630 &
üm_vm_mempoŞ_g


632 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

633 
CRMINIT_EXIT
;

634 
»t_v®ue
 = 
	`mchash_bË_ü—‹
(((
vm_’Œ›s_max
 / 5)+1),

635 
vm_’Œ›s_max
,

636 
üm_ä“_vm’Œy_rcu
,

637 &
üm_vm_bË_g
);

638 if(
»t_v®ue
 !ğ
MCHASHTBL_SUCCESS
)

639 
CRMINIT_EXIT
;

640 
üm_no_of_vm_buck‘s_g
 = (
vm_’Œ›s_max
 / 5) + 1;

645 
	`üm_g‘_vm_pÜt_mempoŞ’Œ›s
(&
vm_pÜt_’Œ›s_max
, &
vm_pÜt_¡©ic_’Œ›s
);

647 
mempoŞ_šfo
.
mempoŞ_ty³
 = 
MEMPOOL_TYPE_HEAP
;

648 
mempoŞ_šfo
.
block_size
 = (
üm_vm_pÜt
);

649 
mempoŞ_šfo
.
max_blocks
 = 
vm_pÜt_’Œ›s_max
;

650 
mempoŞ_šfo
.
¡©ic_blocks
 = 
vm_pÜt_¡©ic_’Œ›s
;

651 
mempoŞ_šfo
.
th»shŞd_mš
 = 
vm_pÜt_¡©ic_’Œ›s
/10;

652 
mempoŞ_šfo
.
th»shŞd_max
 = 
vm_pÜt_¡©ic_’Œ›s
/3;

653 
mempoŞ_šfo
.
»¶’ish_couÁ
 = 
vm_pÜt_¡©ic_’Œ›s
/10;

654 
mempoŞ_šfo
.
b_mem£t_nÙ_»quœed
 = 
FALSE
;

655 
mempoŞ_šfo
.
b_li¡_³r_th»ad_»quœed
 = 
FALSE
;

656 
mempoŞ_šfo
.
noof_blocks_to_move_to_th»ad_li¡
 = 0;

658 
»t_v®ue
 = 
	`mempoŞ_ü—‹_poŞ
("üm_vœtu®_machše_pÜts_poŞ", &
mempoŞ_šfo
,

659 &
üm_vm_pÜt_mempoŞ_g


661 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

663 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "failedo create…ool for virtual machin…orts");

664 
CRMINIT_EXIT
;

668 
	`üm_g‘_‹ÇÁ_mempoŞ’Œ›s
(&
‹ÇÁ_’Œ›s_max
,&
‹ÇÁ_¡©ic_’Œ›s
);

670 
mempoŞ_šfo
.
mempoŞ_ty³
 = 
MEMPOOL_TYPE_HEAP
;

671 
mempoŞ_šfo
.
block_size
 = (
üm_‹ÇÁ
);

672 
mempoŞ_šfo
.
max_blocks
 = 
‹ÇÁ_’Œ›s_max
;

673 
mempoŞ_šfo
.
¡©ic_blocks
 = 
‹ÇÁ_¡©ic_’Œ›s
;

674 
mempoŞ_šfo
.
th»shŞd_mš
 = 
‹ÇÁ_¡©ic_’Œ›s
/10;

675 
mempoŞ_šfo
.
th»shŞd_max
 = 
‹ÇÁ_¡©ic_’Œ›s
/3;

676 
mempoŞ_šfo
.
»¶’ish_couÁ
 = 
‹ÇÁ_¡©ic_’Œ›s
/10;

677 
mempoŞ_šfo
.
b_mem£t_nÙ_»quœed
 = 
FALSE
;

678 
mempoŞ_šfo
.
b_li¡_³r_th»ad_»quœed
 = 
FALSE
;

679 
mempoŞ_šfo
.
noof_blocks_to_move_to_th»ad_li¡
 = 0;

681 
»t_v®ue
 = 
	`mempoŞ_ü—‹_poŞ
("üm_‹ÇÁ_poŞ", &
mempoŞ_šfo
,

682 &
üm_‹ÇÁ_mempoŞ_g


684 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

685 
CRMINIT_EXIT
;

686 
»t_v®ue
 = 
	`mchash_bË_ü—‹
(((
‹ÇÁ_’Œ›s_max
 / 5)+1),

687 
‹ÇÁ_’Œ›s_max
,

688 
üm_ä“_‹ÇÁ’Œy_rcu
,

689 &
üm_‹ÇÁ_bË_g
);

690 if(
»t_v®ue
 !ğ
MCHASHTBL_SUCCESS
)

691 
CRMINIT_EXIT
;

693 
üm_no_of_‹ÇÁ_buck‘s_g
 = (
‹ÇÁ_’Œ›s_max
 / 5) + 1;

695 
	`üm_g‘_vn_mempoŞ’Œ›s
(&
vn_’Œ›s_max
, &
vn_¡©ic_’Œ›s
);

698 
mempoŞ_šfo
.
mempoŞ_ty³
 = 
MEMPOOL_TYPE_HEAP
;

699 
mempoŞ_šfo
.
block_size
 = (
üm_‹ÇÁ_vn_li¡
);

700 
mempoŞ_šfo
.
max_blocks
 = 
vn_’Œ›s_max
;

701 
mempoŞ_šfo
.
¡©ic_blocks
 = 
vn_¡©ic_’Œ›s
;

702 
mempoŞ_šfo
.
th»shŞd_mš
 = 
vn_¡©ic_’Œ›s
/10;

703 
mempoŞ_šfo
.
th»shŞd_max
 = 
vn_¡©ic_’Œ›s
/3;

704 
mempoŞ_šfo
.
»¶’ish_couÁ
 = 
vn_¡©ic_’Œ›s
/10;

705 
mempoŞ_šfo
.
b_mem£t_nÙ_»quœed
 = 
FALSE
;

706 
mempoŞ_šfo
.
b_li¡_³r_th»ad_»quœed
 = 
FALSE
;

707 
mempoŞ_šfo
.
noof_blocks_to_move_to_th»ad_li¡
 = 0;

709 
»t_v®ue
 = 
	`mempoŞ_ü—‹_poŞ
("üm_‹ÇÁ_vÂames_poŞ", &
mempoŞ_šfo
,

710 &(
üm_‹ÇÁ_vÂames_mempoŞ_g
)

713 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

715 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "Memory Pool Creation failed forenant-vnnames†ist.");

716 
CRMINIT_EXIT
;

722 
	`üm_g‘_©Œibu‹_mempoŞ’Œ›s
(&
©Œibu‹_’Œ›s_max
,&
©Œibu‹_¡©ic_’Œ›s
);

724 
mempoŞ_šfo
.
mempoŞ_ty³
 = 
MEMPOOL_TYPE_HEAP
;

725 
mempoŞ_šfo
.
block_size
 = (
üm_»sourû_©Œibu‹_’Œy
);

726 
mempoŞ_šfo
.
max_blocks
 = 
©Œibu‹_’Œ›s_max
;

727 
mempoŞ_šfo
.
¡©ic_blocks
 = 
©Œibu‹_¡©ic_’Œ›s
;

728 
mempoŞ_šfo
.
th»shŞd_mš
 = 
©Œibu‹_¡©ic_’Œ›s
/10;

729 
mempoŞ_šfo
.
th»shŞd_max
 = 
©Œibu‹_¡©ic_’Œ›s
/3;

730 
mempoŞ_šfo
.
»¶’ish_couÁ
 = 
©Œibu‹_¡©ic_’Œ›s
/10;

731 
mempoŞ_šfo
.
b_mem£t_nÙ_»quœed
 = 
FALSE
;

732 
mempoŞ_šfo
.
b_li¡_³r_th»ad_»quœed
 = 
FALSE
;

733 
mempoŞ_šfo
.
noof_blocks_to_move_to_th»ad_li¡
 = 0;

735 
»t_v®ue
 = 
	`mempoŞ_ü—‹_poŞ
("üm_©Œibu‹s_poŞ", &
mempoŞ_šfo
,

736 &
üm_©Œibu‹s_mempoŞ_g
);

738 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

739 
CRMINIT_EXIT
;

743 
	`üm_g‘_nÙifiÿtiÚ_mempoŞ’Œ›s
(&
nÙifiÿtiÚ_’Œ›s_max
,&
nÙifiÿtiÚ_¡©ic_’Œ›s
);

745 
mempoŞ_šfo
.
mempoŞ_ty³
 = 
MEMPOOL_TYPE_HEAP
;

746 
mempoŞ_šfo
.
block_size
 = (
üm_nÙifiÿtiÚ_­p_hook_šfo
);

747 
mempoŞ_šfo
.
max_blocks
 = 
nÙifiÿtiÚ_’Œ›s_max
;

748 
mempoŞ_šfo
.
¡©ic_blocks
 = 
nÙifiÿtiÚ_¡©ic_’Œ›s
;

749 
mempoŞ_šfo
.
th»shŞd_mš
 = 
nÙifiÿtiÚ_¡©ic_’Œ›s
/10;

750 
mempoŞ_šfo
.
th»shŞd_max
 = 
nÙifiÿtiÚ_¡©ic_’Œ›s
/3;

751 
mempoŞ_šfo
.
»¶’ish_couÁ
 = 
nÙifiÿtiÚ_¡©ic_’Œ›s
/10;

752 
mempoŞ_šfo
.
b_mem£t_nÙ_»quœed
 = 
FALSE
;

753 
mempoŞ_šfo
.
b_li¡_³r_th»ad_»quœed
 = 
FALSE
;

754 
mempoŞ_šfo
.
noof_blocks_to_move_to_th»ad_li¡
 = 0;

756 
»t_v®ue
 = 
	`mempoŞ_ü—‹_poŞ
("üm_nÙifiÿtiÚs_poŞ", &
mempoŞ_šfo
,

757 &
üm_nÙifiÿtiÚs_mempoŞ_g
);

759 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

760 
CRMINIT_EXIT
;

762 
	`üm_g‘_v›w_node_mempoŞ’Œ›s
(&
v›w_node_’Œ›s_max
,&
v›w_node_¡©ic_’Œ›s
);

764 
mempoŞ_šfo
.
mempoŞ_ty³
 = 
MEMPOOL_TYPE_HEAP
;

765 
mempoŞ_šfo
.
block_size
 = (
d©aba£_v›w_node
);

766 
mempoŞ_šfo
.
max_blocks
 = 
v›w_node_’Œ›s_max
;

767 
mempoŞ_šfo
.
¡©ic_blocks
 = 
v›w_node_¡©ic_’Œ›s
;

768 
mempoŞ_šfo
.
th»shŞd_mš
 = 
v›w_node_¡©ic_’Œ›s
/10;

769 
mempoŞ_šfo
.
th»shŞd_max
 = 
v›w_node_¡©ic_’Œ›s
/3;

770 
mempoŞ_šfo
.
»¶’ish_couÁ
 = 
v›w_node_¡©ic_’Œ›s
/10;

771 
mempoŞ_šfo
.
b_mem£t_nÙ_»quœed
 = 
FALSE
;

772 
mempoŞ_šfo
.
b_li¡_³r_th»ad_»quœed
 = 
FALSE
;

773 
mempoŞ_šfo
.
noof_blocks_to_move_to_th»ad_li¡
 = 0;

775 
»t_v®ue
 = 
	`mempoŞ_ü—‹_poŞ
("üm_v›w_node_poŞ", &
mempoŞ_šfo
,

776 &
üm_v›w_node_mempoŞ_g


778 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

779 
CRMINIT_EXIT
;

783 
ii
 = 0; i˜< 
CRM_VN_LAST_NOTIFICATION_TYPE
; ii++)

784 
	`OF_LIST_INIT
(
üm_vn_nÙifiÿtiÚs
[
ii
], 
üm_nÙifiÿtiÚs_ä“_­p_’Œy_rcu
);

786 
ii
 = 0; i˜< 
CRM_PORT_LAST_NOTIFICATION_TYPE
; ii++)

787 
	`OF_LIST_INIT
(
üm_pÜt_nÙifiÿtiÚs
[
ii
], 
üm_nÙifiÿtiÚs_ä“_­p_’Œy_rcu
);

789 
ii
 = 0; i˜< 
CRM_VM_LAST_NOTIFICATION_TYPE
; ii++)

790 
	`OF_LIST_INIT
(
üm_vm_nÙifiÿtiÚs
[
ii
], 
üm_nÙifiÿtiÚs_ä“_­p_’Œy_rcu
);

792 
ii
 = 0; i˜< 
CRM_TENANT_LAST_NOTIFICATION_TYPE
; ii++)

793 
	`OF_LIST_INIT
(
üm_‹ÇÁ_nÙifiÿtiÚs
[
ii
], 
üm_nÙifiÿtiÚs_ä“_­p_’Œy_rcu
);

795  
CRM_SUCCESS
;

797 
CRMINIT_EXIT
:

798 
	`mempoŞ_d–‘e_poŞ
(
üm_vn_mempoŞ_g
);

799 
	`mempoŞ_d–‘e_poŞ
(
üm_vn_compu‹_nodes_mempoŞ_g
);

800 
	`mempoŞ_d–‘e_poŞ
(
üm_‹ÇÁ_vÂames_mempoŞ_g
);

801 
	`mempoŞ_d–‘e_poŞ
(
üm_pÜt_»f_mempoŞ_g
);

802 
	`mempoŞ_d–‘e_poŞ
(
üm_pÜt_mempoŞ_g
);

803 
	`mempoŞ_d–‘e_poŞ
(
üm_vm_mempoŞ_g
);

804 
	`mempoŞ_d–‘e_poŞ
(
üm_‹ÇÁ_mempoŞ_g
);

805 
	`mempoŞ_d–‘e_poŞ
(
üm_subÃt_mempoŞ_g
);

806 
	`mempoŞ_d–‘e_poŞ
(
üm_nÙifiÿtiÚs_mempoŞ_g
);

807 
	`mempoŞ_d–‘e_poŞ
(
üm_©Œibu‹s_mempoŞ_g
);

808 
	`mempoŞ_d–‘e_poŞ
(
üm_v›w_node_mempoŞ_g
);

811 
	`mchash_bË_d–‘e
(
üm_vn_bË_g
);

812 
	`mchash_bË_d–‘e
(
üm_pÜt_bË_g
);

813 
	`mchash_bË_d–‘e
(
üm_vm_bË_g
);

814 
	`mchash_bË_d–‘e
(
üm_subÃt_bË_g
);

815 
	`mchash_bË_d–‘e
(
üm_‹ÇÁ_bË_g
);

817 
	`OF_LOG_MSG
(
OF_LOG_CRM
, 
OF_LOG_ERROR
, "CRM Module Failedo Init!.");

818  
CRM_FAILURE
;

819 
	}
}

821 
št32_t
 
	$üm_unš™
()

823 
št32_t
 
»t_v®ue
 = 
FALSE
;

825 
»t_v®ue
 = 
	`mchash_bË_d–‘e
(
üm_vn_bË_g
);

826 if(
»t_v®ue
 !ğ
MCHASHTBL_SUCCESS
)

827  
»t_v®ue
;

829 
»t_v®ue
 = 
	`mchash_bË_d–‘e
(
üm_pÜt_bË_g
);

830 if(
»t_v®ue
 !ğ
MCHASHTBL_SUCCESS
)

831  
»t_v®ue
;

833 
»t_v®ue
 = 
	`mchash_bË_d–‘e
(
üm_subÃt_bË_g
);

834 if(
»t_v®ue
 !ğ
MCHASHTBL_SUCCESS
)

835  
»t_v®ue
;

837 
»t_v®ue
 = 
	`mchash_bË_d–‘e
(
üm_vm_bË_g
);

838 if(
»t_v®ue
 !ğ
MCHASHTBL_SUCCESS
)

839  
»t_v®ue
;

841 
»t_v®ue
 = 
	`mchash_bË_d–‘e
(
üm_‹ÇÁ_bË_g
);

842 if(
»t_v®ue
 !ğ
MCHASHTBL_SUCCESS
)

843  
»t_v®ue
;

845 
»t_v®ue
 = 
	`mempoŞ_d–‘e_poŞ
(
üm_vn_mempoŞ_g
);

846 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

847  
»t_v®ue
;

849 
»t_v®ue
 = 
	`mempoŞ_d–‘e_poŞ
(
üm_vn_compu‹_nodes_mempoŞ_g
);

850 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

851  
»t_v®ue
;

853 
»t_v®ue
 = 
	`mempoŞ_d–‘e_poŞ
(
üm_‹ÇÁ_vÂames_mempoŞ_g
);

854 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

855  
»t_v®ue
;

857 
»t_v®ue
 = 
	`mempoŞ_d–‘e_poŞ
(
üm_pÜt_mempoŞ_g
);

858 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

859  
»t_v®ue
;

861 
»t_v®ue
 = 
	`mempoŞ_d–‘e_poŞ
(
üm_pÜt_»f_mempoŞ_g
);

862 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

863  
»t_v®ue
;

865 
»t_v®ue
 = 
	`mempoŞ_d–‘e_poŞ
(
üm_vm_mempoŞ_g
);

866 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

867  
»t_v®ue
;

869 
»t_v®ue
 = 
	`mempoŞ_d–‘e_poŞ
(
üm_subÃt_mempoŞ_g
);

870 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

871  
»t_v®ue
;

873 
»t_v®ue
 = 
	`mempoŞ_d–‘e_poŞ
(
üm_‹ÇÁ_mempoŞ_g
);

874 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

875  
»t_v®ue
;

877 
»t_v®ue
 = 
	`mempoŞ_d–‘e_poŞ
(
üm_nÙifiÿtiÚs_mempoŞ_g
);

878 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

879  
»t_v®ue
;

881 
»t_v®ue
 = 
	`mempoŞ_d–‘e_poŞ
(
üm_©Œibu‹s_mempoŞ_g
);

882 if(
»t_v®ue
 !ğ
MEMPOOL_SUCCESS
)

883  
»t_v®ue
;

885  
CRM_SUCCESS
;

886 
	}
}

	@crmtest.c

1 
	~"cÚŒŞËr.h
"

2 
	~"d´m.h
"

3 
	~"üm­i.h
"

4 
	~"üm_vn_­i.h
"

5 
	~"üm_pÜt_­i.h
"

7 
	#üm_debug
 
´štf


	)

8 
ušt64_t
 
	gvm_hªdË1
,
	gvm_hªdË2
,
	gvm_hªdË3
,
	gvm_hªdË4
,
	gvm_hªdË5
;

9 
ušt64_t
 
	g‹ÇÁ_hªdË1
,
	g‹ÇÁ_hªdË2
,
	g‹ÇÁ_hªdË3
,
	g‹ÇÁ_hªdË4
,
	g‹ÇÁ_hªdË5
;

11 
üm_‹ÇÁ_cÚfig_šfo
 
	g‹ÇÁ_cÚfig_šfo1
={};

12 
üm_‹ÇÁ_cÚfig_šfo
 
	g‹ÇÁ_cÚfig_šfo2
={};

13 
üm_‹ÇÁ_cÚfig_šfo
 
	g‹ÇÁ_cÚfig_šfo
={};

15 
üm_vm_cÚfig_šfo
 
	gvm_cÚfig_šfo1
={}, 
	gvm_cÚfig_šfo2
={};

16 
üm_vm_cÚfig_šfo
 
	gvm_cÚfig_šfo
={};

18 
vm_ruÁime_šfo
 
	gruÁime_šfo
;

19 
št32_t
 
	glR‘_v®ue0
,
	glR‘_v®ue1
,
	glR‘_v®ue2
,
	glR‘_v®ue3
,
	glR‘_v®ue4
,
	glR‘_v®ue5
;

21 
´štümhªdË
(
ušt64_t
 
hªdË
);

23 
´štüm»tv®ue
(
št32_t
 
»t_v®ue
);

25 
üm_vm_nÙifiÿtiÚs_cbk
(
ušt32_t
 
nÙifiÿtiÚ_ty³
,

26 
ušt64_t
 
üm_vm_hªdË
,

27 
üm_vm_nÙifiÿtiÚ_d©a
 
nÙifiÿtiÚ_d©a
,

28 *
ÿÎback_¬g1
,

29 *
ÿÎback_¬g2
);

31 
üm_‹¡
();

33 
g‘®l_vms
();

34 
št32_t
 
üm_vm_‹¡
();

37 
ušt64_t
 
	güm_pÜt_hªdË1
,
	güm_pÜt_hªdË2
,
	güm_pÜt_hªdË3
,
	güm_pÜt_hªdË4
,
	güm_pÜt_hªdË5
;

38 
ušt64_t
 
	güm_pÜt_hªdË6
,
	güm_pÜt_hªdË7
,
	güm_pÜt_hªdË8
,
	güm_pÜt_hªdË9
,
	güm_pÜt_hªdË10
;

39 
ušt64_t
 
	güm_pÜt_hªdË11
;

42 
	$´štv®ues_vm
()

44 
	`´štf
("\r\ÀVœtu® MachšNamğ%s",
vm_cÚfig_šfo
.
vm_Çme
);

45 
	`´štf
("\r\ÀVœtu® Machš Ty³ = %d",
vm_cÚfig_šfo
.
vm_ty³
);

47 
	`´štf
("\r\ÀVœtu® MachšSw™ch Namğ%s",
vm_cÚfig_šfo
.
sw™ch_Çme
);

48 
	`´štf
("\r\ÀVœtu® MachšT’ªˆNamğ%s",
vm_cÚfig_šfo
.
‹ÇÁ_Çme
);

50 
	}
}

52 
	$´štv®ues_‹ÇÁ
()

55 
	`´štf
("\r\ÀT’ªˆNamğ%s",
‹ÇÁ_cÚfig_šfo
.
‹ÇÁ_Çme
);

56 
	}
}

58 
	$´štümhªdË
(
ušt64_t
 
hªdË
)

60 
ii
;

61 
uch¬8_t
 *
ümhªdË
;

63 
	`´štf
(" handle = ");

64 
ümhªdË
 =(
uch¬8_t
 *)(&
hªdË
);

65 
ii
=0;ii<8;ii++)

66 
	`´štf
(" %x",
ümhªdË
[
ii
]);

67 
	}
}

70 
	$´štüm»tv®ue
(
št32_t
 
»t_v®ue
)

72 if(
»t_v®ue
 =ğ
CRM_ERROR_INVALID_VM_TYPE
)

73 
	`üm_debug
("\r\n Virtual Machine Type Invalid!. \r\n");

74 if(
»t_v®ue
 =ğ
CRM_ERROR_DUPLICATE_VM_RESOURCE
)

75 
	`üm_debug
("\r\n Virtual Machine Type Duplicate!. \r\n");

76 if(
»t_v®ue
 =ğ
CRM_ERROR_VM_NAME_INVALID
)

77 
	`üm_debug
("\r\n Virtual Machine Name‚ot in database!. \r\n");

78 if(
»t_v®ue
 =ğ
CRM_ERROR_VM_NAME_NULL
)

79 
	`üm_debug
("\r\n Virtual Machine Name‚ull!. \r\n");

80 if(
»t_v®ue
 =ğ
CRM_ERROR_NO_MORE_ENTRIES
)

81 
	`üm_debug
("\r\n No More Entries inhe database \r\n");

82 if(
»t_v®ue
 =ğ
CRM_ERROR_TENANT_NAME_INVALID
)

83 
	`üm_debug
("\r\n Tenant‚ame invalid \r\n");

84 if(
»t_v®ue
 =ğ
CRM_ERROR_DUPLICATE_TENANT_RESOURCE
)

85 
	`üm_debug
("\r\n Tenant‚ame duplicate \r\n");

86 if(
»t_v®ue
 =ğ
CRM_ERROR_TENANT_ADD_FAIL
)

87 
	`üm_debug
("\r\n Tenant‡dd fail\r\n");

90 
	}
}

92 
	$üm_vm_nÙifiÿtiÚs_cbk
(
ušt32_t
 
nÙifiÿtiÚ_ty³
,

93 
ušt64_t
 
üm_vm_hªdË
,

94 
üm_vm_nÙifiÿtiÚ_d©a
 
nÙifiÿtiÚ_d©a
,

95 *
ÿÎback_¬g1
,

96 *
ÿÎback_¬g2
)

98 
	`´štf
("\r\n **************************************************************************");

99 
	`´štf
("\r\n CRM Virtial Machine Notificatio Call back invoked");

101 
	`´štf
("\r\ÀVœtu® MachšNam = %s",
nÙifiÿtiÚ_d©a
.
vm_Çme
);

102 
	`´štf
("\r\Àüm‚ÙifiÿtiÚy³ = %d",
nÙifiÿtiÚ_ty³
);

104 if(
nÙifiÿtiÚ_ty³
 == 0)

105 
	`´štf
("\r\n CRM_VM_ALL_NOTIFICATIONS");

106 if(
nÙifiÿtiÚ_ty³
 == 1)

107 
	`´štf
("\r\n CRM_VM_ADDED");

108 if(
nÙifiÿtiÚ_ty³
 == 2)

109 
	`´štf
("\r\n CRM_VM_DELETE");

110 if(
nÙifiÿtiÚ_ty³
 == 3)

111 
	`´štf
("\r\n CRM_VM_MODIFIED");

113 
	`´štf
("\r\ÀÿÎback‡rg1 = %d",*(
ušt32_t
 *)
ÿÎback_¬g1
);

114 
	`´štf
("\r\ÀÿÎback‡rg2 = %d",*(
ušt32_t
 *)
ÿÎback_¬g2
);

115 
	`´štf
("\r\n ******************************************************************************\r\n");

116 
	}
}

121 
	$üm_‹ÇÁ_nÙifiÿtiÚ_cbk
(
ušt32_t
 
nÙifiÿtiÚ_ty³
,

122 
ušt64_t
 
‹ÇÁ_hªdË
,

123 
üm_‹ÇÁ_nÙifiÿtiÚ_d©a
 
nÙifiÿtiÚ_d©a
,

124 *
ÿÎback_¬g1
,

125 *
ÿÎback_¬g2
)

127 
	`´štf
("\r\n **************************************************************************");

128 
	`´štf
("\r\n CRM Tenant Notification Call back invoked");

130 
	`´štf
("\r\ÀT’ªˆNam = %s",
nÙifiÿtiÚ_d©a
.
‹ÇÁ_Çme
);

131 
	`´štf
("\r\Àüm‚ÙifiÿtiÚy³ = %d",
nÙifiÿtiÚ_ty³
);

132 
	`´štümhªdË
(
‹ÇÁ_hªdË
);

134 if(
nÙifiÿtiÚ_ty³
 == 0)

135 
	`´štf
("\r\n CRM_TENANT_ALL_NOTIFICATIONS");

136 if(
nÙifiÿtiÚ_ty³
 == 1)

137 
	`´štf
("\r\n CRM_TENANT_ADDED");

138 if(
nÙifiÿtiÚ_ty³
 == 2)

139 
	`´štf
("\r\n CRM_TENANT_DELETE");

140 if(
nÙifiÿtiÚ_ty³
 == 3)

141 
	`´štf
("\r\n CRM_TENANT_MODIFIED");

143 
	`´štf
("\r\ÀÿÎback‡rg1 = %d",*(
ušt32_t
 *)
ÿÎback_¬g1
);

144 
	`´štf
("\r\ÀÿÎback‡rg2 = %d",*(
ušt32_t
 *)
ÿÎback_¬g2
);

145 
	`´štf
("\r\n ******************************************************************************\r\n");

148 
	}
}

150 
	$üm_‹¡
()

152 
	`üm_‹ÇÁ_‹¡
();

154 
	`üm_vm_‹¡
();

156 
	`üm_vn_‹¡
();

158 
	`üm_compu‹node_‹¡
();

160 
	`üm_vmpÜt_‹¡
();

161 
	`üm_g‘_vmpÜt_v›w_db
();

162 
	`üm_vmpÜt_d–_‹¡
();

163 
	`üm_g‘_vmpÜt_v›w_db
();

166 
	`üm_nwpÜt_uniÿ¡_‹¡
();

167 
	`üm_g‘_nwpÜt_uniÿ¡_v›w_db
();

168 
	`üm_nwpÜt_uniÿ¡_d–_‹¡
();

169 
	`üm_g‘_nwpÜt_uniÿ¡_v›w_db
();

171 
	`üm_nwpÜt_brßdÿ¡_add_‹¡
();

172 
	`üm_g‘_nwpÜt_brßdÿ¡_v›w_db
();

173 
	`üm_nwpÜt_brßdÿ¡_d–_‹¡
();

174 
	`üm_g‘_nwpÜt_brßdÿ¡_v›w_db
();

175 
	}
}

185 
št32_t
 
	$üm_‹ÇÁ_‹¡
()

187 
št32_t
 
»t_v®
;

188 
ušt32_t
 
ÿÎback_¬g1
 = 2;

189 
ušt32_t
 
ÿÎback_¬g2
 = 3;

192 
	`´štf
("\r\n*********************************************************************\n");

193 
	`´štf
("\r\n CRMenantest begins\n");

194 
	`´štf
("\r\n*********************************************************************\n");

195 
	`´štf
("\r\n Addingenant1.....\n");

196 
	`¡rıy
(
‹ÇÁ_cÚfig_šfo1
.
‹ÇÁ_Çme
, "tenant1");

197 
»t_v®
 = 
	`üm_add_‹ÇÁ
(&
‹ÇÁ_cÚfig_šfo1
,&
‹ÇÁ_hªdË1
);

198 
	`´štüm»tv®ue
(
»t_v®
);

199 if(
»t_v®
==
CRM_SUCCESS
)

201 
	`´štümhªdË
(
‹ÇÁ_hªdË1
);

202 
	`´štf
("\r\nenant1‡dded successfully!.\n");

205 
	`´štf
("\r\n failedo‡ddenant1!.\n");

208 
	}
}

210 
št32_t
 
	$üm_vm_‹¡
()

212 
ušt32_t
 
ÿÎback_¬g1
 = 2;

213 
ušt32_t
 
ÿÎback_¬g2
 = 3;

214 
	`´štf
("\r\n*********************************************************************\n");

215 
	`´štf
("\r\n CRM Virtual Machineest begins\n");

216 
	`´štf
("\r\n*********************************************************************\n");

218 
	`´štf
("\r\n Adding virtual machineo DB = (VM1,VM_TYPE_NORMAL_APPLICATION,tenant1,SWITCH-1)\n");

220 
	`¡rıy
(
vm_cÚfig_šfo1
.
vm_Çme
, "VM1");

221 
	`¡rıy
(
vm_cÚfig_šfo1
.
‹ÇÁ_Çme
,"tenant1");

222 
	`¡rıy
(
vm_cÚfig_šfo1
.
sw™ch_Çme
,"SWITCH-1");

223 
vm_cÚfig_šfo1
.
vm_ty³
 = 
VM_TYPE_NORMAL_APPLICATION
;

224 
lR‘_v®ue1
 = 
	`üm_add_vœtu®_machše
(&
vm_cÚfig_šfo1
, &
vm_hªdË1
);

225 
	`´štf
("lR‘_v®ue1=:%d\n",
lR‘_v®ue1
);

226 
	`´štüm»tv®ue
(
lR‘_v®ue1
);

227 if(
lR‘_v®ue1
 =ğ
CRM_SUCCESS
)

229 
	`´štümhªdË
(
vm_hªdË1
);

230 
	`´štf
("\r\n **** Virtual Machine Addedo DB successfully****\n");

233 
	`´štf
("\r\n Virtual Machine Addedo DB failed\n");

237 
	}
}

238 
št32_t
 
	$üm_vn_‹¡
()

240 
üm_vn_cÚfig_šfo
 
cÚfig_šfo
={};

241 
št32_t
 
»tuº_v®ue
;

242 
ušt64_t
 
üm_vn_hªdË
;

244 
	`´štf
("\r\n*********************************************************************\n");

245 
	`´štf
("\r\n CRM Virtual Networkest begins\n");

246 
	`´štf
("\r\n*********************************************************************\n");

248 
	`´štf
("\r\n Adding virtual‚etworko DB = (VN1,tenant1,VXLNA_TYPE,10,5000)\n");

250 
	`¡rıy
(
cÚfig_šfo
.
nw_Çme
,"VN1");

251 
	`¡rıy
(
cÚfig_šfo
.
‹ÇÁ_Çme
,"tenant1");

252 
cÚfig_šfo
.
nw_ty³
=
VXLAN_TYPE
;

253 
cÚfig_šfo
.
nw_·¿ms
.
vxÏn_nw
.
vxÏn_vni
=10;

254 
cÚfig_šfo
.
nw_·¿ms
.
vxÏn_nw
.
vxÏn_£rviû_pÜt
=5000;

255 
»tuº_v®ue
 =
	`üm_add_vœtu®_ÃtwÜk
(&
cÚfig_šfo
, &
üm_vn_hªdË
);

256 ià(
»tuº_v®ue
 !ğ
CRM_SUCCESS
)

258 
	`´štf
("\r\nfailedo‡dd (VN1,tenant1,VXLNA_TYPE,10,5000)\n");

261 
	`´štf
("\r\n Virtual‚etwork‡dded successfully\n");

263  
CRM_SUCCESS
;

264 
	}
}

268 
št32_t
 
	$üm_compu‹node_‹¡
()

270 
št32_t
 
»tuº_v®ue
 = 
	`üm_add_üm_compu‹_node_to_vn
("VN1", "SWITCH-1", "dp1");

271 ià(
»tuº_v®ue
 !ğ
CRM_SUCCESS
)

273 
	`´štf
("\r\nfailedo‡dd (VN1,SWITCH-1,dp1)\n");

276 
	`´štf
("\r\n compute‚ode‡dded successfully\n");

277  
CRM_SUCCESS
;

278 
	}
}

279 
št32_t
 
	$üm_nwpÜt_uniÿ¡_d–_‹¡
()

281 
	`´štf
("\r\n*********************************************************************\n");

282 
	`´štf
("\r\n CRM Virtual Network Unicast Port delest begins\n");

283 
	`´štf
("\r\n*********************************************************************\n");

285 
št32_t
 
»t_v®
;

286 
»t_v®
ğ
	`üm_d–_nwpÜt_äom_vxn_uniÿ¡_pÜt_v›w
(
üm_pÜt_hªdË6
,1000);

287 if(
»t_v®
=ğ
CRM_SUCCESS
)

289 
	`´štf
("\r\n unicast…ort(eth6) view‚ode deleted\n");

292 
	`´štf
("\r\n failedo delete unicast…ort (eth6)\n");

294 
»t_v®
ğ
	`üm_d–_nwpÜt_äom_vxn_uniÿ¡_pÜt_v›w
(
üm_pÜt_hªdË7
,2000);

295 if(
»t_v®
=ğ
CRM_SUCCESS
)

297 
	`´štf
("\r\n unicast…ort(eth7) view‚ode deleted\n");

300 
	`´štf
("\r\n failedo delete unicast…ort (eth7)\n");

302 
»t_v®
ğ
	`üm_d–_nwpÜt_äom_vxn_uniÿ¡_pÜt_v›w
(
üm_pÜt_hªdË8
,3000);

303 if(
»t_v®
=ğ
CRM_SUCCESS
)

305 
	`´štf
("\r\n unicast…ort(eth8) view‚ode deleted\n");

308 
	`´štf
("\r\n failedo delete unicast…ort (eth8)\n");

313 
	}
}

314 
št32_t
 
	$üm_nwpÜt_uniÿ¡_‹¡
()

316 
št32_t
 
»t_v®
;

317 
üm_nwpÜt_cÚfig_šfo
 
nwpÜt_cÚfig_šfo
 ={};

318 
	`´štf
("\r\n*********************************************************************\n");

319 
	`´štf
("\r\n CRM Virtual Network Unicast Portest begins\n");

320 
	`´štf
("\r\n*********************************************************************\n");

322 
	`´štf
("\r\n Adding virtual‚etwork‚wporto DB = (eth6)\n");

323 
	`¡rıy
(
nwpÜt_cÚfig_šfo
.
pÜt_Çme
,"eth6");

324 
nwpÜt_cÚfig_šfo
.
pÜtId
=111;

325 
nwpÜt_cÚfig_šfo
.
nw_ty³
=
VXLAN_TYPE
;

326 
	`¡rıy
(
nwpÜt_cÚfig_šfo
.
sw™ch_Çme
,"SWITCH-1");

327 
	`¡rıy
(
nwpÜt_cÚfig_šfo
.
br_Çme
,"dp1");

328 
nwpÜt_cÚfig_šfo
.
nw_pÜt_cÚfig_šfo
.
vxÏn_šfo
.
vxÏn_vni
=10;

329 
nwpÜt_cÚfig_šfo
.
nw_pÜt_cÚfig_šfo
.
vxÏn_šfo
.
vxÏn_£rviû_pÜt
=1000;

330 
nwpÜt_cÚfig_šfo
.
nw_pÜt_cÚfig_šfo
.
vxÏn_šfo
.
»mÙe_
=0;

331 
»t_v®
 = 
	`üm_add_üm_nwpÜt
(&
nwpÜt_cÚfig_šfo
, &
üm_pÜt_hªdË6
);

332 if(
»t_v®
=ğ
CRM_SUCCESS
)

334 
»t_v®
ğ
	`üm_add_nwpÜt_to_vxn_uniÿ¡_pÜt_v›w
(
üm_pÜt_hªdË6
,1000);

335 if(
»t_v®
=ğ
CRM_SUCCESS
)

337 
	`´štf
("\r\n unicast…ort(eth6) view‚ode‡dded\n");

340 
	`´štf
("\r\n failedo‡dd unicast…ort (eth6)\n");

343 
	`´štf
("\r\n failedo‡dd‚etwork…ortƒth6\n");

346 
	`´štf
("\r\n Adding virtual‚etwork‚wporto DB = (eth7)\n");

347 
	`¡rıy
(
nwpÜt_cÚfig_šfo
.
pÜt_Çme
,"eth7");

348 
nwpÜt_cÚfig_šfo
.
pÜtId
=222;

349 
nwpÜt_cÚfig_šfo
.
nw_ty³
=
VXLAN_TYPE
;

350 
	`¡rıy
(
nwpÜt_cÚfig_šfo
.
sw™ch_Çme
,"SWITCH-1");

351 
	`¡rıy
(
nwpÜt_cÚfig_šfo
.
br_Çme
,"dp1");

352 
nwpÜt_cÚfig_šfo
.
nw_pÜt_cÚfig_šfo
.
vxÏn_šfo
.
vxÏn_vni
=20;

353 
nwpÜt_cÚfig_šfo
.
nw_pÜt_cÚfig_šfo
.
vxÏn_šfo
.
vxÏn_£rviû_pÜt
=2000;

354 
nwpÜt_cÚfig_šfo
.
nw_pÜt_cÚfig_šfo
.
vxÏn_šfo
.
»mÙe_
=0;

355 
»t_v®
 = 
	`üm_add_üm_nwpÜt
(&
nwpÜt_cÚfig_šfo
, &
üm_pÜt_hªdË7
);

356 if(
»t_v®
=ğ
CRM_SUCCESS
)

358 
»t_v®
ğ
	`üm_add_nwpÜt_to_vxn_uniÿ¡_pÜt_v›w
(
üm_pÜt_hªdË7
,2000);

359 if(
»t_v®
=ğ
CRM_SUCCESS
)

361 
	`´štf
("\r\n unicast…ort(eth7) view‚ode‡dded\n");

364 
	`´štf
("\r\n failedo‡dd unicast…ort (eth7)\n");

367 
	`´štf
("\r\n failedo‡dd‚etwork…ortƒth7\n");

369 
	`´štf
("\r\n Adding virtual‚etwork‚wporto DB = (eth8)\n");

370 
	`¡rıy
(
nwpÜt_cÚfig_šfo
.
pÜt_Çme
,"eth8");

371 
nwpÜt_cÚfig_šfo
.
pÜtId
=333;

372 
nwpÜt_cÚfig_šfo
.
nw_ty³
=
VXLAN_TYPE
;

373 
	`¡rıy
(
nwpÜt_cÚfig_šfo
.
sw™ch_Çme
,"SWITCH-1");

374 
	`¡rıy
(
nwpÜt_cÚfig_šfo
.
br_Çme
,"dp1");

375 
nwpÜt_cÚfig_šfo
.
nw_pÜt_cÚfig_šfo
.
vxÏn_šfo
.
vxÏn_vni
=30;

376 
nwpÜt_cÚfig_šfo
.
nw_pÜt_cÚfig_šfo
.
vxÏn_šfo
.
vxÏn_£rviû_pÜt
=3000;

377 
nwpÜt_cÚfig_šfo
.
nw_pÜt_cÚfig_šfo
.
vxÏn_šfo
.
»mÙe_
=0;

378 
»t_v®
 = 
	`üm_add_üm_nwpÜt
(&
nwpÜt_cÚfig_šfo
, &
üm_pÜt_hªdË8
);

379 if(
»t_v®
=ğ
CRM_SUCCESS
)

381 
»t_v®
ğ
	`üm_add_nwpÜt_to_vxn_uniÿ¡_pÜt_v›w
(
üm_pÜt_hªdË8
,3000);

382 if(
»t_v®
=ğ
CRM_SUCCESS
)

384 
	`´štf
("\r\n unicast…ort(eth8) view‚ode‡dded\n");

387 
	`´štf
("\r\n failedo‡dd unicast…ort (eth8)\n");

390 
	`´štf
("\r\n failedo‡dd‚etwork…ortƒth8\n");

394 
	}
}

396 
št32_t
 
	$üm_g‘_nwpÜt_uniÿ¡_v›w_db
()

398 
št32_t
 
»t_v®
;

399 
ušt32_t
 
pÜt_id
;

401 
	`´štf
("####################### crm_get_nwport_unicast_view_db #############################\n");

402 
»t_v®
 = 
	`üm_g‘_vxn_uniÿ¡_nwpÜt_by_swÇme_¥
("SWITCH-1",1000, &
pÜt_id
);

403 if(
»t_v®
==
CRM_SUCCESS
)

405 
	`´štf
Ğ"pÜtid:%d\r\n",
pÜt_id
);

409 
	`´štf
("\r\n failedo get view‚ode\n");

411 
»t_v®
 = 
	`üm_g‘_vxn_uniÿ¡_nwpÜt_by_swÇme_¥
("SWITCH-1",2000, &
pÜt_id
);

412 if(
»t_v®
==
CRM_SUCCESS
)

414 
	`´štf
Ğ"pÜtid:%d\r\n",
pÜt_id
);

418 
	`´štf
("\r\n failedo get view‚ode\n");

420 
»t_v®
 = 
	`üm_g‘_vxn_uniÿ¡_nwpÜt_by_swÇme_¥
("SWITCH-1",3000, &
pÜt_id
);

421 if(
»t_v®
==
CRM_SUCCESS
)

423 
	`´štf
Ğ"pÜtid:%d\r\n",
pÜt_id
);

427 
	`´štf
("\r\n failedo get view‚ode\n");

429 
	`´štf
("####################################################\n");

430  
CRM_SUCCESS
;

432 
	}
}

433 
št32_t
 
	$üm_nwpÜt_brßdÿ¡_d–_‹¡
()

435 
št32_t
 
»t_v®
;

436 
»t_v®
 = 
	`üm_d–_nwpÜt_äom_vxn_brßdÿ¡_pÜt_v›w
(
üm_pÜt_hªdË9
,

440 if(
»t_v®
=ğ
CRM_SUCCESS
)

442 
	`´štf
("\r\n broadcast…ort(eth9) view‚ode deleted\n");

445 
	`´štf
("\r\n failedo delete broadcast…ort (eth9)\n");

447 
»t_v®
 = 
	`üm_d–_nwpÜt_äom_vxn_brßdÿ¡_pÜt_v›w
(
üm_pÜt_hªdË10
,

451 if(
»t_v®
=ğ
CRM_SUCCESS
)

453 
	`´štf
("\r\n broadcast…ort(eth10) view‚ode deleted\n");

456 
	`´štf
("\r\n failedo delete broadcast…ort (eth10)\n");

458 
»t_v®
 = 
	`üm_d–_nwpÜt_äom_vxn_brßdÿ¡_pÜt_v›w
(
üm_pÜt_hªdË11
,

462 if(
»t_v®
=ğ
CRM_SUCCESS
)

464 
	`´štf
("\r\n broadcast…ort(eth11) view‚ode deleted\n");

467 
	`´štf
("\r\n failedo delete broadcast…ort (eth11)\n");

470 
	}
}

471 
št32_t
 
	$üm_nwpÜt_brßdÿ¡_add_‹¡
()

473 
št32_t
 
»t_v®
;

474 
ušt64_t
 
üm_pÜt_hªdË
=0;

475 
üm_nwpÜt_cÚfig_šfo
 
nwpÜt_cÚfig_šfo
 ={};

476 
	`´štf
("\r\n*********************************************************************\n");

477 
	`´štf
("\r\n CRM Virtual Network Broadcast Port Test Begins\n");

478 
	`´štf
("\r\n*********************************************************************\n");

479 
	`´štf
("\r\n Adding virtual‚etwork broadcast‚wporto DB = (eth9)\n");

480 
	`¡rıy
(
nwpÜt_cÚfig_šfo
.
pÜt_Çme
,"eth9");

481 
nwpÜt_cÚfig_šfo
.
pÜtId
=111;

482 
nwpÜt_cÚfig_šfo
.
nw_ty³
=
VXLAN_TYPE
;

483 
	`¡rıy
(
nwpÜt_cÚfig_šfo
.
sw™ch_Çme
,"SWITCH-1");

484 
	`¡rıy
(
nwpÜt_cÚfig_šfo
.
br_Çme
,"dp1");

485 
nwpÜt_cÚfig_šfo
.
nw_pÜt_cÚfig_šfo
.
vxÏn_šfo
.
vxÏn_vni
=10;

486 
nwpÜt_cÚfig_šfo
.
nw_pÜt_cÚfig_šfo
.
vxÏn_šfo
.
vxÏn_£rviû_pÜt
=1000;

487 
nwpÜt_cÚfig_šfo
.
nw_pÜt_cÚfig_šfo
.
vxÏn_šfo
.
»mÙe_
=0x01020304;

488 
»t_v®
 = 
	`üm_add_üm_nwpÜt
(&
nwpÜt_cÚfig_šfo
, &
üm_pÜt_hªdË9
);

489 if(
»t_v®
=ğ
CRM_SUCCESS
)

491 
»t_v®
ğ
	`üm_add_nwpÜt_to_vxn_brßdÿ¡_pÜt_v›w
(
üm_pÜt_hªdË9
,

492 
nwpÜt_cÚfig_šfo
.
nw_pÜt_cÚfig_šfo
.
vxÏn_šfo
.
vxÏn_£rviû_pÜt
,

494 
nwpÜt_cÚfig_šfo
.
nw_pÜt_cÚfig_šfo
.
vxÏn_šfo
.
»mÙe_
);

495 if(
»t_v®
=ğ
CRM_SUCCESS
)

497 
	`´štf
("\r\n broadcast…ort(eth9) view‚ode‡dded\n");

500 
	`´štf
("\r\n failedo‡dd broadcast…ort (eth9)\n");

503 
	`´štf
("\r\n failedo‡dd‚etwork…ortƒth9\n");

508 
	`´štf
("\r\n Adding virtual‚etwork broadcast‚wporto DB = (eth10)\n");

509 
	`¡rıy
(
nwpÜt_cÚfig_šfo
.
pÜt_Çme
,"eth10");

510 
nwpÜt_cÚfig_šfo
.
pÜtId
=222;

511 
nwpÜt_cÚfig_šfo
.
nw_ty³
=
VXLAN_TYPE
;

512 
	`¡rıy
(
nwpÜt_cÚfig_šfo
.
sw™ch_Çme
,"SWITCH-1");

513 
	`¡rıy
(
nwpÜt_cÚfig_šfo
.
br_Çme
,"dp1");

514 
nwpÜt_cÚfig_šfo
.
nw_pÜt_cÚfig_šfo
.
vxÏn_šfo
.
vxÏn_vni
=20;

515 
nwpÜt_cÚfig_šfo
.
nw_pÜt_cÚfig_šfo
.
vxÏn_šfo
.
vxÏn_£rviû_pÜt
=2000;

516 
nwpÜt_cÚfig_šfo
.
nw_pÜt_cÚfig_šfo
.
vxÏn_šfo
.
»mÙe_
=0x05060708;

517 
»t_v®
 = 
	`üm_add_üm_nwpÜt
(&
nwpÜt_cÚfig_šfo
, &
üm_pÜt_hªdË10
);

518 if(
»t_v®
=ğ
CRM_SUCCESS
)

520 
»t_v®
ğ
	`üm_add_nwpÜt_to_vxn_brßdÿ¡_pÜt_v›w
(
üm_pÜt_hªdË10
,

521 
nwpÜt_cÚfig_šfo
.
nw_pÜt_cÚfig_šfo
.
vxÏn_šfo
.
vxÏn_£rviû_pÜt
,

523 
nwpÜt_cÚfig_šfo
.
nw_pÜt_cÚfig_šfo
.
vxÏn_šfo
.
»mÙe_
);

524 if(
»t_v®
=ğ
CRM_SUCCESS
)

526 
	`´štf
("\r\n broadcast…ort(eth10) view‚ode‡dded\n");

529 
	`´štf
("\r\n failedo‡dd broadcast…ort (eth10)\n");

532 
	`´štf
("\r\n failedo‡dd‚etwork broadcast…ortƒth10\n");

535 
	`´štf
("\r\n Adding virtual‚etwork broadcast‚wporto DB = (eth11)\n");

536 
	`¡rıy
(
nwpÜt_cÚfig_šfo
.
pÜt_Çme
,"eth11");

537 
nwpÜt_cÚfig_šfo
.
pÜtId
=333;

538 
nwpÜt_cÚfig_šfo
.
nw_ty³
=
VXLAN_TYPE
;

539 
	`¡rıy
(
nwpÜt_cÚfig_šfo
.
sw™ch_Çme
,"SWITCH-1");

540 
	`¡rıy
(
nwpÜt_cÚfig_šfo
.
br_Çme
,"dp1");

541 
nwpÜt_cÚfig_šfo
.
nw_pÜt_cÚfig_šfo
.
vxÏn_šfo
.
vxÏn_vni
=30;

542 
nwpÜt_cÚfig_šfo
.
nw_pÜt_cÚfig_šfo
.
vxÏn_šfo
.
vxÏn_£rviû_pÜt
=3000;

543 
nwpÜt_cÚfig_šfo
.
nw_pÜt_cÚfig_šfo
.
vxÏn_šfo
.
»mÙe_
=0x09010203;

544 
»t_v®
 = 
	`üm_add_üm_nwpÜt
(&
nwpÜt_cÚfig_šfo
, &
üm_pÜt_hªdË11
);

545 if(
»t_v®
=ğ
CRM_SUCCESS
)

547 
»t_v®
ğ
	`üm_add_nwpÜt_to_vxn_brßdÿ¡_pÜt_v›w
(
üm_pÜt_hªdË11
,

548 
nwpÜt_cÚfig_šfo
.
nw_pÜt_cÚfig_šfo
.
vxÏn_šfo
.
vxÏn_£rviû_pÜt
,

550 
nwpÜt_cÚfig_šfo
.
nw_pÜt_cÚfig_šfo
.
vxÏn_šfo
.
»mÙe_
);

551 if(
»t_v®
=ğ
CRM_SUCCESS
)

553 
	`´štf
("\r\n broadcast…ort(eth11) view‚ode‡dded\n");

556 
	`´štf
("\r\n failedo‡dd broadcast…ort (eth11)\n");

559 
	`´štf
("\r\n failedo‡dd‚etwork…ortƒth11\n");

561 
	}
}

563 
št32_t
 
	$üm_g‘_nwpÜt_brßdÿ¡_v›w_db
()

565 
št32_t
 
»t_v®
;

566 
ušt32_t
 
pÜt_ids
[10];

567 
ušt8_t
 
no_of_pÜts
=10;

569 
	`´štf
("####################### crm_get_nwport_broadcast_view_db #############################\n");

570 
»t_v®
 = 
	`üm_g‘_vxn_brßdÿ¡_nwpÜts_by_swÇme_vni_¥
("SWITCH-1",1000, 10, &
no_of_pÜts
, 
pÜt_ids
);

571 if(
»t_v®
==
CRM_SUCCESS
)

573 
	`´štf
Ğ"no_of_pÜts:%d,pÜtid:%d\r\n",
no_of_pÜts
,
pÜt_ids
[0]);

577 
	`´štf
("\r\n failedo get view‚ode\n");

579 
no_of_pÜts
=10;

580 
»t_v®
 = 
	`üm_g‘_vxn_brßdÿ¡_nwpÜts_by_swÇme_vni_¥
("SWITCH-1",2000, 20, &
no_of_pÜts
, 
pÜt_ids
);

581 if(
»t_v®
==
CRM_SUCCESS
)

583 
	`´štf
Ğ"no_of_pÜts:%d,pÜtid:%d\r\n",
no_of_pÜts
,
pÜt_ids
[0]);

587 
	`´štf
("\r\n failedo get view‚ode\n");

589 
no_of_pÜts
=10;

590 
»t_v®
 = 
	`üm_g‘_vxn_brßdÿ¡_nwpÜts_by_swÇme_vni_¥
("SWITCH-1",3000, 30, &
no_of_pÜts
,
pÜt_ids
);

591 if(
»t_v®
==
CRM_SUCCESS
)

593 
	`´štf
Ğ"no_of_pÜts:%d,pÜtid:%d\r\n",
no_of_pÜts
,
pÜt_ids
[0]);

597 
	`´štf
("\r\n failedo get view‚ode\n");

599 
	`´štf
("####################################################\n");

600  
CRM_SUCCESS
;

603 
	}
}

605 
št32_t
 
	$üm_vmpÜt_d–_‹¡
()

607 
št32_t
 
»t_v®
;

608 
	`´štf
("####################################################\n");

609 
	`´štf
("\r\n*********************************************************************\n");

610 
	`´štf
("\r\n CRM Virtual Network VM Port Delete Test Begins\n");

611 
	`´štf
("\r\n*********************************************************************\n");

613 
	`´štf
("\r\n Deletingƒth1 view‚ode from dmac view\n");

614 
»t_v®
 = 
	`üm_d–_vmpÜt_äom_vmside_pÜtmac_v›w
(
üm_pÜt_hªdË1
,10);

615 if(
»t_v®
==
CRM_SUCCESS
)

616 
	`´štf
("\r\n vm…ort(eth1) view‚ode deleted successfully\n");

618 
	`´štf
("\r\n failedo delete view‚ode(eth1) fromhe db view\n");

620 
	`´štf
("\r\n Deletingƒth1 view‚ode from swname view\n");

621 
»t_v®
 = 
	`üm_d–_vmpÜt_äom_vmside_swÇme_v›w
(
üm_pÜt_hªdË1
,10);

622 if(
»t_v®
==
CRM_SUCCESS
)

623 
	`´štf
("\r\n vm…ort(eth1) view‚ode deleted successfully\n");

625 
	`´štf
("\r\n failedo delete view‚ode(eth1) fromhe db view\n");

627 
	`´štf
("\r\n Deletingƒth2 view‚ode from dmac view\n");

628 
»t_v®
 = 
	`üm_d–_vmpÜt_äom_vmside_pÜtmac_v›w
(
üm_pÜt_hªdË2
,20);

629 if(
»t_v®
==
CRM_SUCCESS
)

630 
	`´štf
("\r\n vm…ort(eth1) view‚ode deleted successfully\n");

632 
	`´štf
("\r\n failedo delete view‚ode(eth1) fromhe db view\n");

633 
	`´štf
("\r\n Deletingƒth2 view‚ode from swname view\n");

634 
»t_v®
 = 
	`üm_d–_vmpÜt_äom_vmside_swÇme_v›w
(
üm_pÜt_hªdË2
,20);

635 if(
»t_v®
==
CRM_SUCCESS
)

636 
	`´štf
("\r\n vm…ort(eth2) view‚ode deleted successfully\n");

638 
	`´štf
("\r\n failedo delete view‚ode(eth2) fromhe db view\n");

640 
	`´štf
("\r\n Deletingƒth3 view‚ode from dmac view\n");

641 
»t_v®
 = 
	`üm_d–_vmpÜt_äom_vmside_pÜtmac_v›w
(
üm_pÜt_hªdË3
,30);

642 if(
»t_v®
==
CRM_SUCCESS
)

643 
	`´štf
("\r\n vm…ort(eth3) view‚ode deleted successfully\n");

645 
	`´štf
("\r\n failedo delete view‚ode(eth3) fromhe db view\n");

646 
	`´štf
("\r\n Deletingƒth3 view‚ode from swname view\n");

647 
»t_v®
 = 
	`üm_d–_vmpÜt_äom_vmside_swÇme_v›w
(
üm_pÜt_hªdË3
,30);

648 if(
»t_v®
==
CRM_SUCCESS
)

649 
	`´štf
("\r\n vm…ort(eth3) view‚ode deleted successfully\n");

651 
	`´štf
("\r\n failedo delete view‚ode(eth3) fromhe db view\n");

653 
	`´štf
("\r\n Deletingƒth4 view‚ode from dmac view\n");

654 
»t_v®
 = 
	`üm_d–_vmpÜt_äom_vmside_pÜtmac_v›w
(
üm_pÜt_hªdË4
,40);

655 if(
»t_v®
==
CRM_SUCCESS
)

656 
	`´štf
("\r\n vm…ort(eth4) view‚ode deleted successfully\n");

658 
	`´štf
("\r\n failedo delete view‚ode(eth4) fromhe db view\n");

659 
	`´štf
("\r\n Deletingƒth4 view‚ode from swname view\n");

660 
»t_v®
 = 
	`üm_d–_vmpÜt_äom_vmside_swÇme_v›w
(
üm_pÜt_hªdË4
,40);

661 if(
»t_v®
==
CRM_SUCCESS
)

662 
	`´štf
("\r\n vm…ort(eth4) view‚ode deleted successfully\n");

664 
	`´štf
("\r\n failedo delete view‚ode(eth4) fromhe db view\n");

667 
	`´štf
("\r\n Deletingƒth5 view‚ode from dmac view\n");

668 
»t_v®
 = 
	`üm_d–_vmpÜt_äom_vmside_pÜtmac_v›w
(
üm_pÜt_hªdË5
,50);

669 if(
»t_v®
==
CRM_SUCCESS
)

670 
	`´štf
("\r\n vm…ort(eth5) view‚ode deleted successfully\n");

672 
	`´štf
("\r\n failedo delete view‚ode(eth5) fromhe db view\n");

673 
	`´štf
("\r\n Deletingƒth5 view‚ode from swname view\n");

674 
»t_v®
 = 
	`üm_d–_vmpÜt_äom_vmside_swÇme_v›w
(
üm_pÜt_hªdË5
,50);

675 if(
»t_v®
==
CRM_SUCCESS
)

676 
	`´štf
("\r\n vm…ort(eth5) view‚ode deleted successfully\n");

678 
	`´štf
("\r\n failedo delete view‚ode(eth5) fromhe db view\n");

680 
	`´štf
("####################################################\n");

682 
	}
}

684 
št32_t
 
	$üm_vmpÜt_‹¡
()

686 
št32_t
 
»t_v®
;

687 
ušt8_t
 
vm_pÜt_mac
[6];

688 
mac_buf
[20];

690 
	`´štf
("\r\n*********************************************************************\n");

691 
	`´štf
("\r\n CRM Virtual Network VM Port Test Begins\n");

692 
	`´štf
("\r\n*********************************************************************\n");

694 
	`´štf
("\r\n Adding virtual‚etwork vmporto DB = (eth1)\n");

695 
	`¡rıy
(
mac_buf
,"11:11:11:11:11:11");

696 
	`of_æow_m©ch_©ox_mac_addr
(
mac_buf
,
vm_pÜt_mac
);

698 
»t_v®
 = 
	`üm_add_üm_vmpÜt
("‘h1","SWITCH-1","dp1",
VM_PORT
,"VN1","VM1",
vm_pÜt_mac
,&
üm_pÜt_hªdË1
);

699 if(
»t_v®
 =ğ
CRM_SUCCESS
)

701 
	`´štf
("\r\n vmport(eth1)‡dded successfully\n");

702 
	`´štf
("\r\n crm virtual‚etwork vm…ort(eth1) dmac viewest begins\n");

703 
»t_v®
 = 
	`tsc_vxn_add_vmpÜt_to_pÜtmac_v›w
(
üm_pÜt_hªdË1
,10);

704 if(
»t_v®
==
CRM_SUCCESS
)

705 
	`´štf
("\r\n vm…ort(eth1) view‚ode‡dded successfully\n");

707 
	`´štf
("\r\n failedo‡dd view‚ode(eth1)ohe db view\n");

710 
	`´štf
("\r\n crm virtual‚etwork vm…ort(eth1) switch‚ame viewest begins\n");

711 
»t_v®
 = 
	`üm_add_vmpÜt_to_vmside_swÇme_v›w
(
üm_pÜt_hªdË1
,10);

712 if(
»t_v®
==
CRM_SUCCESS
)

713 
	`´štf
("\r\n vm…ort(eth1) view‚ode‡dded successfully\n");

715 
	`´štf
("\r\n failedo‡dd view‚ode(eth1)ohe db view\n");

719 
	`´štf
("\r\n Failedo‡dd vmport(eth1)\n");

724 
	`´štf
("\r\n Adding virtual‚etwork vmporto DB = (eth2)\n");

725 
	`¡rıy
(
mac_buf
,"22:22:22:22:22:22");

726 
	`of_æow_m©ch_©ox_mac_addr
(
mac_buf
,
vm_pÜt_mac
);

727 
»t_v®
 = 
	`üm_addh_üm_vmpÜt
("‘h2","SWITCH-1","dp1",
VM_PORT
,"VN1","VM1",
vm_pÜt_mac
,&
üm_pÜt_hªdË2
);

728 if(
»t_v®
 =ğ
CRM_SUCCESS
)

730 
	`´štf
("\r\n vmport(eth2)‡dded successfully\n");

731 
	`´štf
("\r\n CRM Virtual Network VM PORT(eth2) DMAC VIEWest begins\n");

732 
»t_v®
 = 
	`tsc_vxn_add_vmpÜt_to_pÜtmac_v›w
(
üm_pÜt_hªdË2
,20);

733 if(
»t_v®
==
CRM_SUCCESS
)

734 
	`´štf
("\r\n vm…ort(eth2) view‚ode‡dded successfully\n");

736 
	`´štf
("\r\n failedo‡dd view‚ode(eth2)ohe db view\n");

738 
	`´štf
("\r\n CRM Virtual Network VM PORT(eth2) SWITCH NAME VIEWest begins\n");

739 
»t_v®
 = 
	`üm_add_vmpÜt_to_vmside_swÇme_v›w
(
üm_pÜt_hªdË2
,20);

740 if(
»t_v®
==
CRM_SUCCESS
)

741 
	`´štf
("\r\n vm…ort(eth2) view‚ode‡dded successfully\n");

743 
	`´štf
("\r\n failedo‡dd view‚ode(eth2)ohe db view\n");

746 
	`´štf
("\r\n Failedo‡dd vmport(eth2)\n");

750 
	`´štf
("\r\n Adding virtual‚etwork vmporto DB = (eth3)\n");

751 
	`¡rıy
(
mac_buf
,"33:33:33:33:33:33");

752 
	`of_æow_m©ch_©ox_mac_addr
(
mac_buf
,
vm_pÜt_mac
);

753 
»t_v®
 = 
	`üm_add_üm_vmpÜt
("‘h3","SWITCH-1","dp1",
VM_PORT
, "VN1","VM1",
vm_pÜt_mac
,&
üm_pÜt_hªdË3
);

754 if(
»t_v®
 =ğ
CRM_SUCCESS
)

756 
	`´štf
("\r\n vmport(eth3)‡dded successfully\n");

757 
	`´štf
("\r\n CRM Virtual Network VM PORT(eth3) DMAC VIEWest begins\n");

758 
»t_v®
 = 
	`tsc_vxn_add_vmpÜt_to_pÜtmac_v›w
(
üm_pÜt_hªdË3
,30);

759 if(
»t_v®
==
CRM_SUCCESS
)

760 
	`´štf
("\r\n vm…ort(eth3) view‚ode‡dded successfully\n");

762 
	`´štf
("\r\n failedo‡dd view‚ode(eth3)ohe db view\n");

764 
	`´štf
("\r\n CRM Virtual Network VM PORT(eth3) SWITCH NAME VIEWest begins\n");

765 
»t_v®
 = 
	`üm_add_vmpÜt_to_vmside_swÇme_v›w
(
üm_pÜt_hªdË3
,30);

766 if(
»t_v®
==
CRM_SUCCESS
)

767 
	`´štf
("\r\n vm…ort(eth3) view‚ode‡dded successfully\n");

769 
	`´štf
("\r\n failedo‡dd view‚ode(eth3)ohe db view\n");

772 
	`´štf
("\r\n Failedo‡dd vmport(eth3)\n");

774 
	`´štf
("\r\n Adding virtual‚etwork vmporto DB = (eth4)\n");

775 
	`¡rıy
(
mac_buf
,"44:44:44:44:44:44");

776 
	`of_æow_m©ch_©ox_mac_addr
(
mac_buf
,
vm_pÜt_mac
);

777 
»t_v®
 = 
	`üm_add_üm_vmpÜt
("‘h4","SWITCH-1","dp1",
VM_PORT
, "VN1","VM1",
vm_pÜt_mac
,&
üm_pÜt_hªdË4
);

778 if(
»t_v®
 =ğ
CRM_SUCCESS
)

780 
	`´štf
("\r\n vmport(eth4)‡dded successfully\n");

781 
	`´štf
("\r\n CRM Virtual Network VM PORT(eth4) DMAC VIEWest begins\n");

782 
»t_v®
 = 
	`tsc_vxn_add_vmpÜt_to_pÜtmac_v›w
(
üm_pÜt_hªdË4
,40);

783 if(
»t_v®
==
CRM_SUCCESS
)

784 
	`´štf
("\r\n vm…ort view‚ode(eth4)‡dded successfully\n");

786 
	`´štf
("\r\n failedo‡dd view‚ode(eth4)ohe db view\n");

789 
	`´štf
("\r\n CRM Virtual Network VM PORT(eth4) SWITCH NAME VIEWest begins\n");

790 
»t_v®
 = 
	`üm_add_vmpÜt_to_vmside_swÇme_v›w
(
üm_pÜt_hªdË4
,40);

791 if(
»t_v®
==
CRM_SUCCESS
)

792 
	`´štf
("\r\n vm…ort(eth4) view‚ode‡dded successfully\n");

794 
	`´štf
("\r\n failedo‡dd view‚ode(eth4)ohe db view\n");

798 
	`´štf
("\r\n Failedo‡dd vmport(eth4)\n");

804 
	`´štf
("\r\n Adding virtual‚etwork vmporto DB = (eth5)\n");

805 
	`¡rıy
(
mac_buf
,"55:55:55:55:55:55");

806 
	`of_æow_m©ch_©ox_mac_addr
(
mac_buf
,
vm_pÜt_mac
);

807 
»t_v®
 = 
	`üm_add_üm_vmpÜt
("‘h5","SWITCH-1","dp1",
VM_PORT
, "VN1","VM1",
vm_pÜt_mac
,&
üm_pÜt_hªdË5
);

808 if(
»t_v®
 =ğ
CRM_SUCCESS
)

810 
	`´štf
("\r\n vmport(eth5)‡dded successfully\n");

811 
	`´štf
("\r\n CRM Virtual Network VM PORT(eth5) DMAC VIEWest begins\n");

812 
»t_v®
 = 
	`tsc_vxn_add_vmpÜt_to_pÜtmac_v›w
(
üm_pÜt_hªdË5
,50);

813 if(
»t_v®
==
CRM_SUCCESS
)

814 
	`´štf
("\r\n vm…ort view‚ode(eth5)‡dded successfully\n");

816 
	`´štf
("\r\n failedo‡dd view‚ode(eth5)ohe db view\n");

817 
	`´štf
("\r\n CRM Virtual Network VM PORT(eth5) SWITCH NAME VIEWest begins\n");

818 
»t_v®
 = 
	`üm_add_vmpÜt_to_vmside_swÇme_v›w
(
üm_pÜt_hªdË5
,50);

819 if(
»t_v®
==
CRM_SUCCESS
)

820 
	`´štf
("\r\n vm…ort(eth5) view‚ode‡dded successfully\n");

822 
	`´štf
("\r\n failedo‡dd view‚ode(eth5)ohe db view\n");

826 
	`´štf
("\r\n Failedo‡dd vmport(eth5)\n");

828 
	}
}

829 
št32_t
 
	$üm_g‘_vmpÜt_v›w_db
()

831 
üm_pÜt
 *
üm_pÜt_node_p1
=
NULL
;

832 
üm_pÜt
 *
üm_pÜt_node_p2
=
NULL
;

833 
üm_pÜt
 *
üm_pÜt_node_p3
=
NULL
;

834 
üm_pÜt
 *
üm_pÜt_node_p4
=
NULL
;

835 
üm_pÜt
 *
üm_pÜt_node_p5
=
NULL
;

836 
üm_pÜt
 *
üm_pÜt_node_p6
=
NULL
;

837 
ušt8_t
 
vm_pÜt_mac
[6];

838 
št32_t
 
»t_v®
;

839 
ušt8_t
 
no_of_vmside_pÜts
;

840 
št32_t
 
vmside_pÜts_id
[100];

841 
mac_buf
[20];

843 
	`´štf
("\r\n*********************************************************************\n");

844 
	`´štf
("\r\n CRM Virtual Network get vm…ort viewest begins\n");

845 
	`´štf
("\r\n*********************************************************************\n");

848 
	`¡rıy
(
mac_buf
,"11:11:11:11:11:11");

849 
	`of_æow_m©ch_©ox_mac_addr
(
mac_buf
,
vm_pÜt_mac
);

850 
	`´štf
("\r\n*********************************************************************\n");

851 
	`´štf
("\r\n CRM Virtual Network get view‚ode from dmac view(11:11:11:11:11:11,10)\n");

852 
»t_v®
 = 
	`tsc_vxn_g‘_vmpÜt_by_dmac_nid
(
vm_pÜt_mac
,10, &
üm_pÜt_node_p1
);

853 if(
»t_v®
==
CRM_SUCCESS
)

855 
	`´štf
Ğ"pÜt_Çme:%s,pÜt_ty³:%d,vm_Çme:%s,br_Çme:%s,pÜtId:%d\n",
üm_pÜt_node_p1
->
pÜt_Çme
,üm_pÜt_node_p1->
üm_pÜt_ty³
,üm_pÜt_node_p1->
vmInfo
.
vm_Çme
,üm_pÜt_node_p1->
br1_Çme
,üm_pÜt_node_p1->
pÜt_id
);

859 
	`´štf
("\r\n failedo get view‚ode fromhe dmac view(11:11:11:11:11:11,10)\n");

860 
	`´štf
("\r\n CRM Virtual Network get view‚ode from swname-vni view(SWITCH-1,10)\n");

861 
no_of_vmside_pÜts
=10;

862 
»t_v®
 = 
	`üm_g‘_vxn_vmpÜts_by_swÇme_vni
("SWITCH-1",10, &
no_of_vmside_pÜts
, &
vmside_pÜts_id
);

863 if(
»t_v®
==
CRM_SUCCESS
)

865 
	`´štf
Ğ"no_of_vmside_pÜts:%d,vmside_pÜts_id[0]:%d\r\n",
no_of_vmside_pÜts
,
vmside_pÜts_id
[0]);

869 
	`´štf
("\r\n failedo get view‚ode fromhe dmac view(SWITCH-1,10)\n");

871 
	`´štf
("\r\n*********************************************************************\n");

872 
	`¡rıy
(
mac_buf
,"22:22:22:22:22:22");

873 
	`of_æow_m©ch_©ox_mac_addr
(
mac_buf
,
vm_pÜt_mac
);

874 
	`´štf
("\r\n CRM Virtual Network get view‚ode from dmac view (22:22:22:22:22:22,20)\n");

875 
»t_v®
 = 
	`tsc_vxn_g‘_vmpÜt_by_dmac_nid
(
vm_pÜt_mac
,20, &
üm_pÜt_node_p2
);

876 if(
»t_v®
==
CRM_SUCCESS
)

879 
	`´štf
Ğ"pÜt_Çme:%s,pÜt_ty³:%d,vm_Çme:%s,br_Çme:%s,pÜtId:%d",
üm_pÜt_node_p2
->
pÜt_Çme
,üm_pÜt_node_p2->
üm_pÜt_ty³
,üm_pÜt_node_p2->
vmInfo
.
vm_Çme
,üm_pÜt_node_p2->
br1_Çme
,üm_pÜt_node_p2->
pÜt_id
);

882 
	`´štf
("\r\n failedo get view‚ode fromhe dmac view(22:22:22:22:22:22,20)\n");

884 
	`´štf
("\r\n CRM Virtual Network get view‚ode from swname-vni view(SWITCH-1,20)\n");

885 
no_of_vmside_pÜts
=1;

886 
»t_v®
 = 
	`üm_g‘_vxn_vmpÜts_by_swÇme_vni
("SWITCH-1",20, &
no_of_vmside_pÜts
,
vmside_pÜts_id
);

887 if(
»t_v®
==
CRM_SUCCESS
)

889 
	`´štf
Ğ"no_of_vmside_pÜts:%d,vmside_pÜts_id[0]:%d",
no_of_vmside_pÜts
,
vmside_pÜts_id
[0]);

893 
	`´štf
("\r\n failedo get view‚ode fromhe dmac view(SWITCH-1,20)\n");

895 
	`´štf
("\r\n*********************************************************************\n");

896 
	`¡rıy
(
mac_buf
,"33:33:33:33:33:33");

897 
	`of_æow_m©ch_©ox_mac_addr
(
mac_buf
,
vm_pÜt_mac
);

898 
	`´štf
("\r\n CRM Virtual Network get view‚ode from dmac view (33:33:33:33:33:33,30)\n");

899 
»t_v®
 = 
	`tsc_vxn_g‘_vmpÜt_by_dmac_nid
(
vm_pÜt_mac
,30, &
üm_pÜt_node_p3
);

900 if(
»t_v®
==
CRM_SUCCESS
)

903 
	`´štf
Ğ"pÜt_Çme:%s,pÜt_ty³:%d,vm_Çme:%s,br_Çme:%s,pÜtId:%d",
üm_pÜt_node_p3
->
pÜt_Çme
,üm_pÜt_node_p3->
üm_pÜt_ty³
,üm_pÜt_node_p3->
vmInfo
.
vm_Çme
,üm_pÜt_node_p3->
br1_Çme
,üm_pÜt_node_p3->
pÜt_id
);

906 
	`´štf
("\r\n failedo get view‚ode fromhe dmac view(33:33:33:33:33:33,30)\n");

907 
	`´štf
("\r\n CRM Virtual Network get view‚ode from swname-vni view(SWITCH-1,30)\n");

908 
no_of_vmside_pÜts
=1;

909 
»t_v®
 = 
	`üm_g‘_vxn_vmpÜts_by_swÇme_vni
("SWITCH-1",30, &
no_of_vmside_pÜts
,
vmside_pÜts_id
);

910 if(
»t_v®
==
CRM_SUCCESS
)

912 
	`´štf
Ğ"no_of_vmside_pÜts:%d,vmside_pÜts_id[0]:%d",
no_of_vmside_pÜts
,
vmside_pÜts_id
[0]);

916 
	`´štf
("\r\n failedo get view‚ode fromhe dmac view(SWITCH-1,30)\n");

918 
	`´štf
("\r\n*********************************************************************\n");

919 
	`¡rıy
(
mac_buf
,"44:44:44:44:44:44");

920 
	`of_æow_m©ch_©ox_mac_addr
(
mac_buf
,
vm_pÜt_mac
);

921 
	`´štf
("\r\n CRM Virtual Network get view‚ode from dmac view (44:44:44:44:44:44,40)\n");

922 
»t_v®
 = 
	`tsc_vxn_g‘_vmpÜt_by_dmac_nid
(
vm_pÜt_mac
,40, &
üm_pÜt_node_p4
);

923 if(
»t_v®
==
CRM_SUCCESS
)

925 
	`´štf
Ğ"pÜt_Çme:%s,pÜt_ty³:%d,vm_Çme:%s,br_Çme:%s,pÜtId:%d",
üm_pÜt_node_p4
->
pÜt_Çme
,üm_pÜt_node_p4->
üm_pÜt_ty³
,üm_pÜt_node_p4->
vmInfo
.
vm_Çme
,üm_pÜt_node_p4->
br1_Çme
,üm_pÜt_node_p4->
pÜt_id
);

929 
	`´štf
("\r\n failedo get view‚ode fromhe dmac view(44:44:44:44:44:44,40)\n");

931 
	`´štf
("\r\n CRM Virtual Network get view‚ode from swname-vni view(SWITCH-1,40)\n");

932 
no_of_vmside_pÜts
=1;

933 
»t_v®
 = 
	`üm_g‘_vxn_vmpÜts_by_swÇme_vni
("SWITCH-1",40, &
no_of_vmside_pÜts
,
vmside_pÜts_id
);

934 if(
»t_v®
==
CRM_SUCCESS
)

936 
	`´štf
Ğ"no_of_vmside_pÜts:%d,vmside_pÜts_id[0]:%d",
no_of_vmside_pÜts
,
vmside_pÜts_id
[0]);

940 
	`´štf
("\r\n failedo get view‚ode fromhe dmac view(SWITCH-1,40)\n");

943 
	`´štf
("\r\n*********************************************************************\n");

944 
	`¡rıy
(
mac_buf
,"55:55:55:55:55:55");

945 
	`of_æow_m©ch_©ox_mac_addr
(
mac_buf
,
vm_pÜt_mac
);

946 
	`´štf
("\r\n CRM Virtual Network get view‚ode from dmac view (55:55:55:55:55:55,50)\n");

947 
»t_v®
 = 
	`tsc_vxn_g‘_vmpÜt_by_dmac_nid
(
vm_pÜt_mac
,50, &
üm_pÜt_node_p4
);

948 if(
»t_v®
==
CRM_SUCCESS
)

950 
	`´štf
Ğ"pÜt_Çme:%s,pÜt_ty³:%d,vm_Çme:%s,br_Çme:%s,pÜtId:%d",
üm_pÜt_node_p4
->
pÜt_Çme
,üm_pÜt_node_p4->
üm_pÜt_ty³
,üm_pÜt_node_p4->
vmInfo
.
vm_Çme
,üm_pÜt_node_p4->
br1_Çme
,üm_pÜt_node_p4->
pÜt_id
);

954 
	`´štf
("\r\n failedo get view‚ode fromhe dmac view(55:55:55:55:55:55,50)\n");

956 
	`´štf
("\r\n CRM Virtual Network get view‚ode from swname-vni view(SWITCH-1,50)\n");

957 
no_of_vmside_pÜts
=1;

958 
»t_v®
 = 
	`üm_g‘_vxn_vmpÜts_by_swÇme_vni
("SWITCH-1",50, &
no_of_vmside_pÜts
,
vmside_pÜts_id
);

959 if(
»t_v®
==
CRM_SUCCESS
)

961 
	`´štf
Ğ"no_of_vmside_pÜts:%d,vmside_pÜts_id[0]:%d",
no_of_vmside_pÜts
,
vmside_pÜts_id
[0]);

965 
	`´štf
("\r\n failedo get view‚ode fromhe dmac view(SWITCH-1,50)\n");

967 
	`´štf
("\r\n*********************************************************************\n");

968 
	}
}

971 
	$g‘®l_vms
()

973 
št32_t
 
lR‘_v®ue0
;

975 
	`´štf
("\r\n****************************************************************");

976 
	`´štf
("\r\n Get‡llhe VMs\n");

978 
lR‘_v®ue0
 = 
	`üm_g‘_fœ¡_vm
(&
vm_cÚfig_šfo
, &
ruÁime_šfo
, &
vm_hªdË1
);

979 
	`´štüm»tv®ue
(
lR‘_v®ue0
);

980 if(
lR‘_v®ue0
 =ğ
CRM_SUCCESS
)

982 
	`´štv®ues_vm
();

983 
	`´štümhªdË
(
vm_hªdË1
);

985 
lR‘_v®ue0
 = 
CRM_SUCCESS
;lRet_value0 == CRM_SUCCESS;)

987 
	`´štf
("\r\n crmtest - Gethe‚ext Datapath\n");

988 
lR‘_v®ue0
 = 
	`üm_g‘_Ãxt_vm
(&
vm_cÚfig_šfo
, &
ruÁime_šfo
,&
vm_hªdË1
);

989 
	`´štüm»tv®ue
(
lR‘_v®ue0
);

990 if(
lR‘_v®ue0
 =ğ
CRM_SUCCESS
)

992 
	`´štv®ues_vm
();

993 
	`´štümhªdË
(
vm_hªdË1
);

997 if(
lR‘_v®ue0
 =ğ
CRM_ERROR_NO_MORE_ENTRIES
)

999 
	`´štf
("\r\n crmest - No more crms found\n");

1001 if(
lR‘_v®ue0
 =ğ
CRM_ERROR_INVALID_VM_HANDLE
)

1003 
	`´štf
("\r\n crmest - Invalid handle\n");

1008 
	}
}

1011 
	$g‘®l_‹ÇÁs
()

1013 
št32_t
 
lR‘_v®ue0
;

1015 
	`´štf
("\r\n****************************************************************");

1016 
	`´štf
("\r\n Get‡llheenants\n");

1018 
lR‘_v®ue0
 = 
	`üm_g‘_fœ¡_‹ÇÁ
(&
‹ÇÁ_cÚfig_šfo
, &
ruÁime_šfo
, &
‹ÇÁ_hªdË1
);

1019 
	`´štüm»tv®ue
(
lR‘_v®ue0
);

1020 if(
lR‘_v®ue0
 =ğ
CRM_SUCCESS
)

1022 
	`´štv®ues_‹ÇÁ
();

1023 
	`´štümhªdË
(
‹ÇÁ_hªdË1
);

1025 
lR‘_v®ue0
 = 
CRM_SUCCESS
;lRet_value0 == CRM_SUCCESS;)

1027 
	`´štf
("\r\n crmtest - Gethe‚extenant\n");

1028 
lR‘_v®ue0
 = 
	`üm_g‘_Ãxt_‹ÇÁ
(&
‹ÇÁ_cÚfig_šfo
, &
ruÁime_šfo
,&
‹ÇÁ_hªdË1
);

1029 
	`´štüm»tv®ue
(
lR‘_v®ue0
);

1030 if(
lR‘_v®ue0
 =ğ
CRM_SUCCESS
)

1032 
	`´štv®ues_‹ÇÁ
();

1033 
	`´štümhªdË
(
‹ÇÁ_hªdË1
);

1037 if(
lR‘_v®ue0
 =ğ
CRM_ERROR_NO_MORE_ENTRIES
)

1039 
	`´štf
("\r\n crmest - No more crms found\n");

1041 if(
lR‘_v®ue0
 =ğ
CRM_ERROR_INVALID_VM_HANDLE
)

1043 
	`´štf
("\r\n crmest - Invalid handle\n");

1048 
	}
}

	@
1
.
1
/usr/include
11
157
crm_attribute.c
crm_port_api.c
crm_subnet_api.c
crm_tenant_api.c
crm_view_api.c
crm_view_init.c
crm_view_test.c
crm_vm_api.c
crm_vn_api.c
crmapi.c
crmtest.c
